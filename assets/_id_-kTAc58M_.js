import{_ as C}from"./EditProjectListConfig-JqhU7ec1.js";import{_ as v}from"./ProjectCard-B8yjZue4.js";import{_ as w,a6 as P,af as m,Z as o,o as l,N as t,c as y,e as s,R as u,S as f,a9 as L,F as V,X as T,a0 as x,ae as b,f as n,Y as d,T as U,L as p,O as A,i as B,a_ as E,a8 as N,$ as S,n as z,aa as O,W as F,aE as R,U as q,M as j,eG as G}from"./index-CxBwy-Cx.js";import"./VSelect-C6v_9t34.js";import"./VCheckboxBtn-BSY9BYfC.js";import"./VSelectionControl-BDoaeuhK.js";import"https://static.geetest.com/v4/gt4.js";const H={props:{listId:{type:String,required:!0}},components:{EditProjectListConfig:C,ProjectCard:v},setup(){return{localuser:m,getUserAvatar:i=>!i||!i.avatar?"":m.getUserAvatar(i.avatar)}},data(){return{loading:!0,listInfo:{},isOwner:!1,editDialog:!1,error:null}},computed:{hasProjects(){return this.listInfo.projects&&this.listInfo.projects.length>0}},async created(){await this.fetchProjectList()},methods:{async fetchProjectList(){this.loading=!0;try{const a=await P.get(`/projectlist/lists/listid/${this.listId}`);if(a.data.status==="success"){this.listInfo=a.data.data;const i=m.user.value;this.isOwner=i&&i.id===this.listInfo.authorid}else this.$toast.add({severity:"error",summary:"错误",detail:a.data.message||"获取列表失败",life:3e3})}catch(a){console.error("获取列表失败:",a),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},openEditDialog(){this.editDialog=!0},formatDate(a){return a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知"}}},M={class:"d-flex align-center mb-2"},W={class:"text-caption"},X={class:"d-flex flex-wrap"},Y={class:"text-caption mr-4"},Z={class:"text-caption"};function J(a,i,h,g,e,c){const _=v,k=C;return l(),o(q,null,{default:t(()=>[e.loading?(l(),o(u,{key:0},{default:t(()=>[s(f,{class:"text-center",cols:"12"},{default:t(()=>[s(L,{color:"primary",indeterminate:""})]),_:1})]),_:1})):(l(),y(V,{key:1},[s(u,null,{default:t(()=>[s(f,{cols:"12"},{default:t(()=>[s(T,{class:"mb-4"},{default:t(()=>[s(b,{class:"d-flex align-center"},{default:t(()=>[n("span",null,d(e.listInfo.title||"未命名列表"),1),s(U,{color:e.listInfo.state==="public"?"success":"warning",class:"ml-2",size:"small"},{default:t(()=>[p(d(e.listInfo.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),s(A),e.isOwner?(l(),o(B,{key:0,color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:c.openEditDialog},null,8,["onClick"])):x("",!0)]),_:1}),e.listInfo.description?(l(),o(E,{key:0},{default:t(()=>[p(d(e.listInfo.description),1)]),_:1})):x("",!0),s(N,null,{default:t(()=>{var r,I;return[n("div",M,[s(S,{class:"mr-2",size:"24"},{default:t(()=>[s(z,{src:g.getUserAvatar(e.listInfo.author),alt:"用户头像"},null,8,["src"])]),_:1}),n("span",W,d(((r=e.listInfo.author)==null?void 0:r.display_name)||((I=e.listInfo.author)==null?void 0:I.username)||"未知用户"),1)]),n("div",X,[n("span",Y,"创建于: "+d(c.formatDate(e.listInfo.createTime)),1),n("span",Z,"更新于: "+d(c.formatDate(e.listInfo.updateTime)),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),c.hasProjects?(l(),o(u,{key:1},{default:t(()=>[s(f,{cols:"12"},{default:t(()=>[i[2]||(i[2]=n("h3",{class:"text-h6 mb-4"},"项目列表",-1)),s(u,null,{default:t(()=>[(l(!0),y(V,null,F(e.listInfo.projects,r=>(l(),o(f,{key:r.id,cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[s(_,{author:r.author,project:r,"show-author":!0},null,8,["author","project"])]),_:2},1024))),128))]),_:1})]),_:1,__:[2]})]),_:1})):(l(),o(u,{key:0},{default:t(()=>[s(f,{class:"text-center",cols:"12"},{default:t(()=>[s(O,{type:"info",variant:"tonal"},{default:t(()=>i[1]||(i[1]=[p(" 此列表暂无项目 ",-1)])),_:1,__:[1]})]),_:1})]),_:1}))],64)),s(R,{modelValue:e.editDialog,"onUpdate:modelValue":i[0]||(i[0]=r=>e.editDialog=r),"max-width":"600px"},{default:t(()=>[s(k,{callback:c.fetchProjectList,close:()=>e.editDialog=!1,listid:h.listId},null,8,["callback","close","listid"])]),_:1},8,["modelValue"])]),_:1})}const D=w(H,[["render",J],["__scopeId","data-v-5d189164"]]),K={components:{showProjectList:D},data(){return{listId:this.$route.params.id,listTitle:"项目列表"}},async mounted(){try{const a=await G(this.listId);a&&a.title&&(this.listTitle=a.title,this.updatePageTitle())}catch(a){console.error("获取列表信息失败:",a)}},methods:{updatePageTitle(){j({title:this.listTitle})}},setup(){j({title:"项目列表"})}};function Q(a,i,h,g,e,c){const _=D;return l(),o(_,{listId:e.listId},null,8,["listId"])}const rt=w(K,[["render",Q]]);export{rt as default};
