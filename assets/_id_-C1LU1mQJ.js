import{_ as N}from"./ExtensionEditDialog-dfIZLU0H.js";import{_ as F}from"./TimeAgo-nHUMlK0R.js";import{_ as X,c as S,o as u,Z as m,e as s,N as t,a9 as Y,U as C,R as T,S as k,X as g,aY as j,ae as x,L as o,Y as r,a_ as D,T as _,a8 as y,f as l,a0 as v,i as p,O as U,P as b,a5 as Z,$ as I,n as B,aI as H,aE as O,aX as q,a6 as w,M as G,af as A,b9 as J}from"./index-BhZBrlGg.js";import{a as K,V as E}from"./VTimeline-B2dcmHvT.js";import"./ProjectSelector-BTYnMByG.js";import"./VSelect-CWcWmsqs.js";import"./VCheckboxBtn-jKGzOvSv.js";import"./VSelectionControl-Cdx4dl39.js";import"./VRadioGroup-ZofjN44p.js";import"./VSwitch-wS9HwrLL.js";import"https://static.geetest.com/v4/gt4.js";const Q={name:"ExtensionDetail",components:{TimeAgo:F,ExtensionEditDialog:N},data(){return{loading:!0,extension:null,s3BucketUrl:"",showEditDialog:!1,showDeleteDialog:!1,deleteLoading:!1,snackbar:{show:!1,message:"",color:"success"},submitLoading:!1,updateLoading:!1,localuser:A}},async created(){if(A.isLogin.value===!1){this.$router.push("/app/account/login");return}this.s3BucketUrl=J("s3.staticurl"),await this.fetchExtension()},methods:{async fetchExtension(){var i;this.loading=!0;try{const e=this.$route.params.id,V=await w.get(`/extensions/manager/${e}`);V.data.status==="success"?(this.extension=V.data.data,G({title:`${((i=this.extension.project)==null?void 0:i.title)||"扩展"} - ZeroCat`})):this.extension=null}catch(e){console.error("Failed to fetch extension:",e),this.extension=null}finally{this.loading=!1}},async deleteExtension(){if(this.extension){this.deleteLoading=!0;try{const i=await w.delete(`/extensions/manager/${this.extension.id}`);i.data.status==="success"?(this.showMessage("删除扩展成功","success"),this.$router.push("/app/extensions")):this.showMessage(i.data.message||"删除扩展失败","error")}catch(i){console.error("Failed to delete extension:",i),this.showMessage("删除扩展失败","error")}finally{this.deleteLoading=!1,this.showDeleteDialog=!1}}},async submitExtension(){if(this.extension){this.submitLoading=!0;try{const i=await w.post(`/extensions/manager/submit/${this.extension.id}`);i.data.status==="success"?(this.showMessage("推送成功","success"),await this.fetchExtension()):this.showMessage(i.data.message||"推送失败","error")}catch(i){console.error("Failed to submit extension:",i),this.showMessage("推送失败","error")}finally{this.submitLoading=!1}}},async updateToLatestCommit(){if(this.extension){this.updateLoading=!0;try{const i=await w.post(`/extensions/manager/update/${this.extension.id}`);i.data.status==="success"?(this.showMessage("更新成功","success"),await this.fetchExtension()):this.showMessage(i.data.message||"更新失败","error")}catch(i){console.error("Failed to update commit:",i),this.showMessage("更新失败","error")}finally{this.updateLoading=!1}}},getStatusColor(i){return{developing:"primary",pending:"warning",verified:"success",rejected:"error"}[i]||"grey"},getStatusText(i){return{developing:"开发中",pending:"待审核",verified:"上架",rejected:"已拒绝"}[i]||"未知"},showMessage(i,e="success"){this.snackbar={show:!0,message:i,color:e}}}},W={class:"d-flex flex-wrap ga-2"},$={class:"mb-4"},ee={class:"mb-4"},te={class:"d-flex align-center"},se={class:"mb-4"},ne={class:"d-flex align-center"},oe={class:"mb-4"},le={class:"d-flex align-center"},ie={key:0,class:"mb-4"},ae={class:"mb-4"},re={class:"text-caption text-grey mt-1"},de={class:"mb-3"},ue={class:"d-flex flex-wrap ga-2"},me={class:"text-caption text-grey"},pe={class:"text-caption text-grey"},ce={class:"mb-1"};function fe(i,e,V,xe,n,c){const h=F,P=N;return u(),S("div",null,[n.loading?(u(),m(C,{key:0,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:t(()=>[s(Y,{indeterminate:"",size:"64"})]),_:1})):n.extension?(u(),m(C,{key:1},{default:t(()=>[s(T,null,{default:t(()=>[s(k,{cols:"12",lg:"8",md:"8",sm:"12"},{default:t(()=>[s(g,{class:"mb-4",variant:"flat"},{default:t(()=>[s(j,null,{append:t(()=>[s(_,{color:c.getStatusColor(n.extension.status),size:"large",variant:"flat"},{default:t(()=>[o(r(c.getStatusText(n.extension.status)),1)]),_:1},8,["color"])]),default:t(()=>[s(x,null,{default:t(()=>{var a;return[o(r(((a=n.extension.project)==null?void 0:a.title)||"扩展"),1)]}),_:1}),s(D,null,{default:t(()=>{var a;return[o(r(((a=n.extension.project)==null?void 0:a.description)||"扩展"),1)]}),_:1})]),_:1})]),_:1}),s(g,{class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(y,null,{default:t(()=>{var a,d,f,z,L,M;return[l("div",W,[s(p,{color:"primary","prepend-icon":"mdi-pencil",variant:"elevated",onClick:e[0]||(e[0]=R=>n.showEditDialog=!0)},{default:t(()=>e[6]||(e[6]=[o(" 编辑 ",-1)])),_:1,__:[6]}),n.extension.status==="developing"?(u(),m(p,{key:0,color:"success","prepend-icon":"mdi-upload",variant:"elevated",loading:n.submitLoading,onClick:c.submitExtension},{default:t(()=>e[7]||(e[7]=[o(" 推送 ",-1)])),_:1,__:[7]},8,["loading","onClick"])):v("",!0),s(p,{"prepend-icon":"mdi-open-in-new",variant:"outlined",to:`/${(d=(a=n.extension.project)==null?void 0:a.author)==null?void 0:d.username}/${(f=n.extension.project)==null?void 0:f.name}`},{default:t(()=>e[8]||(e[8]=[o(" 查看项目 ",-1)])),_:1,__:[8]},8,["to"]),n.extension.sample_project?(u(),m(p,{key:1,"prepend-icon":"mdi-file-document",variant:"outlined",to:`/${(L=(z=n.extension.sample_project)==null?void 0:z.author)==null?void 0:L.username}/${(M=n.extension.sample_project)==null?void 0:M.name}`},{default:t(()=>e[9]||(e[9]=[o(" 查看示例项目 ",-1)])),_:1,__:[9]},8,["to"])):v("",!0),s(U),s(p,{color:"error","prepend-icon":"mdi-delete",variant:"outlined",onClick:e[1]||(e[1]=R=>n.showDeleteDialog=!0)},{default:t(()=>e[10]||(e[10]=[o(" 删除 ",-1)])),_:1,__:[10]})])]}),_:1})]),_:1}),s(g,{variant:"tonal",border:"",hover:""},{default:t(()=>[s(x,{class:"d-flex align-center"},{default:t(()=>[s(b,{class:"mr-2"},{default:t(()=>e[11]||(e[11]=[o("mdi-information",-1)])),_:1,__:[11]}),e[12]||(e[12]=o(" 扩展信息 ",-1))]),_:1,__:[12]}),s(y,null,{default:t(()=>[s(T,null,{default:t(()=>[s(k,{cols:"12",md:"6"},{default:t(()=>[l("div",$,[e[13]||(e[13]=l("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"分支",-1)),s(_,{"prepend-icon":"mdi-source-branch",variant:"tonal"},{default:t(()=>[o(r(n.extension.branch||"main"),1)]),_:1})]),l("div",ee,[e[15]||(e[15]=l("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"提交ID",-1)),l("div",te,[s(_,{"prepend-icon":"mdi-source-commit",variant:"tonal"},{default:t(()=>{var a;return[o(r(((a=n.extension.commit)==null?void 0:a.substring(0,8))||"latest"),1)]}),_:1}),n.extension.commit&&n.extension.commit!=="latest"?(u(),m(p,{key:0,size:"small",variant:"text","prepend-icon":"mdi-refresh",loading:n.updateLoading,onClick:c.updateToLatestCommit,class:"ml-2"},{default:t(()=>e[14]||(e[14]=[o(" 更新到最新 ",-1)])),_:1,__:[14]},8,["loading","onClick"])):v("",!0)])])]),_:1}),s(k,{cols:"12",md:"6"},{default:t(()=>[l("div",se,[e[17]||(e[17]=l("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"创建时间",-1)),l("div",ne,[s(b,{class:"mr-1",size:"small"},{default:t(()=>e[16]||(e[16]=[o("mdi-clock",-1)])),_:1,__:[16]}),s(h,{date:n.extension.created_at},null,8,["date"])])]),l("div",oe,[e[19]||(e[19]=l("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"更新时间",-1)),l("div",le,[s(b,{class:"mr-1",size:"small"},{default:t(()=>e[18]||(e[18]=[o("mdi-clock",-1)])),_:1,__:[18]}),s(h,{date:n.extension.updated_at},null,8,["date"])])])]),_:1})]),_:1}),s(Z,{class:"my-4"}),n.extension.docs?(u(),S("div",ie,[e[20]||(e[20]=l("div",{class:"text-subtitle-2 text-grey-darken-1 mb-2"},"文档",-1)),s(_,{"prepend-icon":"mdi-book-open-variant",variant:"tonal"},{default:t(()=>[o(r(n.extension.docs),1)]),_:1})])):v("",!0),l("div",ae,[e[21]||(e[21]=l("div",{class:"text-subtitle-2 text-grey-darken-1 mb-2"},"Scratch兼容性",-1)),s(_,{color:n.extension.scratchCompatible?"orange":"grey","prepend-icon":"mdi-puzzle",variant:"tonal"},{default:t(()=>[o(r(n.extension.scratchCompatible?"兼容原版Scratch":"不兼容原版Scratch"),1)]),_:1},8,["color"]),l("p",re,r(n.extension.scratchCompatible?"此扩展可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)])]),_:1})]),_:1})]),_:1}),s(k,{cols:"12",lg:"4",md:"4",sm:"12"},{default:t(()=>{var a;return[n.extension.project?(u(),m(g,{key:0,class:"mb-4",variant:"tonal",border:"",hover:"",to:`/${(a=n.extension.project.author)==null?void 0:a.username}/${n.extension.project.name}`},{default:t(()=>[s(x,{class:"d-flex align-center"},{default:t(()=>[s(b,{class:"mr-2"},{default:t(()=>e[22]||(e[22]=[o("mdi-folder",-1)])),_:1,__:[22]}),e[23]||(e[23]=o(" 项目 ",-1))]),_:1,__:[23]}),s(j,null,{prepend:t(()=>[s(I,null,{default:t(()=>{var d;return[s(B,{src:n.localuser.getUserAvatar((d=n.extension.project.author)==null?void 0:d.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(x,null,{default:t(()=>[o(r(n.extension.project.title),1)]),_:1}),s(D,null,{default:t(()=>{var d,f;return[o("by "+r(((d=n.extension.project.author)==null?void 0:d.display_name)||((f=n.extension.project.author)==null?void 0:f.username)),1)]}),_:1})]),_:1}),s(y,null,{default:t(()=>[l("p",de,r(n.extension.project.description),1),l("div",ue,[s(_,{size:"small",variant:"tonal"},{default:t(()=>[o(r(n.extension.project.type),1)]),_:1}),s(_,{size:"small",variant:"tonal","prepend-icon":"mdi-eye"},{default:t(()=>[o(r(n.extension.project.view_count||0),1)]),_:1}),s(_,{size:"small",variant:"tonal","prepend-icon":"mdi-star"},{default:t(()=>[o(r(n.extension.project.star_count||0),1)]),_:1})])]),_:1})]),_:1},8,["to"])):v("",!0),n.extension.sample_project?(u(),m(g,{key:1,class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(x,{class:"d-flex align-center"},{default:t(()=>[s(b,{class:"mr-2"},{default:t(()=>e[24]||(e[24]=[o("mdi-file-document",-1)])),_:1,__:[24]}),e[25]||(e[25]=o(" 示例项目 ",-1))]),_:1,__:[25]}),s(j,null,{prepend:t(()=>[s(I,null,{default:t(()=>{var d;return[s(B,{src:n.localuser.getUserAvatar((d=n.extension.sample_project.author)==null?void 0:d.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(x,null,{default:t(()=>[o(r(n.extension.sample_project.title),1)]),_:1}),s(D,null,{default:t(()=>{var d,f;return[o("by "+r(((d=n.extension.sample_project.author)==null?void 0:d.display_name)||((f=n.extension.sample_project.author)==null?void 0:f.username)),1)]}),_:1})]),_:1})]),_:1})):v("",!0),s(g,{variant:"tonal",border:"",hover:""},{default:t(()=>[s(x,{class:"d-flex align-center"},{default:t(()=>[s(b,{class:"mr-2"},{default:t(()=>e[26]||(e[26]=[o("mdi-history",-1)])),_:1,__:[26]}),e[27]||(e[27]=o(" 历史 ",-1))]),_:1,__:[27]}),s(y,null,{default:t(()=>[s(K,{density:"compact",side:"end"},{default:t(()=>[s(E,{"dot-color":"primary",size:"small"},{default:t(()=>[e[28]||(e[28]=l("div",{class:"mb-1"},[l("strong",null,"创建时间")],-1)),l("div",me,[s(h,{date:n.extension.created_at},null,8,["date"])])]),_:1,__:[28]}),n.extension.updated_at!==n.extension.created_at?(u(),m(E,{key:0,"dot-color":"warning",size:"small"},{default:t(()=>[e[29]||(e[29]=l("div",{class:"mb-1"},[l("strong",null,"更新时间")],-1)),l("div",pe,[s(h,{date:n.extension.updated_at},null,8,["date"])])]),_:1,__:[29]})):v("",!0),s(E,{"dot-color":c.getStatusColor(n.extension.status),size:"small"},{default:t(()=>[l("div",ce,[l("strong",null,r(c.getStatusText(n.extension.status)),1)]),e[30]||(e[30]=l("div",{class:"text-caption text-grey"}," 状态 ",-1))]),_:1,__:[30]},8,["dot-color"])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1})]),_:1})):(u(),m(C,{key:2,class:"text-center py-8"},{default:t(()=>[s(b,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[31]||(e[31]=[o("mdi-puzzle-remove",-1)])),_:1,__:[31]}),e[33]||(e[33]=l("p",{class:"text-h6 mt-4 text-grey-darken-1"},"扩展详情",-1)),e[34]||(e[34]=l("p",{class:"text-body-2 text-grey"},"扩展详情",-1)),s(p,{class:"mt-4",to:"/app/extensions"},{default:t(()=>e[32]||(e[32]=[o("返回扩展管理",-1)])),_:1,__:[32]})]),_:1,__:[33,34]})),s(P,{modelValue:n.showEditDialog,"onUpdate:modelValue":e[2]||(e[2]=a=>n.showEditDialog=a),extension:n.extension,onUpdated:c.fetchExtension},null,8,["modelValue","extension","onUpdated"]),s(O,{modelValue:n.showDeleteDialog,"onUpdate:modelValue":e[4]||(e[4]=a=>n.showDeleteDialog=a),"max-width":"400"},{default:t(()=>[s(g,null,{default:t(()=>[s(x,null,{default:t(()=>e[35]||(e[35]=[o("删除扩展",-1)])),_:1,__:[35]}),s(y,null,{default:t(()=>{var a,d;return[o(' 确定删除扩展"'+r((d=(a=n.extension)==null?void 0:a.project)==null?void 0:d.title)+'" ',1)]}),_:1}),s(H,null,{default:t(()=>[s(U),s(p,{onClick:e[3]||(e[3]=a=>n.showDeleteDialog=!1)},{default:t(()=>e[36]||(e[36]=[o("取消",-1)])),_:1,__:[36]}),s(p,{color:"error",loading:n.deleteLoading,onClick:c.deleteExtension},{default:t(()=>e[37]||(e[37]=[o(" 删除 ",-1)])),_:1,__:[37]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(q,{modelValue:n.snackbar.show,"onUpdate:modelValue":e[5]||(e[5]=a=>n.snackbar.show=a),color:n.snackbar.color},{default:t(()=>[o(r(n.snackbar.message),1)]),_:1},8,["modelValue","color"])])}const De=X(Q,[["render",fe],["__scopeId","data-v-e047e7f8"]]);export{De as default};
