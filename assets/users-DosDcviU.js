const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RegionSelector-CKUasIpD.js","assets/index-Cq5UgZIy.js","assets/index-CtTLpdc9.css","assets/VSpacer-FaOKtNJ_.js","assets/RegionSelector-IGs0f6Mo.css"])))=>i.map(i=>d[i]);
import{_ as $e,a1 as K,ek as Xe,aa as et,Y as ae,o as F,N as i,e as o,W as z,aN as tt,a9 as ye,L as D,aP as nt,O as ie,X as T,i as j,a0 as Te,a3 as le,aF as ke,ah as ot,ai as ve,V as at,q as ce,T as me,Q as re,R as S,aB as I,f as Y,c as te,$ as ge,S as Fe,Z as Le,n as Ae,aE as De,aA as _e,F as He,U as Pe,ac as it,dG as Ne,el as lt,ap as st,m as We,D as Me,em as rt,aW as Ue,aD as Oe,a5 as ut,bs as dt}from"./index-Cq5UgZIy.js";import{_ as Be}from"./RegionSelector-CKUasIpD.js";import{V as oe}from"./VSelect-BwG6njgE.js";import{V as ct}from"./VTextarea-CFK4GQoy.js";import{V as ne}from"./VSpacer-FaOKtNJ_.js";import{V as ft}from"./VDataTable-CmztA7ym.js";import{V as mt}from"./VSwitch-BDxkTR9g.js";import{g as ze,c as we}from"./_commonjsHelpers-BosuxZz1.js";import{V as gt}from"./VDataTableServer-BLHCUWFX.js";import{V as ht}from"./VTooltip-J98KSPX1.js";import"./VCheckboxBtn-BLgVeXD_.js";import"./VSelectionControl-BFn4kEw3.js";import"./VTable-7i1chsiW.js";import"./filter-BLKSW7-F.js";const pt={name:"UserEditor",components:{RegionSelector:Be},props:{modelValue:{type:Boolean,required:!0},user:{type:Object,required:!0,default:()=>({})}},emits:["update:modelValue","save"],data(){return{tabIndex:1,formValid:!0,saving:!1,showRegionSelector:!1,selectedRegion:null,regionOptions:[],statusOptions:[{text:"活跃",value:"active"},{text:"已暂停",value:"suspended"},{text:"已封禁",value:"banned"},{text:"待验证",value:"pending"}],typeOptions:[{text:"访客",value:"guest"},{text:"普通用户",value:"user"},{text:"管理员",value:"admin"}],sexOptions:[{text:"男",value:"male"},{text:"女",value:"female"},{text:"其他",value:"other"}],contactTypes:[{text:"邮箱",value:"email"},{text:"电话",value:"phone"},{text:"QQ",value:"qq"},{text:"Google",value:"oauth_google"},{text:"GitHub",value:"oauth_github"},{text:"Microsoft",value:"oauth_microsoft"},{text:"40code",value:"oauth_40code"},{text:"LinuxDo",value:"oauth_linuxdo"},{text:"其他",value:"other"}],userData:this.initUserData(),connections:[],loadingConnections:!1,connectionHeaders:[{title:"类型",key:"contact_type",width:"150px"},{title:"验证状态",key:"verified",width:"100px"},{title:"创建时间",key:"created_at",width:"180px"},{title:"操作",key:"actions",width:"100px",sortable:!1}],oauthTypes:[{title:"Google",value:"oauth_google"},{title:"GitHub",value:"oauth_github"},{title:"Microsoft",value:"oauth_microsoft"},{title:"40code",value:"oauth_40code"},{title:"LinuxDo",value:"oauth_linuxdo"},{title:"email",value:"email"},{title:"phone",value:"phone"},{title:"qq",value:"qq"},{title:"other",value:"other"}],connectionDialog:{show:!1,isEdit:!1,valid:!0,saving:!1,data:this.initConnectionData(),infoKeys:[],metadataKeys:[]},deleteConnectionDialog:{show:!1,deleting:!1,connection:null},s3BucketUrl:""}},async created(){try{const e=await Xe(()=>import("./RegionSelector-CKUasIpD.js").then(t=>t.a),__vite__mapDeps([0,1,2,3,4]));this.regionOptions=Object.entries(e.default).map(([t,s])=>({value:t,text:s}))}catch(e){console.error("Error loading region options:",e),this.regionOptions=[]}this.s3BucketUrl=await et("s3.staticurl")},watch:{user:{handler(e){if(!e){this.userData=this.initUserData(),this.selectedRegion=null;return}if(this.userData=this.initUserData(e),e!=null&&e.region){const t=this.getRegionText(e.region);t?this.selectedRegion={value:e.region,text:t}:this.selectedRegion=null}else this.selectedRegion=null;e!=null&&e.id&&this.loadConnections()},immediate:!0}},methods:{initUserData(e={}){return{id:(e==null?void 0:e.id)??null,username:(e==null?void 0:e.username)??"",display_name:(e==null?void 0:e.display_name)??"",status:(e==null?void 0:e.status)??"active",type:(e==null?void 0:e.type)??"user",email:(e==null?void 0:e.email)??"",featured_projects:(e==null?void 0:e.featured_projects)??"",motto:(e==null?void 0:e.motto)??"",bio:(e==null?void 0:e.bio)??"",location:(e==null?void 0:e.location)??"",region:(e==null?void 0:e.region)??"",birthday:(e==null?void 0:e.birthday)??"",sex:(e==null?void 0:e.sex)??"",url:(e==null?void 0:e.url)??"",custom_status:(e==null?void 0:e.custom_status)??{emoji:"",text:""},avatar:(e==null?void 0:e.avatar)??"",featured_projects:(e==null?void 0:e.featured_projects)??[],contacts:((e==null?void 0:e.contacts)??[]).map(t=>({contact_type:(t==null?void 0:t.contact_type)??"",contact_value:(t==null?void 0:t.contact_value)??"",is_primary:(t==null?void 0:t.is_primary)??!1,verified:(t==null?void 0:t.verified)??!1,contact_info:(t==null?void 0:t.contact_info)??"",metadata:(t==null?void 0:t.metadata)??{}}))}},getRegionText(e){if(!e)return"";const t=this.regionOptions.find(s=>s.value===e);return t?t.text:e},addContact(){this.userData.contacts.push({contact_type:"",contact_value:"",is_primary:!1,verified:!1,contact_info:"",metadata:{}})},removeContact(e){this.userData.contacts.splice(e,1)},onRegionSelect(e){this.selectedRegion=e,this.userData.region=e.value,this.showRegionSelector=!1},onRegionClear(){this.selectedRegion=null,this.userData.region=null,this.showRegionSelector=!1},close(){this.$emit("update:modelValue",!1)},async save(){if(this.$refs.editForm.validate()){this.saving=!0;try{await this.$emit("save",this.userData),this.close()}finally{this.saving=!1}}},initConnectionData(){return{contact_type:"",contact_value:"",contact_info:"",metadata:{},verified:!1}},async loadConnections(){if(this.userData.id){this.loadingConnections=!0;try{const{data:e}=await K.get(`/admin/users/${this.userData.id}/connections`);this.connections=e}catch(e){console.error("Error loading connections:",e)}finally{this.loadingConnections=!1}}},showAddConnectionDialog(){this.connectionDialog.isEdit=!1,this.connectionDialog.data=this.initConnectionData(),this.connectionDialog.infoKeys=[],this.connectionDialog.metadataKeys=[],this.connectionDialog.show=!0},editConnection(e){this.connectionDialog.isEdit=!0,this.connectionDialog.data={...e,metadata:{...e.metadata}},this.connectionDialog.metadataKeys=Object.keys(e.metadata||{}),this.connectionDialog.show=!0},addMetadataField(){const e=`field_${this.connectionDialog.metadataKeys.length+1}`;this.$set(this.connectionDialog.data.metadata,e,""),this.connectionDialog.metadataKeys.push(e)},updateMetadataKey(e,t,s){if(s&&s!==t){const c=this.connectionDialog.data.metadata[t];this.$delete(this.connectionDialog.data.metadata,t),this.$set(this.connectionDialog.data.metadata,s,c),this.connectionDialog.metadataKeys[e]=s}},removeMetadataField(e){this.$delete(this.connectionDialog.data.metadata,e);const t=this.connectionDialog.metadataKeys.indexOf(e);t>-1&&this.connectionDialog.metadataKeys.splice(t,1)},async saveConnection(){var e;if((e=this.$refs.connectionForm)!=null&&e.validate()){this.connectionDialog.saving=!0;try{this.connectionDialog.isEdit?await K.put(`/admin/users/${this.userData.id}/connections/${this.connectionDialog.data.contact_id}`,{contact_info:this.connectionDialog.data.contact_info,contact_value:this.connectionDialog.data.contact_value,metadata:this.connectionDialog.data.metadata,contact_type:this.connectionDialog.data.contact_type,verified:this.connectionDialog.data.verified}):await K.post(`/admin/users/${this.userData.id}/connections`,{contact_info:this.connectionDialog.data.contact_info,contact_value:this.connectionDialog.data.contact_value,metadata:this.connectionDialog.data.metadata,contact_type:this.connectionDialog.data.contact_type,verified:this.connectionDialog.data.verified}),await this.loadConnections(),this.connectionDialog.show=!1}catch(t){console.error("Error saving connection:",t)}finally{this.connectionDialog.saving=!1}}},confirmDeleteConnection(e){this.deleteConnectionDialog.connection=e,this.deleteConnectionDialog.show=!0},async deleteConnection(){if(this.deleteConnectionDialog.connection){this.deleteConnectionDialog.deleting=!0;try{await K.delete(`/admin/users/${this.userData.id}/connections/${this.deleteConnectionDialog.connection.contact_id}`),await this.loadConnections(),this.deleteConnectionDialog.show=!1}catch(e){console.error("Error deleting connection:",e)}finally{this.deleteConnectionDialog.deleting=!1}}},getConnectionTypeText(e){const t=this.oauthTypes.find(s=>s.value===e);return t?t.title:e},getConnectionTypeColor(e){return{oauth_google:"red",oauth_github:"grey-darken-3",oauth_microsoft:"blue",oauth_40code:"purple",oauth_linuxdo:"green"}[e]||"grey"}}},vt={class:"d-flex align-center mb-4"},yt={key:0},Dt={key:0},_t={key:1,class:"text-caption"},bt={key:1,class:"text-caption"},Vt={class:"d-flex align-center mb-4"},xt={class:"d-flex align-center mb-4"};function Ct(e,t,s,c,a,d){const y=Be;return F(),ae(_e,{"model-value":s.modelValue,"onUpdate:modelValue":t[28]||(t[28]=n=>e.$emit("update:modelValue",n)),"max-width":"800px",persistent:""},{default:i(()=>[o(z,null,{default:i(()=>[o(tt,null,{append:i(()=>[o(j,{icon:"",onClick:d.close},{default:i(()=>[o(ie,null,{default:i(()=>t[31]||(t[31]=[D("mdi-close")])),_:1,__:[31]})]),_:1},8,["onClick"])]),default:i(()=>[o(ye,{class:"headline"},{default:i(()=>t[29]||(t[29]=[D(" 编辑用户信息 ")])),_:1,__:[29]}),o(nt,null,{default:i(()=>[o(ie,null,{default:i(()=>t[30]||(t[30]=[D("mdi-account")])),_:1,__:[30]}),D(" "+T(a.userData.username),1)]),_:1})]),_:1}),o(Te),o(le,{class:"pt-4"},{default:i(()=>[o(ke,{ref:"editForm",modelValue:a.formValid,"onUpdate:modelValue":t[15]||(t[15]=n=>a.formValid=n)},{default:i(()=>[o(ot,{"model-value":a.tabIndex,"onUpdate:modelValue":t[0]||(t[0]=n=>a.tabIndex=n)},{default:i(()=>[o(ve,{value:1},{default:i(()=>t[32]||(t[32]=[D("个人资料")])),_:1,__:[32]}),o(ve,{value:2},{default:i(()=>t[33]||(t[33]=[D("账户连接")])),_:1,__:[33]}),o(ve,{value:3},{default:i(()=>t[34]||(t[34]=[D("头像设置")])),_:1,__:[34]}),o(ve,{value:4},{default:i(()=>t[35]||(t[35]=[D("数据")])),_:1,__:[35]})]),_:1},8,["model-value"]),o(le,null,{default:i(()=>[o(at,{"model-value":a.tabIndex,"onUpdate:modelValue":t[14]||(t[14]=n=>a.tabIndex=n)},{default:i(()=>[o(ce,{value:0},{default:i(()=>[o(me,null,{default:i(()=>[o(re)]),_:1})]),_:1}),o(ce,{value:1},{default:i(()=>[o(me,null,{default:i(()=>[o(re,null,{default:i(()=>[o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.display_name,"onUpdate:modelValue":t[1]||(t[1]=n=>a.userData.display_name=n),label:"显示名称",rules:[n=>!!n||"显示名称不能为空"],outlined:"",dense:""},null,8,["modelValue","rules"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.username,"onUpdate:modelValue":t[2]||(t[2]=n=>a.userData.username=n),label:"用户名",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(oe,{modelValue:a.userData.status,"onUpdate:modelValue":t[3]||(t[3]=n=>a.userData.status=n),items:a.statusOptions,"item-title":"text","item-value":"value",label:"用户状态",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(oe,{modelValue:a.userData.type,"onUpdate:modelValue":t[4]||(t[4]=n=>a.userData.type=n),items:a.typeOptions,"item-title":"text","item-value":"value",label:"用户类型",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.email,"onUpdate:modelValue":t[5]||(t[5]=n=>a.userData.email=n),label:"邮箱",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.featured_projects,"onUpdate:modelValue":t[6]||(t[6]=n=>a.userData.featured_projects=n),label:"精选项目",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.motto,"onUpdate:modelValue":t[7]||(t[7]=n=>a.userData.motto=n),label:"一句话简介",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.location,"onUpdate:modelValue":t[8]||(t[8]=n=>a.userData.location=n),label:"位置",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{"model-value":a.selectedRegion?a.selectedRegion.text:"",label:"地区",outlined:"",dense:"",readonly:"",onClick:t[9]||(t[9]=n=>a.showRegionSelector=!0)},null,8,["model-value"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(I,{modelValue:a.userData.url,"onUpdate:modelValue":t[10]||(t[10]=n=>a.userData.url=n),label:"个人主页",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),o(S,{cols:"12",sm:"6"},{default:i(()=>[o(oe,{modelValue:a.userData.sex,"onUpdate:modelValue":t[11]||(t[11]=n=>a.userData.sex=n),items:a.sexOptions,"item-title":"text","item-value":"value",label:"性别",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),o(S,{cols:"12"},{default:i(()=>[o(ct,{modelValue:a.userData.bio,"onUpdate:modelValue":t[12]||(t[12]=n=>a.userData.bio=n),label:"个人简介",outlined:"",dense:"",rows:"3",hint:"支持 Markdown 格式","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(ce,{value:2},{default:i(()=>[o(me,null,{default:i(()=>[o(re,null,{default:i(()=>[o(S,{cols:"12"},{default:i(()=>[Y("div",vt,[t[37]||(t[37]=Y("h3",{class:"text-h6"},"连接",-1)),o(ne),o(j,{color:"primary","prepend-icon":"mdi-plus",onClick:d.showAddConnectionDialog},{default:i(()=>t[36]||(t[36]=[D(" 添加连接 ")])),_:1,__:[36]},8,["onClick"])]),o(ft,{headers:a.connectionHeaders,items:a.connections,loading:a.loadingConnections,class:"elevation-1"},{"item.contact_type":i(({item:n})=>[o(Fe,{color:d.getConnectionTypeColor(n.contact_type),size:"small"},{default:i(()=>[D(T(d.getConnectionTypeText(n.contact_type)),1)]),_:2},1032,["color"])]),"item.verified":i(({item:n})=>[o(ie,{color:n.verified?"success":"warning",icon:n.verified?"mdi-check-circle":"mdi-alert-circle"},null,8,["color","icon"]),D(" "+T(n.verified?"已验证":"未验证"),1)]),"item.contact_info":i(({item:n})=>[n.contact_info?(F(),te("div",yt,[n.contact_info.username?(F(),te("div",Dt," 用户名: "+T(n.contact_info.username),1)):ge("",!0),n.contact_info.email?(F(),te("div",_t," 邮箱: "+T(n.contact_info.email),1)):ge("",!0)])):(F(),te("span",bt,"无详细信息"))]),"item.actions":i(({item:n})=>[o(j,{icon:"mdi-pencil",size:"small",class:"mr-2",onClick:m=>d.editConnection(n)},null,8,["onClick"]),o(j,{icon:"mdi-delete",size:"small",color:"error",onClick:m=>d.confirmDeleteConnection(n)},null,8,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),o(ce,{value:3},{default:i(()=>[o(me,null,{default:i(()=>[o(re,{justify:"center",align:"center"},{default:i(()=>[o(S,{cols:"12",class:"text-center"},{default:i(()=>[o(Le,{size:"150",class:"mb-4"},{default:i(()=>[o(Ae,{src:a.s3BucketUrl+"/user/"+a.userData.avatar},null,8,["src"])]),_:1}),Y("div",null,[o(I,{modelValue:a.userData.avatar,"onUpdate:modelValue":t[13]||(t[13]=n=>a.userData.avatar=n),label:"头像图片哈希",outlined:"",dense:"",class:"mt-4"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),o(ce,{value:4},{default:i(()=>[Y("pre",null,T(a.userData),1)]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(Te),o(De,null,{default:i(()=>[o(ne),o(j,{text:"",onClick:d.close},{default:i(()=>t[38]||(t[38]=[D("取消")])),_:1,__:[38]},8,["onClick"]),o(j,{color:"primary",loading:a.saving,disabled:!a.formValid||a.saving,onClick:d.save},{default:i(()=>t[39]||(t[39]=[D(" 保存 ")])),_:1,__:[39]},8,["loading","disabled","onClick"])]),_:1})]),_:1}),o(y,{modelValue:a.showRegionSelector,"onUpdate:modelValue":t[16]||(t[16]=n=>a.showRegionSelector=n),"selected-region":a.selectedRegion,onSelect:d.onRegionSelect,onClear:d.onRegionClear},null,8,["modelValue","selected-region","onSelect","onClear"]),o(_e,{modelValue:a.connectionDialog.show,"onUpdate:modelValue":t[25]||(t[25]=n=>a.connectionDialog.show=n),"max-width":"800px"},{default:i(()=>[o(z,null,{default:i(()=>[o(ye,null,{default:i(()=>[D(T(a.connectionDialog.isEdit?"编辑连接 #"+a.connectionDialog.data.contact_id:"添加新连接"),1)]),_:1}),o(le,null,{default:i(()=>[o(ke,{ref:"connectionForm",modelValue:a.connectionDialog.valid,"onUpdate:modelValue":t[23]||(t[23]=n=>a.connectionDialog.valid=n)},{default:i(()=>[a.connectionDialog.isEdit?ge("",!0):(F(),ae(oe,{key:0,modelValue:a.connectionDialog.data.contact_type,"onUpdate:modelValue":t[17]||(t[17]=n=>a.connectionDialog.data.contact_type=n),items:a.oauthTypes,label:"连接类型",required:"",rules:[n=>!!n||"请选择连接类型"]},null,8,["modelValue","items","rules"])),a.connectionDialog.isEdit?ge("",!0):(F(),ae(I,{key:1,modelValue:a.connectionDialog.data.contact_value,"onUpdate:modelValue":t[18]||(t[18]=n=>a.connectionDialog.data.contact_value=n),label:"提供商用户ID",required:"",rules:[n=>!!n||"请输入提供商用户ID"]},null,8,["modelValue","rules"])),o(z,{class:"mt-4 pa-4",variant:"outlined"},{default:i(()=>[Y("div",Vt,[t[40]||(t[40]=Y("div",{class:"text-subtitle-1"},"连接信息",-1)),o(ne)]),o(I,{modelValue:a.connectionDialog.data.contact_value,"onUpdate:modelValue":t[19]||(t[19]=n=>a.connectionDialog.data.contact_value=n),label:"连接值",outlined:"",dense:""},null,8,["modelValue"]),o(I,{modelValue:a.connectionDialog.data.contact_info,"onUpdate:modelValue":t[20]||(t[20]=n=>a.connectionDialog.data.contact_info=n),label:"随机值",outlined:"",dense:""},null,8,["modelValue"]),o(oe,{modelValue:a.connectionDialog.data.contact_type,"onUpdate:modelValue":t[21]||(t[21]=n=>a.connectionDialog.data.contact_type=n),items:a.oauthTypes,label:"连接类型",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),o(z,{class:"mt-4 pa-4",variant:"outlined"},{default:i(()=>[Y("div",xt,[t[42]||(t[42]=Y("div",{class:"text-subtitle-1"},"元数据",-1)),o(ne),o(j,{color:"primary",size:"small","prepend-icon":"mdi-plus",onClick:d.addMetadataField},{default:i(()=>t[41]||(t[41]=[D(" 添加字段 ")])),_:1,__:[41]},8,["onClick"])]),(F(!0),te(He,null,Pe(a.connectionDialog.data.metadata,(n,m,h)=>(F(),te("div",{key:h,class:"d-flex align-center mb-2 gap-2"},[o(I,{modelValue:a.connectionDialog.metadataKeys[h],"onUpdate:modelValue":[V=>a.connectionDialog.metadataKeys[h]=V,V=>d.updateMetadataKey(h,m,V)],label:"字段名",density:"compact","hide-details":"",class:"flex-grow-0",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),o(I,{modelValue:a.connectionDialog.data.metadata[m],"onUpdate:modelValue":V=>a.connectionDialog.data.metadata[m]=V,label:"值",density:"compact","hide-details":"",class:"flex-grow-1"},null,8,["modelValue","onUpdate:modelValue"]),o(j,{icon:"mdi-delete",color:"error",size:"small",variant:"text",onClick:V=>d.removeMetadataField(m)},null,8,["onClick"])]))),128))]),_:1}),o(mt,{modelValue:a.connectionDialog.data.verified,"onUpdate:modelValue":t[22]||(t[22]=n=>a.connectionDialog.data.verified=n),label:"已验证",color:"success","hide-details":"",class:"mt-4"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(De,null,{default:i(()=>[o(ne),o(j,{text:"",onClick:t[24]||(t[24]=n=>a.connectionDialog.show=!1)},{default:i(()=>t[43]||(t[43]=[D(" 取消 ")])),_:1,__:[43]}),o(j,{color:"primary",loading:a.connectionDialog.saving,disabled:!a.connectionDialog.valid||a.connectionDialog.saving,onClick:d.saveConnection},{default:i(()=>t[44]||(t[44]=[D(" 保存 ")])),_:1,__:[44]},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(_e,{modelValue:a.deleteConnectionDialog.show,"onUpdate:modelValue":t[27]||(t[27]=n=>a.deleteConnectionDialog.show=n),"max-width":"400px"},{default:i(()=>[o(z,null,{default:i(()=>[o(ye,{class:"text-h5 text-error"},{default:i(()=>t[45]||(t[45]=[D(" 确认删除连接 ")])),_:1,__:[45]}),o(le,null,{default:i(()=>{var n;return[D(" 确定要删除这个 "+T(d.getConnectionTypeText((n=a.deleteConnectionDialog.connection)==null?void 0:n.contact_type))+" 连接吗？此操作不可撤销。 ",1)]}),_:1}),o(De,null,{default:i(()=>[o(ne),o(j,{text:"",onClick:t[26]||(t[26]=n=>a.deleteConnectionDialog.show=!1)},{default:i(()=>t[46]||(t[46]=[D(" 取消 ")])),_:1,__:[46]}),o(j,{color:"error",loading:a.deleteConnectionDialog.deleting,onClick:d.deleteConnection},{default:i(()=>t[47]||(t[47]=[D(" 确认删除 ")])),_:1,__:[47]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model-value"])}const qe=$e(pt,[["render",Ct],["__scopeId","data-v-450d53c4"]]);var wt=typeof global=="object"&&global&&global.Object===Object&&global,St=typeof self=="object"&&self&&self.Object===Object&&self,Qe=wt||St||Function("return this")(),be=Qe.Symbol,Ge=Object.prototype,Tt=Ge.hasOwnProperty,kt=Ge.toString,fe=be?be.toStringTag:void 0;function Mt(e){var t=Tt.call(e,fe),s=e[fe];try{e[fe]=void 0;var c=!0}catch{}var a=kt.call(e);return c&&(t?e[fe]=s:delete e[fe]),a}var Ut=Object.prototype,Ot=Ut.toString;function jt(e){return Ot.call(e)}var Yt="[object Null]",Et="[object Undefined]",je=be?be.toStringTag:void 0;function It(e){return e==null?e===void 0?Et:Yt:je&&je in Object(e)?Mt(e):jt(e)}function Rt(e){return e!=null&&typeof e=="object"}var $t="[object Symbol]";function Ft(e){return typeof e=="symbol"||Rt(e)&&It(e)==$t}var Lt=/\s/;function At(e){for(var t=e.length;t--&&Lt.test(e.charAt(t)););return t}var Ht=/^\s+/;function Pt(e){return e&&e.slice(0,At(e)+1).replace(Ht,"")}function Ce(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ye=NaN,Nt=/^[-+]0x[0-9a-f]+$/i,Wt=/^0b[01]+$/i,Bt=/^0o[0-7]+$/i,zt=parseInt;function Ee(e){if(typeof e=="number")return e;if(Ft(e))return Ye;if(Ce(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ce(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Pt(e);var s=Wt.test(e);return s||Bt.test(e)?zt(e.slice(2),s?2:8):Nt.test(e)?Ye:+e}var xe=function(){return Qe.Date.now()},qt="Expected a function",Qt=Math.max,Gt=Math.min;function Ie(e,t,s){var c,a,d,y,n,m,h=0,V=!1,x=!1,L=!0;if(typeof e!="function")throw new TypeError(qt);t=Ee(t)||0,Ce(s)&&(V=!!s.leading,x="maxWait"in s,d=x?Qt(Ee(s.maxWait)||0,t):d,L="trailing"in s?!!s.trailing:L);function k(_){var R=c,A=a;return c=a=void 0,h=_,y=e.apply(A,R),y}function H(_){return h=_,n=setTimeout(N,t),V?k(_):y}function W(_){var R=_-m,A=_-h,J=t-R;return x?Gt(J,d-A):J}function q(_){var R=_-m,A=_-h;return m===void 0||R>=t||R<0||x&&A>=d}function N(){var _=xe();if(q(_))return Q(_);n=setTimeout(N,W(_))}function Q(_){return n=void 0,L&&c?k(_):(c=a=void 0,y)}function Z(){n!==void 0&&clearTimeout(n),h=0,c=m=a=n=void 0}function B(){return n===void 0?y:Q(xe())}function M(){var _=xe(),R=q(_);if(c=arguments,a=this,m=_,R){if(n===void 0)return H(m);if(x)return clearTimeout(n),n=setTimeout(N,t),k(m)}return n===void 0&&(n=setTimeout(N,t)),y}return M.cancel=Z,M.flush=B,M}var Ke={exports:{}};(function(e,t){(function(s,c){e.exports=c()})(we,function(){var s=1e3,c=6e4,a=36e5,d="millisecond",y="second",n="minute",m="hour",h="day",V="week",x="month",L="quarter",k="year",H="date",W="Invalid Date",q=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,N=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Q={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(g){var u=["th","st","nd","rd"],l=g%100;return"["+g+(u[(l-20)%10]||u[l]||u[0])+"]"}},Z=function(g,u,l){var f=String(g);return!f||f.length>=u?g:""+Array(u+1-f.length).join(l)+g},B={s:Z,z:function(g){var u=-g.utcOffset(),l=Math.abs(u),f=Math.floor(l/60),r=l%60;return(u<=0?"+":"-")+Z(f,2,"0")+":"+Z(r,2,"0")},m:function g(u,l){if(u.date()<l.date())return-g(l,u);var f=12*(l.year()-u.year())+(l.month()-u.month()),r=u.clone().add(f,x),p=l-r<0,v=u.clone().add(f+(p?-1:1),x);return+(-(f+(l-r)/(p?r-v:v-r))||0)},a:function(g){return g<0?Math.ceil(g)||0:Math.floor(g)},p:function(g){return{M:x,y:k,w:V,d:h,D:H,h:m,m:n,s:y,ms:d,Q:L}[g]||String(g||"").toLowerCase().replace(/s$/,"")},u:function(g){return g===void 0}},M="en",_={};_[M]=Q;var R="$isDayjsObject",A=function(g){return g instanceof he||!(!g||!g[R])},J=function g(u,l,f){var r;if(!u)return M;if(typeof u=="string"){var p=u.toLowerCase();_[p]&&(r=p),l&&(_[p]=l,r=p);var v=u.split("-");if(!r&&v.length>1)return g(v[0])}else{var C=u.name;_[C]=u,r=C}return!f&&r&&(M=r),r||!f&&M},U=function(g,u){if(A(g))return g.clone();var l=typeof u=="object"?u:{};return l.date=g,l.args=arguments,new he(l)},b=B;b.l=J,b.i=A,b.w=function(g,u){return U(g,{locale:u.$L,utc:u.$u,x:u.$x,$offset:u.$offset})};var he=function(){function g(l){this.$L=J(l.locale,null,!0),this.parse(l),this.$x=this.$x||l.x||{},this[R]=!0}var u=g.prototype;return u.parse=function(l){this.$d=function(f){var r=f.date,p=f.utc;if(r===null)return new Date(NaN);if(b.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var v=r.match(q);if(v){var C=v[2]-1||0,w=(v[7]||"0").substring(0,3);return p?new Date(Date.UTC(v[1],C,v[3]||1,v[4]||0,v[5]||0,v[6]||0,w)):new Date(v[1],C,v[3]||1,v[4]||0,v[5]||0,v[6]||0,w)}}return new Date(r)}(l),this.init()},u.init=function(){var l=this.$d;this.$y=l.getFullYear(),this.$M=l.getMonth(),this.$D=l.getDate(),this.$W=l.getDay(),this.$H=l.getHours(),this.$m=l.getMinutes(),this.$s=l.getSeconds(),this.$ms=l.getMilliseconds()},u.$utils=function(){return b},u.isValid=function(){return this.$d.toString()!==W},u.isSame=function(l,f){var r=U(l);return this.startOf(f)<=r&&r<=this.endOf(f)},u.isAfter=function(l,f){return U(l)<this.startOf(f)},u.isBefore=function(l,f){return this.endOf(f)<U(l)},u.$g=function(l,f,r){return b.u(l)?this[f]:this.set(r,l)},u.unix=function(){return Math.floor(this.valueOf()/1e3)},u.valueOf=function(){return this.$d.getTime()},u.startOf=function(l,f){var r=this,p=!!b.u(f)||f,v=b.p(l),C=function(ee,$){var G=b.w(r.$u?Date.UTC(r.$y,$,ee):new Date(r.$y,$,ee),r);return p?G:G.endOf(h)},w=function(ee,$){return b.w(r.toDate()[ee].apply(r.toDate("s"),(p?[0,0,0,0]:[23,59,59,999]).slice($)),r)},O=this.$W,E=this.$M,P=this.$D,se="set"+(this.$u?"UTC":"");switch(v){case k:return p?C(1,0):C(31,11);case x:return p?C(1,E):C(0,E+1);case V:var X=this.$locale().weekStart||0,ue=(O<X?O+7:O)-X;return C(p?P-ue:P+(6-ue),E);case h:case H:return w(se+"Hours",0);case m:return w(se+"Minutes",1);case n:return w(se+"Seconds",2);case y:return w(se+"Milliseconds",3);default:return this.clone()}},u.endOf=function(l){return this.startOf(l,!1)},u.$set=function(l,f){var r,p=b.p(l),v="set"+(this.$u?"UTC":""),C=(r={},r[h]=v+"Date",r[H]=v+"Date",r[x]=v+"Month",r[k]=v+"FullYear",r[m]=v+"Hours",r[n]=v+"Minutes",r[y]=v+"Seconds",r[d]=v+"Milliseconds",r)[p],w=p===h?this.$D+(f-this.$W):f;if(p===x||p===k){var O=this.clone().set(H,1);O.$d[C](w),O.init(),this.$d=O.set(H,Math.min(this.$D,O.daysInMonth())).$d}else C&&this.$d[C](w);return this.init(),this},u.set=function(l,f){return this.clone().$set(l,f)},u.get=function(l){return this[b.p(l)]()},u.add=function(l,f){var r,p=this;l=Number(l);var v=b.p(f),C=function(E){var P=U(p);return b.w(P.date(P.date()+Math.round(E*l)),p)};if(v===x)return this.set(x,this.$M+l);if(v===k)return this.set(k,this.$y+l);if(v===h)return C(1);if(v===V)return C(7);var w=(r={},r[n]=c,r[m]=a,r[y]=s,r)[v]||1,O=this.$d.getTime()+l*w;return b.w(O,this)},u.subtract=function(l,f){return this.add(-1*l,f)},u.format=function(l){var f=this,r=this.$locale();if(!this.isValid())return r.invalidDate||W;var p=l||"YYYY-MM-DDTHH:mm:ssZ",v=b.z(this),C=this.$H,w=this.$m,O=this.$M,E=r.weekdays,P=r.months,se=r.meridiem,X=function($,G,de,pe){return $&&($[G]||$(f,p))||de[G].slice(0,pe)},ue=function($){return b.s(C%12||12,$,"0")},ee=se||function($,G,de){var pe=$<12?"AM":"PM";return de?pe.toLowerCase():pe};return p.replace(N,function($,G){return G||function(de){switch(de){case"YY":return String(f.$y).slice(-2);case"YYYY":return b.s(f.$y,4,"0");case"M":return O+1;case"MM":return b.s(O+1,2,"0");case"MMM":return X(r.monthsShort,O,P,3);case"MMMM":return X(P,O);case"D":return f.$D;case"DD":return b.s(f.$D,2,"0");case"d":return String(f.$W);case"dd":return X(r.weekdaysMin,f.$W,E,2);case"ddd":return X(r.weekdaysShort,f.$W,E,3);case"dddd":return E[f.$W];case"H":return String(C);case"HH":return b.s(C,2,"0");case"h":return ue(1);case"hh":return ue(2);case"a":return ee(C,w,!0);case"A":return ee(C,w,!1);case"m":return String(w);case"mm":return b.s(w,2,"0");case"s":return String(f.$s);case"ss":return b.s(f.$s,2,"0");case"SSS":return b.s(f.$ms,3,"0");case"Z":return v}return null}($)||v.replace(":","")})},u.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},u.diff=function(l,f,r){var p,v=this,C=b.p(f),w=U(l),O=(w.utcOffset()-this.utcOffset())*c,E=this-w,P=function(){return b.m(v,w)};switch(C){case k:p=P()/12;break;case x:p=P();break;case L:p=P()/3;break;case V:p=(E-O)/6048e5;break;case h:p=(E-O)/864e5;break;case m:p=E/a;break;case n:p=E/c;break;case y:p=E/s;break;default:p=E}return r?p:b.a(p)},u.daysInMonth=function(){return this.endOf(x).$D},u.$locale=function(){return _[this.$L]},u.locale=function(l,f){if(!l)return this.$L;var r=this.clone(),p=J(l,f,!0);return p&&(r.$L=p),r},u.clone=function(){return b.w(this.$d,this)},u.toDate=function(){return new Date(this.valueOf())},u.toJSON=function(){return this.isValid()?this.toISOString():null},u.toISOString=function(){return this.$d.toISOString()},u.toString=function(){return this.$d.toUTCString()},g}(),Se=he.prototype;return U.prototype=Se,[["$ms",d],["$s",y],["$m",n],["$H",m],["$W",h],["$M",x],["$y",k],["$D",H]].forEach(function(g){Se[g[1]]=function(u){return this.$g(u,g[0],g[1])}}),U.extend=function(g,u){return g.$i||(g(u,he,U),g.$i=!0),U},U.locale=J,U.isDayjs=A,U.unix=function(g){return U(1e3*g)},U.en=_[M],U.Ls=_,U.p={},U})})(Ke);var Ze=Ke.exports;const Ve=ze(Ze);var Je={exports:{}};(function(e,t){(function(s,c){e.exports=c()})(we,function(){return function(s,c,a){s=s||{};var d=c.prototype,y={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function n(h,V,x,L){return d.fromToBase(h,V,x,L)}a.en.relativeTime=y,d.fromToBase=function(h,V,x,L,k){for(var H,W,q,N=x.$locale().relativeTime||y,Q=s.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],Z=Q.length,B=0;B<Z;B+=1){var M=Q[B];M.d&&(H=L?a(h).diff(x,M.d,!0):x.diff(h,M.d,!0));var _=(s.rounding||Math.round)(Math.abs(H));if(q=H>0,_<=M.r||!M.r){_<=1&&B>0&&(M=Q[B-1]);var R=N[M.l];k&&(_=k(""+_)),W=typeof R=="string"?R.replace("%d",_):R(_,V,M.l,q);break}}if(V)return W;var A=q?N.future:N.past;return typeof A=="function"?A(W):A.replace("%s",W)},d.to=function(h,V){return n(h,V,this,!0)},d.from=function(h,V){return n(h,V,this)};var m=function(h){return h.$u?a.utc():a()};d.toNow=function(h){return this.to(m(this),h)},d.fromNow=function(h){return this.from(m(this),h)}}})})(Je);var Kt=Je.exports;const Zt=ze(Kt);var Jt={exports:{}};(function(e,t){(function(s,c){e.exports=c(Ze)})(we,function(s){function c(y){return y&&typeof y=="object"&&"default"in y?y:{default:y}}var a=c(s),d={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(y,n){return n==="W"?y+"周":y+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(y,n){var m=100*y+n;return m<600?"凌晨":m<900?"早上":m<1100?"上午":m<1300?"中午":m<1800?"下午":"晚上"}};return a.default.locale(d,null,!0),d})})(Jt);function Xt(e,t){const s=typeof e=="string"?it(e):e,c=en(s,t);return{mounted:c,updated:c,unmounted(a){Ne(null,a)}}}function en(e,t){return function(s,c,a){var x,L,k;const d=typeof t=="function"?t(c):t,y=((x=c.value)==null?void 0:x.text)??c.value??(d==null?void 0:d.text),n=lt(c.value)?c.value:{},m=()=>y??s.textContent,h=(a.ctx===c.instance.$?(L=tn(a,c.instance.$))==null?void 0:L.provides:(k=a.ctx)==null?void 0:k.provides)??c.instance.$.provides,V=st(e,We(d,n),m);V.appContext=Object.assign(Object.create(null),c.instance.$.appContext,{provides:h}),Ne(V,s)}}function tn(e,t){const s=new Set,c=d=>{var y,n;for(const m of d){if(!m)continue;if(m===e||m.el&&e.el&&m.el===e.el)return!0;s.add(m);let h;if(m.suspense?h=c([m.ssContent]):Array.isArray(m.children)?h=c(m.children):(y=m.component)!=null&&y.vnode&&(h=c([(n=m.component)==null?void 0:n.subTree])),h)return h;s.delete(m)}return!1};if(!c([t.subTree]))return t;const a=Array.from(s).reverse();for(const d of a)if(d.component)return d.component;return t}const Re=Xt(ht,e=>{var t;return{activator:"parent",location:(t=e.arg)==null?void 0:t.replace("-"," "),text:typeof e.value=="boolean"?void 0:e.value}});Ve.extend(Zt);Ve.locale("zh-cn");const nn={name:"UsersAdmin",components:{UserEditor:qe},data:()=>({users:[],total:0,loading:!1,refreshing:!1,options:{page:1,itemsPerPage:10,sortBy:["id"],sortDesc:[!1],groupBy:[],groupDesc:[],multiSort:!1},headers:[{title:"ID",value:"id",width:"80px",sortable:!1},{title:"用户",value:"username",width:"250px",sortable:!1},{title:"邮箱",value:"email",sortable:!1},{title:"状态",value:"status",width:"120px",sortable:!1},{title:"类型",value:"type",width:"120px",sortable:!1},{title:"注册时间",value:"regTime",width:"180px",sortable:!1},{title:"操作",value:"actions",sortable:!1,width:"150px",align:"center"}],searchQuery:"",statusFilter:"",typeFilter:"",statusOptions:[{title:"活跃",value:"active"},{title:"已暂停",value:"suspended"},{title:"已封禁",value:"banned"},{title:"待验证",value:"pending"}],typeOptions:[{title:"访客",value:"guest"},{title:"普通用户",value:"user"},{title:"管理员",value:"administrator"}],sexOptions:[{title:"男",value:"male"},{title:"女",value:"female"},{title:"其他",value:"other"}],contactTypes:[{text:"邮箱",value:"email"},{text:"电话",value:"phone"},{text:"QQ",value:"qq"},{text:"Google",value:"oauth_google"},{text:"GitHub",value:"oauth_github"},{text:"Microsoft",value:"oauth_microsoft"},{text:"40code",value:"oauth_40code"},{text:"LinuxDo",value:"oauth_linuxdo"},{text:"其他",value:"other"}],userStats:[{title:"总用户数",value:0,type:"total",icon:"mdi-account-group"},{title:"活跃用户",value:0,type:"active",icon:"mdi-account-check"}],editDialog:!1,deleteDialog:!1,showRegionSelector:!1,editTabIndex:0,editFormValid:!0,saving:!1,deleting:!1,updatingStatus:!1,deleteConfirmation:"",newStatus:"",selectedRegion:null,selectedUser:null,editedUser:{id:null,username:"",display_name:"",status:"active",type:"user",motto:"",bio:"",location:"",region:"",birthday:"",sex:"",url:"",custom_status:{emoji:"",text:""},avatar:"",featured_projects:[],contacts:[]},snackbar:{show:!1,text:"",color:"success",timeout:3e3}}),computed:{getStatusText(){return e=>{const t=this.statusOptions.find(s=>s.value===e);return t?t.title:e}},getTypeText(){return e=>{const t=this.typeOptions.find(s=>s.value===e);return t?t.title:e}}},created(){this.loadUsers(),this.loadUserStats(),this.debounceSearch=Ie(this.loadUsers,300)},methods:{async loadUsers(){this.loading=!0;try{const e=this.options.sortBy[0]||"id",t=this.options.sortDesc[0]?"desc":"asc",s={page:this.options.page,itemsPerPage:this.options.itemsPerPage,sort_by:e,sort_order:t};this.searchQuery&&(s.search=this.searchQuery),this.statusFilter&&(s.status=this.statusFilter),this.typeFilter&&(s.type=this.typeFilter);const{data:c}=await K.get("/admin/users",{params:s});this.users=c.items.map(a=>({...a,id:a.id,username:a.username,email:a.email||"",status:a.status||"pending",type:a.type||"user",regTime:a.regTime,avatar:a.avatar})),this.total=Number(c.total)}catch(e){this.showError("加载用户列表失败"),console.error("Error loading users:",e)}finally{this.loading=!1}},async loadUserStats(){var e;try{const{data:t}=await K.get("/admin/users/stats/overview");this.userStats[0].value=t.totalUsers,this.userStats[1].value=((e=t.usersByStatus.find(s=>s.status==="active"))==null?void 0:e._count)||0 .filter(s=>["suspended","banned"].includes(s.status)).reduce((s,c)=>s+c._count,0)}catch(t){console.error("Error loading user stats:",t)}},async refreshData(){if(!(this.refreshing||this.loading)){this.refreshing=!0;try{await Promise.all([this.loadUsers(),this.loadUserStats()]),this.showSuccess("数据已更新")}catch(e){this.showError("刷新数据失败"),console.error("Error refreshing data:",e)}finally{this.refreshing=!1}}},editUser(e){this.selectedUser=e,this.editDialog=!0},closeEditDialog(){this.editDialog=!1,this.$nextTick(()=>{this.editedUser={id:null,username:"",display_name:"",status:"active",type:"user",motto:"",bio:"",location:"",region:"",birthday:"",sex:"",url:"",custom_status:{emoji:"",text:""},avatar:"",featured_projects:[],contacts:[]},this.selectedRegion=null,this.editTabIndex=0,this.$refs.editForm&&this.$refs.editForm.reset()})},addContact(){this.editedUser.contacts.push({contact_type:"",contact_value:"",is_primary:!1})},removeContact(e){this.editedUser.contacts.splice(e,1)},async saveUser(e){var t,s;try{const{data:c}=await K.put(`/admin/users/${e.id}`,e),a=this.users.findIndex(d=>d.id===e.id);a!==-1&&(this.users[a]={...this.users[a],...c}),this.showSuccess("用户信息更新成功")}catch(c){throw this.showError(((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.error)||"保存用户信息失败"),console.error("Error saving user:",c),c}},confirmDelete(e){this.selectedUser=e,this.deleteConfirmation="",this.deleteDialog=!0},async deleteUser(){this.deleting=!0;try{await K.delete(`/admin/users/${this.selectedUser.id}`),this.showSuccess("用户删除成功"),this.loadUsers(),this.loadUserStats(),this.deleteDialog=!1}catch(e){this.showError("删除用户失败"),console.error("Error deleting user:",e)}finally{this.deleting=!1}},onRegionSelect(e){this.selectedRegion=e,this.editedUser.region=e.value,this.showRegionSelector=!1},onRegionClear(){this.selectedRegion=null,this.editedUser.region=null,this.showRegionSelector=!1},getRegionText(e){var s;const t=(s=this.regionOptions)==null?void 0:s.find(c=>c.value===e);return t?t.text:e},formatDate(e){return Ve(e).format("YYYY-MM-DD HH:mm:ss")},formatTimeAgo(e){return Ve(e).fromNow()},getStatusColor(e){return{active:"success",suspended:"warning",banned:"error",pending:"info"}[e]||"grey"},getAvatarUrl(e){return e?e.startsWith("http")?e:`/api/avatar/${e}`:"/default-avatar.png"},showSuccess(e){this.snackbar={show:!0,text:e,color:"success",timeout:3e3}},showError(e){this.snackbar={show:!0,text:e,color:"error",timeout:5e3}},showInfo(e){this.snackbar={show:!0,text:e,color:"info",timeout:3e3}}},watch:{searchQuery:Ie(function(){this.loadUsers()},300),statusFilter(){this.loadUsers()},typeFilter(){this.loadUsers()}}},on={class:"users-admin"},an={class:"text-overline mb-2"},ln={class:"text-h4"},sn={class:"d-flex align-center"},rn={class:"font-weight-medium"},un={class:"caption grey--text"},dn={class:"caption grey--text"};function cn(e,t,s,c,a,d){const y=qe;return F(),ae(me,null,{default:i(()=>[Y("div",on,[o(re,{class:"mb-4"},{default:i(()=>[(F(!0),te(He,null,Pe(e.userStats,n=>(F(),ae(S,{key:n.title,cols:"12",sm:"6",md:"3"},{default:i(()=>[o(z,{class:Me(["stat-card",`stat-${n.type}`]),elevation:"2"},{default:i(()=>[o(le,null,{default:i(()=>[Y("div",an,T(n.title),1),Y("div",ln,T(n.value),1),o(ie,{class:"stat-icon",large:""},{default:i(()=>[D(T(n.icon),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),o(z,{class:"mb-4"},{default:i(()=>[o(le,null,{default:i(()=>[o(re,{align:"center"},{default:i(()=>[o(S,{cols:"12",sm:"4"},{default:i(()=>[o(I,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=n=>e.searchQuery=n),label:"搜索用户","prepend-icon":"mdi-magnify",clearable:"",onInput:e.debounceSearch,"hide-details":""},null,8,["modelValue","onInput"])]),_:1}),o(S,{cols:"12",sm:"3"},{default:i(()=>[o(oe,{modelValue:e.statusFilter,"onUpdate:modelValue":t[1]||(t[1]=n=>e.statusFilter=n),items:e.statusOptions,label:"状态过滤","prepend-icon":"mdi-filter",clearable:"",onChange:d.loadUsers,"hide-details":""},null,8,["modelValue","items","onChange"])]),_:1}),o(S,{cols:"12",sm:"3"},{default:i(()=>[o(oe,{modelValue:e.typeFilter,"onUpdate:modelValue":t[2]||(t[2]=n=>e.typeFilter=n),items:e.typeOptions,label:"类型过滤","prepend-icon":"mdi-account-filter",clearable:"",onChange:d.loadUsers,"hide-details":""},null,8,["modelValue","items","onChange"])]),_:1}),o(S,{cols:"12",sm:"2",class:"d-flex justify-end"},{default:i(()=>[o(j,{color:"primary",onClick:d.refreshData,loading:e.refreshing,disabled:e.loading},{default:i(()=>[o(ie,{left:"",class:Me({rotate:e.refreshing})},{default:i(()=>t[11]||(t[11]=[D("mdi-refresh")])),_:1,__:[11]},8,["class"]),t[12]||(t[12]=D(" 刷新 "))]),_:1,__:[12]},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),o(z,null,{default:i(()=>[o(gt,{headers:e.headers,items:e.users,"items-length":e.total,loading:e.loading,"items-per-page":e.options.itemsPerPage,"onUpdate:itemsPerPage":t[3]||(t[3]=n=>e.options.itemsPerPage=n),page:e.options.page,"onUpdate:page":t[4]||(t[4]=n=>e.options.page=n),"onUpdate:options":d.loadUsers,"no-data-text":"暂无数据","no-results-text":"未找到匹配的数据","loading-text":"加载中..."},{"item.username":i(({item:n})=>[Y("div",sn,[o(Le,{size:"32",class:"mr-2"},{default:i(()=>[o(Ae,{src:d.getAvatarUrl(n.avatar),alt:n.username},null,8,["src","alt"])]),_:2},1024),Y("div",null,[Y("div",rn,T(n.username),1),Y("div",un,T(n.display_name),1)])])]),"item.status":i(({item:n})=>[o(Fe,{color:d.getStatusColor(n.status),small:"",class:"status-chip"},{default:i(()=>[D(T(d.getStatusText(n.status)),1)]),_:2},1032,["color"])]),"item.type":i(({item:n})=>[D(T(d.getTypeText(n.type)),1)]),"item.regTime":i(({item:n})=>[Y("div",null,T(d.formatDate(n.regTime)),1),Y("div",dn,T(d.formatTimeAgo(n.regTime)),1)]),"item.actions":i(({item:n})=>[o(rt,{group:""},{default:i(()=>[Ue((F(),ae(j,{icon:"",small:"",class:"action-btn",onClick:Oe(m=>d.editUser(n),["stop"])},{default:i(()=>[o(ie,null,{default:i(()=>t[13]||(t[13]=[D("mdi-pencil")])),_:1,__:[13]})]),_:2},1032,["onClick"])),[[Re,"编辑用户"]]),n.type!=="administrator"?Ue((F(),ae(j,{key:0,icon:"",small:"",class:"action-btn",onClick:Oe(m=>d.confirmDelete(n),["stop"])},{default:i(()=>[o(ie,null,{default:i(()=>t[14]||(t[14]=[D("mdi-delete")])),_:1,__:[14]})]),_:2},1032,["onClick"])),[[Re,"删除用户"]]):ge("",!0)]),_:2},1024)]),_:1},8,["headers","items","items-length","loading","items-per-page","page","onUpdate:options"])]),_:1}),o(y,{modelValue:e.editDialog,"onUpdate:modelValue":t[5]||(t[5]=n=>e.editDialog=n),user:e.selectedUser,onSave:d.saveUser},null,8,["modelValue","user","onSave"]),o(_e,{modelValue:e.deleteDialog,"onUpdate:modelValue":t[8]||(t[8]=n=>e.deleteDialog=n),"max-width":"400px",transition:"dialog-bottom-transition"},{default:i(()=>[o(z,null,{default:i(()=>[o(ye,{class:"headline error--text"},{default:i(()=>t[15]||(t[15]=[D("确认删除")])),_:1,__:[15]}),o(le,{class:"pt-4"},{default:i(()=>[o(ut,{type:"warning",text:"",dense:""},{default:i(()=>{var n;return[t[16]||(t[16]=D(" 此操作将永久删除用户 ")),Y("strong",null,T((n=e.selectedUser)==null?void 0:n.username),1),t[17]||(t[17]=D(" 及其所有相关数据，此操作不可撤销。 "))]}),_:1,__:[16,17]}),o(I,{modelValue:e.deleteConfirmation,"onUpdate:modelValue":t[6]||(t[6]=n=>e.deleteConfirmation=n),label:"请输入用户名以确认删除",rules:[n=>{var m;return!n||n===((m=e.selectedUser)==null?void 0:m.username)||"用户名不匹配"}],outlined:"",dense:"",class:"mt-4"},null,8,["modelValue","rules"])]),_:1}),o(De,null,{default:i(()=>{var n;return[o(ne),o(j,{text:"",onClick:t[7]||(t[7]=m=>e.deleteDialog=!1)},{default:i(()=>t[18]||(t[18]=[D("取消")])),_:1,__:[18]}),o(j,{color:"error",text:"",disabled:e.deleteConfirmation!==((n=e.selectedUser)==null?void 0:n.username),onClick:d.deleteUser,loading:e.deleting},{default:i(()=>t[19]||(t[19]=[D(" 确认删除 ")])),_:1,__:[19]},8,["disabled","onClick","loading"])]}),_:1})]),_:1})]),_:1},8,["modelValue"]),o(dt,{modelValue:e.snackbar.show,"onUpdate:modelValue":t[10]||(t[10]=n=>e.snackbar.show=n),color:e.snackbar.color,timeout:e.snackbar.timeout,top:""},{action:i(({attrs:n})=>[o(j,We({text:""},n,{onClick:t[9]||(t[9]=m=>e.snackbar.show=!1)}),{default:i(()=>t[20]||(t[20]=[D(" 关闭 ")])),_:2,__:[20]},1040)]),default:i(()=>[D(T(e.snackbar.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])])]),_:1})}const Sn=$e(nn,[["render",cn],["__scopeId","data-v-639ba6c2"]]);export{Sn as default};
