import{g as se,p as ue,a as ce,u as de,cd as O,bP as fe,x as v,cr as N,r as F,bq as ve,A as pe,w as me,d as ye,bQ as ge,bR as x,bS as M,e as h,f as p,F as w,bT as he,m as V,D as be,S as ke,br as Ie,bW as De,bX as Ce,az as Fe,bY as we}from"./index-BpIYSfoU.js";function Ve(){function e(u){var l,o;return[...((l=u.dataTransfer)==null?void 0:l.items)??[]].filter(n=>n.kind==="file").map(n=>n.webkitGetAsEntry()).filter(Boolean).length>0||[...((o=u.dataTransfer)==null?void 0:o.files)??[]].length>0}async function r(u){var o,n;const c=[],l=[...((o=u.dataTransfer)==null?void 0:o.items)??[]].filter(i=>i.kind==="file").map(i=>i.webkitGetAsEntry()).filter(Boolean);if(l.length)for(const i of l){const b=await j(i,G(".",i));c.push(...b.map(k=>k.file))}else c.push(...((n=u.dataTransfer)==null?void 0:n.files)??[]);return c}return{handleDrop:r,hasFilesOrFolders:e}}function j(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((u,c)=>{e.isFile?e.file(o=>u([{file:o,path:r}]),c):e.isDirectory&&e.createReader().readEntries(async o=>{const n=[];for(const i of o)n.push(...await j(i,G(r,i)));u(n)})})}function G(e,r){return r.isDirectory?`${e}/${r.name}`:e}const Pe=ue({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...Ce({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>O(e).every(r=>r!=null&&typeof r=="object")},...De({clearable:!0})},"VFileInput"),Ae=se()({name:"VFileInput",inheritAttrs:!1,props:Pe(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,r){let{attrs:u,emit:c,slots:l}=r;const{t:o}=ce(),n=de(e,"modelValue",e.modelValue,t=>O(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:i,focus:b,blur:k}=fe(e),P=v(()=>typeof e.showSize!="boolean"?e.showSize:void 0),S=v(()=>(n.value??[]).reduce((t,a)=>{let{size:f=0}=a;return t+f},0)),R=v(()=>N(S.value,P.value)),I=v(()=>(n.value??[]).map(t=>{const{name:a="",size:f=0}=t;return e.showSize?`${a} (${N(f,P.value)})`:a})),q=v(()=>{var a;const t=((a=n.value)==null?void 0:a.length)??0;return e.showSize?o(e.counterSizeString,t,R.value):o(e.counterString,t)}),A=F(),z=F(),s=F(),L=ve(()=>i.value||e.active),B=v(()=>["plain","underlined"].includes(e.variant)),y=pe(!1),{handleDrop:Q,hasFilesOrFolders:U}=Ve();function D(){var t;s.value!==document.activeElement&&((t=s.value)==null||t.focus()),i.value||b()}function W(t){var a;(a=s.value)==null||a.click()}function X(t){c("mousedown:control",t)}function Y(t){var a;(a=s.value)==null||a.click(),c("click:control",t)}function _(t){t.stopPropagation(),D(),Fe(()=>{n.value=[],we(e["onClick:clear"],t)})}function H(t){t.preventDefault(),t.stopImmediatePropagation(),y.value=!0}function J(t){t.preventDefault(),y.value=!1}async function K(t){if(t.preventDefault(),t.stopImmediatePropagation(),y.value=!1,!s.value||!U(t))return;const a=new DataTransfer;for(const f of await Q(t))a.items.add(f);s.value.files=a.files,s.value.dispatchEvent(new Event("change",{bubbles:!0}))}return me(n,t=>{(!Array.isArray(t)||!t.length)&&s.value&&(s.value.value="")}),ye(()=>{const t=!!(l.counter||e.counter),a=!!(t||l.details),[f,Z]=ge(u),{modelValue:Se,...ee}=x.filterProps(e),te=M.filterProps(e);return h(x,V({ref:A,modelValue:e.multiple?n.value:n.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":y.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":B.value},e.class],style:e.style,"onClick:prepend":W},f,ee,{centerAffix:!B.value,focused:i.value}),{...l,default:C=>{let{id:g,isDisabled:m,isDirty:E,isReadonly:T,isValid:ne,hasDetails:ae}=C;return h(M,V({ref:z,prependIcon:e.prependIcon,onMousedown:X,onClick:Y,"onClick:clear":_,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},te,{id:g.value,active:L.value||E.value,dirty:E.value||e.dirty,disabled:m.value,focused:i.value,details:ae.value,error:ne.value===!1,onDragover:H,onDrop:K}),{...l,default:le=>{var $;let{props:{class:ie,...re}}=le;return p(w,null,[p("input",V({ref:s,type:"file",readonly:T.value,disabled:m.value,multiple:e.multiple,name:e.name,onClick:d=>{d.stopPropagation(),T.value&&d.preventDefault(),D()},onChange:d=>{if(!d.target)return;const oe=d.target;n.value=[...oe.files??[]]},onDragleave:J,onFocus:D,onBlur:k},re,Z),null),p("div",{class:be(ie)},[!!(($=n.value)!=null&&$.length)&&!e.hideInput&&(l.selection?l.selection({fileNames:I.value,totalBytes:S.value,totalBytesReadable:R.value}):e.chips?I.value.map(d=>h(ke,{key:d,size:"small",text:d},null)):I.value.join(", "))])])}})},details:a?C=>{var g,m;return p(w,null,[(g=l.details)==null?void 0:g.call(l,C),t&&p(w,null,[p("span",null,null),h(he,{active:!!((m=n.value)!=null&&m.length),value:q.value,disabled:e.disabled},l.counter)])])}:void 0})}),Ie({},A,z,s)}});export{Ae as V};
