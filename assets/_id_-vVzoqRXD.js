import{_ as G}from"./ProjectSelector-21arCGCH.js";import{_ as W,a1 as C,ab as X,aa as H,Y as c,o as m,N as t,e as s,W as _,a9 as g,L as l,O as x,a3 as b,aF as $,Q as E,R as k,ae as N,aZ as ee,a_ as te,$ as v,af as R,X as d,ag as O,c as w,aB as M,aX as se,i as f,ad as oe,F as le,U as ie,D as ne,f as r,Z as S,n as z,aU as L,aW as D,a5 as ae,aE as Q,aA as Y,a4 as re,T as P,S as V,a0 as de,aT as me,M as ue}from"./index-DnUjCeK2.js";import{V as ce}from"./VSelect-BRjm05sd.js";import{V as pe,a as Z}from"./VRadioGroup-BIXKhVX6.js";import{V as fe}from"./VSwitch-DEw0nSGt.js";import{V as B}from"./VSpacer-BFiVag9N.js";import{_ as q}from"./TimeAgo-BczDTXec.js";import{a as ge,V as U}from"./VTimeline-BE5_9MTG.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-DRO8QGQu.js";import"./VSelectionControl-8vMVl1cT.js";const xe={name:"ExtensionEditDialog",components:{ProjectSelector:G},props:{modelValue:{type:Boolean,default:!1},extension:{type:Object,default:null}},emits:["update:modelValue","updated"],data(){return{formValid:!1,loading:!1,loadingCommits:!1,s3BucketUrl:"",form:{branch:"",commit:"",image:"",samples:null,docs:"",scratchCompatible:!1},useLatestCommit:!0,imageMode:"project",commits:[],branches:[],myProjects:[],selectedSampleProject:null,showProjectSelector:!1}},computed:{dialog:{get(){return this.modelValue},set(i){this.$emit("update:modelValue",i)}},previewImage(){return this.imageMode==="project"?null:this.form.image?this.s3BucketUrl+"/extension/"+this.form.image:null}},watch:{async modelValue(i){i&&this.extension&&await this.initializeForm()},useLatestCommit(i){i?this.form.commit="":this.fetchCommits()}},async created(){this.s3BucketUrl=await H("s3.staticurl"),await this.fetchMyProjects()},methods:{async initializeForm(){this.extension&&(this.form={branch:this.extension.branch||"",commit:this.extension.commit||"",image:this.extension.image||"",samples:this.extension.samples||null,docs:this.extension.docs||"",scratchCompatible:this.extension.scratchCompatible||!1},this.useLatestCommit=!this.extension.commit||this.extension.commit==="latest",this.imageMode=this.extension.image?"custom":"project",this.extension.sample_project&&(this.selectedSampleProject=this.extension.sample_project),await this.fetchBranches())},async fetchMyProjects(){try{const i=await C.get("/searchapi",{params:{search_userid:X.user.value.id,search_state:"public",limit:100}});i.data&&i.data.projects&&(this.myProjects=i.data.projects)}catch(i){console.error("Failed to fetch my projects:",i)}},async fetchBranches(){var i,e;if((e=(i=this.extension)==null?void 0:i.project)!=null&&e.id)try{const p=await C.get(`/project/branches?projectid=${this.extension.project.id}`);p.data.status==="success"?this.branches=p.data.data||[]:(console.error("加载分支列表失败:",p.data.message),this.branches=[])}catch(p){console.error("Failed to fetch branches:",p),this.branches=[]}},async fetchCommits(){var i,e;if((e=(i=this.extension)==null?void 0:i.project)!=null&&e.id){this.loadingCommits=!0;try{const p=await C.get(`/project/commits?projectid=${this.extension.project.id}&branch=${this.form.branch||"main"}`);p.data.status==="success"?(this.commits=p.data.data||[],this.commits=this.commits.map(y=>({...y,id:y.hash||y.id||"unknown",commit_message:y.message||y.commit_message||"无提交信息",date:y.date||new Date().toISOString(),author:y.author||{username:"未知用户"}}))):(console.error("加载提交历史失败:",p.data.message),this.commits=[])}catch(p){console.error("Failed to fetch commits:",p),this.commits=[]}finally{this.loadingCommits=!1}}},selectCommit(i){this.form.commit=i.id},async onBranchChange(){this.useLatestCommit||await this.fetchCommits()},selectSampleProject(i){this.selectedSampleProject=i,this.form.samples=i.id,this.showProjectSelector=!1},clearSampleProject(){this.selectedSampleProject=null,this.form.samples=null},async saveExtension(){if(this.extension){this.loading=!0;try{const i={...this.form.branch&&{branch:this.form.branch},...this.form.docs&&{docs:this.form.docs},...this.form.scratchCompatible!==void 0&&{scratchCompatible:this.form.scratchCompatible}};this.useLatestCommit?i.commit="latest":this.form.commit&&(i.commit=this.form.commit),this.imageMode==="project"||this.form.image&&(i.image=this.form.image),this.form.samples&&(i.samples=this.form.samples);const e=await C.put(`/extensions/manager/edit/${this.extension.id}`,i);e.data.status==="success"?(this.$emit("updated"),this.closeDialog(),this.showMessage("扩展更新成功","success")):this.showMessage(e.data.message||"更新失败","error")}catch(i){console.error("Failed to update extension:",i),this.showMessage("更新扩展失败","error")}finally{this.loading=!1}}},closeDialog(){this.dialog=!1},showMessage(i,e){console.log(i)}}},_e={key:0,class:"mt-3"},he={class:"d-flex align-center mt-4"},ve={class:"text-caption text-grey"},be={class:"d-flex align-center mb-3"},ye={key:0,class:"selected-project"},Ve={key:1,class:"text-center py-4 text-grey"},Ce={class:"text-caption text-grey"};function ke(i,e,p,y,o,u){const j=G;return m(),c(Y,{modelValue:u.dialog,"onUpdate:modelValue":e[12]||(e[12]=a=>u.dialog=a),"max-width":"800",persistent:""},{default:t(()=>[s(_,null,{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[13]||(e[13]=[l("mdi-pencil",-1)])),_:1,__:[13]}),e[14]||(e[14]=l(" 编辑扩展 ",-1))]),_:1,__:[14]}),s(b,null,{default:t(()=>[s($,{ref:"form",modelValue:o.formValid,"onUpdate:modelValue":e[10]||(e[10]=a=>o.formValid=a)},{default:t(()=>[s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>e[15]||(e[15]=[l("基本信息",-1)])),_:1,__:[15]}),s(b,null,{default:t(()=>[s(E,null,{default:t(()=>[s(k,{cols:"12",md:"6"},{default:t(()=>[s(ce,{modelValue:o.form.branch,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.form.branch=a),u.onBranchChange],label:"分支名称",placeholder:"选择分支","prepend-inner-icon":"mdi-source-branch",variant:"outlined",density:"compact",items:o.branches,"item-title":"name","item-value":"name"},{item:t(({props:a,item:n})=>[s(N,ee(te(a)),{prepend:t(()=>[s(x,{size:"small"},{default:t(()=>e[16]||(e[16]=[l("mdi-source-branch",-1)])),_:1,__:[16]})]),default:t(()=>[s(R,null,{default:t(()=>[l(d(n.raw.name),1)]),_:2},1024),n.raw.description?(m(),c(O,{key:0},{default:t(()=>[l(d(n.raw.description),1)]),_:2},1024)):v("",!0)]),_:2},1040)]),_:1},8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(k,{cols:"12",md:"6"},{default:t(()=>[s(M,{modelValue:o.form.commit,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.commit=a),label:"提交ID",placeholder:"留空或latest使用最新提交","prepend-inner-icon":"mdi-source-commit",variant:"outlined",density:"compact",readonly:o.useLatestCommit},null,8,["modelValue","readonly"]),s(se,{modelValue:o.useLatestCommit,"onUpdate:modelValue":e[4]||(e[4]=a=>o.useLatestCommit=a),class:"mt-2",variant:"outlined",density:"compact",divided:""},{default:t(()=>[s(f,{variant:o.useLatestCommit?"flat":"outlined",color:o.useLatestCommit?"primary":void 0,size:"small",onClick:e[2]||(e[2]=a=>o.useLatestCommit=!0)},{default:t(()=>e[17]||(e[17]=[l(" 最新 ",-1)])),_:1,__:[17]},8,["variant","color"]),s(f,{variant:o.useLatestCommit?"outlined":"flat",color:o.useLatestCommit?void 0:"primary",size:"small",onClick:e[3]||(e[3]=a=>o.useLatestCommit=!1)},{default:t(()=>e[18]||(e[18]=[l(" 指定 ",-1)])),_:1,__:[18]},8,["variant","color"])]),_:1},8,["modelValue"]),!o.useLatestCommit&&o.commits.length>0?(m(),w("div",_e,[s(oe,{density:"compact","max-height":"200",class:"overflow-y-auto",variant:"outlined"},{default:t(()=>[(m(!0),w(le,null,ie(o.commits,a=>(m(),c(N,{key:a.id,onClick:n=>u.selectCommit(a),active:o.form.commit===a.id,class:ne({"v-list-item--active":o.form.commit===a.id})},{prepend:t(()=>[s(x,{size:"small"},{default:t(()=>e[19]||(e[19]=[l("mdi-source-commit",-1)])),_:1,__:[19]})]),default:t(()=>[s(R,{class:"text-caption"},{default:t(()=>[l(d(a.id.substring(0,8)),1)]),_:2},1024),s(O,{class:"text-caption"},{default:t(()=>[l(d(a.commit_message||"无提交信息"),1)]),_:2},1024)]),_:2},1032,["onClick","active","class"]))),128))]),_:1})])):v("",!0),o.useLatestCommit?v("",!0):(m(),c(f,{key:1,variant:"outlined",size:"small",class:"mt-2","prepend-icon":"mdi-refresh",onClick:u.fetchCommits,loading:o.loadingCommits},{default:t(()=>e[20]||(e[20]=[l(" 刷新提交列表 ",-1)])),_:1,__:[20]},8,["onClick","loading"]))]),_:1}),s(k,{cols:"12"},{default:t(()=>[s(M,{modelValue:o.form.docs,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.docs=a),label:"文档路径",placeholder:"/docs/extension","prepend-inner-icon":"mdi-book-open-variant",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>e[21]||(e[21]=[l("扩展图标",-1)])),_:1,__:[21]}),s(b,null,{default:t(()=>[s(pe,{modelValue:o.imageMode,"onUpdate:modelValue":e[6]||(e[6]=a=>o.imageMode=a),inline:""},{default:t(()=>[s(Z,{label:"跟随项目",value:"project"}),s(Z,{label:"自定义图标",value:"custom"})]),_:1},8,["modelValue"]),o.imageMode==="custom"?(m(),c(M,{key:0,modelValue:o.form.image,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.image=a),label:"图标文件名",placeholder:"icon.png","prepend-inner-icon":"mdi-image",variant:"outlined",density:"compact",class:"mt-2"},null,8,["modelValue"])):v("",!0),r("div",he,[s(S,{size:"48",class:"mr-3"},{default:t(()=>[u.previewImage?(m(),c(z,{key:0,src:u.previewImage},null,8,["src"])):(m(),c(x,{key:1,size:"24"},{default:t(()=>e[22]||(e[22]=[l("mdi-puzzle",-1)])),_:1,__:[22]}))]),_:1}),r("div",null,[e[23]||(e[23]=r("div",{class:"text-body-2"},"预览",-1)),r("div",ve,d(o.imageMode==="project"?"使用项目默认图标":o.form.image||"默认图标"),1)])])]),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>e[24]||(e[24]=[l("示例项目",-1)])),_:1,__:[24]}),s(b,null,{default:t(()=>[r("div",be,[s(f,{class:"ml-2",variant:"outlined",onClick:e[8]||(e[8]=a=>o.showProjectSelector=!0)},{default:t(()=>e[25]||(e[25]=[l(" 选择 ",-1)])),_:1,__:[25]})]),o.selectedSampleProject?(m(),w("div",ye,[s(_,{variant:"outlined",class:"mb-2"},{default:t(()=>[s(L,null,{prepend:t(()=>[s(S,null,{default:t(()=>{var a;return[s(z,{src:o.s3BucketUrl+"/user/"+((a=o.selectedSampleProject.author)==null?void 0:a.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(g,{class:"text-subtitle-2"},{default:t(()=>[l(d(o.selectedSampleProject.title),1)]),_:1}),s(D,null,{default:t(()=>{var a,n;return[l("by "+d(((a=o.selectedSampleProject.author)==null?void 0:a.display_name)||((n=o.selectedSampleProject.author)==null?void 0:n.username)),1)]}),_:1})]),_:1})]),_:1}),s(f,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-close",onClick:u.clearSampleProject},{default:t(()=>e[26]||(e[26]=[l(" 移除示例项目 ",-1)])),_:1,__:[26]},8,["onClick"])])):(m(),w("div",Ve,[s(x,{size:"48"},{default:t(()=>e[27]||(e[27]=[l("mdi-file-document-outline",-1)])),_:1,__:[27]}),e[28]||(e[28]=r("p",{class:"mt-2"},"未选择示例项目",-1))]))]),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>[s(x,{class:"mr-2",color:"orange"},{default:t(()=>e[29]||(e[29]=[l("mdi-puzzle",-1)])),_:1,__:[29]}),e[30]||(e[30]=l(" Scratch兼容性 ",-1))]),_:1,__:[30]}),s(b,null,{default:t(()=>[s(ae,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:t(()=>e[31]||(e[31]=[l(" 选择此扩展是否兼容原版Scratch平台。兼容原版Scratch的扩展可以在Scratch项目中使用。 ",-1)])),_:1,__:[31]}),s(fe,{modelValue:o.form.scratchCompatible,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.scratchCompatible=a),label:"兼容原版Scratch",color:"orange","hide-details":"",class:"mb-2"},null,8,["modelValue"]),r("div",Ce,d(o.form.scratchCompatible?"此扩展将可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(Q,null,{default:t(()=>[s(B),s(f,{onClick:u.closeDialog},{default:t(()=>e[32]||(e[32]=[l("取消",-1)])),_:1,__:[32]},8,["onClick"]),s(f,{color:"primary",loading:o.loading,onClick:u.saveExtension},{default:t(()=>e[33]||(e[33]=[l(" 保存 ",-1)])),_:1,__:[33]},8,["loading","onClick"])]),_:1})]),_:1}),s(j,{modelValue:o.showProjectSelector,"onUpdate:modelValue":e[11]||(e[11]=a=>o.showProjectSelector=a),projects:o.myProjects,onSelect:u.selectSampleProject},null,8,["modelValue","projects","onSelect"])]),_:1},8,["modelValue"])}const J=W(xe,[["render",ke],["__scopeId","data-v-bddb61d0"]]),je={name:"ExtensionDetail",components:{TimeAgo:q,ExtensionEditDialog:J},data(){return{loading:!0,extension:null,s3BucketUrl:"",showEditDialog:!1,showDeleteDialog:!1,deleteLoading:!1,snackbar:{show:!1,message:"",color:"success"},submitLoading:!1,updateLoading:!1}},async created(){if(X.isLogin.value===!1){this.$router.push("/app/account/login");return}this.s3BucketUrl=await H("s3.staticurl"),await this.fetchExtension()},methods:{async fetchExtension(){var i;this.loading=!0;try{const e=this.$route.params.id,p=await C.get(`/extensions/manager/${e}`);p.data.status==="success"?(this.extension=p.data.data,ue({title:`${((i=this.extension.project)==null?void 0:i.title)||"扩展"} - ZeroCat`})):this.extension=null}catch(e){console.error("Failed to fetch extension:",e),this.extension=null}finally{this.loading=!1}},async deleteExtension(){if(this.extension){this.deleteLoading=!0;try{const i=await C.delete(`/extensions/manager/${this.extension.id}`);i.data.status==="success"?(this.showMessage("删除扩展成功","success"),this.$router.push("/app/extensions")):this.showMessage(i.data.message||"删除扩展失败","error")}catch(i){console.error("Failed to delete extension:",i),this.showMessage("删除扩展失败","error")}finally{this.deleteLoading=!1,this.showDeleteDialog=!1}}},async submitExtension(){if(this.extension){this.submitLoading=!0;try{const i=await C.post(`/extensions/manager/submit/${this.extension.id}`);i.data.status==="success"?(this.showMessage("推送成功","success"),await this.fetchExtension()):this.showMessage(i.data.message||"推送失败","error")}catch(i){console.error("Failed to submit extension:",i),this.showMessage("推送失败","error")}finally{this.submitLoading=!1}}},async updateToLatestCommit(){if(this.extension){this.updateLoading=!0;try{const i=await C.post(`/extensions/manager/update/${this.extension.id}`);i.data.status==="success"?(this.showMessage("更新成功","success"),await this.fetchExtension()):this.showMessage(i.data.message||"更新失败","error")}catch(i){console.error("Failed to update commit:",i),this.showMessage("更新失败","error")}finally{this.updateLoading=!1}}},getStatusColor(i){return{developing:"primary",pending:"warning",verified:"success",rejected:"error"}[i]||"grey"},getStatusText(i){return{developing:"开发中",pending:"待审核",verified:"已审核",rejected:"已拒绝"}[i]||"未知"},showMessage(i,e="success"){this.snackbar={show:!0,message:i,color:e}}}},we={class:"d-flex flex-wrap ga-2"},Se={class:"mb-4"},ze={class:"mb-4"},Le={class:"d-flex align-center"},De={class:"mb-4"},Me={class:"d-flex align-center"},Pe={class:"mb-4"},Ue={class:"d-flex align-center"},Ee={key:0,class:"mb-4"},Be={class:"mb-4"},Ie={class:"text-caption text-grey mt-1"},Te={class:"mb-3"},Fe={class:"d-flex flex-wrap ga-2"},Ae={class:"text-caption text-grey"},Ne={class:"text-caption text-grey"},Re={class:"mb-1"};function Oe(i,e,p,y,o,u){const j=q,a=J;return m(),w("div",null,[o.loading?(m(),c(P,{key:0,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:t(()=>[s(re,{indeterminate:"",size:"64"})]),_:1})):o.extension?(m(),c(P,{key:1},{default:t(()=>[s(E,null,{default:t(()=>[s(k,{cols:"12",lg:"8",md:"8",sm:"12"},{default:t(()=>[s(_,{class:"mb-4",variant:"flat"},{default:t(()=>[s(L,null,{prepend:t(()=>[s(S,{size:"64"},{default:t(()=>[o.extension.image?(m(),c(z,{key:0,src:o.s3BucketUrl+"/extension/"+o.extension.image},null,8,["src"])):(m(),c(x,{key:1,size:"32"},{default:t(()=>e[6]||(e[6]=[l("mdi-puzzle",-1)])),_:1,__:[6]}))]),_:1})]),append:t(()=>[s(V,{color:u.getStatusColor(o.extension.status),size:"large",variant:"flat"},{default:t(()=>[l(d(u.getStatusText(o.extension.status)),1)]),_:1},8,["color"])]),default:t(()=>[s(g,{class:"text-h4"},{default:t(()=>{var n;return[l(d(((n=o.extension.project)==null?void 0:n.title)||"扩展"),1)]}),_:1}),s(D,{class:"text-h6 mt-2"},{default:t(()=>{var n;return[l(d(((n=o.extension.project)==null?void 0:n.description)||"扩展"),1)]}),_:1})]),_:1})]),_:1}),s(_,{class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(b,null,{default:t(()=>{var n,h,I,T,F,A;return[r("div",we,[s(f,{color:"primary","prepend-icon":"mdi-pencil",variant:"elevated",onClick:e[0]||(e[0]=K=>o.showEditDialog=!0)},{default:t(()=>e[7]||(e[7]=[l(" 编辑 ",-1)])),_:1,__:[7]}),o.extension.status==="developing"?(m(),c(f,{key:0,color:"success","prepend-icon":"mdi-upload",variant:"elevated",loading:o.submitLoading,onClick:u.submitExtension},{default:t(()=>e[8]||(e[8]=[l(" 推送 ",-1)])),_:1,__:[8]},8,["loading","onClick"])):v("",!0),s(f,{"prepend-icon":"mdi-open-in-new",variant:"outlined",to:`/${(h=(n=o.extension.project)==null?void 0:n.author)==null?void 0:h.username}/${(I=o.extension.project)==null?void 0:I.name}`},{default:t(()=>e[9]||(e[9]=[l(" 查看项目 ",-1)])),_:1,__:[9]},8,["to"]),o.extension.sample_project?(m(),c(f,{key:1,"prepend-icon":"mdi-file-document",variant:"outlined",to:`/${(F=(T=o.extension.sample_project)==null?void 0:T.author)==null?void 0:F.username}/${(A=o.extension.sample_project)==null?void 0:A.name}`},{default:t(()=>e[10]||(e[10]=[l(" 查看示例项目 ",-1)])),_:1,__:[10]},8,["to"])):v("",!0),s(B),s(f,{color:"error","prepend-icon":"mdi-delete",variant:"outlined",onClick:e[1]||(e[1]=K=>o.showDeleteDialog=!0)},{default:t(()=>e[11]||(e[11]=[l(" 删除 ",-1)])),_:1,__:[11]})])]}),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[12]||(e[12]=[l("mdi-information",-1)])),_:1,__:[12]}),e[13]||(e[13]=l(" 扩展信息 ",-1))]),_:1,__:[13]}),s(b,null,{default:t(()=>[s(E,null,{default:t(()=>[s(k,{cols:"12",md:"6"},{default:t(()=>[r("div",Se,[e[14]||(e[14]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"分支",-1)),s(V,{"prepend-icon":"mdi-source-branch",variant:"tonal"},{default:t(()=>[l(d(o.extension.branch||"main"),1)]),_:1})]),r("div",ze,[e[16]||(e[16]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"提交ID",-1)),r("div",Le,[s(V,{"prepend-icon":"mdi-source-commit",variant:"tonal"},{default:t(()=>{var n;return[l(d(((n=o.extension.commit)==null?void 0:n.substring(0,8))||"latest"),1)]}),_:1}),o.extension.commit&&o.extension.commit!=="latest"?(m(),c(f,{key:0,size:"small",variant:"text","prepend-icon":"mdi-refresh",loading:o.updateLoading,onClick:u.updateToLatestCommit,class:"ml-2"},{default:t(()=>e[15]||(e[15]=[l(" 更新到最新 ",-1)])),_:1,__:[15]},8,["loading","onClick"])):v("",!0)])])]),_:1}),s(k,{cols:"12",md:"6"},{default:t(()=>[r("div",De,[e[18]||(e[18]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"创建时间",-1)),r("div",Me,[s(x,{class:"mr-1",size:"small"},{default:t(()=>e[17]||(e[17]=[l("mdi-clock",-1)])),_:1,__:[17]}),s(j,{date:o.extension.created_at},null,8,["date"])])]),r("div",Pe,[e[20]||(e[20]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"更新时间",-1)),r("div",Ue,[s(x,{class:"mr-1",size:"small"},{default:t(()=>e[19]||(e[19]=[l("mdi-clock",-1)])),_:1,__:[19]}),s(j,{date:o.extension.updated_at},null,8,["date"])])])]),_:1})]),_:1}),s(de,{class:"my-4"}),o.extension.docs?(m(),w("div",Ee,[e[21]||(e[21]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-2"},"文档",-1)),s(V,{"prepend-icon":"mdi-book-open-variant",variant:"tonal"},{default:t(()=>[l(d(o.extension.docs),1)]),_:1})])):v("",!0),r("div",Be,[e[22]||(e[22]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-2"},"Scratch兼容性",-1)),s(V,{color:o.extension.scratchCompatible?"orange":"grey","prepend-icon":"mdi-puzzle",variant:"tonal"},{default:t(()=>[l(d(o.extension.scratchCompatible?"兼容原版Scratch":"不兼容原版Scratch"),1)]),_:1},8,["color"]),r("p",Ie,d(o.extension.scratchCompatible?"此扩展可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)])]),_:1})]),_:1})]),_:1}),s(k,{cols:"12",lg:"4",md:"4",sm:"12"},{default:t(()=>[o.extension.project?(m(),c(_,{key:0,class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[23]||(e[23]=[l("mdi-folder",-1)])),_:1,__:[23]}),e[24]||(e[24]=l(" 项目 ",-1))]),_:1,__:[24]}),s(L,null,{prepend:t(()=>[s(S,null,{default:t(()=>{var n;return[s(z,{src:o.s3BucketUrl+"/user/"+((n=o.extension.project.author)==null?void 0:n.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(g,null,{default:t(()=>[l(d(o.extension.project.title),1)]),_:1}),s(D,null,{default:t(()=>{var n,h;return[l("by "+d(((n=o.extension.project.author)==null?void 0:n.display_name)||((h=o.extension.project.author)==null?void 0:h.username)),1)]}),_:1})]),_:1}),s(b,null,{default:t(()=>[r("p",Te,d(o.extension.project.description),1),r("div",Fe,[s(V,{size:"small",variant:"tonal"},{default:t(()=>[l(d(o.extension.project.type),1)]),_:1}),s(V,{size:"small",variant:"tonal","prepend-icon":"mdi-eye"},{default:t(()=>[l(d(o.extension.project.view_count||0),1)]),_:1}),s(V,{size:"small",variant:"tonal","prepend-icon":"mdi-star"},{default:t(()=>[l(d(o.extension.project.star_count||0),1)]),_:1})])]),_:1})]),_:1})):v("",!0),o.extension.sample_project?(m(),c(_,{key:1,class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[25]||(e[25]=[l("mdi-file-document",-1)])),_:1,__:[25]}),e[26]||(e[26]=l(" 示例项目 ",-1))]),_:1,__:[26]}),s(L,null,{prepend:t(()=>[s(S,null,{default:t(()=>{var n;return[s(z,{src:o.s3BucketUrl+"/user/"+((n=o.extension.sample_project.author)==null?void 0:n.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(g,null,{default:t(()=>[l(d(o.extension.sample_project.title),1)]),_:1}),s(D,null,{default:t(()=>{var n,h;return[l("by "+d(((n=o.extension.sample_project.author)==null?void 0:n.display_name)||((h=o.extension.sample_project.author)==null?void 0:h.username)),1)]}),_:1})]),_:1})]),_:1})):v("",!0),s(_,{variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[27]||(e[27]=[l("mdi-history",-1)])),_:1,__:[27]}),e[28]||(e[28]=l(" 历史 ",-1))]),_:1,__:[28]}),s(b,null,{default:t(()=>[s(ge,{density:"compact",side:"end"},{default:t(()=>[s(U,{"dot-color":"primary",size:"small"},{default:t(()=>[e[29]||(e[29]=r("div",{class:"mb-1"},[r("strong",null,"创建时间")],-1)),r("div",Ae,[s(j,{date:o.extension.created_at},null,8,["date"])])]),_:1,__:[29]}),o.extension.updated_at!==o.extension.created_at?(m(),c(U,{key:0,"dot-color":"warning",size:"small"},{default:t(()=>[e[30]||(e[30]=r("div",{class:"mb-1"},[r("strong",null,"更新时间")],-1)),r("div",Ne,[s(j,{date:o.extension.updated_at},null,8,["date"])])]),_:1,__:[30]})):v("",!0),s(U,{"dot-color":u.getStatusColor(o.extension.status),size:"small"},{default:t(()=>[r("div",Re,[r("strong",null,d(u.getStatusText(o.extension.status)),1)]),e[31]||(e[31]=r("div",{class:"text-caption text-grey"}," 状态 ",-1))]),_:1,__:[31]},8,["dot-color"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(m(),c(P,{key:2,class:"text-center py-8"},{default:t(()=>[s(x,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[32]||(e[32]=[l("mdi-puzzle-remove",-1)])),_:1,__:[32]}),e[34]||(e[34]=r("p",{class:"text-h6 mt-4 text-grey-darken-1"},"扩展详情",-1)),e[35]||(e[35]=r("p",{class:"text-body-2 text-grey"},"扩展详情",-1)),s(f,{class:"mt-4",to:"/app/extensions"},{default:t(()=>e[33]||(e[33]=[l("返回扩展管理",-1)])),_:1,__:[33]})]),_:1,__:[34,35]})),s(a,{modelValue:o.showEditDialog,"onUpdate:modelValue":e[2]||(e[2]=n=>o.showEditDialog=n),extension:o.extension,onUpdated:u.fetchExtension},null,8,["modelValue","extension","onUpdated"]),s(Y,{modelValue:o.showDeleteDialog,"onUpdate:modelValue":e[4]||(e[4]=n=>o.showDeleteDialog=n),"max-width":"400"},{default:t(()=>[s(_,null,{default:t(()=>[s(g,null,{default:t(()=>e[36]||(e[36]=[l("删除扩展",-1)])),_:1,__:[36]}),s(b,null,{default:t(()=>{var n,h;return[l(' 确定删除扩展"'+d((h=(n=o.extension)==null?void 0:n.project)==null?void 0:h.title)+'" ',1)]}),_:1}),s(Q,null,{default:t(()=>[s(B),s(f,{onClick:e[3]||(e[3]=n=>o.showDeleteDialog=!1)},{default:t(()=>e[37]||(e[37]=[l("取消",-1)])),_:1,__:[37]}),s(f,{color:"error",loading:o.deleteLoading,onClick:u.deleteExtension},{default:t(()=>e[38]||(e[38]=[l(" 删除 ",-1)])),_:1,__:[38]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(me,{modelValue:o.snackbar.show,"onUpdate:modelValue":e[5]||(e[5]=n=>o.snackbar.show=n),color:o.snackbar.color},{default:t(()=>[l(d(o.snackbar.message),1)]),_:1},8,["modelValue","color"])])}const et=W(je,[["render",Oe],["__scopeId","data-v-72524975"]]);export{et as default};
