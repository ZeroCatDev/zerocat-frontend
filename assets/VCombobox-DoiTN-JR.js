import{g as Ne,p as Ke,a as Oe,r as z,A as P,ck as ze,cl as $e,cm as Ue,u as ue,cn as je,co as qe,bw as He,x as V,cp as T,M as E,cq as Ge,w as _,cr as We,cs as ne,ct as Je,d as Qe,aG as oe,e as f,f as R,P as ie,cu as Xe,F as G,aE as Ye,m as I,ai as Ze,aj as se,cv as el,a5 as ll,aT as al,ci as tl,$ as ul,T as re,cw as nl,C as ol,D as il,h as sl,L as rl,bx as cl,by as vl,cx as dl,cy as fl,cz as ml,cA as ce,cB as hl}from"./index-DHBb6a3D.js";import{u as bl,h as gl,m as yl}from"./filter-ffYPmvXQ.js";const pl=Ke({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...yl({filterKeys:["title"]}),...dl({hideNoData:!0,returnObject:!0}),...vl(fl({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VCombobox"),Cl=Ne()({name:"VCombobox",props:pl(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,ve){var Z;let{emit:de,slots:t}=ve;const{t:fe}=Oe(),g=z(),C=P(!1),k=P(!0),$=P(!1),W=z(),B=z(),s=P(-1);let L=!1;const{items:J,transformIn:me,transformOut:he}=ze(l),{textColorClasses:be,textColorStyles:ge}=$e(()=>{var e;return(e=g.value)==null?void 0:e.color}),{InputIcon:ye}=Ue(l),u=ue(l,"modelValue",[],e=>me(je(e)),e=>{const a=he(e);return l.multiple?a:a[0]??null}),S=qe(l),Q=He(()=>l.closableChips&&!S.isReadonly.value&&!S.isDisabled.value),N=V(()=>!!(l.chips||t.chip)),w=V(()=>N.value||!!t.selection),y=P(!l.multiple&&!w.value?((Z=u.value[0])==null?void 0:Z.title)??"":""),A=P(null),d=V({get:()=>y.value,set:async e=>{var a;if(y.value=e??"",e===null||e===""&&!l.multiple&&!w.value?u.value=[]:!l.multiple&&!w.value&&(u.value=[T(l,e)],E(()=>{var o;return(o=B.value)==null?void 0:o.scrollToIndex(0)})),e&&l.multiple&&((a=l.delimiters)!=null&&a.length)){const o=X(e);o.length>1&&(Y(o),y.value="")}e||(s.value=-1),k.value=!e}}),pe=V(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?u.value.length:d.value.length),{filteredItems:U,getMatches:xe}=bl(l,J,()=>A.value??(l.alwaysFilter||!k.value?d.value:"")),D=V(()=>l.hideSelected&&A.value===null?U.value.filter(e=>!u.value.some(a=>a.value===e.value)):U.value),K=V(()=>l.hideNoData&&!D.value.length||S.isReadonly.value||S.isDisabled.value),j=ue(l,"menu"),v=V({get:()=>j.value,set:e=>{var a;j.value&&!e&&((a=W.value)!=null&&a.Î¨openChildren.size)||e&&K.value||(j.value=e)}}),{menuId:Ve,ariaExpanded:Ce,ariaControls:ke}=Ge(l,v);_(y,e=>{L?E(()=>L=!1):C.value&&!v.value&&(v.value=!0),de("update:search",e)}),_(u,e=>{var a;!l.multiple&&!w.value&&(y.value=((a=e[0])==null?void 0:a.title)??"")});const we=V(()=>u.value.map(e=>e.value)),M=V(()=>D.value.find(e=>e.type==="item"&&!e.props.disabled)),q=V(()=>{var a;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&d.value===((a=M.value)==null?void 0:a.title))&&D.value.length>0&&!k.value&&!$.value}),H=z(),Ie=We(H,g);function De(e){L=!0,E(()=>L=!1),l.openOnClear&&(v.value=!0)}function Se(){K.value||(v.value=!0)}function Fe(e){K.value||(C.value&&(e.preventDefault(),e.stopPropagation()),v.value=!v.value)}function Pe(e){var a;(ce(e)||e.key==="Backspace")&&((a=g.value)==null||a.focus())}function Re(e){var i,b,n,m;if(hl(e)||S.isReadonly.value)return;const a=(i=g.value)==null?void 0:i.selectionStart,o=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(v.value=!0),["Escape"].includes(e.key)&&(v.value=!1),q.value&&["Enter","Tab"].includes(e.key)&&M.value&&!u.value.some(c=>{let{value:F}=c;return F===M.value.value})&&p(M.value),e.key==="ArrowDown"&&q.value&&((b=H.value)==null||b.focus("next")),e.key==="Enter"&&d.value&&(p(T(l,d.value),!0,!0),w.value&&(y.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&w.value&&u.value.length>0&&!d.value)return p(u.value[0],!1);if(~s.value){e.preventDefault();const c=s.value;p(u.value[s.value],!1),s.value=c>=o-1?o-2:c}else e.key==="Backspace"&&!d.value&&(s.value=o-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(s.value<0&&a&&a>0)return;const c=s.value>-1?s.value-1:o-1;u.value[c]?s.value=c:(s.value=-1,(n=g.value)==null||n.setSelectionRange(d.value.length,d.value.length))}else if(e.key==="ArrowRight"){if(s.value<0)return;const c=s.value+1;u.value[c]?s.value=c:(s.value=-1,(m=g.value)==null||m.setSelectionRange(0,0))}else~s.value&&ce(e)&&(s.value=-1)}function Ae(e){var i;const a=((i=e==null?void 0:e.clipboardData)==null?void 0:i.getData("Text"))??"",o=X(a);o.length>1&&l.multiple&&(e.preventDefault(),Y(o))}function Me(){var e;l.eager&&((e=B.value)==null||e.calculateVisibleItems())}function Te(){var e;C.value&&((e=g.value)==null||e.focus()),k.value=!0,A.value=null}function p(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!e||e.props.disabled))if(l.multiple){const i=u.value.findIndex(n=>(l.valueComparator||ne)(n.value,e.value)),b=a??!~i;if(~i){const n=b?[...u.value,e]:[...u.value];n.splice(i,1),u.value=n}else b&&(u.value=[...u.value,e]);l.clearOnSelect&&(d.value="")}else{const i=a!==!1;u.value=i?[e]:[],(!k.value||l.alwaysFilter)&&y.value&&(A.value=y.value),y.value=i&&!w.value?e.title:"",E(()=>{v.value=o,k.value=!0})}}function X(e){const o=[`
`,...l.delimiters??[]].map(ml).join("|");return e.split(new RegExp(`(?:${o})+`))}async function Y(e){for(let a of e)a=a.trim(),a&&(p(T(l,a)),await E())}function Ee(e){C.value=!0,setTimeout(()=>{$.value=!0})}function _e(e){$.value=!1}return _(C,(e,a)=>{if(!(e||e===a)&&(s.value=-1,v.value=!1,d.value)){if(l.multiple){p(T(l,d.value));return}if(!w.value)return;u.value.some(o=>{let{title:i}=o;return i===d.value})?y.value="":p(T(l,d.value))}}),_(v,e=>{if(!l.hideSelected&&e&&u.value.length&&k.value){const a=D.value.findIndex(o=>u.value.some(i=>(l.valueComparator||ne)(i.value,o.value)));Je&&window.requestAnimationFrame(()=>{var o;a>=0&&((o=B.value)==null||o.scrollToIndex(a))})}e&&(A.value=null)}),_(J,(e,a)=>{v.value||C.value&&!a.length&&e.length&&(v.value=!0)}),Qe(()=>{const e=!!(!l.hideNoData||D.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),a=u.value.length>0,o=oe.filterProps(l);return f(oe,I({ref:g},o,{modelValue:d.value,"onUpdate:modelValue":i=>d.value=i,focused:C.value,"onUpdate:focused":i=>C.value=i,validationValue:u.externalValue,counterValue:pe.value,dirty:a,class:["v-combobox",{"v-combobox--active-menu":v.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!w.value,"v-combobox--selecting-index":s.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:S.isReadonly.value,placeholder:a?void 0:l.placeholder,"onClick:clear":De,"onMousedown:control":Se,onKeydown:Re,onPaste:Ae,"aria-expanded":Ce.value,"aria-controls":ke.value}),{...t,default:i=>{let{id:b}=i;return R(G,null,[f(Ye,I({id:Ve.value,ref:W,modelValue:v.value,"onUpdate:modelValue":n=>v.value=n,activator:"parent",contentClass:"v-combobox__content",disabled:K.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Me,onAfterLeave:Te},l.menuProps),{default:()=>[e&&f(Ze,I({ref:H,filterable:!0,selected:we.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),selectable:!0,onKeydown:Pe,onFocusin:Ee,onFocusout:_e,tabindex:"-1","aria-live":"polite","aria-labelledby":`${b.value}-label`,"aria-multiselectable":l.multiple,color:l.itemColor??l.color},Ie,l.listProps),{default:()=>{var n,m,c;return[(n=t["prepend-item"])==null?void 0:n.call(t),!D.value.length&&!l.hideNoData&&(((m=t["no-data"])==null?void 0:m.call(t))??f(se,{key:"no-data",title:fe(l.noDataText)},null)),f(el,{ref:B,renderless:!0,items:D.value,itemKey:"value"},{default:F=>{var le,ae,te;let{item:r,index:x,itemRef:h}=F;const ee=I(r.props,{ref:h,key:r.value,active:q.value&&r===M.value?!0:void 0,onClick:()=>p(r,null),"aria-posinset":x+1,"aria-setsize":D.value.length});return r.type==="divider"?((le=t.divider)==null?void 0:le.call(t,{props:r.raw,index:x}))??f(ll,I(r.props,{key:`divider-${x}`}),null):r.type==="subheader"?((ae=t.subheader)==null?void 0:ae.call(t,{props:r.raw,index:x}))??f(al,I(r.props,{key:`subheader-${x}`}),null):((te=t.item)==null?void 0:te.call(t,{item:r,index:x,props:ee}))??f(se,I(ee,{role:"option"}),{prepend:O=>{let{isSelected:Be}=O;return R(G,null,[l.multiple&&!l.hideSelected?f(tl,{key:r.value,modelValue:Be,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Le=>Le.preventDefault()},null):void 0,r.props.prependAvatar&&f(ul,{image:r.props.prependAvatar},null),r.props.prependIcon&&f(ie,{icon:r.props.prependIcon},null)])},title:()=>{var O;return k.value?r.title:gl("v-combobox",r.title,(O=xe(r))==null?void 0:O.title)}})}}),(c=t["append-item"])==null?void 0:c.call(t)]}})]}),u.value.map((n,m)=>{function c(h){h.stopPropagation(),h.preventDefault(),p(n,!1)}const F=I(re.filterProps(n.props),{"onClick:close":c,onKeydown(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),h.stopPropagation(),c(h))},onMousedown(h){h.preventDefault(),h.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),r=N.value?!!t.chip:!!t.selection,x=r?nl(N.value?t.chip({item:n,index:m,props:F}):t.selection({item:n,index:m})):void 0;if(!(r&&!x))return R("div",{key:n.value,class:il(["v-combobox__selection",m===s.value&&["v-combobox__selection--selected",be.value]]),style:ol(m===s.value?ge.value:{})},[N.value?t.chip?f(sl,{key:"chip-defaults",defaults:{VChip:{closable:Q.value,size:"small",text:n.title}}},{default:()=>[x]}):f(re,I({key:"chip",closable:Q.value,size:"small",text:n.title,disabled:n.props.disabled},F),null):x??R("span",{class:"v-combobox__selection-text"},[n.title,l.multiple&&m<u.value.length-1&&R("span",{class:"v-combobox__selection-comma"},[rl(",")])])])})])},"append-inner":function(){var m,c;for(var i=arguments.length,b=new Array(i),n=0;n<i;n++)b[n]=arguments[n];return R(G,null,[(m=t["append-inner"])==null?void 0:m.call(t,...b),(!l.hideNoData||l.items.length)&&l.menuIcon?f(ie,{class:"v-combobox__menu-icon",color:(c=g.value)==null?void 0:c.fieldIconColor,icon:l.menuIcon,onMousedown:Fe,onClick:Xe,"aria-hidden":!0,tabindex:"-1"},null):void 0,l.appendInnerIcon&&f(ye,{key:"append-icon",name:"appendInner",color:b[0].iconColor.value},null)])}})}),cl({isFocused:C,isPristine:k,menu:v,search:d,selectionIndex:s,filteredItems:U,select:p},g)}});export{Cl as V};
