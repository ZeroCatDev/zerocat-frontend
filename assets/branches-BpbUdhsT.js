import{_ as C,Z as b,o as u,N as n,e as t,R as _,S as k,i as c,L as l,X as p,ae as h,ah as B,c as x,F as I,W as N,ai as m,aD as U,m as F,aE as V,Y as K,a8 as j,aF as w,aG as d,aH as g,aI as D,O as y,U as S,a6 as v,aq as L,ao as P}from"./index-CxBwy-Cx.js";import{V as T}from"./VSelect-C6v_9t34.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-BSY9BYfC.js";import"./VSelectionControl-BDoaeuhK.js";const E={data(){return{projectbranchs:[],project:{},branchDescription:{branch:"",dialog:!1,description:""},newBranch:{name:"",dialog:!1,base:""}}},async mounted(){await this.fetchProjectInfo(),this.fetchBranches()},methods:{async fetchProjectInfo(){const s=this.$route.params.username,e=this.$route.params.projectname,i=await P(s,e);this.project=i},async fetchBranches(){const s=this.project.id,e=await L(s);this.projectbranchs=e.data},async editBranchDescription(s){this.branchDescription.branch=s,this.branchDescription.description=this.projectbranchs.find(e=>e.name===s).description,this.branchDescription.dialog=!0},async saveBranchDescription(){const s=this.project.id,e=this.branchDescription.branch,i=this.branchDescription.description;await v.post(`/project/branches/description/?branch=${e}&projectid=${s}`,{description:i}),this.branchDescription.dialog=!1,this.fetchBranches()},async createBranch(){const s=this.project.id,e=this.newBranch.name,i=await v({url:`/project/branches?projectid=${s}`,method:"post",data:{name:e,branch:this.newBranch.base,projectid:s}});this.$toast.add({severity:i.data.status,summary:i.data.message,detail:i.data.message,life:3e3}),this.newBranch.dialog=!1,this.fetchBranches()}}};function M(s,e,i,O,r,o){return u(),b(S,null,{default:n(()=>[t(_,null,{default:n(()=>[t(k,{cols:"12"},{default:n(()=>[t(c,{onClick:e[0]||(e[0]=a=>r.newBranch.dialog=!0)},{default:n(()=>e[10]||(e[10]=[l("新建分支",-1)])),_:1,__:[10]}),t(p,{border:"",hover:""},{default:n(()=>[t(h,null,{default:n(()=>e[11]||(e[11]=[l("分支列表",-1)])),_:1,__:[11]}),t(B,{dense:""},{default:n(()=>[(u(!0),x(I,null,N(r.projectbranchs,a=>(u(),b(m,{key:a.name,subtitle:JSON.stringify(a),title:a.name},{append:n(()=>[t(U,null,{activator:n(({props:f})=>[t(c,F({icon:"mdi-dots-horizontal"},{ref_for:!0},f,{variant:"text"}),null,16)]),default:n(()=>[t(B,null,{default:n(()=>[t(m,{"prepend-icon":"mdi-pencil",subtitle:"设置此分支的简介",title:"设置分支简介",onClick:f=>o.editBranchDescription(a.name)},null,8,["onClick"]),t(m,{disabled:"","prepend-icon":"mdi-delete",subtitle:"将永久删除掉此分支所有数据，难以恢复",title:"删除此分支"})]),_:2},1024)]),_:2},1024)]),_:2},1032,["subtitle","title"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(V,{modelValue:r.branchDescription.dialog,"onUpdate:modelValue":e[4]||(e[4]=a=>r.branchDescription.dialog=a),"max-width":"500"},{default:n(()=>[t(p,null,{default:n(()=>[t(h,null,{default:n(()=>[l("设置分支 "+K(r.branchDescription.branch)+" 的简介 ",1)]),_:1}),t(j,null,{default:n(()=>[t(w,{modelValue:r.branchDescription.description,"onUpdate:modelValue":e[1]||(e[1]=a=>r.branchDescription.description=a),counter:"100",hint:"设置此分支的简介",label:"分支简介",variant:"outlined",onKeyup:[d(o.saveBranchDescription,["enter"]),e[2]||(e[2]=d(a=>r.branchDescription.dialog=!1,["esc"])),d(g(o.saveBranchDescription,["ctrl"]),["s"])]},null,8,["modelValue","onKeyup"])]),_:1}),t(D,null,{default:n(()=>[t(y),t(c,{onClick:e[3]||(e[3]=a=>r.branchDescription.dialog=!1)},{default:n(()=>e[12]||(e[12]=[l("取消",-1)])),_:1,__:[12]}),t(c,{color:"primary",onClick:o.saveBranchDescription},{default:n(()=>e[13]||(e[13]=[l("保存",-1)])),_:1,__:[13]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(V,{modelValue:r.newBranch.dialog,"onUpdate:modelValue":e[9]||(e[9]=a=>r.newBranch.dialog=a),"max-width":"500"},{default:n(()=>[t(p,null,{default:n(()=>[t(h,null,{default:n(()=>e[14]||(e[14]=[l("创建分支",-1)])),_:1,__:[14]}),t(j,null,{default:n(()=>[t(w,{modelValue:r.newBranch.name,"onUpdate:modelValue":e[5]||(e[5]=a=>r.newBranch.name=a),counter:"100",hint:"设置此分支的名称",label:"分支名称",variant:"outlined",onKeyup:[d(o.createBranch,["enter"]),e[6]||(e[6]=d(a=>r.newBranch.dialog=!1,["esc"])),d(g(o.createBranch,["ctrl"]),["s"])]},null,8,["modelValue","onKeyup"]),t(T,{modelValue:r.newBranch.base,"onUpdate:modelValue":e[7]||(e[7]=a=>r.newBranch.base=a),items:r.projectbranchs,"item-title":"name","item-value":"name",label:"选择基于某个分支"},null,8,["modelValue","items"])]),_:1}),t(D,null,{default:n(()=>[t(y),t(c,{onClick:e[8]||(e[8]=a=>r.newBranch.dialog=!1)},{default:n(()=>e[15]||(e[15]=[l("取消",-1)])),_:1,__:[15]}),t(c,{color:"primary",onClick:o.createBranch},{default:n(()=>e[16]||(e[16]=[l("创建",-1)])),_:1,__:[16]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const H=C(E,[["render",M]]);export{H as default};
