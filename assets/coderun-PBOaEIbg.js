import{_ as $,ac as h,Y as q,o as F,N as a,e,Q as ee,R as le,W as k,a9 as y,L as o,i as u,O as v,X as d,S as B,aA as b,$ as R,a3 as m,ah as ae,ai as I,a6 as te,a7 as S,ad as oe,ae as c,af as g,ag as V,f as L,aF as ie,aB as p,aE as A,T as ne,r,b as de,a1 as N}from"./index-B7oF1r_k.js";import{V as D}from"./VSpacer-BXETznO2.js";import{V as ue}from"./VDataTable-D99dCRe7.js";import{V as re}from"./VSelect-9uej9JMI.js";import{V as se}from"./VTextarea-BWrYhZtQ.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-BUatQX3c.js";import"./VSelectionControl-D--hWwCI.js";import"./VTable-DGvcTnYQ.js";import"./filter-O4zqvO6i.js";const fe={name:"CodeRunAdmin",setup(){const O=r([]),l=r(!1),f=r(null),t=r(!1),T=r(!1),w=r(!1),s=r(!1),i=r(0),_=r(!1),U=r(!1),J=r(!1),x=r({device_name:"",request_url:"",status:"",device_config:""}),W=[{title:"设备名称",value:"device_name"},{title:"设备ID",value:"id"},{title:"请求地址",value:"request_url"},{title:"状态",value:"status"},{title:"最后报告",value:"last_report"},{title:"操作",value:"actions",sortable:!1}],E=["active","inactive","error"],C=async()=>{l.value=!0;try{const n=await N.get("/admin/coderun/devices");n.data.success&&(O.value=n.data.devices)}catch(n){console.error("Failed to fetch devices:",n)}finally{l.value=!1}},M=n=>{f.value=n,t.value=!0},Q=n=>{f.value=n,x.value={device_name:n.device_name||"",request_url:n.request_url||"",status:n.status||"active",device_config:JSON.stringify(n.device_config||{},null,2)},T.value=!0},X=n=>{f.value=n,w.value=!0},Y=()=>{s.value=!0},j=async()=>{_.value=!0;try{const n={...x.value,device_config:JSON.parse(x.value.device_config)};(await N.put(`/admin/coderun/devices/${f.value.id}`,n)).data.success&&(await C(),T.value=!1)}catch(n){console.error("Failed to save device config:",n)}finally{_.value=!1}},z=async()=>{U.value=!0;try{(await N.delete(`/admin/coderun/devices/${f.value.id}`)).data.success&&(await C(),w.value=!1)}catch(n){console.error("Failed to delete device:",n)}finally{U.value=!1}},G=async()=>{J.value=!0;try{(await N.delete("/admin/coderun/devices/inactive/all")).data.success&&(await C(),s.value=!1)}catch(n){console.error("Failed to delete all inactive devices:",n)}finally{J.value=!1}},H=n=>{switch(n){case"active":return"success";case"error":return"error";default:return"warning"}},K=n=>n?new Date(n).toLocaleString():"未知",P=n=>{try{return n&&JSON.parse(n),!0}catch{return"请输入有效的 JSON 格式"}};return de(()=>{C()}),{devices:O,loading:l,headers:W,selectedDevice:f,detailsDialog:t,configDialog:T,deleteDialog:w,deleteInactiveDialog:s,activeTab:i,editConfig:x,statusOptions:E,saving:_,deleting:U,deletingInactive:J,refreshDevices:C,openDeviceDetails:M,openDeviceConfig:Q,confirmDelete:X,confirmDeleteInactive:Y,saveDeviceConfig:j,deleteDevice:z,deleteAllInactive:G,getStatusColor:H,formatDateTime:K,validateJson:P}}};function ve(O,l,f,t,T,w){const s=h("v-list-item-content");return F(),q(ne,{fluid:""},{default:a(()=>[e(ee,null,{default:a(()=>[e(le,{cols:"12"},{default:a(()=>[e(k,null,{default:a(()=>[e(y,{class:"d-flex align-center"},{default:a(()=>[l[18]||(l[18]=o(" CodeRun 设备管理 ")),e(D),e(u,{color:"primary",onClick:t.refreshDevices,loading:t.loading},{default:a(()=>[e(v,{left:""},{default:a(()=>l[14]||(l[14]=[o("mdi-refresh")])),_:1,__:[14]}),l[15]||(l[15]=o(" 刷新 "))]),_:1,__:[15]},8,["onClick","loading"]),e(u,{color:"error",class:"ml-2",onClick:t.confirmDeleteInactive,loading:t.loading},{default:a(()=>[e(v,{left:""},{default:a(()=>l[16]||(l[16]=[o("mdi-delete-sweep")])),_:1,__:[16]}),l[17]||(l[17]=o(" 删除所有不活跃设备 "))]),_:1,__:[17]},8,["onClick","loading"])]),_:1,__:[18]}),e(ue,{headers:t.headers,items:t.devices,loading:t.loading,"items-per-page":10,class:"elevation-1"},{"item.status":a(({item:i})=>[e(B,{color:t.getStatusColor(i.status),small:""},{default:a(()=>[o(d(i.status),1)]),_:2},1032,["color"])]),"item.last_report":a(({item:i})=>[o(d(t.formatDateTime(i.last_report)),1)]),"item.actions":a(({item:i})=>[e(u,{icon:"",small:"",onClick:_=>t.openDeviceDetails(i)},{default:a(()=>[e(v,null,{default:a(()=>l[19]||(l[19]=[o("mdi-eye")])),_:1,__:[19]})]),_:2},1032,["onClick"]),e(u,{icon:"",small:"",onClick:_=>t.openDeviceConfig(i)},{default:a(()=>[e(v,null,{default:a(()=>l[20]||(l[20]=[o("mdi-cog")])),_:1,__:[20]})]),_:2},1032,["onClick"]),e(u,{icon:"",small:"",color:"error",onClick:_=>t.confirmDelete(i)},{default:a(()=>[e(v,null,{default:a(()=>l[21]||(l[21]=[o("mdi-delete")])),_:1,__:[21]})]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1}),e(b,{modelValue:t.detailsDialog,"onUpdate:modelValue":l[3]||(l[3]=i=>t.detailsDialog=i),"max-width":"800px"},{default:a(()=>[t.selectedDevice?(F(),q(k,{key:0},{default:a(()=>[e(y,null,{default:a(()=>[o(" 设备详情: "+d(t.selectedDevice.device_name)+" ",1),e(D),e(u,{icon:"",onClick:l[0]||(l[0]=i=>t.detailsDialog=!1)},{default:a(()=>[e(v,null,{default:a(()=>l[22]||(l[22]=[o("mdi-close")])),_:1,__:[22]})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(ae,{modelValue:t.activeTab,"onUpdate:modelValue":l[1]||(l[1]=i=>t.activeTab=i)},{default:a(()=>[e(I,{value:"basic-info"},{default:a(()=>l[23]||(l[23]=[o("基本信息")])),_:1,__:[23]}),e(I,{value:"docker-info"},{default:a(()=>l[24]||(l[24]=[o("Docker 信息")])),_:1,__:[24]}),e(I,{value:"system-info"},{default:a(()=>l[25]||(l[25]=[o("系统信息")])),_:1,__:[25]}),e(I,{value:"runtime-info"},{default:a(()=>l[26]||(l[26]=[o("运行时信息")])),_:1,__:[26]})]),_:1},8,["modelValue"]),e(te,{modelValue:t.activeTab,"onUpdate:modelValue":l[2]||(l[2]=i=>t.activeTab=i)},{default:a(()=>[e(S,{value:"basic-info"},{default:a(()=>[e(oe,null,{default:a(()=>[e(c,null,{default:a(()=>[e(s,null,{default:a(()=>[e(g,null,{default:a(()=>l[27]||(l[27]=[o("设备 ID")])),_:1,__:[27]}),e(V,null,{default:a(()=>[o(d(t.selectedDevice.id),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(s,null,{default:a(()=>[e(g,null,{default:a(()=>l[28]||(l[28]=[o("设备名称")])),_:1,__:[28]}),e(V,null,{default:a(()=>[o(d(t.selectedDevice.device_name),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(s,null,{default:a(()=>[e(g,null,{default:a(()=>l[29]||(l[29]=[o("状态")])),_:1,__:[29]}),e(V,null,{default:a(()=>[e(B,{color:t.getStatusColor(t.selectedDevice.status),small:""},{default:a(()=>[o(d(t.selectedDevice.status),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(s,null,{default:a(()=>[e(g,null,{default:a(()=>l[30]||(l[30]=[o("创建时间")])),_:1,__:[30]}),e(V,null,{default:a(()=>[o(d(t.formatDateTime(t.selectedDevice.created_at)),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(s,null,{default:a(()=>[e(g,null,{default:a(()=>l[31]||(l[31]=[o("最后更新")])),_:1,__:[31]}),e(V,null,{default:a(()=>[o(d(t.formatDateTime(t.selectedDevice.updated_at)),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(s,null,{default:a(()=>[e(g,null,{default:a(()=>l[32]||(l[32]=[o("最后报告")])),_:1,__:[32]}),e(V,null,{default:a(()=>[o(d(t.formatDateTime(t.selectedDevice.last_report)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{value:"docker-info"},{default:a(()=>[e(m,null,{default:a(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.docker_info,null,2)),1)]),_:1})]),_:1}),e(S,{value:"system-info"},{default:a(()=>[e(m,null,{default:a(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.system_info,null,2)),1)]),_:1})]),_:1}),e(S,{value:"runtime-info"},{default:a(()=>[e(m,null,{default:a(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.coderun_info,null,2)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):R("",!0)]),_:1},8,["modelValue"]),e(b,{modelValue:t.configDialog,"onUpdate:modelValue":l[9]||(l[9]=i=>t.configDialog=i),"max-width":"600px"},{default:a(()=>[t.selectedDevice?(F(),q(k,{key:0},{default:a(()=>[e(y,null,{default:a(()=>[o(" 设备配置: "+d(t.selectedDevice.device_name)+" ",1),e(D),e(u,{icon:"",onClick:l[4]||(l[4]=i=>t.configDialog=!1)},{default:a(()=>[e(v,null,{default:a(()=>l[33]||(l[33]=[o("mdi-close")])),_:1,__:[33]})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(ie,{ref:"configForm"},{default:a(()=>[e(p,{modelValue:t.editConfig.device_name,"onUpdate:modelValue":l[5]||(l[5]=i=>t.editConfig.device_name=i),label:"设备名称",required:""},null,8,["modelValue"]),e(p,{modelValue:t.editConfig.request_url,"onUpdate:modelValue":l[6]||(l[6]=i=>t.editConfig.request_url=i),label:"请求 URL",required:""},null,8,["modelValue"]),e(re,{modelValue:t.editConfig.status,"onUpdate:modelValue":l[7]||(l[7]=i=>t.editConfig.status=i),items:t.statusOptions,label:"状态",required:""},null,8,["modelValue","items"]),e(se,{modelValue:t.editConfig.device_config,"onUpdate:modelValue":l[8]||(l[8]=i=>t.editConfig.device_config=i),label:"设备配置 (JSON)",rows:"10",rules:[t.validateJson]},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(A,null,{default:a(()=>[e(D),e(u,{color:"primary",onClick:t.saveDeviceConfig,loading:t.saving},{default:a(()=>l[34]||(l[34]=[o(" 保存 ")])),_:1,__:[34]},8,["onClick","loading"])]),_:1})]),_:1})):R("",!0)]),_:1},8,["modelValue"]),e(b,{modelValue:t.deleteDialog,"onUpdate:modelValue":l[11]||(l[11]=i=>t.deleteDialog=i),"max-width":"400px"},{default:a(()=>[e(k,null,{default:a(()=>[e(y,null,{default:a(()=>l[35]||(l[35]=[o("确认删除")])),_:1,__:[35]}),e(m,null,{default:a(()=>{var i;return[o(' 确定要删除设备 "'+d((i=t.selectedDevice)==null?void 0:i.device_name)+'" 吗？此操作无法撤销。 ',1)]}),_:1}),e(A,null,{default:a(()=>[e(D),e(u,{text:"",onClick:l[10]||(l[10]=i=>t.deleteDialog=!1)},{default:a(()=>l[36]||(l[36]=[o(" 取消 ")])),_:1,__:[36]}),e(u,{color:"error",onClick:t.deleteDevice,loading:t.deleting},{default:a(()=>l[37]||(l[37]=[o(" 删除 ")])),_:1,__:[37]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(b,{modelValue:t.deleteInactiveDialog,"onUpdate:modelValue":l[13]||(l[13]=i=>t.deleteInactiveDialog=i),"max-width":"400px"},{default:a(()=>[e(k,null,{default:a(()=>[e(y,null,{default:a(()=>l[38]||(l[38]=[o("确认批量删除")])),_:1,__:[38]}),e(m,null,{default:a(()=>l[39]||(l[39]=[o(" 确定要删除所有不活跃的设备吗？此操作无法撤销。 ")])),_:1,__:[39]}),e(A,null,{default:a(()=>[e(D),e(u,{text:"",onClick:l[12]||(l[12]=i=>t.deleteInactiveDialog=!1)},{default:a(()=>l[40]||(l[40]=[o(" 取消 ")])),_:1,__:[40]}),e(u,{color:"error",onClick:t.deleteAllInactive,loading:t.deletingInactive},{default:a(()=>l[41]||(l[41]=[o(" 删除 ")])),_:1,__:[41]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const we=$(fe,[["render",ve],["__scopeId","data-v-4637984c"]]);export{we as default};
