import{_ as x}from"./EditProjectListConfig-F69an3dQ.js";import{_ as j}from"./ProjectCard-BYWSBxv8.js";import{_ as C,a1 as P,ab as k,Y as r,o as l,N as e,c as g,e as a,Q as u,R as f,a4 as b,F as I,W as L,$ as y,a9 as T,f as c,X as d,S as B,L as m,i as N,aP as z,a3 as A,Z as E,n as S,a5 as U,U as O,aA as F,T as R,M as V,el as q}from"./index-CqDYMkg5.js";import{V as H}from"./VSpacer-BmIOKXlY.js";import"./VSelect-ByyaaPA0.js";import"./VCheckboxBtn-8mXxa5va.js";import"./VSelectionControl-DLr9dD2N.js";const M={props:{listId:{type:String,required:!0}},components:{EditProjectListConfig:x,ProjectCard:j},data(){return{loading:!0,listInfo:{},isOwner:!1,editDialog:!1}},computed:{hasProjects(){return this.listInfo.projects&&this.listInfo.projects.length>0}},async created(){await this.fetchProjectList()},methods:{async fetchProjectList(){this.loading=!0;try{const t=await P.get(`/projectlist/lists/listid/${this.listId}`);if(t.data.status==="success"){this.listInfo=t.data.data;const i=k.user.value;this.isOwner=i&&i.id===this.listInfo.authorid}else this.$toast.add({severity:"error",summary:"错误",detail:t.data.message||"获取列表失败",life:3e3})}catch(t){console.error("获取列表失败:",t),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},getAvatarUrl(t){return t?t.avatar?t.avatar:t.avatar?`https://zerocat-bitiful.houlangs.com/user/${t.avatar}`:"":""},openEditDialog(){this.editDialog=!0},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知"}}},Q={class:"d-flex align-center mb-2"},W={class:"text-caption"},X={class:"d-flex flex-wrap"},Y={class:"text-caption mr-4"},Z={class:"text-caption"};function G(t,i,p,w,s,n){const _=j,D=x;return l(),r(R,null,{default:e(()=>[s.loading?(l(),r(u,{key:0},{default:e(()=>[a(f,{cols:"12",class:"text-center"},{default:e(()=>[a(b,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(l(),g(I,{key:1},[a(u,null,{default:e(()=>[a(f,{cols:"12"},{default:e(()=>[a(L,{class:"mb-4"},{default:e(()=>[a(T,{class:"d-flex align-center"},{default:e(()=>[c("span",null,d(s.listInfo.title||"未命名列表"),1),a(B,{class:"ml-2",color:s.listInfo.state==="public"?"success":"warning",size:"small"},{default:e(()=>[m(d(s.listInfo.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),a(H),s.isOwner?(l(),r(N,{key:0,icon:"mdi-pencil",variant:"text",size:"small",onClick:n.openEditDialog,color:"primary"},null,8,["onClick"])):y("",!0)]),_:1}),s.listInfo.description?(l(),r(z,{key:0},{default:e(()=>[m(d(s.listInfo.description),1)]),_:1})):y("",!0),a(A,null,{default:e(()=>{var o,h;return[c("div",Q,[a(E,{size:"24",class:"mr-2"},{default:e(()=>[a(S,{src:n.getAvatarUrl(s.listInfo.author),alt:"用户头像"},null,8,["src"])]),_:1}),c("span",W,d(((o=s.listInfo.author)==null?void 0:o.display_name)||((h=s.listInfo.author)==null?void 0:h.username)||"未知用户"),1)]),c("div",X,[c("span",Y,"创建于: "+d(n.formatDate(s.listInfo.createTime)),1),c("span",Z,"更新于: "+d(n.formatDate(s.listInfo.updateTime)),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),n.hasProjects?(l(),r(u,{key:1},{default:e(()=>[a(f,{cols:"12"},{default:e(()=>[i[2]||(i[2]=c("h3",{class:"text-h6 mb-4"},"项目列表",-1)),a(u,null,{default:e(()=>[(l(!0),g(I,null,O(s.listInfo.projects,o=>(l(),r(f,{key:o.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[a(_,{"project-data":o,"author-data":o.author,"show-author":!0},null,8,["project-data","author-data"])]),_:2},1024))),128))]),_:1})]),_:1,__:[2]})]),_:1})):(l(),r(u,{key:0},{default:e(()=>[a(f,{cols:"12",class:"text-center"},{default:e(()=>[a(U,{type:"info",variant:"tonal"},{default:e(()=>i[1]||(i[1]=[m(" 此列表暂无项目 ")])),_:1,__:[1]})]),_:1})]),_:1}))],64)),a(F,{modelValue:s.editDialog,"onUpdate:modelValue":i[0]||(i[0]=o=>s.editDialog=o),"max-width":"600px"},{default:e(()=>[a(D,{listid:p.listId,callback:n.fetchProjectList,close:()=>s.editDialog=!1},null,8,["listid","callback","close"])]),_:1},8,["modelValue"])]),_:1})}const v=C(M,[["render",G],["__scopeId","data-v-0efb759d"]]),J={components:{showProjectList:v},data(){return{listId:this.$route.params.id,listTitle:"项目列表"}},async mounted(){try{const t=await q(this.listId);t&&t.title&&(this.listTitle=t.title,this.updatePageTitle())}catch(t){console.error("获取列表信息失败:",t)}},methods:{updatePageTitle(){V({title:this.listTitle})}},setup(){V({title:"项目列表"})}};function K(t,i,p,w,s,n){const _=v;return l(),r(_,{listId:s.listId},null,8,["listId"])}const ot=C(J,[["render",K]]);export{ot as default};
