import{_ as N}from"./Comment-IiQLDY2d.js";import{_ as O}from"./Projects-aWGXMA-d.js";import{f as V,p as j,U as J,n as z,t as f,y as K,s as Q,i as w,a as n,W as b,X,E as F,Y as q,B as A,k as D,Z as W,u as Y,$ as ee,R as te,a0 as ie,a1 as k,A as Z,j as se,l as ne,a2 as ae,a3 as re,a4 as le,a5 as E,z as oe,a6 as ue,a7 as ce,_ as de,c as _,o as m,w as u,a8 as me,a9 as I,G as g,J as fe,H as h,O as d,P as he,aa as ge,e as p,M as P,N as $,K as T,ab as B,ac as L,ad as x,I as _e,Q as M,T as ye}from"./index-DpxDA7WW.js";import{g as ve,a as pe}from"./user-8rPB26LL.js";import{g as Ce}from"./projectService-CkzBMm6s.js";import{V as R,a as U}from"./VRow-Doh-Eq9L.js";import{V as C}from"./VChip-CaF5FQDz.js";import{V as Te}from"./VContainer-DWP4xcxp.js";import"./VForm-oj_SL6MH.js";import"./VTextarea-C_vZXKor.js";import"./VDialog-DYUGEkig.js";import"./showProjects-CbMC3d4V.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-Ns7AJq2_.js";/* empty css              */const be=j({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:W,iconColor:String,lineColor:String,...D(),...A(),...q(),...F()},"VTimelineDivider"),ke=V()({name:"VTimelineDivider",props:be(),setup(e,t){let{slots:l}=t;const{sizeClasses:r,sizeStyles:i}=J(e,"v-timeline-divider__dot"),{backgroundColorStyles:s,backgroundColorClasses:o}=z(f(e,"dotColor")),{roundedClasses:c}=K(e,"v-timeline-divider__dot"),{elevationClasses:a}=Q(e),{backgroundColorClasses:y,backgroundColorStyles:v}=z(f(e,"lineColor"));return w(()=>n("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[n("div",{class:["v-timeline-divider__before",y.value],style:v.value},null),!e.hideDot&&n("div",{key:"dot",class:["v-timeline-divider__dot",a.value,c.value,r.value],style:i.value},[n("div",{class:["v-timeline-divider__inner-dot",o.value,c.value],style:s.value},[l.default?n(X,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},l.default):n(b,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),n("div",{class:["v-timeline-divider__after",y.value],style:v.value},null)])),{}}}),H=j({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:W,iconColor:String,lineInset:[Number,String],...D(),...se(),...F(),...A(),...q(),...Z()},"VTimelineItem"),Ie=V()({name:"VTimelineItem",props:H(),setup(e,t){let{slots:l}=t;const{dimensionStyles:r}=Y(e),i=ee(0),s=te();return ie(s,o=>{var c;o&&(i.value=((c=o.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:c.getBoundingClientRect().width)??0)},{flush:"post"}),w(()=>{var o,c;return n("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":k(i.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${k(e.lineInset)})`:k(0)},e.style]},[n("div",{class:"v-timeline-item__body",style:r.value},[(o=l.default)==null?void 0:o.call(l)]),n(ke,{ref:s,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:l.icon}),e.density!=="compact"&&n("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((c=l.opposite)==null?void 0:c.call(l))])])}),{}}}),xe=j({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...ce(H({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...D(),...ue(),...Z(),...oe()},"VTimeline"),Ve=V()({name:"VTimeline",props:xe(),setup(e,t){let{slots:l}=t;const{themeClasses:r}=ne(e),{densityClasses:i}=ae(e),{rtlClasses:s}=re();le({VTimelineDivider:{lineColor:f(e,"lineColor")},VTimelineItem:{density:f(e,"density"),dotColor:f(e,"dotColor"),fillDot:f(e,"fillDot"),hideOpposite:f(e,"hideOpposite"),iconColor:f(e,"iconColor"),lineColor:f(e,"lineColor"),lineInset:f(e,"lineInset"),size:f(e,"size")}});const o=E(()=>{const a=e.side?e.side:e.density!=="default"?"end":null;return a&&`v-timeline--side-${a}`}),c=E(()=>{const a=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return a;case"start":return a[0];case"end":return a[1];default:return null}});return w(()=>n(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,c.value,{"v-timeline--inset-line":!!e.lineInset},r.value,i.value,o.value,s.value,e.class],style:[{"--v-timeline-line-thickness":k(e.lineThickness)},e.style]},l)),{}}}),je={components:{Projects:O,Comment:N},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},projectInfo:{},userInfo:{},currentPage:1,isLoadingMore:!1,pageSize:20}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await pe(this.username),ye({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await M({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(e=1){try{const t=await M.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});t.data.status==="success"&&(e===1?this.timeline=t.data.data:(this.timeline.events=[...this.timeline.events,...t.data.data.events],this.timeline.pagination=t.data.data.pagination),await this.fetchRelatedInfo())}catch(t){console.error("Failed to fetch timeline:",t)}},async fetchRelatedInfo(){const e=new Set,t=new Set,l=(this.currentPage-1)*this.pageSize;this.timeline.events.slice(l).forEach(i=>{var s,o,c,a,y,v,S;try{["project_create","project_delete","project_fork","project_publish"].includes(i.type)&&(s=i.target)!=null&&s.id&&e.add(i.target.id),i.type==="comment_create"&&(((c=(o=i.target)==null?void 0:o.page)==null?void 0:c.type)==="project"&&((a=i.target.page)!=null&&a.id)?e.add(i.target.page.id):((v=(y=i.target)==null?void 0:y.page)==null?void 0:v.type)==="user"&&((S=i.target.page)!=null&&S.id)&&t.add(i.target.page.id))}catch(G){console.warn("Error processing event:",i,G)}});try{if(e.size>0){const i=await Ce(Array.from(e)),s=new Set;i.forEach(o=>{o&&o.id&&(this.projectInfo[o.id]=o,o.authorid&&s.add(o.authorid))}),s.forEach(o=>{o&&t.add(o)})}t.size>0&&(await ve(Array.from(t))).forEach(s=>{s&&s.id&&(this.userInfo[s.id]=s,Object.values(this.projectInfo).forEach(o=>{o&&o.authorid===s.id&&(o.author_username=s.username)}))})}catch(i){console.error("Error fetching related info:",i)}},getTargetLink(e){var t,l;if(!e)return null;try{switch(e.type){case"comment":{if(!((t=e.page)!=null&&t.type)||!((l=e.page)!=null&&l.id))return null;const{type:r,id:i}=e.page;if(r==="project"){const s=this.projectInfo[i];return!(s!=null&&s.author_username)||!(s!=null&&s.name)?null:`/${s.author_username}/${s.name}`}if(r==="user"){const s=this.userInfo[i];return s!=null&&s.username?`/${s.username}`:null}return null}case"project":{const r=this.projectInfo[e.id];return!(r!=null&&r.author_username)||!(r!=null&&r.name)?null:`/${r.author_username}/${r.name}`}case"user":{const r=this.userInfo[e.id];return r!=null&&r.username?`/${r.username}`:null}default:return null}}catch(r){return console.warn("Error generating target link:",r),null}},getTargetContent(e,t){if(!e)return"";try{switch(e.type){case"comment":return this.getCommentTargetContent(e,t);case"project":return this.getProjectTargetContent(e,t);case"user":return this.getUserTargetContent(e,t);default:return`未知目标类型 #${(e==null?void 0:e.id)||"未知"}`}}catch(l){return console.warn("Error generating target content:",l),"内容获取失败"}},getCommentTargetContent(e,t){if(!e.page)return`评论 #${e.id}`;const{type:l,id:r}=e.page;switch(l){case"project":{const i=this.projectInfo[r];return i?`在作品 ${i.title} 下的评论`:`在作品 #${r} 下的评论`}case"user":{const i=this.userInfo[r];return i?`在用户 ${i.display_name} 主页下的评论`:`在用户 #${r} 主页下的评论`}default:return`在 ${l} #${r} 下的评论`}},getProjectTargetContent(e,t){const l=this.projectInfo[e.id];if(!l)return`项目 #${e.id}`;if(t==="project_publish"){const r=l.state==="public"?"公开":"私有";return`${l.title||l.name}（${r}）`}return l.title||l.name},getUserTargetContent(e,t){const l=this.userInfo[e.id];return l?l.display_name:`用户 #${e.id}`},getEventChipText(e){return{project_create:"新建项目",project_delete:"删除项目",project_fork:"复刻项目",project_publish:"发布项目",comment_create:"评论",user_profile_update:"个人资料",user_register:"用户注册"}[e]||e},getEventColor(e){return{project_create:"success",project_delete:"error",project_fork:"warning",project_publish:"info",comment_create:"secondary",user_profile_update:"info",user_register:"primary"}[e]||"primary"},getEventDisplayText(e){const t=e.actor.display_name;switch(e.type){case"project_create":return`${t} 创建了新项目`;case"project_delete":return`${t} 删除了项目`;case"project_fork":return`${t} 复刻了项目`;case"project_publish":return`${t} 发布了项目`;case"comment_create":return`${t} 发表了评论`;case"user_profile_update":{const l=e.event_data.updated_fields.map(r=>this.getFieldDisplayName(r)).join("、");return`${t} 更新了个人资料（${l}）`}case"user_register":return`${t} 加入了 ZeroCat`;default:return`${t} 进行了操作`}},getFieldDisplayName(e){return{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}[e]||e},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}}}},we={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},De={class:"mt-2 text-body-1 text-medium-emphasis"},Se={class:"mt-2 text-medium-emphasis"},ze={key:0,class:"text-body-2 mt-1 text-grey"},Ee={key:0,class:"text-body-2 mt-1 text-grey"},Pe={class:"d-flex justify-center mt-4 mb-4"},$e={key:1,class:"text-medium-emphasis"};function Be(e,t,l,r,i,s){const o=O,c=N;return m(),_(Te,null,{default:u(()=>[n(me,{modelValue:i.tab,"onUpdate:modelValue":t[0]||(t[0]=a=>i.tab=a)},{default:u(()=>[n(I,{value:"home"},{default:u(()=>[n(fe,{class:"mt-8"},{default:u(()=>[n(R,{class:"d-flex align-center"},{default:u(()=>[n(U,null,{default:u(()=>[t[2]||(t[2]=g("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),g("p",we,[h(d(i.user.display_name)+" ",1),n(he,{size:"52",class:"ma-2"},{default:u(()=>[n(ge,{src:"https://s4-1.wuyuan.1r.ink/user/"+i.user.images},null,8,["src"])]),_:1})]),g("p",De,d(i.user.motto),1),g("p",Se,[n(C,null,{default:u(()=>[n(b,{icon:"mdi-account-circle",start:""}),h(" ID:"+d(i.user.id),1)]),_:1}),n(C,null,{default:u(()=>[n(b,{icon:"mdi-clock",start:""}),h(" "+d(i.user.regTime)+"注册 ",1)]),_:1}),n(C,null,{default:u(()=>[n(b,{icon:"mdi-tag",start:""}),t[1]||(t[1]=h(" 创作者 "))]),_:1})])]),_:1})]),_:1})]),_:1}),t[3]||(t[3]=g("br",null,null,-1)),n(o,{url:i.url},null,8,["url"]),n(R,null,{default:u(()=>[(m(!0),p(P,null,$(i.lists,a=>(m(),_(U,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:a.id},{default:u(()=>[n(T,{rounded:"lg"},{default:u(()=>[n(T,{to:"/app/projectlist/"+a.id,rounded:"lg",title:a.title,subtitle:a.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t[4]||(t[4]=g("br",null,null,-1)),n(c,{url:"user-"+i.user.id,name:"用户"},null,8,["url"])]),_:1}),n(I,{value:"comment"},{default:u(()=>[n(c,{url:"user-"+i.user.id,name:"用户"},null,8,["url"])]),_:1}),n(I,{value:"timeline"},{default:u(()=>[n(Ve,{side:"end",align:"start",class:"mt-4"},{default:u(()=>[(m(!0),p(P,null,$(i.timeline.events,a=>(m(),_(Ie,{key:a.id,size:"small","dot-color":"primary"},{opposite:u(()=>[h(d(new Date(a.created_at).toLocaleString()),1)]),default:u(()=>[s.getTargetLink(a.target)?(m(),_(T,{key:0,class:"elevation-1",to:s.getTargetLink(a.target)},{default:u(()=>[n(B,{class:"text-subtitle-1"},{default:u(()=>[h(d(s.getEventDisplayText(a)),1)]),_:2},1024),n(L,null,{default:u(()=>[n(C,{size:"small",color:s.getEventColor(a.type),class:"mr-2"},{default:u(()=>[h(d(s.getEventChipText(a.type)),1)]),_:2},1032,["color"]),g("div",null,d(s.getTargetContent(a.target,a.type)),1),a.event_data.comment_text?(m(),p("div",ze,d(a.event_data.comment_text),1)):x("",!0)]),_:2},1024)]),_:2},1032,["to"])):(m(),_(T,{key:1,class:"elevation-1"},{default:u(()=>[n(B,{class:"text-subtitle-1"},{default:u(()=>[h(d(s.getEventDisplayText(a)),1)]),_:2},1024),n(L,null,{default:u(()=>[n(C,{size:"small",color:s.getEventColor(a.type),class:"mr-2"},{default:u(()=>[h(d(s.getEventChipText(a.type)),1)]),_:2},1032,["color"]),g("div",null,d(s.getTargetContent(a.target,a.type)),1),a.event_data.comment_text?(m(),p("div",Ee,d(a.event_data.comment_text),1)):x("",!0)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1}),g("div",Pe,[s.hasMoreEvents?(m(),_(_e,{key:0,loading:i.isLoadingMore,variant:"tonal",onClick:s.loadMoreEvents},{default:u(()=>t[5]||(t[5]=[h(" 加载更多 ")])),_:1},8,["loading","onClick"])):i.timeline.events.length>0?(m(),p("div",$e," 没有更多内容了 ")):x("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Qe=de(je,[["render",Be],["__scopeId","data-v-f387de89"]]);export{Qe as default};
