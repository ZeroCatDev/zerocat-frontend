import{g as w,p as B,bF as ae,b3 as Z,bs as le,br as oe,d as L,f as i,C,D as k,e as n,O as P,h as ne,bv as X,H as Y,bt as Q,K as N,I as $,bo as de,A as re,r as ee,w as te,k as V,G as ie,bp as ce,v as me,bG as ue,bH as _e,ba as fe,a_ as p,x as J,E as ve,J as ye,bx as ge,_ as he,ac as pe,c as g,o as f,N as o,F as D,U as W,Y as j,$ as I,X as l,S as x,L as y,W as S,a3 as z,Z as be,i as xe,bI as Ce}from"./index-CqDYMkg5.js";const je=B({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:$,iconColor:String,lineColor:String,...N(),...Q(),...Y(),...X()},"VTimelineDivider"),ke=w()({name:"VTimelineDivider",props:je(),setup(e,s){let{slots:_}=s;const{sizeClasses:r,sizeStyles:h}=ae(e,"v-timeline-divider__dot"),{backgroundColorStyles:c,backgroundColorClasses:a}=Z(()=>e.dotColor),{roundedClasses:t}=le(e,"v-timeline-divider__dot"),{elevationClasses:d}=oe(e),{backgroundColorClasses:b,backgroundColorStyles:T}=Z(()=>e.lineColor);return L(()=>i("div",{class:k(["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class]),style:C(e.style)},[i("div",{class:k(["v-timeline-divider__before",b.value]),style:C(T.value)},null),!e.hideDot&&i("div",{key:"dot",class:k(["v-timeline-divider__dot",d.value,t.value,r.value]),style:C(h.value)},[i("div",{class:k(["v-timeline-divider__inner-dot",a.value,t.value]),style:C(c.value)},[_.default?n(ne,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},_.default):n(P,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),i("div",{class:k(["v-timeline-divider__after",b.value]),style:C(T.value)},null)])),{}}}),se=B({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:$,iconColor:String,lineInset:[Number,String],side:{type:String,validator:e=>e==null||["start","end"].includes(e)},...N(),...ce(),...X(),...Q(),...Y(),...ie()},"VTimelineItem"),Te=w()({name:"VTimelineItem",props:se(),setup(e,s){let{slots:_}=s;const{dimensionStyles:r}=de(e),h=re(0),c=ee();return te(c,a=>{var t;a&&(h.value=((t=a.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:t.getBoundingClientRect().width)??0)},{flush:"post"}),L(()=>{var a,t;return i("div",{class:k(["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot,"v-timeline-item--side-start":e.side==="start","v-timeline-item--side-end":e.side==="end"},e.class]),style:C([{"--v-timeline-dot-size":V(h.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${V(e.lineInset)})`:V(0)},e.style])},[i("div",{class:"v-timeline-item__body",style:C(r.value)},[(a=_.default)==null?void 0:a.call(_)]),n(ke,{ref:c,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:_.icon}),e.density!=="compact"&&i("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((t=_.opposite)==null?void 0:t.call(_))])])}),{}}}),Pe=B({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...ge(se({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...N(),...ye(),...ie(),...ve()},"VTimeline"),De=w()({name:"VTimeline",props:Pe(),setup(e,s){let{slots:_}=s;const{themeClasses:r}=me(e),{densityClasses:h}=ue(e),{rtlClasses:c}=_e();fe({VTimelineDivider:{lineColor:p(()=>e.lineColor)},VTimelineItem:{density:p(()=>e.density),dotColor:p(()=>e.dotColor),fillDot:p(()=>e.fillDot),hideOpposite:p(()=>e.hideOpposite),iconColor:p(()=>e.iconColor),lineColor:p(()=>e.lineColor),lineInset:p(()=>e.lineInset),size:p(()=>e.size)}});const a=J(()=>{const d=e.side?e.side:e.density!=="default"?"end":null;return d&&`v-timeline--side-${d}`}),t=J(()=>{const d=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return d;case"start":return d[0];case"end":return d[1];default:return null}});return L(()=>n(e.tag,{class:k(["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,t.value,{"v-timeline--inset-line":!!e.lineInset},r.value,h.value,a.value,c.value,e.class]),style:C([{"--v-timeline-line-thickness":V(e.lineThickness)},e.style])},_)),{}}}),Se={name:"Timeline",props:{timeline:{type:Object,required:!0,default:()=>({events:[],pagination:{current:1,size:20,total:0}})},isLoadingMore:{type:Boolean,default:!1}},setup(e){const s=ee(new Map),_="https://zerocat-bitiful.houlangs.com",r=async c=>{try{const a=[...new Set(c)].filter(d=>d&&!s.value.has(d));if(a.length===0)return;const t=await Ce(a);t&&Array.isArray(t)&&t.forEach(d=>{d&&d.id&&s.value.set(d.id,d)})}catch(a){console.error("Failed to fetch project info:",a)}},h=c=>{if(!c)return"/app/link/project";const a=s.value.get(c);return!a||!a.author||!a.name?`/app/link/project?id=${c}`:`/${a.author.username}/${a.name}`};return te(()=>e.timeline.events,async c=>{if(!c)return;const a=c.filter(t=>{var d,b;return((d=t.target)==null?void 0:d.type)==="project"&&((b=t.target)==null?void 0:b.id)}).map(t=>t.target.id);await r(a)},{immediate:!0}),{VITE_APP_S3_BUCKET:_,projectInfoMap:s,getProjectLink:h,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",bio:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}}},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{loadMore(){this.$emit("load-more")},getUpdatedFields(e){return e!=null&&e.length?e.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},getTargetContent(e,s){if(!e)return"";switch(e.type){case"project":return e.title||`项目 #${e.id}`;case"user":return e.display_name||`用户 #${e.id}`;case"projectlist":return`项目列表 #${e.id}`;default:return`${e.type} #${e.id}`}},getFieldDisplayName(e){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[e]||e}}},ze={class:"timeline-item-content"},Ve={class:"event-header"},Ie={class:"text-h6"},we={class:"project-info"},Be={class:"font-weight-medium"},Le={class:"mt-2 text-caption text-medium-emphasis"},Ne={class:"d-flex align-center mb-2"},Ee={class:"font-weight-medium"},Fe={class:"rename-details text-body-2"},Me={class:"d-flex align-center"},Re={class:"d-flex align-center mt-1"},Oe={class:"project-meta text-caption text-medium-emphasis mt-2"},Ae={class:"d-flex align-center mb-2"},Ue={class:"font-weight-medium"},qe={class:"commit-message text-body-2"},Ke={class:"commit-hash text-caption text-medium-emphasis mt-1"},Ge={class:"d-flex align-center mb-2"},He={class:"font-weight-medium"},Ze={class:"info-updates text-body-2"},Je={class:"d-flex align-center"},We={class:"d-flex flex-column mt-1 field-changes"},Xe={class:"old-value"},Ye={class:"ml-2"},Qe={class:"new-value"},$e={class:"ml-2 text-info"},et={class:"project-meta text-caption text-medium-emphasis mt-2"},tt={key:3,class:"event-content pa-2"},it={key:0,class:"text-body-2"},st={key:1,class:"text-body-2"},at={key:2,class:"text-body-2 text-medium-emphasis"},lt={class:"d-flex justify-center mt-4 mb-4"},ot={key:1,class:"text-medium-emphasis"};function nt(e,s,_,r,h,c){const a=pe("router-link");return f(),g(D,null,[n(De,{side:"end",align:"start",class:"mt-4"},{default:o(()=>[(f(!0),g(D,null,W(_.timeline.events,t=>(f(),j(Te,{key:t.id,size:"small","dot-color":"primary"},{opposite:o(()=>[y(l(new Date(t.created_at).toLocaleString()),1)]),icon:o(()=>[n(be,{image:r.VITE_APP_S3_BUCKET+"/user/"+t.actor.avatar},null,8,["image"])]),default:o(()=>{var d,b,T,E,F,M,R,O,A,U,q,K;return[i("div",ze,[i("div",Ve,[i("h3",Ie,l(t.actor.display_name)+" "+l(((d=r.eventTypes[t.type])==null?void 0:d.text)||"进行了操作"),1),n(x,{size:"x-small",color:((b=r.eventTypes[t.type])==null?void 0:b.color)||"primary",class:"ml-2"},{default:o(()=>{var m;return[y(l(((m=r.eventTypes[t.type])==null?void 0:m.label)||t.type),1)]}),_:2},1032,["color"])]),(T=r.eventTypes[t.type])!=null&&T.isProject?(f(),j(a,{key:0,to:r.getProjectLink((E=t.target)==null?void 0:E.id),class:"text-decoration-none"},{default:o(()=>{var m;return[y(l((m=t.event_data)==null?void 0:m.project_title),1)]}),_:2},1032,["to"])):I("",!0),s[4]||(s[4]=i("div",{class:"mb-2"},null,-1)),(F=r.eventTypes[t.type])!=null&&F.isProject&&!["project_rename","project_commit"].includes(t.type)?(f(),j(S,{key:1,class:"mb-3 project-event",to:r.getProjectLink((M=t.target)==null?void 0:M.id)},{default:o(()=>[n(z,null,{default:o(()=>{var m,u;return[i("div",we,[n(P,{icon:"mdi-source-repository",color:"primary",class:"mr-2"}),i("span",Be,l(((m=t.event_data)==null?void 0:m.project_name)||"未命名项目"),1),i("div",Le,l((u=t.event_data)==null?void 0:u.project_description),1)])]}),_:2},1024)]),_:2},1032,["to"])):["project_rename","project_commit","project_info_update"].includes(t.type)?(f(),g(D,{key:2},[t.type==="project_rename"?(f(),j(S,{key:0,class:"rename-card mb-3",to:r.getProjectLink((R=t.target)==null?void 0:R.id)},{default:o(()=>[n(z,null,{default:o(()=>{var m;return[i("div",Ne,[n(P,{icon:"mdi-rename-box",color:"warning",class:"mr-2"}),i("span",Ee,l((m=t.event_data)==null?void 0:m.project_title),1)]),i("div",Fe,[i("div",Me,[s[0]||(s[0]=i("span",{class:"text-medium-emphasis"},"从",-1)),n(x,{size:"small",class:"mx-2",color:"surface-variant"},{default:o(()=>{var u;return[y(l((u=t.event_data)==null?void 0:u.old_name),1)]}),_:2},1024)]),i("div",Re,[s[1]||(s[1]=i("span",{class:"text-medium-emphasis"},"到",-1)),n(x,{size:"small",class:"mx-2",color:"warning"},{default:o(()=>{var u;return[y(l((u=t.event_data)==null?void 0:u.new_name),1)]}),_:2},1024)])]),i("div",Oe,[n(x,{size:"x-small",class:"mr-1"},{default:o(()=>{var u;return[y(l((u=t.event_data)==null?void 0:u.project_type),1)]}),_:2},1024),n(x,{size:"x-small"},{default:o(()=>{var u;return[y(l((u=t.event_data)==null?void 0:u.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_commit"?(f(),j(S,{key:1,class:"commit-card mb-3",to:r.getProjectLink((O=t.target)==null?void 0:O.id)},{default:o(()=>[n(z,null,{default:o(()=>{var m,u,v;return[i("div",Ae,[n(P,{icon:"mdi-source-commit",color:"info",class:"mr-2"}),i("span",Ue,"分支: "+l((m=t.event_data)==null?void 0:m.branch),1)]),i("div",qe,l((u=t.event_data)==null?void 0:u.commit_message),1),i("div",Ke," 提交ID: "+l((v=t.event_data)==null?void 0:v.commit_id.substring(0,7)),1)]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_info_update"?(f(),j(S,{key:2,class:"info-update-card mb-3",to:r.getProjectLink((A=t.target)==null?void 0:A.id)},{default:o(()=>[n(z,null,{default:o(()=>{var m,u;return[i("div",Ge,[n(P,{icon:"mdi-file-document-edit",color:"info",class:"mr-2"}),i("span",He,l((m=t.event_data)==null?void 0:m.project_title),1)]),i("div",Ze,[(f(!0),g(D,null,W((u=t.event_data)==null?void 0:u.updated_fields,v=>{var G,H;return f(),g("div",{key:v,class:"update-item mb-2"},[i("div",Je,[n(x,{size:"x-small",color:"info",class:"mr-2"},{default:o(()=>[y(l(c.getFieldDisplayName(v)),1)]),_:2},1024)]),i("div",We,[i("div",Xe,[s[2]||(s[2]=i("span",{class:"text-medium-emphasis"},"从：",-1)),i("span",Ye,l((G=t.event_data)==null?void 0:G.old_values[v]),1)]),i("div",Qe,[s[3]||(s[3]=i("span",{class:"text-medium-emphasis"},"到：",-1)),i("span",$e,l((H=t.event_data)==null?void 0:H.new_values[v]),1)])])])}),128))]),i("div",et,[n(x,{size:"x-small",class:"mr-1"},{default:o(()=>{var v;return[y(l((v=t.event_data)==null?void 0:v.project_type),1)]}),_:2},1024),n(x,{size:"x-small"},{default:o(()=>{var v;return[y(l((v=t.event_data)==null?void 0:v.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):I("",!0)],64)):(f(),g("div",tt,[t.type==="user_profile_update"?(f(),g("div",it," 更新了："+l(c.getUpdatedFields((U=t.event_data)==null?void 0:U.updated_fields)),1)):((q=t.target)==null?void 0:q.type)==="project"?(f(),g("div",st,[i("span",null,l(((K=r.eventTypes[t.type])==null?void 0:K.text)||"操作了"),1),n(a,{to:r.getProjectLink(t.target.id),class:"text-decoration-none ml-1"},{default:o(()=>{var m;return[y(l(((m=t.event_data)==null?void 0:m.project_name)||t.target.title||`项目 #${t.target.id}`),1)]}),_:2},1032,["to"])])):(f(),g("div",at,l(c.getTargetContent(t.target,t.type)),1))]))])]}),_:2},1024))),128))]),_:1}),i("div",lt,[c.hasMoreEvents?(f(),j(xe,{key:0,loading:_.isLoadingMore,variant:"tonal",onClick:c.loadMore},{default:o(()=>s[5]||(s[5]=[y(" 加载更多 ")])),_:1,__:[5]},8,["loading","onClick"])):_.timeline.events.length>0?(f(),g("div",ot," 没有更多内容了 ")):I("",!0)])],64)}const rt=he(Se,[["render",nt],["__scopeId","data-v-3223353e"]]);export{rt as _};
