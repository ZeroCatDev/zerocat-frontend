import{_ as me,r as p,x as J,w as fe,b as _e,aa as V,c,o,e as a,N as e,a3 as ge,f as n,$ as b,X as u,Z as H,aw as w,Y as g,F as k,U as C,S as h,L as i,O as _,W as z,a9 as U,i as T,T as ye,Q as F,R as S,aA as pe,j as he,a4 as be,D as K,n as Q,bS as j,bR as ee,aT as N,aV as M,bC as Ve,cw as xe,aC as we,az as ke,a1 as te}from"./index-NKeTyzEk.js";import{V as le}from"./VSelect-CLBac9jt.js";const Ce={class:"flex-grow-1"},ze={key:0,class:"text-grey-600"},Se={key:1,class:"d-flex align-center"},Ne={class:"text-subtitle-2"},$e={class:"text-caption text-grey-600"},Ae={key:2,class:"flex-grow-1"},Pe={class:"text-subtitle-2 mb-1"},Ie={class:"d-flex flex-wrap gap-1"},De={class:"text-h6"},Ue={class:"pa-4"},Be={key:1,class:"text-center py-8"},Oe={key:2,class:"text-center py-8 text-grey-600"},Te={class:"d-flex align-center gap-2"},Fe={class:"d-flex align-center justify-space-between text-caption text-grey-600"},Me={class:"d-flex align-center gap-3"},Le={class:"d-flex align-center"},Ee={class:"d-flex align-center"},Re={key:0,class:"mt-2"},Je={key:4,class:"d-flex justify-center mt-6"},Qe={key:0,class:"pa-4"},Ge={class:"d-flex align-center justify-space-between mb-3"},We={class:"d-flex flex-wrap gap-2 mb-4"},Xe={key:1,class:"pa-4"},Ye={class:"d-flex align-center justify-space-between mb-3"},Ze={class:"position-absolute",style:{top:"8px",right:"8px"}},qe={class:"d-flex align-center gap-2"},He={class:"d-flex align-center justify-space-between text-caption text-grey-600"},Ke={class:"d-flex align-center gap-3"},je={class:"d-flex align-center"},et={class:"d-flex align-center"},tt={key:0,class:"mt-2"},lt={__name:"ProjectSelector",props:{modelValue:{type:[Number,Array],default:()=>null},multiple:{type:Boolean,default:!1},limit:{type:Number,default:20},author:{type:[String,Number,Array],default:null}},emits:["update:modelValue"],setup(y,{emit:ae}){const d=y,G=ae,x=p(!1),B=p(!1),$=p([]),v=p(new Map),O=p(""),L=p("time_down"),E=p(""),A=p(1),R=p(0),se=[{title:"最新发布",value:"time_down"},{title:"最早发布",value:"time_up"},{title:"最多观看",value:"view_down"},{title:"最少观看",value:"view_up"},{title:"最多点赞",value:"star_down"},{title:"最少点赞",value:"star_up"},{title:"ID降序",value:"id_down"},{title:"ID升序",value:"id_up"}],ie=[{title:"所有",value:""},{title:"公开",value:"public"},{title:"私有",value:"private"}],m=J(()=>Array.from(v.value.values())),P=J(()=>d.multiple||!d.modelValue?null:v.value.get(d.modelValue)||null),ue=J(()=>d.multiple?m.value.length>0:!!d.modelValue&&!!P.value),W=s=>v.value.has(s),ne=async()=>{if(!d.author)return null;if(d.author==="me")return V.user.value.id;if(Array.isArray(d.author))return d.author.map(t=>Number(t)).filter(t=>!isNaN(t));const s=Number(d.author);return isNaN(s)?null:s},I=async(s=!0)=>{s&&(A.value=1),B.value=!0;try{const t={curr:A.value,limit:d.limit,search_orderby:L.value,search_state:E.value};O.value&&(t.search_title=O.value);const l=await ne();l!==null&&(t.search_userid=l);const r=(await te.get("/searchapi",{params:t})).data;$.value=r.projects,R.value=r.totalCount}catch(t){console.error("Failed to load projects:",t)}finally{B.value=!1}},oe=()=>{I()},de=s=>{A.value=s,I(!1)},re=s=>{d.multiple?v.value.has(s.id)?v.value.delete(s.id):v.value.set(s.id,s):(v.value.clear(),v.value.set(s.id,s),G("update:modelValue",s.id),x.value=!1)},X=s=>{v.value.delete(s)},Y=()=>{const s=Array.from(v.value.keys());G("update:modelValue",s),x.value=!1},ce=()=>{x.value=!0,$.value.length===0&&I()},Z=s=>new Date(s).toLocaleDateString("zh-CN"),ve=async s=>{try{(await te.post("/project/batch",{projectIds:s})).data.data.forEach(f=>{v.value.has(f.id)&&v.value.set(f.id,f)})}catch(t){console.error("Failed to load project details:",t)}},q=async()=>{if(v.value.clear(),d.modelValue){const s=[];d.multiple&&Array.isArray(d.modelValue)?d.modelValue.forEach(t=>{v.value.set(t,{id:t,title:`项目 ${t}`,loading:!0,author:{display_name:"加载中...",username:"",avatar:"",id:0},description:"加载中...",view_count:0,star_count:0,time:new Date().toISOString(),tags:"",state:"public"}),s.push(t)}):!d.multiple&&typeof d.modelValue=="number"&&(v.value.set(d.modelValue,{id:d.modelValue,title:`项目 ${d.modelValue}`,loading:!0,author:{display_name:"加载中...",username:"",avatar:"",id:0},description:"加载中...",view_count:0,star_count:0,time:new Date().toISOString(),tags:"",state:"public"}),s.push(d.modelValue)),s.length>0&&await ve(s)}};return fe(()=>d.modelValue,(s,t)=>{JSON.stringify(s)!==JSON.stringify(t)&&q()},{immediate:!0,deep:!0}),_e(async()=>{q(),s3BucketUrl.value=get("s3.staticurl"),V.value=V}),(s,t)=>(o(),c("div",null,[a(z,{class:"cursor-pointer",onClick:ce,elevation:"1",rounded:"lg"},{default:e(()=>[a(ge,{class:"d-flex align-center justify-space-between"},{default:e(()=>[n("div",Ce,[ue.value?!y.multiple&&P.value?(o(),c("div",Se,[a(H,{class:"me-2",image:w(V).getUserAvatar(P.value.author.avatar)},null,8,["image"]),n("div",null,[n("div",Ne,u(P.value.title),1),n("div",$e," by "+u(P.value.author.display_name),1)])])):y.multiple?(o(),c("div",Ae,[n("div",Pe," 已选择 "+u(m.value.length)+" 个"+u(y.author==="me"?"我的":"")+"项目 ",1),n("div",Ie,[(o(!0),c(k,null,C(m.value.slice(0,3),l=>(o(),g(h,{key:l.id,size:"small",variant:"outlined",color:"primary"},{default:e(()=>[i(u(l.title),1)]),_:2},1024))),128)),m.value.length>3?(o(),g(h,{key:0,size:"small",variant:"outlined",color:"grey"},{default:e(()=>[i(" +"+u(m.value.length-3),1)]),_:1})):b("",!0)])])):b("",!0):(o(),c("div",ze,u(y.multiple?"选择项目...":"选择一个项目..."),1))]),a(_,null,{default:e(()=>t[6]||(t[6]=[i("mdi-chevron-down",-1)])),_:1,__:[6]})]),_:1})]),_:1}),a(ke,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=l=>x.value=l),"max-width":s.$vuetify.display.mobile?void 0:"1200px",fullscreen:s.$vuetify.display.mobile,scrollable:"",transition:"dialog-transition"},{default:e(()=>[a(z,{border:"",hover:""},{default:e(()=>[a(U,{class:"d-flex align-center justify-space-between pa-4"},{default:e(()=>[n("span",De,u(y.multiple?"选择项目":"选择一个项目"),1),a(T,{icon:"",variant:"text",onClick:t[0]||(t[0]=l=>x.value=!1)},{default:e(()=>[a(_,null,{default:e(()=>t[7]||(t[7]=[i("mdi-close",-1)])),_:1,__:[7]})]),_:1})]),_:1}),a(ye,{fluid:"",class:"pa-0"},{default:e(()=>[a(F,{"no-gutters":""},{default:e(()=>[a(S,{cols:y.multiple&&m.value.length>0?s.$vuetify.display.mobile?12:8:12,order:s.$vuetify.display.mobile?2:1},{default:e(()=>[n("div",Ue,[a(pe,{modelValue:O.value,"onUpdate:modelValue":t[1]||(t[1]=l=>O.value=l),label:"搜索项目","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:oe},null,8,["modelValue"]),a(F,{class:"mb-4"},{default:e(()=>[a(S,{cols:"12",sm:"6"},{default:e(()=>[a(le,{modelValue:L.value,"onUpdate:modelValue":[t[2]||(t[2]=l=>L.value=l),I],items:se,label:"排序",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),a(S,{cols:"12",sm:"6"},{default:e(()=>[a(le,{modelValue:E.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>E.value=l),I],items:ie,label:"状态",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),B.value?(o(),g(he,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):b("",!0),B.value&&$.value.length===0?(o(),c("div",Be,[a(be,{indeterminate:"",size:"48"}),t[8]||(t[8]=n("div",{class:"mt-4 text-h6"},"加载中...",-1))])):$.value.length===0?(o(),c("div",Oe,[a(_,{size:"64",class:"mb-4"},{default:e(()=>t[9]||(t[9]=[i("mdi-folder-open-outline",-1)])),_:1,__:[9]}),t[10]||(t[10]=n("div",{class:"text-h6"},"未找到项目",-1))])):(o(),g(F,{key:3},{default:e(()=>[(o(!0),c(k,null,C($.value,l=>(o(),g(S,{key:l.id,cols:"6",sm:"6",md:"4",lg:"3"},{default:e(()=>[a(z,{class:K(["project-card",{selected:W(l.id)}]),rounded:"lg",elevation:"2",onClick:f=>re(l)},{default:e(()=>{var f;return[a(z,{rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:e(()=>[a(Q,{src:w(ee)(l.thumbnail),class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":j},{default:e(()=>[a(N,null,{default:e(()=>[a(U,{class:"text-white"},{default:e(()=>[i(u(l.title),1)]),_:2},1024),a(M,{class:"text-white"},{default:e(()=>[i(u(l.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024),a(N,{"append-avatar":(f=l.author)!=null&&f.avatar?w(V).getUserAvatar(l.author.avatar):""},{append:e(()=>[n("div",Te,[a(h,{color:l.state==="public"?"success":"warning",size:"small",variant:"outlined"},{default:e(()=>[i(u(l.state==="public"?"公开":"私有"),1)]),_:2},1032,["color"]),W(l.id)?(o(),g(_,{key:0,color:"primary",size:"24"},{default:e(()=>t[11]||(t[11]=[i(" mdi-check-circle ",-1)])),_:1,__:[11]})):b("",!0)])]),default:e(()=>[a(U,null,{default:e(()=>{var r,D;return[i(u(((r=l.author)==null?void 0:r.display_name)||((D=l.author)==null?void 0:D.username)||"未知用户"),1)]}),_:2},1024),a(M,null,{default:e(()=>{var r;return[i("@"+u(((r=l.author)==null?void 0:r.username)||""),1)]}),_:2},1024)]),_:2},1032,["append-avatar"]),a(N,{class:"pt-0"},{default:e(()=>[n("div",Fe,[n("div",Me,[n("div",Le,[a(_,{size:"16",class:"me-1"},{default:e(()=>t[12]||(t[12]=[i("mdi-eye",-1)])),_:1,__:[12]}),i(" "+u(l.view_count),1)]),n("div",Ee,[a(_,{size:"16",class:"me-1"},{default:e(()=>t[13]||(t[13]=[i("mdi-star",-1)])),_:1,__:[13]}),i(" "+u(l.star_count),1)])]),n("div",null,u(Z(l.time)),1)]),l.tags?(o(),c("div",Re,[(o(!0),c(k,null,C(l.tags.split(","),r=>(o(),g(h,{key:r,size:"x-small",variant:"outlined",class:"me-1"},{default:e(()=>[i(u(r.trim()),1)]),_:2},1024))),128))])):b("",!0)]),_:2},1024)]}),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})),R.value>0?(o(),c("div",Je,[a(Ve,{modelValue:A.value,"onUpdate:modelValue":[t[4]||(t[4]=l=>A.value=l),de],length:Math.ceil(R.value/y.limit),"total-visible":7},null,8,["modelValue","length"])])):b("",!0)])]),_:1},8,["cols","order"]),y.multiple&&m.value.length>0?(o(),g(S,{key:0,cols:s.$vuetify.display.mobile?12:4,class:K({"border-s":!s.$vuetify.display.mobile,"border-b":s.$vuetify.display.mobile}),order:s.$vuetify.display.mobile?1:2},{default:e(()=>[s.$vuetify.display.mobile?(o(),c("div",Qe,[n("div",Ge,[t[14]||(t[14]=n("div",{class:"text-h6"},"已选择",-1)),a(h,{border:"",size:"small"},{default:e(()=>[i(u(m.value.length),1)]),_:1})]),n("div",We,[a(xe,{column:""},{default:e(()=>[(o(!0),c(k,null,C(m.value,l=>(o(),g(h,{key:l.id,closable:"",border:"",variant:"text","onClick:close":f=>X(l.id)},{default:e(()=>[a(H,{start:"",size:"24",class:"me-2"},{default:e(()=>[a(Q,{src:w(V).getUserAvatar(l.author.avatar),cover:""},{placeholder:e(()=>[a(_,{size:"12"},{default:e(()=>t[15]||(t[15]=[i("mdi-image",-1)])),_:1,__:[15]})]),_:2},1032,["src"])]),_:2},1024),i(" "+u(l.title),1)]),_:2},1032,["onClick:close"]))),128))]),_:1})]),a(T,{color:"primary",variant:"elevated",block:"",size:"large",onClick:Y},{default:e(()=>[a(_,{start:""},{default:e(()=>t[16]||(t[16]=[i("mdi-check",-1)])),_:1,__:[16]}),i(" 确认选择 ("+u(m.value.length)+") ",1)]),_:1})])):(o(),c("div",Xe,[n("div",Ye,[t[17]||(t[17]=n("div",{class:"text-h6"},"已选择",-1)),a(h,{color:"primary",size:"small"},{default:e(()=>[i(u(m.value.length),1)]),_:1})]),n("div",null,[a(F,null,{default:e(()=>[(o(!0),c(k,null,C(m.value,l=>(o(),g(S,{key:l.id,cols:"12",sm:"6"},{default:e(()=>[a(z,{rounded:"lg",elevation:"2",border:"",hover:""},{default:e(()=>{var f;return[a(z,{rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:e(()=>[a(Q,{src:w(ee)(l.thumbnail),class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":j},{default:e(()=>[a(N,null,{default:e(()=>[a(U,{class:"text-white"},{default:e(()=>[i(u(l.title),1)]),_:2},1024),a(M,{class:"text-white"},{default:e(()=>[i(u(l.description),1)]),_:2},1024)]),_:2},1024),n("div",Ze,[a(T,{icon:"",size:"small",variant:"elevated",color:"error",onClick:we(r=>X(l.id),["stop"])},{default:e(()=>[a(_,{size:"16"},{default:e(()=>t[18]||(t[18]=[i("mdi-close",-1)])),_:1,__:[18]})]),_:2},1032,["onClick"])])]),_:2},1032,["src"])]),_:2},1024),a(N,{"append-avatar":(f=l.author)!=null&&f.avatar?w(V).getUserAvatar(l.author.avatar):""},{append:e(()=>[n("div",qe,[a(h,{color:l.state==="public"?"success":"warning",size:"small",variant:"outlined"},{default:e(()=>[i(u(l.state==="public"?"公开":"私有"),1)]),_:2},1032,["color"])])]),default:e(()=>[a(U,null,{default:e(()=>{var r,D;return[i(u(((r=l.author)==null?void 0:r.display_name)||((D=l.author)==null?void 0:D.username)||"未知用户"),1)]}),_:2},1024),a(M,null,{default:e(()=>{var r;return[i("@"+u(((r=l.author)==null?void 0:r.username)||""),1)]}),_:2},1024)]),_:2},1032,["append-avatar"]),a(N,{class:"pt-0"},{default:e(()=>[n("div",He,[n("div",Ke,[n("div",je,[a(_,{size:"16",class:"me-1"},{default:e(()=>t[19]||(t[19]=[i("mdi-eye",-1)])),_:1,__:[19]}),i(" "+u(l.view_count),1)]),n("div",et,[a(_,{size:"16",class:"me-1"},{default:e(()=>t[20]||(t[20]=[i("mdi-star",-1)])),_:1,__:[20]}),i(" "+u(l.star_count),1)])]),n("div",null,u(Z(l.time)),1)]),l.tags?(o(),c("div",tt,[(o(!0),c(k,null,C(l.tags.split(","),r=>(o(),g(h,{key:r,size:"x-small",variant:"outlined",class:"me-1"},{default:e(()=>[i(u(r.trim()),1)]),_:2},1024))),128))])):b("",!0)]),_:2},1024)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),a(T,{color:"primary",variant:"elevated",block:"",class:"mt-3",size:"large",onClick:Y},{default:e(()=>[a(_,{start:""},{default:e(()=>t[21]||(t[21]=[i("mdi-check",-1)])),_:1,__:[21]}),i(" 确认选择 ("+u(m.value.length)+") ",1)]),_:1})]))]),_:1},8,["cols","class","order"])):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","max-width","fullscreen"])]))}},it=me(lt,[["__scopeId","data-v-0461cbe4"]]);export{it as _};
