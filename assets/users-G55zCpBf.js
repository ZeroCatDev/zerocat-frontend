const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RegionSelector-BKF-li6S.js","assets/index-BySeSNft.js","assets/index-DfB-GPtG.css","assets/VSpacer-CjVyWe_u.js","assets/RegionSelector-IGs0f6Mo.css"])))=>i.map(i=>d[i]);
import{_ as Ue,a1 as N,er as Ne,aa as ze,Y as X,o as L,N as i,e as l,W as P,aN as We,a9 as ve,L as _,aP as qe,O as $,X as k,i as U,a0 as be,a3 as ee,aF as Ce,ah as Ke,ai as pe,V as Qe,q as de,T as ce,Q as oe,R as w,aB as O,f as T,c as G,$ as me,S as Te,Z as Ye,n as Oe,aE as _e,aA as De,F as Ee,U as Fe,ac as Ge,dN as je,es as Ze,ap as Je,m as He,D as we,et as Xe,b1 as ke,aD as Me,a5 as $e,bz as et}from"./index-BySeSNft.js";import{_ as Le}from"./RegionSelector-BKF-li6S.js";import{V as J}from"./VSelect-OdGzKFSb.js";import{V as tt}from"./VTextarea-B995THNE.js";import{V as Z}from"./VSpacer-CjVyWe_u.js";import{V as nt}from"./VDataTable-CWbU3-L_.js";import{V as ot}from"./VSwitch-BhzZ14Le.js";import{g as Re,c as Ve}from"./_commonjsHelpers-BosuxZz1.js";import{d as lt}from"./debounce-BMmXVQ06.js";import{V as it}from"./VDataTableServer-DlzqiDbe.js";import{V as at}from"./VTooltip-Cmm15TWy.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-LaiRG4NO.js";import"./VSelectionControl-QjJuLtJd.js";import"./VTable-BRffUUnI.js";import"./filter-ucDmfyKB.js";const st={name:"UserEditor",components:{RegionSelector:Le},props:{modelValue:{type:Boolean,required:!0},user:{type:Object,required:!0,default:()=>({})}},emits:["update:modelValue","save"],data(){return{tabIndex:1,formValid:!0,saving:!1,showRegionSelector:!1,selectedRegion:null,regionOptions:[],statusOptions:[{text:"活跃",value:"active"},{text:"已暂停",value:"suspended"},{text:"已封禁",value:"banned"},{text:"待验证",value:"pending"}],typeOptions:[{text:"访客",value:"guest"},{text:"普通用户",value:"user"},{text:"管理员",value:"admin"}],sexOptions:[{text:"男",value:"male"},{text:"女",value:"female"},{text:"其他",value:"other"}],contactTypes:[{text:"邮箱",value:"email"},{text:"电话",value:"phone"},{text:"QQ",value:"qq"},{text:"Google",value:"oauth_google"},{text:"GitHub",value:"oauth_github"},{text:"Microsoft",value:"oauth_microsoft"},{text:"40code",value:"oauth_40code"},{text:"LinuxDo",value:"oauth_linuxdo"},{text:"其他",value:"other"}],userData:this.initUserData(),connections:[],loadingConnections:!1,connectionHeaders:[{title:"类型",key:"contact_type",width:"150px"},{title:"验证状态",key:"verified",width:"100px"},{title:"创建时间",key:"created_at",width:"180px"},{title:"操作",key:"actions",width:"100px",sortable:!1}],oauthTypes:[{title:"Google",value:"oauth_google"},{title:"GitHub",value:"oauth_github"},{title:"Microsoft",value:"oauth_microsoft"},{title:"40code",value:"oauth_40code"},{title:"LinuxDo",value:"oauth_linuxdo"},{title:"email",value:"email"},{title:"phone",value:"phone"},{title:"qq",value:"qq"},{title:"other",value:"other"}],connectionDialog:{show:!1,isEdit:!1,valid:!0,saving:!1,data:this.initConnectionData(),infoKeys:[],metadataKeys:[]},deleteConnectionDialog:{show:!1,deleting:!1,connection:null},s3BucketUrl:""}},async created(){try{const t=await Ne(()=>import("./RegionSelector-BKF-li6S.js").then(e=>e.a),__vite__mapDeps([0,1,2,3,4]));this.regionOptions=Object.entries(t.default).map(([e,d])=>({value:e,text:d}))}catch(t){console.error("Error loading region options:",t),this.regionOptions=[]}this.s3BucketUrl=await ze("s3.staticurl")},watch:{user:{handler(t){if(!t){this.userData=this.initUserData(),this.selectedRegion=null;return}if(this.userData=this.initUserData(t),t!=null&&t.region){const e=this.getRegionText(t.region);e?this.selectedRegion={value:t.region,text:e}:this.selectedRegion=null}else this.selectedRegion=null;t!=null&&t.id&&this.loadConnections()},immediate:!0}},methods:{initUserData(t={}){return{id:(t==null?void 0:t.id)??null,username:(t==null?void 0:t.username)??"",display_name:(t==null?void 0:t.display_name)??"",status:(t==null?void 0:t.status)??"active",type:(t==null?void 0:t.type)??"user",email:(t==null?void 0:t.email)??"",featured_projects:(t==null?void 0:t.featured_projects)??"",motto:(t==null?void 0:t.motto)??"",bio:(t==null?void 0:t.bio)??"",location:(t==null?void 0:t.location)??"",region:(t==null?void 0:t.region)??"",birthday:(t==null?void 0:t.birthday)??"",sex:(t==null?void 0:t.sex)??"",url:(t==null?void 0:t.url)??"",custom_status:(t==null?void 0:t.custom_status)??{emoji:"",text:""},avatar:(t==null?void 0:t.avatar)??"",featured_projects:(t==null?void 0:t.featured_projects)??[],contacts:((t==null?void 0:t.contacts)??[]).map(e=>({contact_type:(e==null?void 0:e.contact_type)??"",contact_value:(e==null?void 0:e.contact_value)??"",is_primary:(e==null?void 0:e.is_primary)??!1,verified:(e==null?void 0:e.verified)??!1,contact_info:(e==null?void 0:e.contact_info)??"",metadata:(e==null?void 0:e.metadata)??{}}))}},getRegionText(t){if(!t)return"";const e=this.regionOptions.find(d=>d.value===t);return e?e.text:t},addContact(){this.userData.contacts.push({contact_type:"",contact_value:"",is_primary:!1,verified:!1,contact_info:"",metadata:{}})},removeContact(t){this.userData.contacts.splice(t,1)},onRegionSelect(t){this.selectedRegion=t,this.userData.region=t.value,this.showRegionSelector=!1},onRegionClear(){this.selectedRegion=null,this.userData.region=null,this.showRegionSelector=!1},close(){this.$emit("update:modelValue",!1)},async save(){if(this.$refs.editForm.validate()){this.saving=!0;try{await this.$emit("save",this.userData),this.close()}finally{this.saving=!1}}},initConnectionData(){return{contact_type:"",contact_value:"",contact_info:"",metadata:{},verified:!1}},async loadConnections(){if(this.userData.id){this.loadingConnections=!0;try{const{data:t}=await N.get(`/admin/users/${this.userData.id}/connections`);this.connections=t}catch(t){console.error("Error loading connections:",t)}finally{this.loadingConnections=!1}}},showAddConnectionDialog(){this.connectionDialog.isEdit=!1,this.connectionDialog.data=this.initConnectionData(),this.connectionDialog.infoKeys=[],this.connectionDialog.metadataKeys=[],this.connectionDialog.show=!0},editConnection(t){this.connectionDialog.isEdit=!0,this.connectionDialog.data={...t,metadata:{...t.metadata}},this.connectionDialog.metadataKeys=Object.keys(t.metadata||{}),this.connectionDialog.show=!0},addMetadataField(){const t=`field_${this.connectionDialog.metadataKeys.length+1}`;this.$set(this.connectionDialog.data.metadata,t,""),this.connectionDialog.metadataKeys.push(t)},updateMetadataKey(t,e,d){if(d&&d!==e){const h=this.connectionDialog.data.metadata[e];this.$delete(this.connectionDialog.data.metadata,e),this.$set(this.connectionDialog.data.metadata,d,h),this.connectionDialog.metadataKeys[t]=d}},removeMetadataField(t){this.$delete(this.connectionDialog.data.metadata,t);const e=this.connectionDialog.metadataKeys.indexOf(t);e>-1&&this.connectionDialog.metadataKeys.splice(e,1)},async saveConnection(){var t;if((t=this.$refs.connectionForm)!=null&&t.validate()){this.connectionDialog.saving=!0;try{this.connectionDialog.isEdit?await N.put(`/admin/users/${this.userData.id}/connections/${this.connectionDialog.data.contact_id}`,{contact_info:this.connectionDialog.data.contact_info,contact_value:this.connectionDialog.data.contact_value,metadata:this.connectionDialog.data.metadata,contact_type:this.connectionDialog.data.contact_type,verified:this.connectionDialog.data.verified}):await N.post(`/admin/users/${this.userData.id}/connections`,{contact_info:this.connectionDialog.data.contact_info,contact_value:this.connectionDialog.data.contact_value,metadata:this.connectionDialog.data.metadata,contact_type:this.connectionDialog.data.contact_type,verified:this.connectionDialog.data.verified}),await this.loadConnections(),this.connectionDialog.show=!1}catch(e){console.error("Error saving connection:",e)}finally{this.connectionDialog.saving=!1}}},confirmDeleteConnection(t){this.deleteConnectionDialog.connection=t,this.deleteConnectionDialog.show=!0},async deleteConnection(){if(this.deleteConnectionDialog.connection){this.deleteConnectionDialog.deleting=!0;try{await N.delete(`/admin/users/${this.userData.id}/connections/${this.deleteConnectionDialog.connection.contact_id}`),await this.loadConnections(),this.deleteConnectionDialog.show=!1}catch(t){console.error("Error deleting connection:",t)}finally{this.deleteConnectionDialog.deleting=!1}}},getConnectionTypeText(t){const e=this.oauthTypes.find(d=>d.value===t);return e?e.title:t},getConnectionTypeColor(t){return{oauth_google:"red",oauth_github:"grey-darken-3",oauth_microsoft:"blue",oauth_40code:"purple",oauth_linuxdo:"green"}[t]||"grey"}}},rt={class:"d-flex align-center mb-4"},ut={key:0},dt={key:0},ct={key:1,class:"text-caption"},mt={key:1,class:"text-caption"},ft={class:"d-flex align-center mb-4"},ht={class:"d-flex align-center mb-4"};function gt(t,e,d,h,o,u){const D=Le;return L(),X(De,{"model-value":d.modelValue,"onUpdate:modelValue":e[28]||(e[28]=n=>t.$emit("update:modelValue",n)),"max-width":"800px",persistent:""},{default:i(()=>[l(P,null,{default:i(()=>[l(We,null,{append:i(()=>[l(U,{icon:"",onClick:u.close},{default:i(()=>[l($,null,{default:i(()=>e[31]||(e[31]=[_("mdi-close",-1)])),_:1,__:[31]})]),_:1},8,["onClick"])]),default:i(()=>[l(ve,{class:"headline"},{default:i(()=>e[29]||(e[29]=[_(" 编辑用户信息 ",-1)])),_:1,__:[29]}),l(qe,null,{default:i(()=>[l($,null,{default:i(()=>e[30]||(e[30]=[_("mdi-account",-1)])),_:1,__:[30]}),_(" "+k(o.userData.username),1)]),_:1})]),_:1}),l(be),l(ee,{class:"pt-4"},{default:i(()=>[l(Ce,{ref:"editForm",modelValue:o.formValid,"onUpdate:modelValue":e[15]||(e[15]=n=>o.formValid=n)},{default:i(()=>[l(Ke,{"model-value":o.tabIndex,"onUpdate:modelValue":e[0]||(e[0]=n=>o.tabIndex=n)},{default:i(()=>[l(pe,{value:1},{default:i(()=>e[32]||(e[32]=[_("个人资料",-1)])),_:1,__:[32]}),l(pe,{value:2},{default:i(()=>e[33]||(e[33]=[_("账户连接",-1)])),_:1,__:[33]}),l(pe,{value:3},{default:i(()=>e[34]||(e[34]=[_("头像设置",-1)])),_:1,__:[34]}),l(pe,{value:4},{default:i(()=>e[35]||(e[35]=[_("数据",-1)])),_:1,__:[35]})]),_:1},8,["model-value"]),l(ee,null,{default:i(()=>[l(Qe,{"model-value":o.tabIndex,"onUpdate:modelValue":e[14]||(e[14]=n=>o.tabIndex=n)},{default:i(()=>[l(de,{value:0},{default:i(()=>[l(ce,null,{default:i(()=>[l(oe)]),_:1})]),_:1}),l(de,{value:1},{default:i(()=>[l(ce,null,{default:i(()=>[l(oe,null,{default:i(()=>[l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.display_name,"onUpdate:modelValue":e[1]||(e[1]=n=>o.userData.display_name=n),label:"显示名称",rules:[n=>!!n||"显示名称不能为空"],outlined:"",dense:""},null,8,["modelValue","rules"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.username,"onUpdate:modelValue":e[2]||(e[2]=n=>o.userData.username=n),label:"用户名",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(J,{modelValue:o.userData.status,"onUpdate:modelValue":e[3]||(e[3]=n=>o.userData.status=n),items:o.statusOptions,"item-title":"text","item-value":"value",label:"用户状态",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(J,{modelValue:o.userData.type,"onUpdate:modelValue":e[4]||(e[4]=n=>o.userData.type=n),items:o.typeOptions,"item-title":"text","item-value":"value",label:"用户类型",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.email,"onUpdate:modelValue":e[5]||(e[5]=n=>o.userData.email=n),label:"邮箱",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.featured_projects,"onUpdate:modelValue":e[6]||(e[6]=n=>o.userData.featured_projects=n),label:"精选项目",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.motto,"onUpdate:modelValue":e[7]||(e[7]=n=>o.userData.motto=n),label:"一句话简介",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.location,"onUpdate:modelValue":e[8]||(e[8]=n=>o.userData.location=n),label:"位置",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{"model-value":o.selectedRegion?o.selectedRegion.text:"",label:"地区",outlined:"",dense:"",readonly:"",onClick:e[9]||(e[9]=n=>o.showRegionSelector=!0)},null,8,["model-value"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(O,{modelValue:o.userData.url,"onUpdate:modelValue":e[10]||(e[10]=n=>o.userData.url=n),label:"个人主页",outlined:"",dense:""},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:i(()=>[l(J,{modelValue:o.userData.sex,"onUpdate:modelValue":e[11]||(e[11]=n=>o.userData.sex=n),items:o.sexOptions,"item-title":"text","item-value":"value",label:"性别",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),l(w,{cols:"12"},{default:i(()=>[l(tt,{modelValue:o.userData.bio,"onUpdate:modelValue":e[12]||(e[12]=n=>o.userData.bio=n),label:"个人简介",outlined:"",dense:"",rows:"3",hint:"支持 Markdown 格式","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(de,{value:2},{default:i(()=>[l(ce,null,{default:i(()=>[l(oe,null,{default:i(()=>[l(w,{cols:"12"},{default:i(()=>[T("div",rt,[e[37]||(e[37]=T("h3",{class:"text-h6"},"连接",-1)),l(Z),l(U,{color:"primary","prepend-icon":"mdi-plus",onClick:u.showAddConnectionDialog},{default:i(()=>e[36]||(e[36]=[_(" 添加连接 ",-1)])),_:1,__:[36]},8,["onClick"])]),l(nt,{headers:o.connectionHeaders,items:o.connections,loading:o.loadingConnections,class:"elevation-1"},{"item.contact_type":i(({item:n})=>[l(Te,{color:u.getConnectionTypeColor(n.contact_type),size:"small"},{default:i(()=>[_(k(u.getConnectionTypeText(n.contact_type)),1)]),_:2},1032,["color"])]),"item.verified":i(({item:n})=>[l($,{color:n.verified?"success":"warning",icon:n.verified?"mdi-check-circle":"mdi-alert-circle"},null,8,["color","icon"]),_(" "+k(n.verified?"已验证":"未验证"),1)]),"item.contact_info":i(({item:n})=>[n.contact_info?(L(),G("div",ut,[n.contact_info.username?(L(),G("div",dt," 用户名: "+k(n.contact_info.username),1)):me("",!0),n.contact_info.email?(L(),G("div",ct," 邮箱: "+k(n.contact_info.email),1)):me("",!0)])):(L(),G("span",mt,"无详细信息"))]),"item.actions":i(({item:n})=>[l(U,{icon:"mdi-pencil",size:"small",class:"mr-2",onClick:m=>u.editConnection(n)},null,8,["onClick"]),l(U,{icon:"mdi-delete",size:"small",color:"error",onClick:m=>u.confirmDeleteConnection(n)},null,8,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),l(de,{value:3},{default:i(()=>[l(ce,null,{default:i(()=>[l(oe,{justify:"center",align:"center"},{default:i(()=>[l(w,{cols:"12",class:"text-center"},{default:i(()=>[l(Ye,{size:"150",class:"mb-4"},{default:i(()=>[l(Oe,{src:o.s3BucketUrl+"/user/"+o.userData.avatar},null,8,["src"])]),_:1}),T("div",null,[l(O,{modelValue:o.userData.avatar,"onUpdate:modelValue":e[13]||(e[13]=n=>o.userData.avatar=n),label:"头像图片哈希",outlined:"",dense:"",class:"mt-4"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),l(de,{value:4},{default:i(()=>[T("pre",null,k(o.userData),1)]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(be),l(_e,null,{default:i(()=>[l(Z),l(U,{text:"",onClick:u.close},{default:i(()=>e[38]||(e[38]=[_("取消",-1)])),_:1,__:[38]},8,["onClick"]),l(U,{color:"primary",loading:o.saving,disabled:!o.formValid||o.saving,onClick:u.save},{default:i(()=>e[39]||(e[39]=[_(" 保存 ",-1)])),_:1,__:[39]},8,["loading","disabled","onClick"])]),_:1})]),_:1}),l(D,{modelValue:o.showRegionSelector,"onUpdate:modelValue":e[16]||(e[16]=n=>o.showRegionSelector=n),"selected-region":o.selectedRegion,onSelect:u.onRegionSelect,onClear:u.onRegionClear},null,8,["modelValue","selected-region","onSelect","onClear"]),l(De,{modelValue:o.connectionDialog.show,"onUpdate:modelValue":e[25]||(e[25]=n=>o.connectionDialog.show=n),"max-width":"800px"},{default:i(()=>[l(P,null,{default:i(()=>[l(ve,null,{default:i(()=>[_(k(o.connectionDialog.isEdit?"编辑连接 #"+o.connectionDialog.data.contact_id:"添加新连接"),1)]),_:1}),l(ee,null,{default:i(()=>[l(Ce,{ref:"connectionForm",modelValue:o.connectionDialog.valid,"onUpdate:modelValue":e[23]||(e[23]=n=>o.connectionDialog.valid=n)},{default:i(()=>[o.connectionDialog.isEdit?me("",!0):(L(),X(J,{key:0,modelValue:o.connectionDialog.data.contact_type,"onUpdate:modelValue":e[17]||(e[17]=n=>o.connectionDialog.data.contact_type=n),items:o.oauthTypes,label:"连接类型",required:"",rules:[n=>!!n||"请选择连接类型"]},null,8,["modelValue","items","rules"])),o.connectionDialog.isEdit?me("",!0):(L(),X(O,{key:1,modelValue:o.connectionDialog.data.contact_value,"onUpdate:modelValue":e[18]||(e[18]=n=>o.connectionDialog.data.contact_value=n),label:"提供商用户ID",required:"",rules:[n=>!!n||"请输入提供商用户ID"]},null,8,["modelValue","rules"])),l(P,{class:"mt-4 pa-4",variant:"outlined"},{default:i(()=>[T("div",ft,[e[40]||(e[40]=T("div",{class:"text-subtitle-1"},"连接信息",-1)),l(Z)]),l(O,{modelValue:o.connectionDialog.data.contact_value,"onUpdate:modelValue":e[19]||(e[19]=n=>o.connectionDialog.data.contact_value=n),label:"连接值",outlined:"",dense:""},null,8,["modelValue"]),l(O,{modelValue:o.connectionDialog.data.contact_info,"onUpdate:modelValue":e[20]||(e[20]=n=>o.connectionDialog.data.contact_info=n),label:"随机值",outlined:"",dense:""},null,8,["modelValue"]),l(J,{modelValue:o.connectionDialog.data.contact_type,"onUpdate:modelValue":e[21]||(e[21]=n=>o.connectionDialog.data.contact_type=n),items:o.oauthTypes,label:"连接类型",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1}),l(P,{class:"mt-4 pa-4",variant:"outlined"},{default:i(()=>[T("div",ht,[e[42]||(e[42]=T("div",{class:"text-subtitle-1"},"元数据",-1)),l(Z),l(U,{color:"primary",size:"small","prepend-icon":"mdi-plus",onClick:u.addMetadataField},{default:i(()=>e[41]||(e[41]=[_(" 添加字段 ",-1)])),_:1,__:[41]},8,["onClick"])]),(L(!0),G(Ee,null,Fe(o.connectionDialog.data.metadata,(n,m,v)=>(L(),G("div",{key:v,class:"d-flex align-center mb-2 gap-2"},[l(O,{modelValue:o.connectionDialog.metadataKeys[v],"onUpdate:modelValue":[x=>o.connectionDialog.metadataKeys[v]=x,x=>u.updateMetadataKey(v,m,x)],label:"字段名",density:"compact","hide-details":"",class:"flex-grow-0",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),l(O,{modelValue:o.connectionDialog.data.metadata[m],"onUpdate:modelValue":x=>o.connectionDialog.data.metadata[m]=x,label:"值",density:"compact","hide-details":"",class:"flex-grow-1"},null,8,["modelValue","onUpdate:modelValue"]),l(U,{icon:"mdi-delete",color:"error",size:"small",variant:"text",onClick:x=>u.removeMetadataField(m)},null,8,["onClick"])]))),128))]),_:1}),l(ot,{modelValue:o.connectionDialog.data.verified,"onUpdate:modelValue":e[22]||(e[22]=n=>o.connectionDialog.data.verified=n),label:"已验证",color:"success","hide-details":"",class:"mt-4"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(_e,null,{default:i(()=>[l(Z),l(U,{text:"",onClick:e[24]||(e[24]=n=>o.connectionDialog.show=!1)},{default:i(()=>e[43]||(e[43]=[_(" 取消 ",-1)])),_:1,__:[43]}),l(U,{color:"primary",loading:o.connectionDialog.saving,disabled:!o.connectionDialog.valid||o.connectionDialog.saving,onClick:u.saveConnection},{default:i(()=>e[44]||(e[44]=[_(" 保存 ",-1)])),_:1,__:[44]},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(De,{modelValue:o.deleteConnectionDialog.show,"onUpdate:modelValue":e[27]||(e[27]=n=>o.deleteConnectionDialog.show=n),"max-width":"400px"},{default:i(()=>[l(P,null,{default:i(()=>[l(ve,{class:"text-h5 text-error"},{default:i(()=>e[45]||(e[45]=[_(" 确认删除连接 ",-1)])),_:1,__:[45]}),l(ee,null,{default:i(()=>{var n;return[_(" 确定要删除这个 "+k(u.getConnectionTypeText((n=o.deleteConnectionDialog.connection)==null?void 0:n.contact_type))+" 连接吗？此操作不可撤销。 ",1)]}),_:1}),l(_e,null,{default:i(()=>[l(Z),l(U,{text:"",onClick:e[26]||(e[26]=n=>o.deleteConnectionDialog.show=!1)},{default:i(()=>e[46]||(e[46]=[_(" 取消 ",-1)])),_:1,__:[46]}),l(U,{color:"error",loading:o.deleteConnectionDialog.deleting,onClick:u.deleteConnection},{default:i(()=>e[47]||(e[47]=[_(" 确认删除 ",-1)])),_:1,__:[47]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model-value"])}const Ie=Ue(st,[["render",gt],["__scopeId","data-v-450d53c4"]]);var Ae={exports:{}};(function(t,e){(function(d,h){t.exports=h()})(Ve,function(){var d=1e3,h=6e4,o=36e5,u="millisecond",D="second",n="minute",m="hour",v="day",x="week",C="month",A="quarter",E="year",I="date",z="Invalid Date",le=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ie=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ae={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(f){var r=["th","st","nd","rd"],a=f%100;return"["+f+(r[(a-20)%10]||r[a]||r[0])+"]"}},se=function(f,r,a){var c=String(f);return!c||c.length>=r?f:""+Array(r+1-c.length).join(a)+f},W={s:se,z:function(f){var r=-f.utcOffset(),a=Math.abs(r),c=Math.floor(a/60),s=a%60;return(r<=0?"+":"-")+se(c,2,"0")+":"+se(s,2,"0")},m:function f(r,a){if(r.date()<a.date())return-f(a,r);var c=12*(a.year()-r.year())+(a.month()-r.month()),s=r.clone().add(c,C),g=a-s<0,p=r.clone().add(c+(g?-1:1),C);return+(-(c+(a-s)/(g?s-p:p-s))||0)},a:function(f){return f<0?Math.ceil(f)||0:Math.floor(f)},p:function(f){return{M:C,y:E,w:x,d:v,D:I,h:m,m:n,s:D,ms:u,Q:A}[f]||String(f||"").toLowerCase().replace(/s$/,"")},u:function(f){return f===void 0}},F="en",j={};j[F]=ae;var te="$isDayjsObject",q=function(f){return f instanceof he||!(!f||!f[te])},fe=function f(r,a,c){var s;if(!r)return F;if(typeof r=="string"){var g=r.toLowerCase();j[g]&&(s=g),a&&(j[g]=a,s=g);var p=r.split("-");if(!s&&p.length>1)return f(p[0])}else{var V=r.name;j[V]=r,s=V}return!c&&s&&(F=s),s||!c&&F},M=function(f,r){if(q(f))return f.clone();var a=typeof r=="object"?r:{};return a.date=f,a.args=arguments,new he(a)},y=W;y.l=fe,y.i=q,y.w=function(f,r){return M(f,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var he=function(){function f(a){this.$L=fe(a.locale,null,!0),this.parse(a),this.$x=this.$x||a.x||{},this[te]=!0}var r=f.prototype;return r.parse=function(a){this.$d=function(c){var s=c.date,g=c.utc;if(s===null)return new Date(NaN);if(y.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var p=s.match(le);if(p){var V=p[2]-1||0,b=(p[7]||"0").substring(0,3);return g?new Date(Date.UTC(p[1],V,p[3]||1,p[4]||0,p[5]||0,p[6]||0,b)):new Date(p[1],V,p[3]||1,p[4]||0,p[5]||0,p[6]||0,b)}}return new Date(s)}(a),this.init()},r.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},r.$utils=function(){return y},r.isValid=function(){return this.$d.toString()!==z},r.isSame=function(a,c){var s=M(a);return this.startOf(c)<=s&&s<=this.endOf(c)},r.isAfter=function(a,c){return M(a)<this.startOf(c)},r.isBefore=function(a,c){return this.endOf(c)<M(a)},r.$g=function(a,c,s){return y.u(a)?this[c]:this.set(s,a)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(a,c){var s=this,g=!!y.u(c)||c,p=y.p(a),V=function(Q,H){var B=y.w(s.$u?Date.UTC(s.$y,H,Q):new Date(s.$y,H,Q),s);return g?B:B.endOf(v)},b=function(Q,H){return y.w(s.toDate()[Q].apply(s.toDate("s"),(g?[0,0,0,0]:[23,59,59,999]).slice(H)),s)},S=this.$W,Y=this.$M,R=this.$D,ne="set"+(this.$u?"UTC":"");switch(p){case E:return g?V(1,0):V(31,11);case C:return g?V(1,Y):V(0,Y+1);case x:var K=this.$locale().weekStart||0,re=(S<K?S+7:S)-K;return V(g?R-re:R+(6-re),Y);case v:case I:return b(ne+"Hours",0);case m:return b(ne+"Minutes",1);case n:return b(ne+"Seconds",2);case D:return b(ne+"Milliseconds",3);default:return this.clone()}},r.endOf=function(a){return this.startOf(a,!1)},r.$set=function(a,c){var s,g=y.p(a),p="set"+(this.$u?"UTC":""),V=(s={},s[v]=p+"Date",s[I]=p+"Date",s[C]=p+"Month",s[E]=p+"FullYear",s[m]=p+"Hours",s[n]=p+"Minutes",s[D]=p+"Seconds",s[u]=p+"Milliseconds",s)[g],b=g===v?this.$D+(c-this.$W):c;if(g===C||g===E){var S=this.clone().set(I,1);S.$d[V](b),S.init(),this.$d=S.set(I,Math.min(this.$D,S.daysInMonth())).$d}else V&&this.$d[V](b);return this.init(),this},r.set=function(a,c){return this.clone().$set(a,c)},r.get=function(a){return this[y.p(a)]()},r.add=function(a,c){var s,g=this;a=Number(a);var p=y.p(c),V=function(Y){var R=M(g);return y.w(R.date(R.date()+Math.round(Y*a)),g)};if(p===C)return this.set(C,this.$M+a);if(p===E)return this.set(E,this.$y+a);if(p===v)return V(1);if(p===x)return V(7);var b=(s={},s[n]=h,s[m]=o,s[D]=d,s)[p]||1,S=this.$d.getTime()+a*b;return y.w(S,this)},r.subtract=function(a,c){return this.add(-1*a,c)},r.format=function(a){var c=this,s=this.$locale();if(!this.isValid())return s.invalidDate||z;var g=a||"YYYY-MM-DDTHH:mm:ssZ",p=y.z(this),V=this.$H,b=this.$m,S=this.$M,Y=s.weekdays,R=s.months,ne=s.meridiem,K=function(H,B,ue,ge){return H&&(H[B]||H(c,g))||ue[B].slice(0,ge)},re=function(H){return y.s(V%12||12,H,"0")},Q=ne||function(H,B,ue){var ge=H<12?"AM":"PM";return ue?ge.toLowerCase():ge};return g.replace(ie,function(H,B){return B||function(ue){switch(ue){case"YY":return String(c.$y).slice(-2);case"YYYY":return y.s(c.$y,4,"0");case"M":return S+1;case"MM":return y.s(S+1,2,"0");case"MMM":return K(s.monthsShort,S,R,3);case"MMMM":return K(R,S);case"D":return c.$D;case"DD":return y.s(c.$D,2,"0");case"d":return String(c.$W);case"dd":return K(s.weekdaysMin,c.$W,Y,2);case"ddd":return K(s.weekdaysShort,c.$W,Y,3);case"dddd":return Y[c.$W];case"H":return String(V);case"HH":return y.s(V,2,"0");case"h":return re(1);case"hh":return re(2);case"a":return Q(V,b,!0);case"A":return Q(V,b,!1);case"m":return String(b);case"mm":return y.s(b,2,"0");case"s":return String(c.$s);case"ss":return y.s(c.$s,2,"0");case"SSS":return y.s(c.$ms,3,"0");case"Z":return p}return null}(H)||p.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(a,c,s){var g,p=this,V=y.p(c),b=M(a),S=(b.utcOffset()-this.utcOffset())*h,Y=this-b,R=function(){return y.m(p,b)};switch(V){case E:g=R()/12;break;case C:g=R();break;case A:g=R()/3;break;case x:g=(Y-S)/6048e5;break;case v:g=(Y-S)/864e5;break;case m:g=Y/o;break;case n:g=Y/h;break;case D:g=Y/d;break;default:g=Y}return s?g:y.a(g)},r.daysInMonth=function(){return this.endOf(C).$D},r.$locale=function(){return j[this.$L]},r.locale=function(a,c){if(!a)return this.$L;var s=this.clone(),g=fe(a,c,!0);return g&&(s.$L=g),s},r.clone=function(){return y.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},f}(),xe=he.prototype;return M.prototype=xe,[["$ms",u],["$s",D],["$m",n],["$H",m],["$W",v],["$M",C],["$y",E],["$D",I]].forEach(function(f){xe[f[1]]=function(r){return this.$g(r,f[0],f[1])}}),M.extend=function(f,r){return f.$i||(f(r,he,M),f.$i=!0),M},M.locale=fe,M.isDayjs=q,M.unix=function(f){return M(1e3*f)},M.en=j[F],M.Ls=j,M.p={},M})})(Ae);var Pe=Ae.exports;const ye=Re(Pe);var Be={exports:{}};(function(t,e){(function(d,h){t.exports=h()})(Ve,function(){return function(d,h,o){d=d||{};var u=h.prototype,D={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function n(v,x,C,A){return u.fromToBase(v,x,C,A)}o.en.relativeTime=D,u.fromToBase=function(v,x,C,A,E){for(var I,z,le,ie=C.$locale().relativeTime||D,ae=d.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],se=ae.length,W=0;W<se;W+=1){var F=ae[W];F.d&&(I=A?o(v).diff(C,F.d,!0):C.diff(v,F.d,!0));var j=(d.rounding||Math.round)(Math.abs(I));if(le=I>0,j<=F.r||!F.r){j<=1&&W>0&&(F=ae[W-1]);var te=ie[F.l];E&&(j=E(""+j)),z=typeof te=="string"?te.replace("%d",j):te(j,x,F.l,le);break}}if(x)return z;var q=le?ie.future:ie.past;return typeof q=="function"?q(z):q.replace("%s",z)},u.to=function(v,x){return n(v,x,this,!0)},u.from=function(v,x){return n(v,x,this)};var m=function(v){return v.$u?o.utc():o()};u.toNow=function(v){return this.to(m(this),v)},u.fromNow=function(v){return this.from(m(this),v)}}})})(Be);var pt=Be.exports;const vt=Re(pt);var _t={exports:{}};(function(t,e){(function(d,h){t.exports=h(Pe)})(Ve,function(d){function h(D){return D&&typeof D=="object"&&"default"in D?D:{default:D}}var o=h(d),u={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(D,n){return n==="W"?D+"周":D+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(D,n){var m=100*D+n;return m<600?"凌晨":m<900?"早上":m<1100?"上午":m<1300?"中午":m<1800?"下午":"晚上"}};return o.default.locale(u,null,!0),u})})(_t);function Dt(t,e){const d=typeof t=="string"?Ge(t):t,h=yt(d,e);return{mounted:h,updated:h,unmounted(o){je(null,o)}}}function yt(t,e){return function(d,h,o){var C,A,E;const u=typeof e=="function"?e(h):e,D=((C=h.value)==null?void 0:C.text)??h.value??(u==null?void 0:u.text),n=Ze(h.value)?h.value:{},m=()=>D??d.textContent,v=(o.ctx===h.instance.$?(A=Vt(o,h.instance.$))==null?void 0:A.provides:(E=o.ctx)==null?void 0:E.provides)??h.instance.$.provides,x=Je(t,He(u,n),m);x.appContext=Object.assign(Object.create(null),h.instance.$.appContext,{provides:v}),je(x,d)}}function Vt(t,e){const d=new Set,h=u=>{var D,n;for(const m of u){if(!m)continue;if(m===t||m.el&&t.el&&m.el===t.el)return!0;d.add(m);let v;if(m.suspense?v=h([m.ssContent]):Array.isArray(m.children)?v=h(m.children):(D=m.component)!=null&&D.vnode&&(v=h([(n=m.component)==null?void 0:n.subTree])),v)return v;d.delete(m)}return!1};if(!h([e.subTree]))return e;const o=Array.from(d).reverse();for(const u of o)if(u.component)return u.component;return e}const Se=Dt(at,t=>{var e;return{activator:"parent",location:(e=t.arg)==null?void 0:e.replace("-"," "),text:typeof t.value=="boolean"?void 0:t.value}});ye.extend(vt);ye.locale("zh-cn");const xt={name:"UsersPage",components:{UserEditor:Ie},data(){return{userStats:[{title:"总用户数",value:0,type:"total",icon:"mdi-account-group"},{title:"活跃用户",value:0,type:"active",icon:"mdi-account-check"}],users:[],total:0,loading:!1,refreshing:!1,options:{page:1,itemsPerPage:10,sortBy:["id"],sortDesc:[!1],groupBy:[],groupDesc:[],multiSort:!1},headers:[{title:"ID",value:"id",width:"80px",sortable:!1},{title:"用户",value:"username",width:"250px",sortable:!1},{title:"邮箱",value:"email",sortable:!1},{title:"状态",value:"status",width:"120px",sortable:!1},{title:"类型",value:"type",width:"120px",sortable:!1},{title:"注册时间",value:"regTime",width:"180px",sortable:!1},{title:"操作",value:"actions",sortable:!1,width:"150px",align:"center"}],searchQuery:"",statusFilter:"",typeFilter:"",statusOptions:[{title:"活跃",value:"active"},{title:"已暂停",value:"suspended"},{title:"已封禁",value:"banned"},{title:"待验证",value:"pending"}],typeOptions:[{title:"访客",value:"guest"},{title:"普通用户",value:"user"},{title:"管理员",value:"administrator"}],editDialog:!1,deleteDialog:!1,deleteConfirmation:"",selectedUser:null,deleting:!1,snackbar:{show:!1,text:"",color:"success",timeout:3e3}}},methods:{async loadUsers(){this.loading=!0;try{const t={page:this.options.page,itemsPerPage:this.options.itemsPerPage,sort_by:this.options.sortBy[0]||"id",sort_order:this.options.sortDesc[0]?"desc":"asc"};this.searchQuery&&(t.search=this.searchQuery),this.statusFilter&&(t.status=this.statusFilter),this.typeFilter&&(t.type=this.typeFilter);const{data:e}=await N.get("/admin/users",{params:t});this.users=e.items.map(d=>({...d,id:d.id,username:d.username,email:d.email||"",status:d.status||"pending",type:d.type||"user",regTime:d.regTime,avatar:d.avatar})),this.total=Number(e.total)}catch(t){this.showError("加载用户列表失败"),console.error("Error loading users:",t)}finally{this.loading=!1}},async loadUserStats(){var t;try{const{data:e}=await N.get("/admin/users/stats/overview");this.userStats[0].value=e.totalUsers,this.userStats[1].value=((t=e.usersByStatus.find(d=>d.status==="active"))==null?void 0:t._count)||0}catch(e){console.error("Error loading user stats:",e)}},async refreshData(){if(!(this.refreshing||this.loading)){this.refreshing=!0;try{await Promise.all([this.loadUsers(),this.loadUserStats()]),this.showSuccess("数据已更新")}catch(t){this.showError("刷新数据失败"),console.error("Error refreshing data:",t)}finally{this.refreshing=!1}}},editUser(t){this.selectedUser=t,this.editDialog=!0},async saveUser(t){var e,d;try{const{data:h}=await N.put(`/admin/users/${t.id}`,t),o=this.users.findIndex(u=>u.id===t.id);o!==-1&&(this.users[o]={...this.users[o],...h}),this.showSuccess("用户信息更新成功")}catch(h){throw this.showError(((d=(e=h.response)==null?void 0:e.data)==null?void 0:d.error)||"保存用户信息失败"),console.error("Error saving user:",h),h}},confirmDelete(t){this.selectedUser=t,this.deleteConfirmation="",this.deleteDialog=!0},async deleteUser(){this.deleting=!0;try{await N.delete(`/admin/users/${this.selectedUser.id}`),this.showSuccess("用户删除成功"),this.loadUsers(),this.loadUserStats(),this.deleteDialog=!1}catch(t){this.showError("删除用户失败"),console.error("Error deleting user:",t)}finally{this.deleting=!1}},getStatusText(t){const e=this.statusOptions.find(d=>d.value===t);return e?e.title:t},getTypeText(t){const e=this.typeOptions.find(d=>d.value===t);return e?e.title:t},formatDate(t){return ye(t).format("YYYY-MM-DD HH:mm:ss")},formatTimeAgo(t){return ye(t).fromNow()},getStatusColor(t){return{active:"success",suspended:"warning",banned:"error",pending:"info"}[t]||"grey"},getAvatarUrl(t){return t?t.startsWith("http")?t:`/api/avatar/${t}`:"/default-avatar.png"},showSuccess(t){this.snackbar={show:!0,text:t,color:"success",timeout:3e3}},showError(t){this.snackbar={show:!0,text:t,color:"error",timeout:5e3}},debouncedSearch:lt(function(){this.loadUsers()},300)},mounted(){this.loadUsers(),this.loadUserStats()}},bt={class:"users-admin"},Ct={class:"text-overline mb-2"},wt={class:"text-h4"},kt={class:"d-flex align-center"},Mt={class:"font-weight-medium"},St={class:"caption grey--text"},Ut={class:"caption grey--text"};function Tt(t,e,d,h,o,u){const D=Ie;return L(),X(ce,null,{default:i(()=>[T("div",bt,[l(oe,{class:"mb-4"},{default:i(()=>[(L(!0),G(Ee,null,Fe(o.userStats,n=>(L(),X(w,{key:n.title,cols:"12",sm:"6",md:"3"},{default:i(()=>[l(P,{class:we(["stat-card",`stat-${n.type}`]),elevation:"2"},{default:i(()=>[l(ee,null,{default:i(()=>[T("div",Ct,k(n.title),1),T("div",wt,k(n.value),1),l($,{class:"stat-icon",large:""},{default:i(()=>[_(k(n.icon),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),l(P,{class:"mb-4"},{default:i(()=>[l(ee,null,{default:i(()=>[l(oe,{align:"center"},{default:i(()=>[l(w,{cols:"12",sm:"4"},{default:i(()=>[l(O,{modelValue:o.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=n=>o.searchQuery=n),label:"搜索用户","prepend-icon":"mdi-magnify",clearable:"",onInput:u.debouncedSearch,"hide-details":""},null,8,["modelValue","onInput"])]),_:1}),l(w,{cols:"12",sm:"3"},{default:i(()=>[l(J,{modelValue:o.statusFilter,"onUpdate:modelValue":e[1]||(e[1]=n=>o.statusFilter=n),items:o.statusOptions,label:"状态过滤","prepend-icon":"mdi-filter",clearable:"",onChange:u.loadUsers,"hide-details":""},null,8,["modelValue","items","onChange"])]),_:1}),l(w,{cols:"12",sm:"3"},{default:i(()=>[l(J,{modelValue:o.typeFilter,"onUpdate:modelValue":e[2]||(e[2]=n=>o.typeFilter=n),items:o.typeOptions,label:"类型过滤","prepend-icon":"mdi-account-filter",clearable:"",onChange:u.loadUsers,"hide-details":""},null,8,["modelValue","items","onChange"])]),_:1}),l(w,{cols:"12",sm:"2",class:"d-flex justify-end"},{default:i(()=>[l(U,{color:"primary",onClick:u.refreshData,loading:o.refreshing,disabled:o.loading},{default:i(()=>[l($,{left:"",class:we({rotate:o.refreshing})},{default:i(()=>e[11]||(e[11]=[_("mdi-refresh",-1)])),_:1,__:[11]},8,["class"]),e[12]||(e[12]=_(" 刷新 ",-1))]),_:1,__:[12]},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(P,null,{default:i(()=>[l(it,{headers:o.headers,items:o.users,"items-length":o.total,loading:o.loading,"items-per-page":o.options.itemsPerPage,"onUpdate:itemsPerPage":e[3]||(e[3]=n=>o.options.itemsPerPage=n),page:o.options.page,"onUpdate:page":e[4]||(e[4]=n=>o.options.page=n),"onUpdate:options":u.loadUsers,"no-data-text":"暂无数据","no-results-text":"未找到匹配的数据","loading-text":"加载中..."},{"item.username":i(({item:n})=>[T("div",kt,[l(Ye,{size:"32",class:"mr-2"},{default:i(()=>[l(Oe,{src:u.getAvatarUrl(n.avatar),alt:n.username},null,8,["src","alt"])]),_:2},1024),T("div",null,[T("div",Mt,k(n.username),1),T("div",St,k(n.display_name),1)])])]),"item.status":i(({item:n})=>[l(Te,{color:u.getStatusColor(n.status),small:"",class:"status-chip"},{default:i(()=>[_(k(u.getStatusText(n.status)),1)]),_:2},1032,["color"])]),"item.type":i(({item:n})=>[_(k(u.getTypeText(n.type)),1)]),"item.regTime":i(({item:n})=>[T("div",null,k(u.formatDate(n.regTime)),1),T("div",Ut,k(u.formatTimeAgo(n.regTime)),1)]),"item.actions":i(({item:n})=>[l(Xe,{group:""},{default:i(()=>[ke((L(),X(U,{icon:"",small:"",class:"action-btn",onClick:Me(m=>u.editUser(n),["stop"])},{default:i(()=>[l($,null,{default:i(()=>e[13]||(e[13]=[_("mdi-pencil",-1)])),_:1,__:[13]})]),_:2},1032,["onClick"])),[[Se,"编辑用户"]]),n.type!=="administrator"?ke((L(),X(U,{key:0,icon:"",small:"",class:"action-btn",onClick:Me(m=>u.confirmDelete(n),["stop"])},{default:i(()=>[l($,null,{default:i(()=>e[14]||(e[14]=[_("mdi-delete",-1)])),_:1,__:[14]})]),_:2},1032,["onClick"])),[[Se,"删除用户"]]):me("",!0)]),_:2},1024)]),_:1},8,["headers","items","items-length","loading","items-per-page","page","onUpdate:options"])]),_:1}),l(D,{modelValue:o.editDialog,"onUpdate:modelValue":e[5]||(e[5]=n=>o.editDialog=n),user:o.selectedUser,onSave:u.saveUser},null,8,["modelValue","user","onSave"]),l(De,{modelValue:o.deleteDialog,"onUpdate:modelValue":e[8]||(e[8]=n=>o.deleteDialog=n),"max-width":"400px",transition:"dialog-bottom-transition"},{default:i(()=>[l(P,null,{default:i(()=>[l(ve,{class:"headline error--text"},{default:i(()=>e[15]||(e[15]=[_("确认删除",-1)])),_:1,__:[15]}),l(ee,{class:"pt-4"},{default:i(()=>[l($e,{type:"warning",text:"",dense:""},{default:i(()=>{var n;return[e[16]||(e[16]=_(" 此操作将永久删除用户 ",-1)),T("strong",null,k((n=o.selectedUser)==null?void 0:n.username),1),e[17]||(e[17]=_(" 及其所有相关数据，此操作不可撤销。 ",-1))]}),_:1,__:[16,17]}),l(O,{modelValue:o.deleteConfirmation,"onUpdate:modelValue":e[6]||(e[6]=n=>o.deleteConfirmation=n),label:"请输入用户名以确认删除",rules:[n=>{var m;return!n||n===((m=o.selectedUser)==null?void 0:m.username)||"用户名不匹配"}],outlined:"",dense:"",class:"mt-4"},null,8,["modelValue","rules"])]),_:1}),l(_e,null,{default:i(()=>{var n;return[l(Z),l(U,{text:"",onClick:e[7]||(e[7]=m=>o.deleteDialog=!1)},{default:i(()=>e[18]||(e[18]=[_("取消",-1)])),_:1,__:[18]}),l(U,{color:"error",text:"",disabled:o.deleteConfirmation!==((n=o.selectedUser)==null?void 0:n.username),onClick:u.deleteUser,loading:o.deleting},{default:i(()=>e[19]||(e[19]=[_(" 确认删除 ",-1)])),_:1,__:[19]},8,["disabled","onClick","loading"])]}),_:1})]),_:1})]),_:1},8,["modelValue"]),l(et,{modelValue:o.snackbar.show,"onUpdate:modelValue":e[10]||(e[10]=n=>o.snackbar.show=n),color:o.snackbar.color,timeout:o.snackbar.timeout,top:""},{action:i(({attrs:n})=>[l(U,He({text:""},n,{onClick:e[9]||(e[9]=m=>o.snackbar.show=!1)}),{default:i(()=>e[20]||(e[20]=[_(" 关闭 ",-1)])),_:2,__:[20]},1040)]),default:i(()=>[_(k(o.snackbar.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])])]),_:1})}const Kt=Ue(xt,[["render",Tt],["__scopeId","data-v-a8b2aebe"]]);export{Kt as default};
