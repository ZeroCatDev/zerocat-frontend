import{_ as k}from"./Timeline-DBF35bI1.js";import{_ as U,a as I}from"./UserFollowers-DjYG9eIT.js";import{_ as M,a as F}from"./Comment-BJ0-VIVy.js";import{g as Q}from"./projectListService-DwemNzWZ.js";import{_ as L,c as f,o as i,Y as m,N as l,e,a3 as w,a4 as X,W as a,F as V,a5 as Y,L as u,U as N,R as h,Q as b,a1 as x,i as P,f as r,X as n,a6 as G,a7 as p,a8 as J,Z as ee,n as te,S as v,O as y,T as j,a9 as se,aa as le,M as oe,ab as re}from"./index-C2P-a4uT.js";import{_ as ie}from"./Projects-Dq4n3IV9.js";import{_ as S}from"./UserRelationControls-CDXiRDN_.js";import{_ as A}from"./TimeAgo-DNkfFlaR.js";import{_ as E}from"./PageAnalytics-POozScAQ.js";/* empty css                        */import"./_commonjsHelpers-BosuxZz1.js";import"./VTextarea-DsXkTDlF.js";import"./ProjectCard-B2mA-Qd6.js";import"./VSpacer-B4Xp7Juf.js";const ne={name:"UserProjectLists",props:{userId:{type:[Number,String],required:!0},projectLists:{type:Array,default:()=>[]}},data(){return{loading:!1,localLists:[]}},computed:{lists(){return this.projectLists.length>0?this.projectLists:this.localLists}},watch:{userId:{immediate:!0,handler(t){t&&this.projectLists.length===0&&this.fetchUserLists()}}},methods:{async fetchUserLists(){this.loading=!0;try{const t=await Q(this.userId);t.status==="success"?this.localLists=t.data||[]:console.error("获取用户列表失败:",t.message)}catch(t){console.error("获取用户列表失败:",t)}finally{this.loading=!1}}}};function ae(t,s,g,C,o,_){return i(),f("div",null,[o.loading?(i(),m(a,{key:0,class:"mb-4"},{default:l(()=>[e(w,{class:"text-center"},{default:l(()=>[e(X,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(i(),f(V,{key:1},[_.lists.length===0?(i(),m(a,{key:0,class:"mb-4"},{default:l(()=>[e(w,{class:"text-center"},{default:l(()=>[e(Y,{type:"info",variant:"tonal"},{default:l(()=>s[0]||(s[0]=[u(" 该用户暂无公开项目列表 ")])),_:1,__:[0]})]),_:1})]),_:1})):(i(),m(b,{key:1},{default:l(()=>[(i(!0),f(V,null,N(_.lists,c=>(i(),m(h,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:c.id},{default:l(()=>[e(a,{rounded:"lg"},{default:l(()=>[e(a,{to:"/app/projectlist/"+c.id,rounded:"lg",title:c.title,subtitle:c.description,variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))],64))])}const B=L(ne,[["render",ae]]),ue={name:"FollowStats",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},data(){return{followersCount:0,followingCount:0,loading:!1}},mounted(){this.fetchFollowStats()},watch:{userId:{handler(){this.fetchFollowStats()}}},methods:{async fetchFollowStats(){try{this.loading=!0;const t=await x.get(`/follows/followers/${this.userId}`,{params:{limit:1,offset:0}});t.data.success&&(this.followersCount=t.data.data.total);const s=await x.get(`/follows/following/${this.userId}`,{params:{limit:1,offset:0}});s.data.success&&(this.followingCount=s.data.data.total)}catch(t){console.error("获取关注统计失败:",t)}finally{this.loading=!1}}}},ce={class:"font-weight-bold"},de={class:"font-weight-bold"};function me(t,s,g,C,o,_){return i(),m(b,{class:"follow-stats"},{default:l(()=>[e(h,null,{default:l(()=>[e(P,{variant:"text",to:`/${g.username}?tab=followers`,class:"stats-btn"},{default:l(()=>[r("span",ce,n(o.followersCount),1),s[0]||(s[0]=r("span",{class:"text-body-2 text-medium-emphasis"},"关注者",-1))]),_:1,__:[0]},8,["to"])]),_:1}),e(h,null,{default:l(()=>[e(P,{variant:"text",to:`/${g.username}?tab=following`,class:"stats-btn"},{default:l(()=>[r("span",de,n(o.followingCount),1),s[1]||(s[1]=r("span",{class:"text-body-2 text-medium-emphasis"},"正在关注",-1))]),_:1,__:[1]},8,["to"])]),_:1})]),_:1})}const R=L(ue,[["render",me],["__scopeId","data-v-d6d9b628"]]),_e={components:{Comment:F,Markdown:M,TimeAgo:A,UserProjectLists:B,UserRelationControls:S,FollowStats:R,UserFollowers:I,UserFollowing:U,Timeline:k,PageAnalytics:E},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},isLoadingMore:!1,localuser:re,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"},VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},watch:{"$route.query.tab"(t){this.tab=t||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await le(this.username),oe({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){try{const t=await x({url:`/projectlist/userid/${this.user.id}/public`,method:"get"});t.data&&t.data.data&&(this.lists=t.data.data)}catch(t){console.error("获取用户项目列表失败:",t),this.lists=[]}},async fetchTimeline(t=1){try{const s=await x.get(`/timeline/user/${this.user.id}`,{params:{page:t,limit:this.timeline.pagination.size}});s.data.status==="success"&&(t===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(t){return t!=null&&t.length?t.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!this.isLoadingMore)try{this.isLoadingMore=!0,await this.fetchTimeline(this.timeline.pagination.current+1)}finally{this.isLoadingMore=!1}},getTargetContent(t,s){if(!t)return"";switch(t.type){case"project":return t.title||`项目 #${t.id}`;case"user":return t.display_name||`用户 #${t.id}`;case"projectlist":return`项目列表 #${t.id}`;default:return`${t.type} #${t.id}`}},getFieldDisplayName(t){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[t]||t}}},pe={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},fe={class:"mt-2 text-body-1 text-medium-emphasis",style:{"word-break":"break-word","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},he={class:"mt-2 text-medium-emphasis"};function ge(t,s,g,C,o,_){const c=E,q=A,$=S,D=R,z=M,W=ie,Z=B,T=F,K=I,H=U,O=k;return i(),f("div",null,[e(c,{"target-type":"user","target-id":o.user.id},null,8,["target-id"]),e(j,null,{default:l(()=>[e(G,{modelValue:o.tab,"onUpdate:modelValue":s[0]||(s[0]=d=>o.tab=d)},{default:l(()=>[e(p,{value:"home"},{default:l(()=>[e(J,{class:"mt-8"},{default:l(()=>[e(b,{class:"d-flex align-center"},{default:l(()=>[e(h,null,{default:l(()=>[s[2]||(s[2]=r("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),r("p",pe,[u(n(o.user.display_name)+" ",1),e(ee,{size:"52",class:"ma-2"},{default:l(()=>[e(te,{src:o.VITE_APP_S3_BUCKET+"/user/"+o.user.images},null,8,["src"])]),_:1})]),r("p",fe,n(o.user.motto),1),r("p",he,[e(v,null,{default:l(()=>[e(y,{icon:"mdi-account-circle",start:""}),u(" #"+n(o.user.id),1)]),_:1}),e(v,null,{default:l(()=>[e(y,{icon:"mdi-clock",start:""}),e(q,{date:o.user.regTime},null,8,["date"]),s[1]||(s[1]=u(" 注册 "))]),_:1,__:[1]}),e(v,null,{default:l(()=>[e(y,{icon:"mdi-tag",start:""}),u(" "+n(o.user.id===1?"社区管理员":"用户"),1)]),_:1})]),e($,{"user-id":o.user.id,username:o.username,"display-name":o.user.display_name},null,8,["user-id","username","display-name"]),e(D,{"user-id":o.user.id,username:o.username,class:"mt-3"},null,8,["user-id","username"])]),_:1,__:[2]})]),_:1})]),_:1}),s[4]||(s[4]=r("br",null,null,-1)),e(a,{title:"关于我",subtitle:"README.md"},{default:l(()=>[e(w,{class:"markdown-body"},{default:l(()=>[s[3]||(s[3]=r("br",null,null,-1)),e(z,null,{default:l(()=>[u(n(o.user.motto),1)]),_:1})]),_:1,__:[3]})]),_:1}),e(W,{url:o.url},null,8,["url"]),e(b,null,{default:l(()=>[(i(!0),f(V,null,N(o.lists,d=>(i(),m(h,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:d.id},{default:l(()=>[e(a,{rounded:"lg"},{default:l(()=>[e(a,{to:"/app/projectlist/"+d.id,rounded:"lg",title:d.title,subtitle:d.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[5]||(s[5]=r("br",null,null,-1)),e(Z,{"user-id":o.user.id,"project-lists":o.lists},null,8,["user-id","project-lists"]),s[6]||(s[6]=r("br",null,null,-1)),e(T,{url:"user-"+o.user.id,name:"用户"},null,8,["url"])]),_:1,__:[4,5,6]}),e(p,{value:"comment"},{default:l(()=>[e(T,{url:"user-"+o.user.id,name:"用户"},null,8,["url"])]),_:1}),e(p,{value:"followers"},{default:l(()=>[e(j,null,{default:l(()=>[s[7]||(s[7]=r("h2",{class:"text-h5 mb-4"},"关注者",-1)),e(K,{"user-id":o.user.id,"show-all":!1},null,8,["user-id"])]),_:1,__:[7]})]),_:1}),e(p,{value:"following"},{default:l(()=>[e(j,null,{default:l(()=>[s[8]||(s[8]=r("h2",{class:"text-h5 mb-4"},"正在关注",-1)),e(H,{"user-id":o.user.id,"show-all":!1},null,8,["user-id"])]),_:1,__:[8]})]),_:1}),e(p,{value:"timeline"},{default:l(()=>[e(a,{class:"mt-4",variant:"flat"},{default:l(()=>[e(se,{class:"d-flex align-center"},{default:l(()=>[e(y,{icon:"mdi-timeline-clock",color:"primary",class:"mr-2"}),u(" "+n(o.user.display_name)+" 的动态 ",1)]),_:1}),e(w,null,{default:l(()=>[e(O,{timeline:o.timeline,"is-loading-more":o.isLoadingMore,onLoadMore:_.loadMoreEvents},null,8,["timeline","is-loading-more","onLoadMore"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const Me=L(_e,[["render",ge],["__scopeId","data-v-f82e74d5"]]);export{Me as default};
