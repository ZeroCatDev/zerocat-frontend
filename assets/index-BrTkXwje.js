import{_ as v}from"./LoadingDialog-BdXwkqGQ.js";import{_ as w}from"./AuthCard-CtasAUoZ.js";import{_ as k}from"./Recaptcha-2W3JBfdD.js";import{_ as y,c as V,o as b,e as a,N as n,aF as R,aD as L,Q as S,R as d,aB as C,i as u,f as M,bc as B,r as p,ab as z,M as A}from"./index-CqDYMkg5.js";import{A as D}from"./authService-w9KrMMhD.js";import"https://static.geetest.com/v4/gt4.js";const F={components:{LoadingDialog:v,Recaptcha:k,AuthCard:w},setup(){const _=B(),l=p(null),i=p(""),e=p(!1),c=p(!1),g=[t=>!!t||"必须填写邮箱",t=>/.+@.+\..+/.test(t)||"不符合格式"];z.isLogin.value===!0&&_.push("/app/dashboard"),A({title:"魔术链接登录"});const m=async()=>{var t,o,h;if(!i.value||!/.+@.+\..+/.test(i.value)){s("请输入正确的邮箱地址");return}if(!c.value){e.value=!0;try{const r=(t=l.value)==null?void 0:t.getResponse();if(!r){s("请完成人机验证"),e.value=!1;return}const x=await D.generateMagicLink(i.value,window.location.origin+"/app/account/magiclink/validate",r);x.status==="success"?(f("登录链接已发送到您的邮箱"),c.value=!0):s(x.message||"发送失败")}catch(r){s(((h=(o=r.response)==null?void 0:o.data)==null?void 0:h.message)||r.message)}finally{e.value=!1}}},f=t=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"success",summary:"成功",detail:t,life:3e3})},s=t=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"error",summary:"错误",detail:t,life:3e3})};return{email:i,loading:e,linkSent:c,recaptcha:l,emailRules:g,sendMagicLink:m}}},N={class:"d-flex flex-wrap justify-start gap-2"};function T(_,l,i,e,c,g){const m=k,f=w,s=v;return b(),V("div",null,[a(f,{subtitle:"魔术链接登录"},{default:n(()=>[a(R,{onSubmit:L(e.sendMagicLink,["prevent"])},{default:n(()=>[a(S,null,{default:n(()=>[a(d,{cols:"12"},{default:n(()=>[a(C,{label:"邮箱",type:"text",modelValue:e.email,"onUpdate:modelValue":l[0]||(l[0]=t=>e.email=t),variant:"outlined",rules:e.emailRules},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12"},{default:n(()=>[a(m,{ref:"recaptcha",recaptchaId:"recaptcha-div"},null,512)]),_:1}),a(d,{cols:"12"},{default:n(()=>[a(u,{class:"text-none",color:"primary",rounded:"xl",text:e.linkSent?"已发送，请检查邮箱":"发送登录链接",variant:"flat",size:"large",onClick:e.sendMagicLink,"append-icon":"mdi-arrow-right",loading:e.loading,disabled:e.linkSent},null,8,["text","onClick","loading","disabled"])]),_:1}),a(d,{cols:"12"},{default:n(()=>[M("div",N,[a(u,{class:"text-none",color:"white",rounded:"xl",text:"密码登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/login"}),a(u,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),a(u,{class:"text-none",color:"white",rounded:"xl",text:"找回密码",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),a(s,{show:e.loading,text:"处理中"},null,8,["show"])])}const q=y(F,[["render",T]]);export{q as default};
