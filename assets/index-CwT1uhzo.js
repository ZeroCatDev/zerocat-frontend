import{_ as N}from"./Comment-Bfn62cHu.js";import{_ as O}from"./Projects-CUzz35sG.js";import{f as x,p as V,U as Z,n as j,t as m,y as G,s as J,i as D,a as n,W as k,X as K,E as F,Y as q,B as A,k as w,Z as M,u as Q,$ as X,R as Y,a0 as ee,a1 as I,A as W,j as te,l as ie,a2 as se,a3 as ae,a4 as ne,a5 as S,z as le,a6 as re,a7 as oe,_ as ue,c as y,o as f,w as o,a8 as ce,a9 as b,G as h,J as de,H as _,O as d,P as me,aa as fe,e as C,M as z,N as E,K as T,ab as P,ac as $,ad as B,Q as R,T as _e}from"./index-D0HrcQOC.js";import{g as he,a as ge}from"./user-Bx1P-eiF.js";import{g as ye}from"./projectService-BihQa7QO.js";import{V as U,a as L}from"./VRow-Da1ay3cz.js";import{V as v}from"./VChip-B0uQpSOf.js";import{V as ve}from"./VContainer-DxLRcBx_.js";import"./VForm-KFvPMsXu.js";import"./VTextarea-yEsE0dBK.js";import"./VDialog-ChWyIGbd.js";import"./showProjects-cl3sygCZ.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-7B-ty4oY.js";/* empty css              */const pe=V({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:M,iconColor:String,lineColor:String,...w(),...A(),...q(),...F()},"VTimelineDivider"),Ce=x()({name:"VTimelineDivider",props:pe(),setup(e,a){let{slots:t}=a;const{sizeClasses:i,sizeStyles:s}=Z(e,"v-timeline-divider__dot"),{backgroundColorStyles:r,backgroundColorClasses:c}=j(m(e,"dotColor")),{roundedClasses:u}=G(e,"v-timeline-divider__dot"),{elevationClasses:l}=J(e),{backgroundColorClasses:g,backgroundColorStyles:p}=j(m(e,"lineColor"));return D(()=>n("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[n("div",{class:["v-timeline-divider__before",g.value],style:p.value},null),!e.hideDot&&n("div",{key:"dot",class:["v-timeline-divider__dot",l.value,u.value,i.value],style:s.value},[n("div",{class:["v-timeline-divider__inner-dot",c.value,u.value],style:r.value},[t.default?n(K,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},t.default):n(k,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),n("div",{class:["v-timeline-divider__after",g.value],style:p.value},null)])),{}}}),H=V({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:M,iconColor:String,lineInset:[Number,String],...w(),...te(),...F(),...A(),...q(),...W()},"VTimelineItem"),Te=x()({name:"VTimelineItem",props:H(),setup(e,a){let{slots:t}=a;const{dimensionStyles:i}=Q(e),s=X(0),r=Y();return ee(r,c=>{var u;c&&(s.value=((u=c.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:u.getBoundingClientRect().width)??0)},{flush:"post"}),D(()=>{var c,u;return n("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":I(s.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${I(e.lineInset)})`:I(0)},e.style]},[n("div",{class:"v-timeline-item__body",style:i.value},[(c=t.default)==null?void 0:c.call(t)]),n(Ce,{ref:r,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:t.icon}),e.density!=="compact"&&n("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((u=t.opposite)==null?void 0:u.call(t))])])}),{}}}),ke=V({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...oe(H({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...w(),...re(),...W(),...le()},"VTimeline"),Ie=x()({name:"VTimeline",props:ke(),setup(e,a){let{slots:t}=a;const{themeClasses:i}=ie(e),{densityClasses:s}=se(e),{rtlClasses:r}=ae();ne({VTimelineDivider:{lineColor:m(e,"lineColor")},VTimelineItem:{density:m(e,"density"),dotColor:m(e,"dotColor"),fillDot:m(e,"fillDot"),hideOpposite:m(e,"hideOpposite"),iconColor:m(e,"iconColor"),lineColor:m(e,"lineColor"),lineInset:m(e,"lineInset"),size:m(e,"size")}});const c=S(()=>{const l=e.side?e.side:e.density!=="default"?"end":null;return l&&`v-timeline--side-${l}`}),u=S(()=>{const l=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return l;case"start":return l[0];case"end":return l[1];default:return null}});return D(()=>n(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,u.value,{"v-timeline--inset-line":!!e.lineInset},i.value,s.value,c.value,r.value,e.class],style:[{"--v-timeline-line-thickness":I(e.lineThickness)},e.style]},t)),{}}}),be={components:{Projects:O,Comment:N},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},projectInfo:{},userInfo:{}}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},methods:{async fetchUser(){this.user=await ge(this.username),_e({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await R({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(){try{const e=await R.get(`/timeline/user/${this.user.id}`);e.data.status==="success"&&(this.timeline=e.data.data,await this.fetchRelatedInfo())}catch(e){console.error("Failed to fetch timeline:",e)}},async fetchRelatedInfo(){const e=new Set,a=new Set;this.timeline.events.forEach(t=>{var i,s,r,c,u,l,g;try{["project_create","project_delete","project_fork"].includes(t.type)&&(i=t.target)!=null&&i.id&&e.add(t.target.id),t.type==="comment_create"&&(((r=(s=t.target)==null?void 0:s.page)==null?void 0:r.type)==="project"&&((c=t.target.page)!=null&&c.id)?e.add(t.target.page.id):((l=(u=t.target)==null?void 0:u.page)==null?void 0:l.type)==="user"&&((g=t.target.page)!=null&&g.id)&&a.add(t.target.page.id))}catch(p){console.warn("Error processing event:",t,p)}});try{if(e.size>0){const t=await ye(Array.from(e)),i=new Set;t.forEach(s=>{s&&s.id&&(this.projectInfo[s.id]=s,s.authorid&&i.add(s.authorid))}),i.forEach(s=>{s&&a.add(s)})}a.size>0&&(await he(Array.from(a))).forEach(i=>{i&&i.id&&(this.userInfo[i.id]=i,Object.values(this.projectInfo).forEach(s=>{s&&s.authorid===i.id&&(s.author_username=i.username)}))})}catch(t){console.error("Error fetching related info:",t)}},getTargetLink(e){var a,t;if(!e)return null;try{switch(e.type){case"comment":{if(!((a=e.page)!=null&&a.type)||!((t=e.page)!=null&&t.id))return null;const{type:i,id:s}=e.page;if(i==="project"){const r=this.projectInfo[s];return!(r!=null&&r.author_username)||!(r!=null&&r.name)?null:`/${r.author_username}/${r.name}`}if(i==="user"){const r=this.userInfo[s];return r!=null&&r.username?`/${r.username}`:null}return null}case"project":{const i=this.projectInfo[e.id];return!(i!=null&&i.author_username)||!(i!=null&&i.name)?null:`/${i.author_username}/${i.name}`}case"user":{const i=this.userInfo[e.id];return i!=null&&i.username?`/${i.username}`:null}default:return null}}catch(i){return console.warn("Error generating target link:",i),null}},getTargetContent(e,a){if(!e)return"";try{switch(e.type){case"comment":return this.getCommentTargetContent(e,a);case"project":return this.getProjectTargetContent(e,a);case"user":return this.getUserTargetContent(e,a);default:return`未知目标类型 #${(e==null?void 0:e.id)||"未知"}`}}catch(t){return console.warn("Error generating target content:",t),"内容获取失败"}},getCommentTargetContent(e,a){if(!e.page)return`评论 #${e.id}`;const{type:t,id:i}=e.page;switch(t){case"project":{const s=this.projectInfo[i];return s?`在作品 ${s.title} 下的评论`:`在作品 #${i} 下的评论`}case"user":{const s=this.userInfo[i];return s?`在用户 ${s.display_name} 主页下的评论`:`在用户 #${i} 主页下的评论`}default:return`在 ${t} #${i} 下的评论`}},getProjectTargetContent(e,a){const t=this.projectInfo[e.id];return t?t.title||t.name:`项目 #${e.id}`},getUserTargetContent(e,a){const t=this.userInfo[e.id];return t?t.display_name:`用户 #${e.id}`},getEventChipText(e){return{project_create:"新建项目",project_delete:"删除项目",project_fork:"复刻项目",comment_create:"评论",user_profile_update:"个人资料"}[e]||e},getEventColor(e){return{project_create:"success",project_delete:"error",project_fork:"warning",comment_create:"secondary",user_profile_update:"info"}[e]||"primary"},getEventDisplayText(e){const a=e.actor.display_name;switch(e.type){case"project_create":return`${a} 创建了新项目`;case"project_delete":return`${a} 删除了项目`;case"project_fork":return`${a} 复刻了项目`;case"comment_create":return`${a} 发表了评论`;case"user_profile_update":{const t=e.event_data.updated_fields.map(i=>this.getFieldDisplayName(i)).join("、");return`${a} 更新了个人资料（${t}）`}default:return`${a} 进行了操作`}},getFieldDisplayName(e){return{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}[e]||e}}},xe={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},Ve={class:"mt-2 text-body-1 text-medium-emphasis"},De={class:"mt-2 text-medium-emphasis"},we={key:0,class:"text-body-2 mt-1 text-grey"},je={key:0,class:"text-body-2 mt-1 text-grey"};function Se(e,a,t,i,s,r){const c=O,u=N;return f(),y(ve,null,{default:o(()=>[n(ce,{modelValue:s.tab,"onUpdate:modelValue":a[0]||(a[0]=l=>s.tab=l)},{default:o(()=>[n(b,{value:"home"},{default:o(()=>[n(de,{class:"mt-8"},{default:o(()=>[n(U,{class:"d-flex align-center"},{default:o(()=>[n(L,null,{default:o(()=>[a[2]||(a[2]=h("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),h("p",xe,[_(d(s.user.display_name)+" ",1),n(me,{size:"52",class:"ma-2"},{default:o(()=>[n(fe,{src:"https://s4-1.wuyuan.1r.ink/user/"+s.user.images},null,8,["src"])]),_:1})]),h("p",Ve,d(s.user.motto),1),h("p",De,[n(v,null,{default:o(()=>[n(k,{icon:"mdi-account-circle",start:""}),_(" ID:"+d(s.user.id),1)]),_:1}),n(v,null,{default:o(()=>[n(k,{icon:"mdi-clock",start:""}),_(" "+d(s.user.regTime)+"注册 ",1)]),_:1}),n(v,null,{default:o(()=>[n(k,{icon:"mdi-tag",start:""}),a[1]||(a[1]=_(" 创作者 "))]),_:1})])]),_:1})]),_:1})]),_:1}),a[3]||(a[3]=h("br",null,null,-1)),n(c,{url:s.url},null,8,["url"]),n(U,null,{default:o(()=>[(f(!0),C(z,null,E(s.lists,l=>(f(),y(L,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:l.id},{default:o(()=>[n(T,{rounded:"lg"},{default:o(()=>[n(T,{to:"/app/projectlist/"+l.id,rounded:"lg",title:l.title,subtitle:l.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),a[4]||(a[4]=h("br",null,null,-1)),n(u,{url:"user-"+s.user.id,name:"用户"},null,8,["url"])]),_:1}),n(b,{value:"comment"},{default:o(()=>[n(u,{url:"user-"+s.user.id,name:"用户"},null,8,["url"])]),_:1}),n(b,{value:"timeline"},{default:o(()=>[n(Ie,{side:"end",align:"start",class:"mt-4"},{default:o(()=>[(f(!0),C(z,null,E(s.timeline.events,l=>(f(),y(Te,{key:l.id,size:"small","dot-color":"primary"},{opposite:o(()=>[_(d(new Date(l.created_at).toLocaleString()),1)]),default:o(()=>[r.getTargetLink(l.target)?(f(),y(T,{key:0,class:"elevation-1",to:r.getTargetLink(l.target)},{default:o(()=>[n(P,{class:"text-subtitle-1"},{default:o(()=>[_(d(r.getEventDisplayText(l)),1)]),_:2},1024),n($,null,{default:o(()=>[n(v,{size:"small",color:r.getEventColor(l.type),class:"mr-2"},{default:o(()=>[_(d(r.getEventChipText(l.type)),1)]),_:2},1032,["color"]),h("div",null,d(r.getTargetContent(l.target,l.type)),1),l.event_data.comment_text?(f(),C("div",we,d(l.event_data.comment_text),1)):B("",!0)]),_:2},1024)]),_:2},1032,["to"])):(f(),y(T,{key:1,class:"elevation-1"},{default:o(()=>[n(P,{class:"text-subtitle-1"},{default:o(()=>[_(d(r.getEventDisplayText(l)),1)]),_:2},1024),n($,null,{default:o(()=>[n(v,{size:"small",color:r.getEventColor(l.type),class:"mr-2"},{default:o(()=>[_(d(r.getEventChipText(l.type)),1)]),_:2},1032,["color"]),h("div",null,d(r.getTargetContent(l.target,l.type)),1),l.event_data.comment_text?(f(),C("div",je,d(l.event_data.comment_text),1)):B("",!0)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const He=ue(be,[["render",Se],["__scopeId","data-v-c63f572b"]]);export{He as default};
