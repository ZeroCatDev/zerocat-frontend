import{p as W,A as y,g as he,a as ge,u as be,cn as _,bV as Fe,w as ke,d as we,bY as Ce,bZ as L,b_ as O,e as k,f as h,F as V,b$ as De,m as A,z as Ie,T as Se,bw as Ve,r as B,bx as Ae,L as Be,c1 as Pe,cC as G,M as Te,c3 as Re,by as ze,c4 as $e}from"./index-C30_-gqw.js";function xe(){function e(o){var a,n;return[...((a=o.dataTransfer)==null?void 0:a.items)??[]].filter(s=>s.kind==="file").map(s=>s.webkitGetAsEntry()).filter(Boolean).length>0||[...((n=o.dataTransfer)==null?void 0:n.files)??[]].length>0}async function r(o){var n,s;const u=[],a=[...((n=o.dataTransfer)==null?void 0:n.items)??[]].filter(i=>i.kind==="file").map(i=>i.webkitGetAsEntry()).filter(Boolean);if(a.length)for(const i of a){const d=await K(i,U(".",i));u.push(...d.map(m=>m.file))}else u.push(...((s=o.dataTransfer)==null?void 0:s.files)??[]);return u}return{handleDrop:r,hasFilesOrFolders:e}}function K(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((o,u)=>{e.isFile?e.file(n=>o([{file:n,path:r}]),u):e.isDirectory&&e.createReader().readEntries(async n=>{const s=[];for(const i of n)s.push(...await K(i,U(r,i)));o(s)})})}function U(e,r){return r.isDirectory?`${e}/${r.name}`:e}const Ee=W({filterByType:String},"file-accept");function Me(e){const r=y(()=>e.filterByType?Ne(e.filterByType):null);function o(u){if(r.value){const a=u.filter(r.value);return{accepted:a,rejected:u.filter(n=>!a.includes(n))}}return{accepted:u,rejected:[]}}return{filterAccepted:o}}function Ne(e){const r=e.split(",").map(n=>n.trim().toLowerCase()),o=r.filter(n=>n.startsWith(".")),u=r.filter(n=>n.endsWith("/*")),a=r.filter(n=>!o.includes(n)&&!u.includes(n));return n=>{var d,m;const s=((d=n.name.split(".").at(-1))==null?void 0:d.toLowerCase())??"",i=((m=n.type.split("/").at(0))==null?void 0:m.toLowerCase())??"";return a.includes(n.type)||o.includes(`.${s}`)||u.includes(`${i}/*`)}}const je=W({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...ze($e({prependIcon:"$file"}),["direction"]),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>_(e).every(r=>r!=null&&typeof r=="object")},...Ee(),...Re({clearable:!0})},"VFileInput"),Oe=he()({name:"VFileInput",inheritAttrs:!1,props:je(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(e,r){let{attrs:o,emit:u,slots:a}=r;const{t:n}=ge(),{filterAccepted:s}=Me(e),i=be(e,"modelValue",e.modelValue,t=>_(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:d,focus:m,blur:Y}=Fe(e),P=y(()=>typeof e.showSize!="boolean"?e.showSize:void 0),T=y(()=>(i.value??[]).reduce((t,l)=>{let{size:f=0}=l;return t+f},0)),R=y(()=>G(T.value,P.value)),w=y(()=>(i.value??[]).map(t=>{const{name:l="",size:f=0}=t,v=ne(l);return e.showSize?`${v} (${G(f,P.value)})`:v})),Z=y(()=>{var l;const t=((l=i.value)==null?void 0:l.length)??0;return e.showSize?n(e.counterSizeString,t,R.value):n(e.counterString,t)}),z=B(),$=B(),c=B(),q=Ae(()=>d.value||e.active),x=y(()=>["plain","underlined"].includes(e.variant)),b=Te(!1),{handleDrop:H,hasFilesOrFolders:J}=xe();function C(){var t;c.value!==document.activeElement&&((t=c.value)==null||t.focus()),d.value||m()}function Q(t){var l;(l=c.value)==null||l.click()}function X(t){u("mousedown:control",t)}function ee(t){var l;(l=c.value)==null||l.click(),u("click:control",t)}function te(t){t.stopPropagation(),C(),Be(()=>{i.value=[],Pe(e["onClick:clear"],t)})}function ne(t){if(t.length<Number(e.truncateLength))return t;const l=Math.floor((Number(e.truncateLength)-1)/2);return`${t.slice(0,l)}â€¦${t.slice(t.length-l)}`}function le(t){t.preventDefault(),t.stopImmediatePropagation(),b.value=!0}function ae(t){t.preventDefault(),b.value=!1}async function ie(t){if(t.preventDefault(),t.stopImmediatePropagation(),b.value=!1,!c.value||!J(t))return;const l=await H(t);E(l)}function re(t){if(!(!t.target||t.repack))if(e.filterByType)E([...t.target.files]);else{const l=t.target;i.value=[...l.files??[]]}}function E(t){const l=new DataTransfer,{accepted:f,rejected:v}=s(t);v.length&&u("rejected",v);for(const I of f)l.items.add(I);c.value.files=l.files,i.value=[...l.files];const D=new Event("change",{bubbles:!0});D.repack=!0,c.value.dispatchEvent(D)}return ke(i,t=>{(!Array.isArray(t)||!t.length)&&c.value&&(c.value.value="")}),we(()=>{const t=!!(a.counter||e.counter),l=!!(t||a.details),[f,v]=Ce(o),{modelValue:D,...I}=L.filterProps(e),oe={...O.filterProps(e),"onClick:clear":te},ue=o.webkitdirectory!==void 0&&o.webkitdirectory!==!1,se=o.accept?String(o.accept):void 0,ce=ue?void 0:e.filterByType??se;return k(L,A({ref:z,modelValue:e.multiple?i.value:i.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":b.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":x.value},e.class],style:e.style,"onClick:prepend":Q},f,I,{centerAffix:!x.value,focused:d.value}),{...a,default:S=>{let{id:F,isDisabled:g,isDirty:M,isReadonly:N,isValid:de,hasDetails:fe}=S;return k(O,A({ref:$,prependIcon:e.prependIcon,onMousedown:X,onClick:ee,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},oe,{id:F.value,active:q.value||M.value,dirty:M.value||e.dirty,disabled:g.value,focused:d.value,details:fe.value,error:de.value===!1,onDragover:le,onDrop:ie}),{...a,default:ve=>{var j;let{props:{class:pe,...ye},controlRef:me}=ve;return h(V,null,[h("input",A({ref:p=>c.value=me.value=p,type:"file",accept:ce,readonly:N.value,disabled:g.value,multiple:e.multiple,name:e.name,onClick:p=>{p.stopPropagation(),N.value&&p.preventDefault(),C()},onChange:re,onDragleave:ae,onFocus:C,onBlur:Y},ye,v),null),h("div",{class:Ie(pe)},[!!((j=i.value)!=null&&j.length)&&!e.hideInput&&(a.selection?a.selection({fileNames:w.value,totalBytes:T.value,totalBytesReadable:R.value}):e.chips?w.value.map(p=>k(Se,{key:p,size:"small",text:p},null)):w.value.join(", "))])])}})},details:l?S=>{var F,g;return h(V,null,[(F=a.details)==null?void 0:F.call(a,S),t&&h(V,null,[h("span",null,null),k(De,{active:!!((g=i.value)!=null&&g.length),value:Z.value,disabled:e.disabled},a.counter)])])}:void 0})}),Ve({},z,$,c)}});export{Oe as V};
