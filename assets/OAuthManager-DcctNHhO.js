import{g as R,p as W,d as X,e as s,C as N,D as Y,G as H,K as J,r as i,b as Q,aj as b,c as C,o as d,N as t,aA as L,f as I,a3 as w,Y as k,$ as Z,ap as B,F as O,U as P,aq as T,ar as $,L as m,X as f,as as ee,i as x,a5 as ae,W as S,a1 as p,ao as U}from"./index-CSzZWmxC.js";import{_ as te}from"./verifyEmail-DDX7ZZBt.js";const se=W({start:Boolean,end:Boolean,...J(),...H()},"VListItemAction"),le=R()({name:"VListItemAction",props:se(),setup(c,_){let{slots:o}=_;return X(()=>s(c.tag,{class:Y(["v-list-item-action",{"v-list-item-action--start":c.start,"v-list-item-action--end":c.end},c.class]),style:N(c.style)},o)),{}}}),oe={class:"oauth-binding"},ue={__name:"OAuthManager",setup(c){const _=i([]),o=i(""),r=i("info"),g=i(!1),y=i(""),F=i(""),V=i([]),E="https://zerocat-api.houlangs.com",h={google:{backgroundColor:"#4285F4",color:"#FFFFFF"},microsoft:{backgroundColor:"#F25022",color:"#FFFFFF"},github:{backgroundColor:"#333333",color:"#FFFFFF"},default:{backgroundColor:"#CCCCCC",color:"#000000"}},A=async()=>{var l,e;try{const a=await p.post("/account/oauth/bound",{userid:U.user.value.id});a.data.status==="success"?_.value=a.data.data:(o.value=a.data.message,r.value="error")}catch(a){o.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"获取绑定的 OAuth 账号失败",r.value="error"}},z=async()=>{var l,e;try{const a=await p.get("/account/emails");if(a.data.status==="success"){const n=a.data.data.find(v=>v.is_primary);n&&(y.value=n.contact_value)}else o.value=a.data.message,r.value="error"}catch(a){o.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"获取邮箱列表失败",r.value="error"}},D=async()=>{var l,e;try{const a=await p.get("/account/oauth/providers");a.data.status==="success"?V.value=a.data.data:(o.value=a.data.message,r.value="error")}catch(a){o.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"获取可绑定的 OAuth 提供商失败",r.value="error"}},M=(l,e)=>{F.value=e,g.value=!0},j=async l=>{var e,a;try{const u=await p.post("/account/confirm-unlink-oauth",{email:y.value,code:l,provider:F.value});u.data.status==="success"?(o.value="成功解绑 OAuth 账号",r.value="success",A()):(o.value=u.data.message||"解绑失败",r.value="error")}catch(u){o.value=((a=(e=u.response)==null?void 0:e.data)==null?void 0:a.message)||"解绑 OAuth 账号失败",r.value="error"}},q=l=>{window.location.href=`${E}/account/oauth/bind/${l}?token=${U.getToken()}`},G=l=>h[l]||h.default;return Q(()=>{A(),z(),D()}),(l,e)=>{const a=b("v-list-item-content"),u=b("v-list-item-group");return d(),C("div",oe,[s(S,null,{default:t(()=>[s(L,null,{default:t(()=>e[1]||(e[1]=[I("h2",null,"已绑定的 OAuth 账号",-1)])),_:1,__:[1]}),s(w,null,{default:t(()=>[s(B,null,{default:t(()=>[s(u,null,{default:t(()=>[(d(!0),C(O,null,P(_.value,(n,v)=>(d(),k(T,{key:v},{default:t(()=>[s(a,null,{default:t(()=>[s($,null,{default:t(()=>[m(f(n.contact_value),1)]),_:2},1024),s(ee,null,{default:t(()=>[m(f(n.contact_type),1)]),_:2},1024)]),_:2},1024),s(le,null,{default:t(()=>[s(x,{onClick:K=>M(n.contact_value,n.contact_type),color:"red"},{default:t(()=>e[2]||(e[2]=[m("解绑")])),_:2,__:[2]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o.value?(d(),k(ae,{key:0,type:r.value},{default:t(()=>[m(f(o.value),1)]),_:1},8,["type"])):Z("",!0)]),_:1})]),_:1}),s(te,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),email:y.value,onVerified:j},null,8,["modelValue","email"]),s(S,{class:"mt-4"},{default:t(()=>[s(L,null,{default:t(()=>e[3]||(e[3]=[I("h2",null,"可绑定的 OAuth 提供商",-1)])),_:1,__:[3]}),s(w,null,{default:t(()=>[e[4]||(e[4]=m(" 不论怎样，你都需要确保对绑定账户内邮箱完全的控制。 ")),s(B,null,{default:t(()=>[(d(!0),C(O,null,P(V.value,(n,v)=>(d(),k(T,{key:v},{default:t(()=>[s(a,null,{default:t(()=>[s($,null,{default:t(()=>[s(x,{style:N(G(n.id)),onClick:K=>q(n.id)},{default:t(()=>[m(f(n.name),1)]),_:2},1032,["style","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1,__:[4]})]),_:1})])}}};export{ue as _};
