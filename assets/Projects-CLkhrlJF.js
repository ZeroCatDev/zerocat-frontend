import{l as w,b as P}from"./project-D59TWirU.js";import{l as x,b as Q}from"./user-BBNnAO5M.js";import{_ as A}from"./43-lazyload-CBkwrR6M.js";import{bS as V,o as r,c as u,w as e,A as p,F as m,aZ as y,a as s,cm as _,cl as F,cF as T,cD as D,O as l,bc as h,cE as L,cu as N,cj as j,z as f,cg as B,cp as q,G as g,cq as b}from"./index-B2HYbJQK.js";import{a as I,V as S}from"./VRow-CEXFBg7K.js";import{V as C}from"./VChip-BaaJjW8W.js";import{V as E}from"./VPagination-HufVOtbT.js";const M={props:{projectIds:{type:Array,required:!0},actions:{type:Array}},data(){return{projects:[],authorids:[],authors:{},liveQuerySubscription:null,authorQuerySubscription:null}},watch:{projectIds:{handler(){this.startLiveFetch(),this.refreshData()},immediate:!0,deep:!0}},methods:{startLiveFetch(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.liveQuerySubscription=w(this.projectIds,o=>{this.projects=o,this.updateAuthorIds()})},updateAuthorIds(){const o=[...new Set(this.projects.map(t=>t.authorid))];JSON.stringify(o)!==JSON.stringify(this.authorids)&&(this.authorids=o,this.startAuthorLiveFetch())},startAuthorLiveFetch(){this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe(),this.authorQuerySubscription=x(this.authorids,o=>{const t={};o.forEach(n=>{t[n.id]=n}),this.authors=t})},async refreshData(){await P(this.projectIds),await Q(this.authorids)}},beforeDestroy(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe()}};function O(o,t,n,v,i,d){return r(),u(S,null,{default:e(()=>[(r(!0),p(m,null,y(i.projects,a=>(r(),u(I,{key:a.id,cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2"},{default:e(()=>[s(_,{rounded:"lg",border:""},{default:e(()=>[s(_,{to:"/projects/"+a.id,style:{"aspect-ratio":"4/3"},rounded:"lg"},{default:e(()=>[s(F,{src:"https://s4-1.wuyuan.1r.ink/scratch_slt/"+a.id,class:"align-end","lazy-src":A,height:"100%",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",cover:""},{default:e(()=>[s(T,null,{default:e(()=>[s(D,null,{default:e(()=>[l(h(a.title||"未缓存"),1)]),_:2},1024),s(L,null,{default:e(()=>[l(h(a.description||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["to"]),n.actions?(r(),u(N,{key:0},{default:e(()=>[(r(!0),p(m,null,y(n.actions,c=>(r(),p("div",{key:c.name},[s(j,{onClick:G=>c.function(a.id,a)},{default:e(()=>[l(h(c.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)):f("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})}const k=V(M,[["render",O]]),U={components:{showProjects:k},props:{url:{type:String,required:!0},actions:{type:Array}},data(){return{projectIds:[],page:1,limit:16,totalPage:1,totalCount:0,loading:!1,loadTime:0}},computed:{hasTotalCount(){return this.totalCount>0}},methods:{async fetchProjects(){this.loading=!0;const o=performance.now();try{const t=await B.get(`${this.url}&curr=${this.page}&limit=${this.limit}`);this.projectIds=this.hasTotalCount?t.projects:[...this.projectIds,...t.projects],this.totalCount=t.totalCount||0,this.totalPage=this.totalCount?Math.ceil(this.totalCount/this.limit):1}catch(t){console.error("Failed to fetch projects:",t)}finally{this.loading=!1,this.loadTime=performance.now()-o}},loadMore(){this.page++,this.fetchProjects()}},watch:{url:{handler(){this.page=1,this.fetchProjects()},immediate:!0},page:{handler(){this.fetchProjects()}}}},z={class:"mt-2 text-medium-emphasis"};function J(o,t,n,v,i,d){const a=k;return r(),p(m,null,[i.loading?(r(),u(q,{key:0,indeterminate:"",color:"primary"})):f("",!0),s(S,null,{default:e(()=>[s(I,{cols:"12"},{default:e(()=>[g("p",z,[s(C,null,{default:e(()=>[s(b,{icon:"mdi-timer",start:""}),l(" 加载耗时: "+h(i.loadTime)+" ms ",1)]),_:1}),i.totalCount?(r(),u(C,{key:0},{default:e(()=>[s(b,{icon:"mdi-counter",start:""}),l(" 总作品数量: "+h(i.totalCount),1)]),_:1})):f("",!0)])]),_:1})]),_:1}),s(a,{projectIds:i.projectIds,actions:n.actions},null,8,["projectIds","actions"]),t[2]||(t[2]=g("br",null,null,-1)),d.hasTotalCount?(r(),u(E,{key:1,modelValue:i.page,"onUpdate:modelValue":t[0]||(t[0]=c=>i.page=c),length:i.totalPage,onInput:d.fetchProjects,rounded:"circle"},null,8,["modelValue","length","onInput"])):(r(),u(j,{key:2,onClick:d.loadMore,color:"primary"},{default:e(()=>t[1]||(t[1]=[l("继续加载")])),_:1},8,["onClick"]))],64)}const $=V(U,[["render",J]]);export{$ as _,k as s};
