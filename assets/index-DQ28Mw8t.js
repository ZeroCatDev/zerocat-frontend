import{a as f}from"./Comment-CzB8I6F9.js";import{_ as u,a as h}from"./ProjectPlayer-PK3LbUkw.js";import{_ as l}from"./ProjectBranchNav-DjDv-Y8O.js";import{_ as b,Y as y,o as w,N as o,e,Q as B,R as m,f as C,T as P,aj as $,ak as g,al as p,am as x,M as I,an as N,ab as H}from"./index-CqDYMkg5.js";import"./_commonjsHelpers-BosuxZz1.js";import"./TimeAgo-DefCx_l6.js";import"./VTextarea-BMQ0gWum.js";import"./UserRelationControls-BBYAsz8L.js";import"./VSpacer-BmIOKXlY.js";import"./projectListService-D9KVKasP.js";import"./VSelect-ByyaaPA0.js";import"./VCheckboxBtn-8mXxa5va.js";import"./VSelectionControl-DLr9dD2N.js";import"./openEdit-AJJkPSPH.js";const V={components:{ProjectBranchNav:l,ProjectPlayer:h,ProjectInfoCard:u},data(){return{project:{},author:{},localuser:H,projectbranchs:[],projectbranchhistory:[],showplayer:!0,currentCommitId:"",initProject:N}},async mounted(){await this.initlizeProject()},methods:{async initlizeProject(){const r=this.$route.params.username,a=this.$route.params.projectname,n=this.$route.params.branch;if(r==="proxy"){this.$router.replace(`/app${this.$route.path}`);return}const s=await g(r,a);if(s.id===0){p.show404();return}if(this.project=s,this.project.default_branch==null){this.showplayer=!1;return}var t=await x(this.project.id);if(t.data.length===0){this.showplayer=!1;return}this.projectbranchs=t.data;const c=this.projectbranchs.find(i=>i.name===n);if(!c){p.show404();return}this.currentCommitId=c.latest_commit_hash,this.loadBranchHistory(),I({title:`${this.project.title} at ${n}`}),this.author=this.project.author},async loadBranchHistory(){const r=await $(this.project.id,this.currentCommitId);this.projectbranchhistory=r}},watch:{"$route.params.branch":{handler:async function(r){await this.initlizeProject()},immediate:!0}}};function k(r,a,n,s,t,c){const i=l,j=h,d=u,_=f;return w(),y(P,null,{default:o(()=>[e(B,null,{default:o(()=>[e(m,{xs:"12",sm:"12",md:"8",lg:"8",xl:"8",xxl:"8",cols:"12"},{default:o(()=>[e(i,{username:r.$route.params.username,projectname:r.$route.params.projectname,"current-branch":r.$route.params.branch,"current-commit-id":t.currentCommitId,branches:t.projectbranchs,"branch-history":t.projectbranchhistory},null,8,["username","projectname","current-branch","current-commit-id","branches","branch-history"]),e(j,{"project-id":t.project.id,branch:r.$route.params.branch,"commit-id":t.currentCommitId,showplayer:t.showplayer},null,8,["project-id","branch","commit-id","showplayer"]),a[0]||(a[0]=C("br",null,null,-1))]),_:1,__:[0]}),e(m,{xs:"12",sm:"12",md:"4",lg:"4",xl:"4",xxl:"8",cols:"12"},{default:o(()=>[e(d,{project:t.project,author:t.author,username:r.$route.params.username,projectname:r.$route.params.projectname},null,8,["project","author","username","projectname"])]),_:1}),e(m,{xxl:"8",xl:"8",lg:"8",md:"8",sm:"12",xs:"12",cols:"12"},{default:o(()=>[e(_,{url:"project-"+t.project.id+"#"+r.$route.params.branch,name:` ${t.project.title} 的分支：${r.$route.params.branch} `},null,8,["url","name"])]),_:1})]),_:1})]),_:1})}const K=b(V,[["render",k]]);export{K as default};
