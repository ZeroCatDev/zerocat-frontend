import{R as u,ai as j,Q as F,c as T,o as g,w as a,a as l,K as q,ac as N,H as i,O as b,a3 as S,G as p,a8 as h,a4 as P,a5 as $,I as w,f as Z,p as ee,l as le,aj as ae,i as te,ak as oe,z as ue,A as re,al as se,k as ne,am as ie,e as G,M as de,N as ve,af as fe}from"./index-CRa2tHx8.js";import{V as O}from"./VAlert-VGhentZM.js";import{V as z}from"./VSpacer-UShwK8wW.js";import{V as M}from"./VDialog-B5cefiiB.js";import{V as me,a as ce}from"./VRow-D8KT61wW.js";import{V as K}from"./VChip-XFyzIyXY.js";import{V as pe}from"./VForm-CJ_NAIh4.js";import{V as ye}from"./VContainer-Chq5Q-PS.js";/* empty css              */const Ve={__name:"verifyEmail",props:{modelValue:Boolean,email:{type:String,required:!0},title:{type:String,default:"验证邮箱"}},emits:["update:modelValue","verified"],setup(m,{expose:k,emit:r}){const x=m,C=r,d=u(x.modelValue),v=u(""),s=u(""),c=u("info"),V=u(!1),_={required:n=>!!n||"此字段为必填项",length:n=>(n==null?void 0:n.length)===6||"验证码必须是6位数字"};j(()=>d.value,n=>{C("update:modelValue",n),n&&D()}),j(()=>x.modelValue,n=>{d.value=n});const D=async()=>{var n,f;s.value="",V.value=!0;try{const y=await F.post("/account/send-verification-code",{email:x.email});y.data.status==="success"?(s.value="验证码已发送",c.value="success"):(s.value=y.data.message,c.value="error")}catch(y){s.value=((f=(n=y.response)==null?void 0:n.data)==null?void 0:f.message)||"发送验证码失败",c.value="error"}finally{V.value=!1}},B=()=>{if(!v.value||v.value.length!==6){s.value="请输入6位验证码",c.value="error";return}C("verified",v.value),E()},E=()=>{d.value=!1,v.value="",s.value=""};return k({sendCode:D}),(n,f)=>(g(),T(M,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=y=>d.value=y),"max-width":"400px"},{default:a(()=>[l(q,null,{default:a(()=>[l(N,null,{default:a(()=>[i(b(m.title),1)]),_:1}),l(S,null,{default:a(()=>[p("p",null,"验证码将发送到邮箱 "+b(m.email),1),l(P,{modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=y=>v.value=y),label:"验证码",rules:[_.required,_.length],maxlength:"6",variant:"outlined",class:"mt-4"},null,8,["modelValue","rules"]),s.value?(g(),T(O,{key:0,type:c.value,variant:"tonal",class:"mt-3"},{default:a(()=>[i(b(s.value),1)]),_:1},8,["type"])):h("",!0)]),_:1}),l($,null,{default:a(()=>[l(z),l(w,{color:"grey",variant:"text",onClick:E},{default:a(()=>f[2]||(f[2]=[i("取消")])),_:1}),l(w,{color:"primary",loading:V.value,onClick:B},{default:a(()=>f[3]||(f[3]=[i(" 确认 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ge=ee({fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...ne(),...se(),...re(),...ue()},"VTable"),ke=Z()({name:"VTable",props:ge(),setup(m,k){let{slots:r,emit:x}=k;const{themeClasses:C}=le(m),{densityClasses:d}=ae(m);return te(()=>l(m.tag,{class:["v-table",{"v-table--fixed-height":!!m.height,"v-table--fixed-header":m.fixedHeader,"v-table--fixed-footer":m.fixedFooter,"v-table--has-top":!!r.top,"v-table--has-bottom":!!r.bottom,"v-table--hover":m.hover},C.value,d.value,m.class],style:m.style},{default:()=>{var v,s,c;return[(v=r.top)==null?void 0:v.call(r),r.default?l("div",{class:"v-table__wrapper",style:{height:oe(m.height)}},[l("table",null,[r.default()])]):(s=r.wrapper)==null?void 0:s.call(r),(c=r.bottom)==null?void 0:c.call(r)]}})),{}}}),Ee={__name:"index",setup(m){const k=u([]),r=u(!1),x=u(!1),C=u(!1),d=u(!1),v=u(""),s=u("");u("");const c=u(null),V=u(""),_=u("info");u(""),u("info");const D=u(null),B=u(!1),E=u(""),n=u(""),f=u(null),y={required:o=>!!o||"此字段为必填项",email:o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)||"请输入有效的邮箱地址",length:o=>(o==null?void 0:o.length)===6||"验证码必须是6位数字"};ie(async()=>{await U()});const U=async()=>{try{const o=await F.get("/account/emails");o.data.status==="success"&&(k.value=o.data.data)}catch(o){console.error("获取邮箱列表失败:",o)}},A=(o,e,t)=>{E.value=o,n.value=e,f.value=t,B.value=!0},Q=o=>{f.value&&(f.value(o),f.value=null)},L=async()=>{if(!v.value){V.value="请输入新邮箱地址",_.value="error";return}const o=k.value.find(e=>e.is_primary);if(!o){V.value="未找到主邮箱",_.value="error";return}A(o.contact_value,"验证主邮箱",e=>{s.value=e,H()})},H=async()=>{if(!(!v.value||!s.value)){d.value=!0;try{const o=await F.post("/account/add-email",{email:v.value,verificationCode:s.value});o.data.status==="success"?(await U(),I()):(V.value=o.data.message,_.value="error")}catch{V.value="添加邮箱失败",_.value="error"}finally{d.value=!1}}},J=o=>{c.value=o,x.value=!0},W=()=>{const o=k.value.find(e=>e.is_primary);o&&c.value&&A(o.contact_value,"验证主邮箱",async e=>{d.value=!0;try{(await F.post("/account/remove-email",{email:c.value.contact_value,verificationCode:e})).data.status==="success"&&(await U(),R())}catch(t){console.error("删除失败:",t)}finally{d.value=!1}})},I=()=>{r.value=!1,C.value=!1,v.value="",s.value="",V.value="",D.value&&D.value.reset()},R=()=>{x.value=!1,c.value=null},X=o=>{A(o,"验证邮箱",async e=>{d.value=!0;try{(await F.post("/account/verify-email",{email:o,token:e})).data.status==="success"&&await U()}catch(t){console.error("验证失败:",t)}finally{d.value=!1}})};return(o,e)=>(g(),T(ye,null,{default:a(()=>[l(me,null,{default:a(()=>[l(ce,{cols:"12"},{default:a(()=>[l(q,{class:"mb-4"},{default:a(()=>[l(N,{class:"d-flex align-center justify-space-between"},{default:a(()=>[e[8]||(e[8]=p("span",null,"邮箱管理",-1)),l(w,{color:"primary",onClick:e[0]||(e[0]=t=>r.value=!0),disabled:k.value.length>=5},{default:a(()=>e[7]||(e[7]=[i(" 添加邮箱 ")])),_:1},8,["disabled"])]),_:1}),l(S,null,{default:a(()=>[l(ke,null,{default:a(()=>[e[12]||(e[12]=p("thead",null,[p("tr",null,[p("th",null,"邮箱地址"),p("th",null,"状态"),p("th",null,"添加时间"),p("th",null,"操作")])],-1)),p("tbody",null,[(g(!0),G(de,null,ve(k.value,t=>(g(),G("tr",{key:t.contact_id},[p("td",null,[i(b(t.contact_value)+" ",1),t.is_primary?(g(),T(K,{key:0,color:"primary",size:"small",class:"ml-2"},{default:a(()=>e[9]||(e[9]=[i("主邮箱")])),_:1})):h("",!0)]),p("td",null,[l(K,{color:t.verified?"success":"warning",size:"small"},{default:a(()=>[i(b(t.verified?"已验证":"未验证"),1)]),_:2},1032,["color"])]),p("td",null,b(new Date(t.created_at).toLocaleString()),1),p("td",null,[t.verified?h("",!0):(g(),T(w,{key:0,variant:"text",color:"primary",size:"small",onClick:Y=>X(t.contact_value)},{default:a(()=>e[10]||(e[10]=[i(" 验证 ")])),_:2},1032,["onClick"])),t.is_primary?h("",!0):(g(),T(w,{key:1,variant:"text",color:"error",size:"small",onClick:Y=>J(t)},{default:a(()=>e[11]||(e[11]=[i(" 删除 ")])),_:2},1032,["onClick"]))])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(M,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value=t),"max-width":"500px"},{default:a(()=>[l(q,null,{default:a(()=>[l(N,null,{default:a(()=>e[13]||(e[13]=[i("添加新邮箱")])),_:1}),l(S,null,{default:a(()=>[l(pe,{onSubmit:fe(L,["prevent"]),ref_key:"addForm",ref:D},{default:a(()=>[l(P,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),label:"新邮箱地址",rules:[y.required,y.email],variant:"outlined"},null,8,["modelValue","rules"]),C.value?(g(),T(P,{key:0,modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value=t),label:"主邮箱验证码",rules:[y.required,y.length],maxlength:"6",variant:"outlined"},null,8,["modelValue","rules"])):h("",!0),V.value?(g(),T(O,{key:1,type:_.value,variant:"tonal",class:"mt-3"},{default:a(()=>[i(b(V.value),1)]),_:1},8,["type"])):h("",!0)]),_:1},512)]),_:1}),l($,null,{default:a(()=>[l(z),l(w,{color:"grey",variant:"text",onClick:I},{default:a(()=>e[14]||(e[14]=[i("取消")])),_:1}),l(w,{color:"primary",loading:d.value,onClick:e[3]||(e[3]=t=>C.value?H():L())},{default:a(()=>[i(b(C.value?"添加":"发送验证码"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(M,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=t=>x.value=t),"max-width":"500px"},{default:a(()=>[l(q,null,{default:a(()=>[l(N,null,{default:a(()=>e[15]||(e[15]=[i("删除邮箱")])),_:1}),l(S,null,{default:a(()=>{var t;return[p("p",null,"确认要删除邮箱 "+b((t=c.value)==null?void 0:t.contact_value)+" 吗？",1)]}),_:1}),l($,null,{default:a(()=>[l(z),l(w,{color:"grey",variant:"text",onClick:R},{default:a(()=>e[16]||(e[16]=[i("取消")])),_:1}),l(w,{color:"error",loading:d.value,onClick:W},{default:a(()=>e[17]||(e[17]=[i(" 删除 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ve,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=t=>B.value=t),email:E.value,title:n.value,onVerified:Q},null,8,["modelValue","email","title"])]),_:1}))}};export{Ee as default};
