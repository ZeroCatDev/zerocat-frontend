import{_ as w}from"./LicenseSelector-DKoC4JWh.js";import{_ as U,ac as S,Y as c,o as f,N as r,e as t,Q as F,R as a,f as n,aB as V,i as u,a0 as L,S as B,m as E,L as s,X as p,aE as y,$ as j,n as q,W as g,ad as R,ae as k,aA as D,a9 as T,a3 as P,T as A,a1 as d,ab as b,ak as O,M as z}from"./index-CqDYMkg5.js";import{V as H}from"./VTextarea-BMQ0gWum.js";import{V as M}from"./VSelect-ByyaaPA0.js";import{V as Q}from"./VCombobox-CCJdL5BB.js";import{V as v}from"./VSpacer-BmIOKXlY.js";import{V as W}from"./VFileInput-DRqmpwST.js";import{V as X,a as Y,b as Z,c as G}from"./VExpansionPanels-TbU22qXq.js";import"./VCheckboxBtn-8mXxa5va.js";import"./VSelectionControl-DLr9dD2N.js";import"./filter-COFDuoWJ.js";const J={components:{LicenseSelector:w},data(){return{localuser:b,states:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],projectID:this.$route.params.id,project:{},newProjectName:"",tags:{items:["动画","故事","音乐","硬核","艺术","水"],chips:[]},changeVisibility:!1,changeVisibilityText:"",confirmDelete:!1,confirmDeleteText:"",thumbnail:null}},async created(){b.isLogin.value||this.$router.push("/app/account/login"),await this.fetchProject()},setup(){z({title:"项目设置"})},methods:{removeTag(o){this.tags.chips.splice(this.tags.chips.indexOf(o),1)},async fetchProject(){try{const{username:o,projectname:e}=this.$route.params;this.project=await O(o,e),this.projectID=this.project.id,this.newProjectName=this.project.name,this.tags.chips=this.project.tags.map(x=>x.name)}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"无法获取项目数据",life:3e3})}},async deleteProject(){try{await d.delete(`/project/${this.projectID}`),this.$toast.add({severity:"info",summary:"成功",detail:"项目已删除",life:3e3}),this.$router.push("/explore")}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"删除项目失败",life:3e3})}},async saveProject(){this.project.tags=this.tags.chips.map(o=>o);try{const o=(await d.put(`/project/id/${this.projectID}`,{id:this.project.id,title:this.project.title,description:this.project.description,type:this.project.type,tags:this.project.tags,license:this.project.license})).data;this.$toast.add({severity:o.status,summary:o.message,detail:o.message,life:3e3})}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"保存项目失败",life:3e3})}},async renameProject(){try{const o=(await d.put(`/project/rename/${this.projectID}`,{newName:this.newProjectName})).data;this.$toast.add({severity:o.status,summary:o.message,detail:o.message,life:3e3})}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"修改项目名称失败",life:3e3})}},async changeProjectVisibility(){try{const o=(await d.put(`/project/changevisibility/${this.projectID}`,{newState:this.project.state==="public"?"private":"public"})).data;this.$toast.add({severity:o.status,summary:o.message,detail:o.message,life:3e3}),this.$router.push(`/explore/${b.user.value.username}/${this.project.name}`)}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"修改项目状态失败",life:3e3})}},cancel(){this.$router.push("/explore/my")},onFileChange(o){const e=o.target.files[0];e&&(this.thumbnail=URL.createObjectURL(e))},async uploadThumbnail(){const o=new FormData;o.append("file",this.$refs.fileInput.$el.querySelector("input").files[0]);try{await d.post(`/scratch/thumbnail/${this.projectID}`,o,{headers:{Authorization:`Bearer ${b.token}`,"Content-Type":"multipart/form-data"}}),this.$toast.add({severity:"success",summary:"成功",detail:"封面上传成功",life:3e3})}catch(e){console.error(e),this.$toast.add({severity:"error",summary:"错误",detail:"封面上传失败",life:3e3})}}}};function K(o,e,x,$,l,m){const I=w,h=S("v-if");return f(),c(A,null,{default:r(()=>[t(F,null,{default:r(()=>[t(a,{cols:"12"},{default:r(()=>e[14]||(e[14]=[n("h1",null,"常规",-1)])),_:1,__:[14]}),t(a,{cols:"7"},{default:r(()=>[t(V,{label:"项目名称",required:"",modelValue:l.newProjectName,"onUpdate:modelValue":e[0]||(e[0]=i=>l.newProjectName=i),hint:"修改项目名称",variant:"outlined"},{append:r(()=>[t(u,{color:"primary",text:"修改名称",variant:"tonal",onClick:m.renameProject},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1}),t(a,{cols:"12"},{default:r(()=>[t(L)]),_:1}),t(a,{cols:"7"},{default:r(()=>[t(V,{label:"项目标题",required:"",modelValue:l.project.title,"onUpdate:modelValue":e[1]||(e[1]=i=>l.project.title=i),hint:"可读性更好的标题",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12"},{default:r(()=>[t(H,{hint:"介绍作品类型，玩法，并向对这个作品有帮助的人致谢！",label:"简介",modelValue:l.project.description,"onUpdate:modelValue":e[2]||(e[2]=i=>l.project.description=i),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:r(()=>[t(M,{items:["scratch","python","text"],label:"类型",required:"",hint:"不建议你改",modelValue:l.project.type,"onUpdate:modelValue":e[3]||(e[3]=i=>l.project.type=i),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:r(()=>[t(I,{modelValue:l.project.license,"onUpdate:modelValue":e[4]||(e[4]=i=>l.project.license=i)},null,8,["modelValue"])]),_:1}),t(a,{cols:"12"},{default:r(()=>[t(Q,{modelValue:l.tags.chips,"onUpdate:modelValue":e[5]||(e[5]=i=>l.tags.chips=i),items:l.tags.items,label:"标签","prepend-icon":"mdi-tag",variant:"outlined",chips:"",multiple:""},{selection:r(({attrs:i,item:C,select:_,selected:N})=>[t(B,E(i,{"model-value":N,closable:"",onClick:_,"onClick:close":ee=>m.removeTag(C)}),{default:r(()=>[n("strong",null,p(C.name),1),e[15]||(e[15]=s("  ")),e[16]||(e[16]=n("span",null,"(interest)",-1))]),_:2,__:[15,16]},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue","items"])]),_:1}),t(a,{cols:"12"},{default:r(()=>[t(y,null,{default:r(()=>[t(v),t(u,{text:"取消",variant:"plain",onClick:m.cancel},null,8,["onClick"]),t(u,{color:"primary",text:"保存",variant:"tonal",onClick:m.saveProject},null,8,["onClick"])]),_:1})]),_:1}),t(a,{cols:"12"},{default:r(()=>e[17]||(e[17]=[n("h1",null,"图片",-1)])),_:1,__:[17]}),t(a,{cols:"12"},{default:r(()=>[t(W,{ref:"fileInput",label:"上传封面",variant:"outlined",accept:"image/*","prepend-icon":"mdi-image",onChange:m.onFileChange},null,8,["onChange"]),l.thumbnail?(f(),c(q,{key:0,src:l.thumbnail,"max-width":"200"},null,8,["src"])):j("",!0),t(u,{color:"primary",text:"上传封面",variant:"tonal",onClick:m.uploadThumbnail,disabled:!l.thumbnail},null,8,["onClick","disabled"])]),_:1}),t(a,{cols:"12"},{default:r(()=>e[18]||(e[18]=[n("h1",null,"危险",-1)])),_:1,__:[18]}),t(a,{cols:"12"},{default:r(()=>[t(g,null,{default:r(()=>[t(R,null,{default:r(()=>[t(k,{title:"删除此项目",subtitle:"删除此项目后无法恢复。"},{append:r(()=>[t(u,{color:"error",text:"删除此项目",variant:"tonal",onClick:e[6]||(e[6]=i=>l.confirmDelete=!0)})]),_:1}),t(k,{title:"更改项目可见性",subtitle:"选择项目的可见性，公开或私密。"},{append:r(()=>[t(u,{color:"error",text:"更改项目可见性",variant:"tonal",onClick:e[7]||(e[7]=i=>l.changeVisibility=!0)})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(X,null,{default:r(()=>[t(Y,null,{default:r(()=>[t(Z,null,{default:r(()=>e[19]||(e[19]=[s("详细数据")])),_:1,__:[19]}),t(G,null,{default:r(()=>[s(p(l.project),1)]),_:1})]),_:1})]),_:1}),t(D,{modelValue:l.confirmDelete,"onUpdate:modelValue":e[10]||(e[10]=i=>l.confirmDelete=i),"max-width":"500px"},{default:r(()=>[t(g,null,{default:r(()=>[t(T,{class:"headline"},{default:r(()=>[s("删除 "+p(l.project.title),1)]),_:1}),t(P,null,{default:r(()=>[e[20]||(e[20]=s("你确定要删除这个项目吗？此操作无法撤销。")),e[21]||(e[21]=n("br",null,null,-1)),s("这将永久删除 "+p(l.project.title)+" 项目、推送、Star、评论、和其他所有数据，移除Fork对此项目的关联（但不会删除Fork）。",1),e[22]||(e[22]=n("br",null,null,-1)),e[23]||(e[23]=s("要确认，请在下面的框中输入提示的小字以确认您的操作。 ")),e[24]||(e[24]=n("br",null,null,-1)),e[25]||(e[25]=n("br",null,null,-1)),t(V,{variant:"outlined",label:`${l.localuser.user.username}/${l.project.name}`,modelValue:l.confirmDeleteText,"onUpdate:modelValue":e[8]||(e[8]=i=>l.confirmDeleteText=i)},null,8,["label","modelValue"])]),_:1,__:[20,21,22,23,24,25]}),t(y,null,{default:r(()=>[t(v),t(u,{color:"primary",text:"",onClick:e[9]||(e[9]=i=>{l.confirmDelete=!1,l.confirmDeleteText=""})},{default:r(()=>e[26]||(e[26]=[s("取消")])),_:1,__:[26]}),t(u,{color:"error",text:"",onClick:m.deleteProject,disabled:l.confirmDeleteText!==`${l.localuser.user.username}/${l.project.name}`},{default:r(()=>e[27]||(e[27]=[s("删除")])),_:1,__:[27]},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:l.changeVisibility,"onUpdate:modelValue":e[13]||(e[13]=i=>l.changeVisibility=i),"max-width":"500px"},{default:r(()=>[t(g,null,{default:r(()=>[t(T,{class:"headline"},{default:r(()=>[s(p(l.project.state==="public"?"私密":"公开")+" "+p(l.project.title),1)]),_:1}),t(P,null,{default:r(()=>[l.project.state==="public"?(f(),c(h,{key:0},{default:r(()=>e[28]||(e[28]=[s(" 将此仓库设为私有将删除不再有权访问此仓库的用户的 star。如果您决定在将来公开此存储库，则无法恢复这些 star ，这将影响项目的排名。"),n("br",null,null,-1),s(" 此项目的Fork将保持公开，且不再与此项目有任何关联。 ")])),_:1,__:[28]})):j("",!0),l.project.state==="private"?(f(),c(h,{key:1},{default:r(()=>e[29]||(e[29]=[s(" 该项目将对可以访问ZeroCat的每个人都可见"),n("br",null,null,-1),s(" 任何人都可以复制或下载您的仓库。"),n("br",null,null,-1),s(" 您的操作历史记录和日志将对所有人可见。 ")])),_:1,__:[29]})):j("",!0),e[30]||(e[30]=n("br",null,null,-1)),e[31]||(e[31]=n("br",null,null,-1)),e[32]||(e[32]=s(" 要确认，请在下面的框中输入提示的小字以确认您的操作。 ")),e[33]||(e[33]=n("br",null,null,-1)),e[34]||(e[34]=n("br",null,null,-1)),t(V,{variant:"outlined",label:`${l.localuser.user.username}/${l.project.name}`,modelValue:l.changeVisibilityText,"onUpdate:modelValue":e[11]||(e[11]=i=>l.changeVisibilityText=i)},null,8,["label","modelValue"])]),_:1,__:[30,31,32,33,34]}),t(y,null,{default:r(()=>[t(v),t(u,{color:"primary",text:"",onClick:e[12]||(e[12]=i=>l.changeVisibility=!1)},{default:r(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]}),t(u,{color:"error",text:"",onClick:m.changeProjectVisibility,disabled:l.changeVisibilityText!==`${l.localuser.user.username}/${l.project.name}`},{default:r(()=>[s(p(l.project.state==="public"?"设置为私密":"设置为公开"),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const de=U(J,[["render",K]]);export{de as default};
