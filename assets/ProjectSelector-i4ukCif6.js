import{_ as V,a1 as x,ab as k,aa as C,Y as n,o,N as s,e as r,W as v,a9 as S,f as c,L as d,O as f,$ as g,X as u,i as _,a3 as b,c as p,aB as w,a4 as U,ad as B,F as D,U as T,ae as A,D as z,af as L,Z as Q,n as I,S as P,aD as N,aE as F,aA as O}from"./index-DmjUHmS9.js";import{V as j}from"./VCheckbox-B5sNSQxl.js";import{V as E}from"./VSpacer-pm7_9tB-.js";const q={name:"ProjectSelector",props:{modelValue:{type:Boolean,default:!1},projects:{type:Array,default:()=>[]}},emits:["update:modelValue","select","multiSelect"],data(){return{searchQuery:"",s3BucketUrl:"",selectedProjects:[],allProjects:[],searchTimeout:null,loading:!1}},computed:{dialog:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},filteredProjects(){const t=this.allProjects.length>0?this.allProjects:this.projects;let e=t;if(this.searchQuery){const m=this.searchQuery.toLowerCase();e=t.filter(y=>{var i;return(i=y.title)==null?void 0:i.toLowerCase().includes(m)})}return e.slice(0,100)},selectedCount(){return this.selectedProjects.length},selectAll:{get(){return this.filteredProjects.length>0&&this.selectedProjects.length===this.filteredProjects.length},set(t){}},isIndeterminate(){return this.selectedProjects.length>0&&this.selectedProjects.length<this.filteredProjects.length}},async created(){try{this.s3BucketUrl=await C("s3.staticurl"),await this.fetchProjects()}catch(t){console.warn("Failed to get s3.staticurl:",t),this.s3BucketUrl=""}},methods:{async fetchProjects(){this.loading=!0;try{const t=await x.get("/searchapi",{params:{search_userid:k.user.value.id,limit:200}});t.data&&t.data.projects&&(this.allProjects=t.data.projects)}catch(t){console.error("Failed to fetch projects:",t)}finally{this.loading=!1}},selectProject(t){this.$emit("select",t)},confirmSelection(){const e=(this.allProjects.length>0?this.allProjects:this.projects).filter(m=>this.selectedProjects.includes(m.id));this.$emit("multiSelect",e),this.closeDialog()},toggleSelectAll(){this.selectedProjects.length===this.filteredProjects.length?this.selectedProjects=[]:this.selectedProjects=this.filteredProjects.map(t=>t.id)},toggleProjectSelection(t){const e=this.selectedProjects.indexOf(t);e>-1?this.selectedProjects.splice(e,1):this.selectedProjects.push(t)},clearSelection(){this.selectedProjects=[]},closeDialog(){this.dialog=!1,this.searchQuery="",this.selectedProjects=[]},handleSearchUpdate(t){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.searchQuery=t||""},300)},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN"):""}}},M={class:"d-flex align-center"},W={class:"d-flex align-center"},X={class:"text-caption"},Y={key:0,class:"text-center py-8"},Z={class:"d-flex align-center"},G={class:"flex-grow-1"},H={class:"font-weight-medium"},J={class:"text-caption text-grey"},K={class:"d-flex align-center"},R={key:2,class:"text-center py-8"},$={class:"text-h6 mt-4 text-grey-darken-1"};function ee(t,e,m,y,i,a){return o(),n(O,{modelValue:a.dialog,"onUpdate:modelValue":e[3]||(e[3]=l=>a.dialog=l),"max-width":"1000",scrollable:""},{default:s(()=>[r(v,null,{default:s(()=>[r(S,{class:"d-flex align-center justify-space-between"},{default:s(()=>[c("div",M,[r(f,{class:"mr-2"},{default:s(()=>e[4]||(e[4]=[d("mdi-folder-multiple",-1)])),_:1,__:[4]}),e[5]||(e[5]=d(" 选择项目 ",-1))]),c("div",W,[r(j,{modelValue:a.selectAll,"onUpdate:modelValue":e[0]||(e[0]=l=>a.selectAll=l),indeterminate:a.isIndeterminate,onChange:a.toggleSelectAll,"hide-details":"",class:"mr-2"},null,8,["modelValue","indeterminate","onChange"]),c("span",X,u(a.selectedCount)+"/"+u(a.filteredProjects.length)+" 已选择",1),i.selectedProjects.length>0?(o(),n(_,{key:0,variant:"text",size:"small",color:"error",class:"ml-2",onClick:a.clearSelection},{default:s(()=>e[6]||(e[6]=[d(" 取消选择 ",-1)])),_:1,__:[6]},8,["onClick"])):g("",!0)])]),_:1}),r(b,{style:{height:"600px"}},{default:s(()=>[r(w,{modelValue:i.searchQuery,"onUpdate:modelValue":[e[1]||(e[1]=l=>i.searchQuery=l),a.handleSearchUpdate],label:"项目名","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","hide-details":"",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue"]),i.loading?(o(),p("div",Y,[r(U,{indeterminate:"",color:"primary"}),e[7]||(e[7]=c("p",{class:"text-body-2 text-grey mt-3"},"正在加载项目...",-1))])):(o(),n(B,{key:1,class:"project-list"},{default:s(()=>[(o(!0),p(D,null,T(a.filteredProjects,l=>(o(),n(A,{key:l.id,class:z(["project-item mb-2",{"selected-item":i.selectedProjects.includes(l.id)}]),variant:"outlined",rounded:"",onClick:h=>a.toggleProjectSelection(l.id),density:"compact"},{prepend:s(()=>[r(j,{"model-value":i.selectedProjects.includes(l.id),"onUpdate:modelValue":h=>a.toggleProjectSelection(l.id),"hide-details":"",onClick:e[2]||(e[2]=N(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"])]),append:s(()=>[c("div",K,[l.state==="public"?(o(),n(P,{key:0,color:"success",size:"small",variant:"tonal",class:"mr-2"},{default:s(()=>e[9]||(e[9]=[d(" 公开 ",-1)])),_:1,__:[9]})):l.state==="private"?(o(),n(P,{key:1,color:"error",size:"small",variant:"tonal",class:"mr-2"},{default:s(()=>e[10]||(e[10]=[d(" 私密 ",-1)])),_:1,__:[10]})):g("",!0),r(P,{size:"x-small",variant:"tonal","prepend-icon":"mdi-eye"},{default:s(()=>[d(u(l.view_count||0),1)]),_:2},1024)])]),default:s(()=>[r(L,null,{default:s(()=>{var h;return[c("div",Z,[r(Q,{size:"32",class:"mr-3"},{default:s(()=>[l.thumbnail?(o(),n(I,{key:0,src:`${i.s3BucketUrl}/${l.thumbnail}`,alt:l.title},null,8,["src","alt"])):(o(),n(f,{key:1},{default:s(()=>e[8]||(e[8]=[d("mdi-folder",-1)])),_:1,__:[8]}))]),_:2},1024),c("div",G,[c("div",H,u(l.title),1),c("div",J,u(((h=l.author)==null?void 0:h.username)||"未知用户")+" • "+u(a.formatDate(l.updated_at)),1)])])]}),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})),a.filteredProjects.length===0?(o(),p("div",R,[r(f,{size:"64",color:"grey-lighten-1"},{default:s(()=>e[11]||(e[11]=[d("mdi-folder-outline",-1)])),_:1,__:[11]}),c("p",$,u(i.searchQuery?"未找到匹配的项目":"暂无项目"),1)])):g("",!0)]),_:1}),r(F,null,{default:s(()=>[r(E),r(_,{onClick:a.closeDialog},{default:s(()=>e[12]||(e[12]=[d("取消",-1)])),_:1,__:[12]},8,["onClick"]),r(_,{color:"primary",disabled:i.selectedProjects.length===0,onClick:a.confirmSelection},{default:s(()=>[d(" 确认选择 ("+u(i.selectedProjects.length)+") ",1)]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ae=V(q,[["render",ee],["__scopeId","data-v-477f01b5"]]);export{ae as _};
