import{_ as w,Y as a,ai as b,a as d,o as c,h as e,N as l,K as t,T as n,j as u,al as V,U as h,X as m,am as f,aD as B,m as y,ak as x,S as C,av as v,Z as F,M as p,aq as S}from"./index-DKqePUrh.js";import{V as U}from"./VTextarea-CNLlxTZD.js";import{V as I}from"./VSpacer-e-NAsH-v.js";import{V as L}from"./VDialog-DDRRILQ3.js";import{V as R}from"./VSnackbar-CaMekowO.js";const D={name:"UserRelationControls",props:{userId:{type:Number,required:!0},username:{type:String,required:!0},displayName:{type:String,required:!0}},data(){return{isFollowing:!1,isBlocking:!1,followLoading:!1,blockLoading:!1,blockDialog:!1,blockReason:"",localuser:b,targetUsername:this.displayName||this.username,snackbar:{show:!1,text:"",color:"success"}}},mounted(){this.localuser.user.id&&this.checkRelationships()},watch:{userId:{handler(){this.checkRelationships()},immediate:!0}},methods:{async checkRelationships(){if(this.localuser.user.id)try{const i=await a.get(`/follows/relationships/${this.userId}`);if(i.data.success){const{isFollowing:o,isBlocking:g}=i.data.data;this.isFollowing=o,this.isBlocking=g}}catch(i){console.error("检查用户关系失败:",i)}},async toggleFollow(){if(!this.localuser.user.id){this.$router.push("/login");return}try{this.followLoading=!0,this.isFollowing?(await a.delete(`/follows/${this.userId}`),this.isFollowing=!1,this.showSnackbar(`已取消关注 ${this.targetUsername}`,"info")):(await a.post(`/follows/${this.userId}`),this.isFollowing=!0,this.showSnackbar(`已成功关注 ${this.targetUsername}`,"success"))}catch(i){console.error("关注操作失败:",i),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.followLoading=!1}},toggleBlock(){if(!this.localuser.user.id){this.$router.push("/login");return}this.blockDialog=!0},async confirmBlockAction(){try{if(this.blockLoading=!0,this.isBlocking)await a.delete(`/follows/block/${this.userId}`),this.isBlocking=!1,this.showSnackbar(`已取消拉黑 ${this.targetUsername}`,"success");else{const i=this.blockReason?{reason:this.blockReason}:{};await a.post(`/follows/block/${this.userId}`,i),this.isBlocking=!0,this.isFollowing&&(await a.delete(`/follows/${this.userId}`),this.isFollowing=!1),this.showSnackbar(`已拉黑 ${this.targetUsername}`,"success")}this.blockDialog=!1,this.blockReason=""}catch(i){console.error("拉黑操作失败:",i),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.blockLoading=!1}},sendMessage(){this.showSnackbar("私信功能即将上线","info")},reportUser(){this.showSnackbar("举报功能即将上线","info")},showSnackbar(i,o="success"){this.snackbar.text=i,this.snackbar.color=o,this.snackbar.show=!0}}},N={key:0},_={key:1};function T(i,o,g,q,s,k){return c(),d("div",null,[e(u,{loading:s.followLoading,variant:s.isFollowing?"outlined":"tonal",color:"primary","prepend-icon":s.isFollowing?"mdi-check":"mdi-account-plus",onClick:k.toggleFollow,rounded:"pill"},{default:l(()=>[t(n(s.isFollowing?"已关注":"关注"),1)]),_:1},8,["loading","variant","prepend-icon","onClick"]),e(x,{location:"bottom"},{activator:l(({props:r})=>[e(u,y({icon:"mdi-dots-vertical",variant:"text",size:"small",class:"ml-2"},r),null,16)]),default:l(()=>[e(V,{density:"compact",width:"150"},{default:l(()=>[e(f,{"prepend-icon":s.isBlocking?"mdi-account-cancel":"mdi-account-remove",title:s.isBlocking?"取消拉黑":"拉黑用户",class:B({"text-error":!s.isBlocking}),onClick:k.toggleBlock},null,8,["prepend-icon","title","class","onClick"]),s.isFollowing?(c(),h(f,{key:0,"prepend-icon":"mdi-account-remove",title:"取消关注",onClick:k.toggleFollow},null,8,["onClick"])):m("",!0)]),_:1})]),_:1}),e(L,{modelValue:s.blockDialog,"onUpdate:modelValue":o[2]||(o[2]=r=>s.blockDialog=r),"max-width":"400px"},{default:l(()=>[e(C,null,{default:l(()=>[e(v,{class:"text-h5 text-center pa-4"},{default:l(()=>[t(n(s.isBlocking?"取消拉黑用户":"拉黑用户"),1)]),_:1}),e(F,{class:"pa-4"},{default:l(()=>[s.isBlocking?(c(),d("p",N,[o[5]||(o[5]=t(" 确定要取消拉黑 ")),p("strong",null,n(s.targetUsername),1),o[6]||(o[6]=t(" 吗？取消拉黑后，该用户可以查看您的内容并与您互动。 "))])):(c(),d("p",_,[o[7]||(o[7]=t(" 确定要拉黑 ")),p("strong",null,n(s.targetUsername),1),o[8]||(o[8]=t(" 吗？拉黑后，该用户将无法关注您，也无法查看您的动态或与您互动。 "))])),s.isBlocking?m("",!0):(c(),h(U,{key:2,modelValue:s.blockReason,"onUpdate:modelValue":o[0]||(o[0]=r=>s.blockReason=r),label:"拉黑原因（可选）",placeholder:"请简要说明拉黑原因...",variant:"outlined",rows:"3",class:"mt-4","hide-details":""},null,8,["modelValue"]))]),_:1}),e(S,{class:"pa-4 pt-0"},{default:l(()=>[e(I),e(u,{variant:"text",onClick:o[1]||(o[1]=r=>s.blockDialog=!1)},{default:l(()=>o[9]||(o[9]=[t(" 取消 ")])),_:1}),e(u,{color:s.isBlocking?"primary":"error",loading:s.blockLoading,onClick:k.confirmBlockAction,variant:"tonal"},{default:l(()=>[t(n(s.isBlocking?"取消拉黑":"拉黑"),1)]),_:1},8,["color","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{modelValue:s.snackbar.show,"onUpdate:modelValue":o[4]||(o[4]=r=>s.snackbar.show=r),color:s.snackbar.color,timeout:3e3},{actions:l(()=>[e(u,{variant:"text",onClick:o[3]||(o[3]=r=>s.snackbar.show=!1)},{default:l(()=>o[10]||(o[10]=[t(" 关闭 ")])),_:1})]),default:l(()=>[t(n(s.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const K=w(D,[["render",T]]);export{K as _};
