import{u as xe,a as ke,m as Ce}from"./VSelect-DrDGiuRO.js";import{V as j,m as we}from"./VTextField-huVeyDMJ.js";import{b as Se,p as Fe,d as Ie,r as P,B as S,u as B,y as g,bU as Ae,bC as Pe,aI as De,w as D,bv as X,bx as Re,f as Te,h as v,F as N,O as Z,b_ as Me,ah as _e,m as w,ai as Ee,aj as $,U as Ke,bV as Le,i as Oe,K as Ue,aZ as Be,bJ as Ne,a_ as ze,bW as G,aJ as qe,bX as Q}from"./index-BoardjOA.js";import{u as He,h as Je,m as We}from"./filter-CR-5Yzqa.js";import{f as je}from"./VInput-BSMIx3P2.js";import{V as Xe}from"./VCheckboxBtn-B8zOAPkX.js";import{V as Ze}from"./VChip-Dy0NAZz2.js";const $e=Fe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...We({filterKeys:["title"]}),...Ce(),...ze(we({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ne({transition:!1})},"VAutocomplete"),ul=Se()({name:"VAutocomplete",props:$e(),emits:{"update:focused":l=>!0,"update:search":l=>!0,"update:modelValue":l=>!0,"update:menu":l=>!0},setup(l,Y){let{slots:n}=Y;const{t:R}=Ie(),p=P(),V=S(!1),b=S(!0),T=S(!1),z=P(),M=P(),_=B(l,"menu"),r=g({get:()=>_.value,set:e=>{var t;_.value&&!e&&((t=z.value)!=null&&t.Î¨openChildren.size)||(_.value=e)}}),o=S(-1),ee=g(()=>{var e;return(e=p.value)==null?void 0:e.color}),q=g(()=>r.value?l.closeText:l.openText),{items:H,transformIn:le,transformOut:te}=Ae(l),{textColorClasses:ae,textColorStyles:ue}=Pe(ee),f=B(l,"search",""),u=B(l,"modelValue",[],e=>le(e===null?[null]:De(e)),e=>{const t=te(e);return l.multiple?t:t[0]??null}),ne=g(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:u.value.length),F=je(l),{filteredItems:E,getMatches:oe}=He(l,H,()=>b.value?"":f.value),y=g(()=>l.hideSelected?E.value.filter(e=>!u.value.some(t=>t.value===e.value)):E.value),I=g(()=>!!(l.chips||n.chip)),k=g(()=>I.value||!!n.selection),ie=g(()=>u.value.map(e=>e.props.value)),K=g(()=>{var t;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&f.value===((t=y.value[0])==null?void 0:t.title))&&y.value.length>0&&!b.value&&!T.value}),L=g(()=>l.hideNoData&&!y.value.length||F.isReadonly.value||F.isDisabled.value),O=P(),se=xe(O,p);function re(e){l.openOnClear&&(r.value=!0),f.value=""}function ce(){L.value||(r.value=!0)}function ve(e){L.value||(V.value&&(e.preventDefault(),e.stopPropagation()),r.value=!r.value)}function de(e){var t;e.key!==" "&&G(e)&&((t=p.value)==null||t.focus())}function fe(e){var a,s,m;if(F.isReadonly.value)return;const t=p.value.selectionStart,i=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(r.value=!0),["Escape"].includes(e.key)&&(r.value=!1),K.value&&["Enter","Tab"].includes(e.key)&&!u.value.some(c=>{let{value:d}=c;return d===y.value[0].value})&&x(y.value[0]),e.key==="ArrowDown"&&K.value&&((a=O.value)==null||a.focus("next")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&k.value&&u.value.length>0&&!f.value)return x(u.value[0],!1);if(~o.value){e.preventDefault();const c=o.value;x(u.value[o.value],!1),o.value=c>=i-1?i-2:c}else e.key==="Backspace"&&!f.value&&(o.value=i-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(o.value<0&&t>0)return;const c=o.value>-1?o.value-1:i-1;u.value[c]?o.value=c:(o.value=-1,p.value.setSelectionRange((s=f.value)==null?void 0:s.length,(m=f.value)==null?void 0:m.length))}else if(e.key==="ArrowRight"){if(o.value<0)return;const c=o.value+1;u.value[c]?o.value=c:(o.value=-1,p.value.setSelectionRange(0,0))}else~o.value&&G(e)&&(o.value=-1)}function me(e){if(Q(p.value,":autofill")||Q(p.value,":-webkit-autofill")){const t=H.value.find(i=>i.title===e.target.value);t&&x(t)}}function he(){var e;l.eager&&((e=M.value)==null||e.calculateVisibleItems())}function pe(){var e;V.value&&(b.value=!0,(e=p.value)==null||e.focus())}function ge(e){V.value=!0,setTimeout(()=>{T.value=!0})}function Ve(e){T.value=!1}function ye(e){(e==null||e===""&&!l.multiple&&!k.value)&&(u.value=[])}const U=S(!1);function x(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const i=u.value.findIndex(s=>(l.valueComparator||qe)(s.value,e.value)),a=t??!~i;if(~i){const s=a?[...u.value,e]:[...u.value];s.splice(i,1),u.value=s}else a&&(u.value=[...u.value,e]);l.clearOnSelect&&(f.value="")}else{const i=t!==!1;u.value=i?[e]:[],f.value=i&&!k.value?e.title:"",X(()=>{r.value=!1,b.value=!0})}}return D(V,(e,t)=>{var i;e!==t&&(e?(U.value=!0,f.value=l.multiple||k.value?"":String(((i=u.value.at(-1))==null?void 0:i.props.title)??""),b.value=!0,X(()=>U.value=!1)):(!l.multiple&&f.value==null&&(u.value=[]),r.value=!1,(l.multiple||k.value)&&(f.value=""),o.value=-1))}),D(f,e=>{!V.value||U.value||(e&&(r.value=!0),b.value=!e)}),D(r,()=>{if(!l.hideSelected&&r.value&&u.value.length){const e=y.value.findIndex(t=>u.value.some(i=>t.value===i.value));Re&&window.requestAnimationFrame(()=>{var t;e>=0&&((t=M.value)==null||t.scrollToIndex(e))})}}),D(()=>l.items,(e,t)=>{r.value||V.value&&!t.length&&e.length&&(r.value=!0)}),Te(()=>{const e=!!(!l.hideNoData||y.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),t=u.value.length>0,i=j.filterProps(l);return v(j,w({ref:p},i,{modelValue:f.value,"onUpdate:modelValue":[a=>f.value=a,ye],focused:V.value,"onUpdate:focused":a=>V.value=a,validationValue:u.externalValue,counterValue:ne.value,dirty:t,onChange:me,class:["v-autocomplete",`v-autocomplete--${l.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!l.chips,"v-autocomplete--selection-slot":!!k.value,"v-autocomplete--selecting-index":o.value>-1},l.class],style:l.style,readonly:F.isReadonly.value,placeholder:t?void 0:l.placeholder,"onClick:clear":re,"onMousedown:control":ce,onKeydown:fe}),{...n,default:()=>v(N,null,[v(_e,w({ref:z,modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,activator:"parent",contentClass:"v-autocomplete__content",disabled:L.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:he,onAfterLeave:pe},l.menuProps),{default:()=>[e&&v(Ee,w({ref:O,selected:ie.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onKeydown:de,onFocusin:ge,onFocusout:Ve,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},se,l.listProps),{default:()=>{var a,s,m;return[(a=n["prepend-item"])==null?void 0:a.call(n),!y.value.length&&!l.hideNoData&&(((s=n["no-data"])==null?void 0:s.call(n))??v($,{key:"no-data",title:R(l.noDataText)},null)),v(ke,{ref:M,renderless:!0,items:y.value,itemKey:"value"},{default:c=>{var W;let{item:d,index:C,itemRef:h}=c;const J=w(d.props,{ref:h,key:d.value,active:K.value&&C===0?!0:void 0,onClick:()=>x(d,null)});return((W=n.item)==null?void 0:W.call(n,{item:d,index:C,props:J}))??v($,w(J,{role:"option"}),{prepend:A=>{let{isSelected:be}=A;return v(N,null,[l.multiple&&!l.hideSelected?v(Xe,{key:d.value,modelValue:be,ripple:!1,tabindex:"-1"},null):void 0,d.props.prependAvatar&&v(Ke,{image:d.props.prependAvatar},null),d.props.prependIcon&&v(Z,{icon:d.props.prependIcon},null)])},title:()=>{var A;return b.value?d.title:Je("v-autocomplete",d.title,(A=oe(d))==null?void 0:A.title)}})}}),(m=n["append-item"])==null?void 0:m.call(n)]}})]}),u.value.map((a,s)=>{function m(h){h.stopPropagation(),h.preventDefault(),x(a,!1)}const c={"onClick:close":m,onKeydown(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),h.stopPropagation(),m(h))},onMousedown(h){h.preventDefault(),h.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},d=I.value?!!n.chip:!!n.selection,C=d?Le(I.value?n.chip({item:a,index:s,props:c}):n.selection({item:a,index:s})):void 0;if(!(d&&!C))return v("div",{key:a.value,class:["v-autocomplete__selection",s===o.value&&["v-autocomplete__selection--selected",ae.value]],style:s===o.value?ue.value:{}},[I.value?n.chip?v(Oe,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:a.title}}},{default:()=>[C]}):v(Ze,w({key:"chip",closable:l.closableChips,size:"small",text:a.title,disabled:a.props.disabled},c),null):C??v("span",{class:"v-autocomplete__selection-text"},[a.title,l.multiple&&s<u.value.length-1&&v("span",{class:"v-autocomplete__selection-comma"},[Ue(",")])])])})]),"append-inner":function(){var c;for(var a=arguments.length,s=new Array(a),m=0;m<a;m++)s[m]=arguments[m];return v(N,null,[(c=n["append-inner"])==null?void 0:c.call(n,...s),l.menuIcon?v(Z,{class:"v-autocomplete__menu-icon",icon:l.menuIcon,onMousedown:ve,onClick:Me,"aria-label":R(q.value),title:R(q.value),tabindex:"-1"},null):void 0])}})}),Be({isFocused:V,isPristine:b,menu:r,search:f,filteredItems:E,select:x},p)}});export{ul as V};
