import{_ as S}from"./TimeAgo-DqdsDU9T.js";import{_ as C}from"./ProjectCard-B0vIoyNN.js";import{_ as I}from"./Timeline-DkZ_30Hf.js";import{_ as B,X as n,o as l,M as t,e as s,aS as D,ae as _,L as i,N as R,i as b,a8 as h,aG as U,aH as K,ah as L,c as g,ai as x,aj as j,F as y,W as v,$ as w,T as p,S as M,ak as T,f as c,O as d,Z as H,n as O,aJ as Z,Q as k,R as P,eO as G,Y as V,aV as J,j as Q,bU as W,U as X,a6 as Y,a5 as u,af as E}from"./index-B0FU96U5.js";import{V as q}from"./VSkeletonLoader-Cvuq3Bij.js";import"./VTimeline-Ca9UPze1.js";import"https://static.geetest.com/v4/gt4.js";const $={name:"Dashboard",components:{Timeline:I,TimeAgo:S,ProjectCard:C},data(){return{localuser:E,isLoadingTopProjects:!1,isLoadingExplore:!1,search:{title:"",state:"public",limit:10},exploreSearch:{page:1,limit:20,hasMore:!0},topProjects:[],latestProjects:[],exploreProjects:[],timeline:{events:[],pagination:{current:1,size:20,total:0}},isLoadingMore:!1,recentActivities:[],projects:[],loading:!1,error:null,localuser:E,loadMoreTrigger:null}},methods:{async fetchTopProjects(){this.isLoadingTopProjects=!0;try{this.search.title!=""&&(this.search.limit=40);const a=await u.get("/searchapi",{params:{search_userid:this.localuser.user.id,search_title:this.search.title,search_state:this.search.state,limit:this.search.limit}});a.data&&a.data.projects&&(this.topProjects=a.data.projects)}catch(a){console.error("Failed to fetch top projects:",a),this.topProjects=[]}finally{this.isLoadingTopProjects=!1}},async fetchLatestProjects(){try{const a=await u.get("/projectlist/latest",{params:{limit:6,state:"public"}});a.data.status==="success"&&(this.latestProjects=a.data.data)}catch(a){console.error("Failed to fetch latest projects:",a)}},async fetchTimeline(a=1){try{const e=await u.get("/timeline/following",{params:{page:a,limit:this.timeline.pagination.size}});e.data.status==="success"&&(a===1?this.timeline=e.data.data:(this.timeline.events=[...this.timeline.events,...e.data.data.events],this.timeline.pagination=e.data.data.pagination))}catch(e){console.error("Failed to fetch timeline:",e)}},async fetchRecentActivities(){try{const a=await u.get("/timeline/me",{params:{page:1,limit:100}});a.data.status==="success"&&(this.recentActivities=a.data.data.events.map(e=>{var f;return{id:e.id,text:((f=e.event_data)==null?void 0:f.project_title)||e.type,icon:this.getEventIcon(e.type),color:this.getEventColor(e.type),date:e.created_at}}))}catch(a){console.error("Failed to fetch recent activities:",a)}},getEventIcon(a){return{project_create:"mdi-plus-circle",project_publish:"mdi-upload",project_fork:"mdi-source-fork",project_delete:"mdi-delete",user_profile_update:"mdi-account-edit",project_commit:"mdi-source-commit",project_rename:"mdi-rename-box",project_info_update:"mdi-file-document-edit"}[a]||"mdi-bell"},getEventColor(a){return{project_create:"success",project_publish:"info",project_fork:"warning",project_delete:"error",user_profile_update:"info",project_commit:"info",project_rename:"warning",project_info_update:"info"}[a]||"primary"},resetSearch(){this.search={title:"",state:"public"},this.fetchTopProjects()},async searchProjects(){await this.fetchTopProjects()},async loadMoreEvents(){if(!this.isLoadingMore)try{this.isLoadingMore=!0,await this.fetchTimeline(this.timeline.pagination.current+1)}finally{this.isLoadingMore=!1}},async loadMoreExploreProjects(){if(!(this.isLoadingExplore||!this.exploreSearch.hasMore)){this.isLoadingExplore=!0;try{const a=await u.get("/searchapi",{params:{search_title:"",search_state:"public",search_orderby:"view_down",curr:this.exploreSearch.page,limit:this.exploreSearch.limit}});if(a.data&&a.data.projects){if(a.data.projects.length===0){this.exploreSearch.hasMore=!1;return}this.exploreProjects=[...this.exploreProjects,...a.data.projects],this.exploreSearch.page++}}catch(a){console.error("Failed to fetch more explore projects:",a)}finally{this.isLoadingExplore=!1}}},onIntersect(a){a&&this.loadMoreExploreProjects()}},async mounted(){await Promise.all([this.fetchTopProjects(),this.fetchLatestProjects(),this.fetchTimeline(),this.fetchRecentActivities(),this.loadMoreExploreProjects()])},created(){Y({title:"Dashboard - ZeroCat"})}},ee={class:"d-flex align-center gap-2"},te={class:"d-flex align-center"},se={class:"text-caption"},ae={class:"d-flex align-center"},oe={class:"text-caption"},ie={class:"d-flex justify-center my-4"},re={style:{height:"20px"}};function le(a,e,f,ne,r,m){const A=G,z=I,F=C,N=S;return l(),n(X,{fluid:""},{default:t(()=>[s(D,null,{default:t(()=>[s(_,{class:"text-subtitle-1 font-weight-bold d-flex align-center"},{default:t(()=>[e[2]||(e[2]=i(" 我的项目 ",-1)),s(R),s(b,{color:"success","prepend-icon":"mdi-plus",size:"small",to:"/app/new",variant:"tonal"},{default:t(()=>e[1]||(e[1]=[i("新建 ",-1)])),_:1,__:[1]})]),_:1,__:[2]}),s(h,{class:"pt-2 pb-0"},{default:t(()=>[s(U,{modelValue:r.search.title,"onUpdate:modelValue":e[0]||(e[0]=o=>r.search.title=o),class:"mb-2",density:"compact","hide-details":"",label:"项目名称",placeholder:"输入项目名称搜索","single-line":"",variant:"outlined",onInput:m.searchProjects,onKeyup:K(m.searchProjects,["enter"])},null,8,["modelValue","onInput","onKeyup"])]),_:1}),s(L,{density:"compact"},{default:t(()=>[r.isLoadingTopProjects?(l(),n(q,{key:0,type:"text",width:"80%"})):r.topProjects.length===0?(l(),n(x,{key:1},{default:t(()=>[s(j,{class:"text-center text-medium-emphasis"},{default:t(()=>e[3]||(e[3]=[i(" 暂无项目 ",-1)])),_:1,__:[3]})]),_:1})):(l(!0),g(y,{key:2},v(r.topProjects,o=>(l(),n(x,{key:o.id,to:`/${o.author.username}/${o.name}`},{prepend:t(()=>[s(H,{size:"32"},{default:t(()=>[s(O,{src:r.localuser.getUserAvatar(o.author.avatar)},null,8,["src"])]),_:2},1024)]),append:t(()=>[c("div",ee,[c("div",te,[s(d,{class:"mr-1",size:"small"},{default:t(()=>e[5]||(e[5]=[i("mdi-eye",-1)])),_:1,__:[5]}),c("span",se,p(o.view_count),1)]),c("div",ae,[s(d,{class:"mr-1",size:"small"},{default:t(()=>e[6]||(e[6]=[i("mdi-star",-1)])),_:1,__:[6]}),c("span",oe,p(o.star_count),1)])])]),default:t(()=>[s(j,{class:"text-body-2 d-flex align-center"},{default:t(()=>[i(p(o.title)+" ",1),o.state==="private"?(l(),n(M,{key:0,class:"ml-2",color:"error",size:"x-small"},{default:t(()=>e[4]||(e[4]=[i("私密 ",-1)])),_:1,__:[4]})):w("",!0)]),_:2},1024),s(T,{class:"text-caption"},{default:t(()=>[i(p(o.description),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1}),s(Z,{class:"justify-center"},{default:t(()=>[s(b,{block:"",class:"text-none",to:"/app/project",variant:"text"},{default:t(()=>[e[8]||(e[8]=i(" 查看全部 ",-1)),s(d,{end:""},{default:t(()=>e[7]||(e[7]=[i("mdi-chevron-right",-1)])),_:1,__:[7]})]),_:1,__:[8]})]),_:1})]),_:1}),s(k,null,{default:t(()=>[s(P,{cols:"12",md:"9"},{default:t(()=>[s(A,{mode:"dialog"}),e[13]||(e[13]=c("br",null,null,-1)),s(V,{class:"mb-4",variant:"flat"},{default:t(()=>[s(_,{class:"d-flex align-center"},{default:t(()=>[s(d,{class:"mr-2",color:"primary",icon:"mdi-timeline-clock"}),e[9]||(e[9]=i(" 时间线 ",-1))]),_:1,__:[9]}),s(h,null,{default:t(()=>[s(z,{"is-loading-more":r.isLoadingMore,timeline:r.timeline,onLoadMore:m.loadMoreEvents},null,8,["is-loading-more","timeline","onLoadMore"])]),_:1})]),_:1}),s(_,{class:"text-subtitle-1 font-weight-bold"},{default:t(()=>[s(d,{start:""},{default:t(()=>e[10]||(e[10]=[i("mdi-compass",-1)])),_:1,__:[10]}),e[11]||(e[11]=i(" 热门项目 ",-1))]),_:1,__:[11]}),s(h,{class:"pa-2"},{default:t(()=>[s(k,null,{default:t(()=>[(l(!0),g(y,null,v(r.exploreProjects,o=>(l(),n(P,{key:o.id,cols:"3",lg:"3",md:"4",sm:"4",xl:"3"},{default:t(()=>[s(F,{author:o.author,project:o,"show-author":!0,to:o.author?`/${o.author.username}/${o.name}`:`/app/link/project?id=${o.id}`},null,8,["author","project","to"])]),_:2},1024))),128))]),_:1}),c("div",ie,[r.isLoadingExplore?(l(),n(Q,{key:0,color:"primary",indeterminate:""})):r.exploreSearch.hasMore?w("",!0):(l(),n(M,{key:1,color:"primary",variant:"flat"},{default:t(()=>e[12]||(e[12]=[i(" 已加载全部项目 ",-1)])),_:1,__:[12]}))]),J(c("div",re,null,512),[[W,{handler:m.onIntersect,options:{threshold:[0,.5,1]}}]])]),_:1})]),_:1,__:[13]}),s(P,{cols:"12",md:"3"},{default:t(()=>[s(V,{variant:"tonal"},{default:t(()=>[s(_,{class:"text-subtitle-1 font-weight-bold"},{default:t(()=>[s(d,{start:""},{default:t(()=>e[14]||(e[14]=[i("mdi-clock-outline",-1)])),_:1,__:[14]}),e[15]||(e[15]=i(" 最近活动 ",-1))]),_:1,__:[15]}),s(L,{density:"compact"},{default:t(()=>[(l(!0),g(y,null,v(r.recentActivities,o=>(l(),n(x,{key:o.id},{prepend:t(()=>[s(d,{color:o.color,size:"small"},{default:t(()=>[i(p(o.icon),1)]),_:2},1032,["color"])]),default:t(()=>[s(j,{class:"text-body-2"},{default:t(()=>[i(p(o.text),1)]),_:2},1024),s(T,null,{default:t(()=>[s(N,{date:o.date},null,8,["date"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(V,{class:"mt-4",variant:"flat"})]),_:1})]),_:1})]),_:1})}const he=B($,[["render",le],["__scopeId","data-v-2b715992"]]);export{he as default};
