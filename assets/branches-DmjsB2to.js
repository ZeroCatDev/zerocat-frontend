import{b as C,a as k}from"./projectService-DDDE0ugX.js";import{_ as x,T as b,o as u,N as n,h as t,j as c,K as s,R as p,as as m,ai as V,a as I,F as K,Q as N,aj as h,ah as S,m as T,S as U,Y as B,av as d,ak as j,an as w,X as g}from"./index-P_rwkuFw.js";import{V as F,a as P}from"./VRow-C_n86HCt.js";import{V as D}from"./VDialog-BltRcpdr.js";import{V as y}from"./VTextField-CUyFiBLI.js";import{V as v}from"./VSpacer-K2XWOVPY.js";import{V as L}from"./VSelect-Bj4tkLdJ.js";import{V as M}from"./VContainer-CFee8l1F.js";/* empty css              *//* empty css                   */import"./VInput-DKMu1vsR.js";import"./VCheckboxBtn-IlUW789W.js";import"./VSelectionControl-IiUb5uUu.js";import"./VChip-DNqBLz8q.js";const R={data(){return{projectbranchs:[],project:{},branchDescription:{branch:"",dialog:!1,description:""},newBranch:{name:"",dialog:!1,base:""}}},async mounted(){await this.fetchProjectInfo(),this.fetchBranches()},methods:{async fetchProjectInfo(){const i=this.$route.params.username,e=this.$route.params.projectname,o=await k(i,e);this.project=o},async fetchBranches(){const i=this.project.id,e=await C(i);this.projectbranchs=e.data},async editBranchDescription(i){this.branchDescription.branch=i,this.branchDescription.description=this.projectbranchs.find(e=>e.name===i).description,this.branchDescription.dialog=!0},async saveBranchDescription(){const i=this.project.id,e=this.branchDescription.branch,o=this.branchDescription.description;await g.post(`/project/branches/description/?branch=${e}&projectid=${i}`,{description:o}),this.branchDescription.dialog=!1,this.fetchBranches()},async createBranch(){const i=this.project.id,e=this.newBranch.name,o=await g({url:`/project/branches?projectid=${i}`,method:"post",data:{name:e,branch:this.newBranch.base,projectid:i}});this.$toast.add({severity:o.data.status,summary:o.data.message,detail:o.data.message,life:3e3}),this.newBranch.dialog=!1,this.fetchBranches()}}};function z(i,e,o,A,a,l){return u(),b(M,null,{default:n(()=>[t(F,null,{default:n(()=>[t(P,{cols:"12"},{default:n(()=>[t(c,{onClick:e[0]||(e[0]=r=>a.newBranch.dialog=!0)},{default:n(()=>e[10]||(e[10]=[s("新建分支")])),_:1}),t(p,{hover:"",border:""},{default:n(()=>[t(m,null,{default:n(()=>e[11]||(e[11]=[s("分支列表")])),_:1}),t(V,{dense:""},{default:n(()=>[(u(!0),I(K,null,N(a.projectbranchs,r=>(u(),b(h,{key:r.name,title:r.name,subtitle:JSON.stringify(r)},{append:n(()=>[t(S,null,{activator:n(({props:f})=>[t(c,T({variant:"text",icon:"mdi-dots-horizontal",ref_for:!0},f),null,16)]),default:n(()=>[t(V,null,{default:n(()=>[t(h,{"prepend-icon":"mdi-pencil",title:"设置分支简介",subtitle:"设置此分支的简介",onClick:f=>l.editBranchDescription(r.name)},null,8,["onClick"]),t(h,{"prepend-icon":"mdi-delete",title:"删除此分支",subtitle:"将永久删除掉此分支所有数据，难以恢复",disabled:""})]),_:2},1024)]),_:2},1024)]),_:2},1032,["title","subtitle"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(D,{modelValue:a.branchDescription.dialog,"onUpdate:modelValue":e[4]||(e[4]=r=>a.branchDescription.dialog=r),"max-width":"500"},{default:n(()=>[t(p,null,{default:n(()=>[t(m,null,{default:n(()=>[s("设置分支 "+U(a.branchDescription.branch)+" 的简介",1)]),_:1}),t(B,null,{default:n(()=>[t(y,{modelValue:a.branchDescription.description,"onUpdate:modelValue":e[1]||(e[1]=r=>a.branchDescription.description=r),label:"分支简介",variant:"outlined",hint:"设置此分支的简介",onKeyup:[d(l.saveBranchDescription,["enter"]),e[2]||(e[2]=d(r=>a.branchDescription.dialog=!1,["esc"])),d(j(l.saveBranchDescription,["ctrl"]),["s"])],counter:"100"},null,8,["modelValue","onKeyup"])]),_:1}),t(w,null,{default:n(()=>[t(v),t(c,{onClick:e[3]||(e[3]=r=>a.branchDescription.dialog=!1)},{default:n(()=>e[12]||(e[12]=[s("取消")])),_:1}),t(c,{color:"primary",onClick:l.saveBranchDescription},{default:n(()=>e[13]||(e[13]=[s("保存")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:a.newBranch.dialog,"onUpdate:modelValue":e[9]||(e[9]=r=>a.newBranch.dialog=r),"max-width":"500"},{default:n(()=>[t(p,null,{default:n(()=>[t(m,null,{default:n(()=>e[14]||(e[14]=[s("创建分支")])),_:1}),t(B,null,{default:n(()=>[t(y,{modelValue:a.newBranch.name,"onUpdate:modelValue":e[5]||(e[5]=r=>a.newBranch.name=r),label:"分支名称",variant:"outlined",hint:"设置此分支的名称",onKeyup:[d(l.createBranch,["enter"]),e[6]||(e[6]=d(r=>a.newBranch.dialog=!1,["esc"])),d(j(l.createBranch,["ctrl"]),["s"])],counter:"100"},null,8,["modelValue","onKeyup"]),t(L,{modelValue:a.newBranch.base,"onUpdate:modelValue":e[7]||(e[7]=r=>a.newBranch.base=r),items:a.projectbranchs,"item-title":"name","item-value":"name",label:"选择基于某个分支"},null,8,["modelValue","items"])]),_:1}),t(w,null,{default:n(()=>[t(v),t(c,{onClick:e[8]||(e[8]=r=>a.newBranch.dialog=!1)},{default:n(()=>e[15]||(e[15]=[s("取消")])),_:1}),t(c,{color:"primary",onClick:l.createBranch},{default:n(()=>e[16]||(e[16]=[s("创建")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const te=x(R,[["render",z]]);export{te as default};
