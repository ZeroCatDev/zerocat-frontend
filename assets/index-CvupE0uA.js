import{_ as te}from"./Comment-Dc3ptLfg.js";import{_ as ie}from"./Projects-C8EfEV2C.js";import{f as I,p as B,U as de,n as J,t as g,y as ce,s as me,i as N,a as i,W as C,X as ue,E as se,Y as le,B as ae,k as L,Z as oe,u as _e,$ as pe,R as fe,a0 as he,a1 as D,A as ne,j as ye,l as ve,a2 as ge,a3 as xe,a4 as be,a5 as K,z as Ce,a6 as je,a7 as ke,_ as Te,r as Ve,c as b,o as c,w as a,a8 as we,a9 as z,G as l,J as De,H as m,O as o,P as Q,aa as ze,e as x,M as V,N as P,K as k,ab as S,ac as w,I as Pe,Q as X,T as Se}from"./index-BMBKnoIw.js";import{g as Ie}from"./user-7eLoVmDZ.js";import{V as Y,a as ee}from"./VRow-OUGpbdLK.js";import{V as v}from"./VChip-KrR_6Wjc.js";import{V as Be}from"./VContainer-CLeoOx_V.js";import"./VForm-CXmJkE6Z.js";import"./VTextarea-CyrX8PdY.js";import"./VDialog-BbGIAsiw.js";import"./showProjects-D4mo8pmf.js";import"./projectService-BDJSQ7vV.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-CuqyfS9l.js";/* empty css              */const Ne=B({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:oe,iconColor:String,lineColor:String,...L(),...ae(),...le(),...se()},"VTimelineDivider"),Le=I()({name:"VTimelineDivider",props:Ne(),setup(e,s){let{slots:u}=s;const{sizeClasses:j,sizeStyles:n}=de(e,"v-timeline-divider__dot"),{backgroundColorStyles:f,backgroundColorClasses:h}=J(g(e,"dotColor")),{roundedClasses:_}=ce(e,"v-timeline-divider__dot"),{elevationClasses:y}=me(e),{backgroundColorClasses:t,backgroundColorStyles:T}=J(g(e,"lineColor"));return N(()=>i("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[i("div",{class:["v-timeline-divider__before",t.value],style:T.value},null),!e.hideDot&&i("div",{key:"dot",class:["v-timeline-divider__dot",y.value,_.value,j.value],style:n.value},[i("div",{class:["v-timeline-divider__inner-dot",h.value,_.value],style:f.value},[u.default?i(ue,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},u.default):i(C,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),i("div",{class:["v-timeline-divider__after",t.value],style:T.value},null)])),{}}}),re=B({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:oe,iconColor:String,lineInset:[Number,String],...L(),...ye(),...se(),...ae(),...le(),...ne()},"VTimelineItem"),Me=I()({name:"VTimelineItem",props:re(),setup(e,s){let{slots:u}=s;const{dimensionStyles:j}=_e(e),n=pe(0),f=fe();return he(f,h=>{var _;h&&(n.value=((_=h.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:_.getBoundingClientRect().width)??0)},{flush:"post"}),N(()=>{var h,_;return i("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":D(n.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${D(e.lineInset)})`:D(0)},e.style]},[i("div",{class:"v-timeline-item__body",style:j.value},[(h=u.default)==null?void 0:h.call(u)]),i(Le,{ref:f,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:u.icon}),e.density!=="compact"&&i("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((_=u.opposite)==null?void 0:_.call(u))])])}),{}}}),Re=B({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...ke(re({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...L(),...je(),...ne(),...Ce()},"VTimeline"),Ee=I()({name:"VTimeline",props:Re(),setup(e,s){let{slots:u}=s;const{themeClasses:j}=ve(e),{densityClasses:n}=ge(e),{rtlClasses:f}=xe();be({VTimelineDivider:{lineColor:g(e,"lineColor")},VTimelineItem:{density:g(e,"density"),dotColor:g(e,"dotColor"),fillDot:g(e,"fillDot"),hideOpposite:g(e,"hideOpposite"),iconColor:g(e,"iconColor"),lineColor:g(e,"lineColor"),lineInset:g(e,"lineInset"),size:g(e,"size")}});const h=K(()=>{const y=e.side?e.side:e.density!=="default"?"end":null;return y&&`v-timeline--side-${y}`}),_=K(()=>{const y=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return y;case"start":return y[0];case"end":return y[1];default:return null}});return N(()=>i(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,_.value,{"v-timeline--inset-line":!!e.lineInset},j.value,n.value,h.value,f.value,e.class],style:[{"--v-timeline-line-thickness":D(e.lineThickness)},e.style]},u)),{}}}),Ue={components:{Projects:ie,Comment:te},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},currentPage:1,isLoadingMore:!1,pageSize:20,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await Ie(this.username),Se({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await X({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(e=1){try{const s=await X.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});s.data.status==="success"&&(e===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(e){return e!=null&&e.length?e.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}},getTargetContent(e,s){if(!e)return"";switch(e.type){case"project":return e.title||`项目 #${e.id}`;case"user":return e.display_name||`用户 #${e.id}`;case"projectlist":return`项目列表 #${e.id}`;default:return`${e.type} #${e.id}`}},getFieldDisplayName(e){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[e]||e}}},Fe={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},Oe={class:"mt-2 text-body-1 text-medium-emphasis"},qe={class:"mt-2 text-medium-emphasis"},$e={class:"timeline-item-content"},We={class:"event-header"},Ze={class:"text-h6"},Ae={class:"project-info"},He={class:"font-weight-medium"},Ge={class:"mt-2 text-caption text-medium-emphasis"},Je={class:"d-flex align-center mb-2"},Ke={class:"font-weight-medium"},Qe={class:"rename-details text-body-2"},Xe={class:"d-flex align-center"},Ye={class:"d-flex align-center mt-1"},et={class:"project-meta text-caption text-medium-emphasis mt-2"},tt={class:"d-flex align-center mb-2"},it={class:"font-weight-medium"},st={class:"commit-message text-body-2"},lt={class:"commit-hash text-caption text-medium-emphasis mt-1"},at={class:"d-flex align-center mb-2"},ot={class:"font-weight-medium"},nt={class:"info-updates text-body-2"},rt={class:"d-flex align-center"},dt={class:"d-flex flex-column mt-1 field-changes"},ct={class:"old-value"},mt={class:"ml-2"},ut={class:"new-value"},_t={class:"ml-2 text-info"},pt={class:"project-meta text-caption text-medium-emphasis mt-2"},ft={key:3,class:"event-content pa-2"},ht={key:0,class:"text-body-2"},yt={key:1,class:"text-body-2"},vt={key:2,class:"text-body-2 text-medium-emphasis"},gt={class:"d-flex justify-center mt-4 mb-4"},xt={key:1,class:"text-medium-emphasis"};function bt(e,s,u,j,n,f){const h=ie,_=te,y=Ve("router-link");return c(),b(Be,null,{default:a(()=>[i(we,{modelValue:n.tab,"onUpdate:modelValue":s[0]||(s[0]=t=>n.tab=t)},{default:a(()=>[i(z,{value:"home"},{default:a(()=>[i(De,{class:"mt-8"},{default:a(()=>[i(Y,{class:"d-flex align-center"},{default:a(()=>[i(ee,null,{default:a(()=>[s[2]||(s[2]=l("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),l("p",Fe,[m(o(n.user.display_name)+" ",1),i(Q,{size:"52",class:"ma-2"},{default:a(()=>[i(ze,{src:"https://s4-1.wuyuan.1r.ink/user/"+n.user.images},null,8,["src"])]),_:1})]),l("p",Oe,o(n.user.motto),1),l("p",qe,[i(v,null,{default:a(()=>[i(C,{icon:"mdi-account-circle",start:""}),m(" ID:"+o(n.user.id),1)]),_:1}),i(v,null,{default:a(()=>[i(C,{icon:"mdi-clock",start:""}),m(" "+o(n.user.regTime)+"注册 ",1)]),_:1}),i(v,null,{default:a(()=>[i(C,{icon:"mdi-tag",start:""}),s[1]||(s[1]=m(" 创作者 "))]),_:1})])]),_:1})]),_:1})]),_:1}),s[3]||(s[3]=l("br",null,null,-1)),i(h,{url:n.url},null,8,["url"]),i(Y,null,{default:a(()=>[(c(!0),x(V,null,P(n.lists,t=>(c(),b(ee,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:t.id},{default:a(()=>[i(k,{rounded:"lg"},{default:a(()=>[i(k,{to:"/app/projectlist/"+t.id,rounded:"lg",title:t.title,subtitle:t.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[4]||(s[4]=l("br",null,null,-1)),i(_,{url:"user-"+n.user.id,name:"用户"},null,8,["url"])]),_:1}),i(z,{value:"comment"},{default:a(()=>[i(_,{url:"user-"+n.user.id,name:"用户"},null,8,["url"])]),_:1}),i(z,{value:"timeline"},{default:a(()=>[i(Ee,{side:"end",align:"start",class:"mt-4"},{default:a(()=>[(c(!0),x(V,null,P(n.timeline.events,t=>(c(),b(Me,{key:t.id,size:"small","dot-color":"primary"},{opposite:a(()=>[m(o(new Date(t.created_at).toLocaleString()),1)]),icon:a(()=>[i(Q,{image:"https://s4-1.wuyuan.1r.ink/user/"+n.user.images},null,8,["image"])]),default:a(()=>{var T,M,R,E,U,F,O,q,$,W,Z,A;return[l("div",$e,[l("div",We,[l("h3",Ze,o(t.actor.display_name)+" "+o(((T=n.eventTypes[t.type])==null?void 0:T.text)||"进行了操作"),1),i(v,{size:"x-small",color:((M=n.eventTypes[t.type])==null?void 0:M.color)||"primary",class:"ml-2"},{default:a(()=>{var r;return[m(o(((r=n.eventTypes[t.type])==null?void 0:r.label)||t.type),1)]}),_:2},1032,["color"])]),s[9]||(s[9]=m()),(R=n.eventTypes[t.type])!=null&&R.isProject?(c(),b(y,{key:0,to:`/app/link/project?id=${(E=t.target)==null?void 0:E.id}`,class:"text-decoration-none"},{default:a(()=>{var r;return[m(o((r=t.event_data)==null?void 0:r.project_title),1)]}),_:2},1032,["to"])):S("",!0),s[10]||(s[10]=l("div",{class:"mb-2"},null,-1)),(U=n.eventTypes[t.type])!=null&&U.isProject&&!["project_rename","project_commit"].includes(t.type)?(c(),b(k,{key:1,class:"mb-3 project-event",to:`/app/link/project?id=${(F=t.target)==null?void 0:F.id}`},{default:a(()=>[i(w,null,{default:a(()=>{var r,d;return[l("div",Ae,[i(C,{icon:"mdi-source-repository",color:"primary",class:"mr-2"}),l("span",He,o(((r=t.event_data)==null?void 0:r.project_name)||"未命名项目"),1),l("div",Ge,o((d=t.event_data)==null?void 0:d.project_description),1)])]}),_:2},1024)]),_:2},1032,["to"])):["project_rename","project_commit","project_info_update"].includes(t.type)?(c(),x(V,{key:2},[t.type==="project_rename"?(c(),b(k,{key:0,class:"rename-card mb-3",to:`/app/link/project?id=${(O=t.target)==null?void 0:O.id}`},{default:a(()=>[i(w,null,{default:a(()=>{var r;return[l("div",Je,[i(C,{icon:"mdi-rename-box",color:"warning",class:"mr-2"}),l("span",Ke,o((r=t.event_data)==null?void 0:r.project_title),1)]),l("div",Qe,[l("div",Xe,[s[5]||(s[5]=l("span",{class:"text-medium-emphasis"},"从",-1)),i(v,{size:"small",class:"mx-2",color:"surface-variant"},{default:a(()=>{var d;return[m(o((d=t.event_data)==null?void 0:d.old_name),1)]}),_:2},1024)]),l("div",Ye,[s[6]||(s[6]=l("span",{class:"text-medium-emphasis"},"到",-1)),i(v,{size:"small",class:"mx-2",color:"warning"},{default:a(()=>{var d;return[m(o((d=t.event_data)==null?void 0:d.new_name),1)]}),_:2},1024)])]),l("div",et,[i(v,{size:"x-small",class:"mr-1"},{default:a(()=>{var d;return[m(o((d=t.event_data)==null?void 0:d.project_type),1)]}),_:2},1024),i(v,{size:"x-small"},{default:a(()=>{var d;return[m(o((d=t.event_data)==null?void 0:d.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_commit"?(c(),b(k,{key:1,class:"commit-card mb-3",to:`/app/link/project?id=${(q=t.target)==null?void 0:q.id}`},{default:a(()=>[i(w,null,{default:a(()=>{var r,d,p;return[l("div",tt,[i(C,{icon:"mdi-source-commit",color:"info",class:"mr-2"}),l("span",it,"分支: "+o((r=t.event_data)==null?void 0:r.branch),1)]),l("div",st,o((d=t.event_data)==null?void 0:d.commit_message),1),l("div",lt," 提交ID: "+o((p=t.event_data)==null?void 0:p.commit_id.substring(0,7)),1)]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_info_update"?(c(),b(k,{key:2,class:"info-update-card mb-3",to:`/app/link/project?id=${($=t.target)==null?void 0:$.id}`},{default:a(()=>[i(w,null,{default:a(()=>{var r,d;return[l("div",at,[i(C,{icon:"mdi-file-document-edit",color:"info",class:"mr-2"}),l("span",ot,o((r=t.event_data)==null?void 0:r.project_title),1)]),l("div",nt,[(c(!0),x(V,null,P((d=t.event_data)==null?void 0:d.updated_fields,p=>{var H,G;return c(),x("div",{key:p,class:"update-item mb-2"},[l("div",rt,[i(v,{size:"x-small",color:"info",class:"mr-2"},{default:a(()=>[m(o(f.getFieldDisplayName(p)),1)]),_:2},1024)]),l("div",dt,[l("div",ct,[s[7]||(s[7]=l("span",{class:"text-medium-emphasis"},"从：",-1)),l("span",mt,o((H=t.event_data)==null?void 0:H.old_values[p]),1)]),l("div",ut,[s[8]||(s[8]=l("span",{class:"text-medium-emphasis"},"到：",-1)),l("span",_t,o((G=t.event_data)==null?void 0:G.new_values[p]),1)])])])}),128))]),l("div",pt,[i(v,{size:"x-small",class:"mr-1"},{default:a(()=>{var p;return[m(o((p=t.event_data)==null?void 0:p.project_type),1)]}),_:2},1024),i(v,{size:"x-small"},{default:a(()=>{var p;return[m(o((p=t.event_data)==null?void 0:p.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):S("",!0)],64)):(c(),x("div",ft,[t.type==="user_profile_update"?(c(),x("div",ht," 更新了："+o(f.getUpdatedFields((W=t.event_data)==null?void 0:W.updated_fields)),1)):((Z=t.target)==null?void 0:Z.type)==="project"?(c(),x("div",yt,[l("span",null,o(((A=n.eventTypes[t.type])==null?void 0:A.text)||"操作了"),1),i(y,{to:`/app/link/project?id=${t.target.id}`,class:"text-decoration-none ml-1"},{default:a(()=>{var r;return[m(o(((r=t.event_data)==null?void 0:r.project_name)||t.target.title||`项目 #${t.target.id}`),1)]}),_:2},1032,["to"])])):(c(),x("div",vt,o(f.getTargetContent(t.target,t.type)),1))]))])]}),_:2},1024))),128))]),_:1}),l("div",gt,[f.hasMoreEvents?(c(),b(Pe,{key:0,loading:n.isLoadingMore,variant:"tonal",onClick:f.loadMoreEvents},{default:a(()=>s[11]||(s[11]=[m(" 加载更多 ")])),_:1},8,["loading","onClick"])):n.timeline.events.length>0?(c(),x("div",xt," 没有更多内容了 ")):S("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Rt=Te(Ue,[["render",bt],["__scopeId","data-v-e146540b"]]);export{Rt as default};
