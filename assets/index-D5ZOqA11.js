import{f as X,p as Y,l as Z,a2 as ee,i as ae,a as t,a1 as le,z as te,A as oe,a6 as re,k as se,R as s,av as ne,Q as h,c as k,o as c,w as o,K as N,ap as A,G as n,I as V,H as u,ac as P,e as H,M as ue,N as ie,ab as x,O as C,as as de,ai as I,aj as L}from"./index-BMBKnoIw.js";import{_ as ve}from"./verifyEmail-CHB96sAa.js";import{V as fe,a as me}from"./VRow-OUGpbdLK.js";import{V as R}from"./VChip-KrR_6Wjc.js";import{V as j}from"./VDialog-BbGIAsiw.js";import{V as ce}from"./VForm-CXmJkE6Z.js";import{V as pe}from"./VAlert-DTCoGHxe.js";import{V as G}from"./VSpacer-BfdcsZqy.js";import{V as ye}from"./VContainer-CLeoOx_V.js";/* empty css              */const Ve=Y({fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...se(),...re(),...oe(),...te()},"VTable"),ge=X()({name:"VTable",props:Ve(),setup(i,p){let{slots:r,emit:b}=p;const{themeClasses:g}=Z(i),{densityClasses:d}=ee(i);return ae(()=>t(i.tag,{class:["v-table",{"v-table--fixed-height":!!i.height,"v-table--fixed-header":i.fixedHeader,"v-table--fixed-footer":i.fixedFooter,"v-table--has-top":!!r.top,"v-table--has-bottom":!!r.bottom,"v-table--hover":i.hover},g.value,d.value,i.class],style:i.style},{default:()=>{var v,f,m;return[(v=r.top)==null?void 0:v.call(r),r.default?t("div",{class:"v-table__wrapper",style:{height:le(i.height)}},[t("table",null,[r.default()])]):(f=r.wrapper)==null?void 0:f.call(r),(m=r.bottom)==null?void 0:m.call(r)]}})),{}}}),Ee={__name:"index",setup(i){const p=s([]),r=s(!1),b=s(!1),g=s(!1),d=s(!1),v=s(""),f=s("");s("");const m=s(null),y=s(""),w=s("info");s(""),s("info");const B=s(null),E=s(!1),U=s(""),$=s(""),_=s(null),D={required:l=>!!l||"此字段为必填项",email:l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)||"请输入有效的邮箱地址",length:l=>(l==null?void 0:l.length)===6||"验证码必须是6位数字"};ne(async()=>{await T()});const T=async()=>{try{const l=await h.get("/account/emails");l.data.status==="success"&&(p.value=l.data.data)}catch(l){console.error("获取邮箱列表失败:",l)}},F=(l,e,a)=>{U.value=l,$.value=e,_.value=a,E.value=!0},K=l=>{_.value&&(_.value(l),_.value=null)},z=async()=>{if(!v.value){y.value="请输入新邮箱地址",w.value="error";return}const l=p.value.find(e=>e.is_primary);if(!l){y.value="未找到主邮箱",w.value="error";return}F(l.contact_value,"验证主邮箱",e=>{f.value=e,M()})},M=async()=>{if(!(!v.value||!f.value)){d.value=!0;try{const l=await h.post("/account/add-email",{email:v.value,verificationCode:f.value});l.data.status==="success"?(await T(),S()):(y.value=l.data.message,w.value="error")}catch{y.value="添加邮箱失败",w.value="error"}finally{d.value=!1}}},O=l=>{m.value=l,b.value=!0},Q=()=>{const l=p.value.find(e=>e.is_primary);l&&m.value&&F(l.contact_value,"验证主邮箱",async e=>{d.value=!0;try{(await h.post("/account/remove-email",{email:m.value.contact_value,verificationCode:e})).data.status==="success"&&(await T(),q())}catch(a){console.error("删除失败:",a)}finally{d.value=!1}})},S=()=>{r.value=!1,g.value=!1,v.value="",f.value="",y.value="",B.value&&B.value.reset()},q=()=>{b.value=!1,m.value=null},J=l=>{F(l,"验证邮箱",async e=>{d.value=!0;try{(await h.post("/account/verify-email",{email:l,token:e})).data.status==="success"&&await T()}catch(a){console.error("验证失败:",a)}finally{d.value=!1}})};return(l,e)=>(c(),k(ye,null,{default:o(()=>[t(fe,null,{default:o(()=>[t(me,{cols:"12"},{default:o(()=>[t(N,{class:"mb-4"},{default:o(()=>[t(A,{class:"d-flex align-center justify-space-between"},{default:o(()=>[e[8]||(e[8]=n("span",null,"邮箱管理",-1)),t(V,{color:"primary",onClick:e[0]||(e[0]=a=>r.value=!0),disabled:p.value.length>=5},{default:o(()=>e[7]||(e[7]=[u(" 添加邮箱 ")])),_:1},8,["disabled"])]),_:1}),t(P,null,{default:o(()=>[t(ge,null,{default:o(()=>[e[12]||(e[12]=n("thead",null,[n("tr",null,[n("th",null,"邮箱地址"),n("th",null,"状态"),n("th",null,"添加时间"),n("th",null,"操作")])],-1)),n("tbody",null,[(c(!0),H(ue,null,ie(p.value,a=>(c(),H("tr",{key:a.contact_id},[n("td",null,[u(C(a.contact_value)+" ",1),a.is_primary?(c(),k(R,{key:0,color:"primary",size:"small",class:"ml-2"},{default:o(()=>e[9]||(e[9]=[u("主邮箱")])),_:1})):x("",!0)]),n("td",null,[t(R,{color:a.verified?"success":"warning",size:"small"},{default:o(()=>[u(C(a.verified?"已验证":"未验证"),1)]),_:2},1032,["color"])]),n("td",null,C(new Date(a.created_at).toLocaleString()),1),n("td",null,[a.verified?x("",!0):(c(),k(V,{key:0,variant:"text",color:"primary",size:"small",onClick:W=>J(a.contact_value)},{default:o(()=>e[10]||(e[10]=[u(" 验证 ")])),_:2},1032,["onClick"])),a.is_primary?x("",!0):(c(),k(V,{key:1,variant:"text",color:"error",size:"small",onClick:W=>O(a)},{default:o(()=>e[11]||(e[11]=[u(" 删除 ")])),_:2},1032,["onClick"]))])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(j,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value=a),"max-width":"500px"},{default:o(()=>[t(N,null,{default:o(()=>[t(A,null,{default:o(()=>e[13]||(e[13]=[u("添加新邮箱")])),_:1}),t(P,null,{default:o(()=>[t(ce,{onSubmit:de(z,["prevent"]),ref_key:"addForm",ref:B},{default:o(()=>[t(I,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),label:"新邮箱地址",rules:[D.required,D.email],variant:"outlined"},null,8,["modelValue","rules"]),g.value?(c(),k(I,{key:0,modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),label:"主邮箱验证码",rules:[D.required,D.length],maxlength:"6",variant:"outlined"},null,8,["modelValue","rules"])):x("",!0),y.value?(c(),k(pe,{key:1,type:w.value,variant:"tonal",class:"mt-3"},{default:o(()=>[u(C(y.value),1)]),_:1},8,["type"])):x("",!0)]),_:1},512)]),_:1}),t(L,null,{default:o(()=>[t(G),t(V,{color:"grey",variant:"text",onClick:S},{default:o(()=>e[14]||(e[14]=[u("取消")])),_:1}),t(V,{color:"primary",loading:d.value,onClick:e[3]||(e[3]=a=>g.value?M():z())},{default:o(()=>[u(C(g.value?"添加":"发送验证码"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(j,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a),"max-width":"500px"},{default:o(()=>[t(N,null,{default:o(()=>[t(A,null,{default:o(()=>e[15]||(e[15]=[u("删除邮箱")])),_:1}),t(P,null,{default:o(()=>{var a;return[n("p",null,"确认要删除邮箱 "+C((a=m.value)==null?void 0:a.contact_value)+" 吗？",1)]}),_:1}),t(L,null,{default:o(()=>[t(G),t(V,{color:"grey",variant:"text",onClick:q},{default:o(()=>e[16]||(e[16]=[u("取消")])),_:1}),t(V,{color:"error",loading:d.value,onClick:Q},{default:o(()=>e[17]||(e[17]=[u(" 删除 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ve,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=a=>E.value=a),email:U.value,title:$.value,onVerified:K},null,8,["modelValue","email","title"])]),_:1}))}};export{Ee as default};
