import{_ as N}from"./LoadingDialog-BQSXedWM.js";import{_ as L}from"./AuthCard-BFFyANer.js";import{_ as q,a as k,o as d,h as i,N as l,Z as C,M as m,X as T,U as V,O as w,T as D,j as p,K as E,S as z,am as F,ap as U,aX as X,aZ as Z,r as s,e as j}from"./index-CArOYGig.js";import{A as I}from"./authService-SiuKWy6z.js";import{V as K}from"./VForm-kWZNP_1X.js";import{V as O}from"./VTextField-2xHPA_NG.js";import{V as W}from"./VSpacer-DfnemHCW.js";import{V as G}from"./VDialog-DlHJ_BKh.js";import"./VRow-BPr-bugJ.js";/* empty css              */import"./VInput-B9tqVN4t.js";/* empty css                   */const H={components:{AuthCard:L,LoadingDialog:N},setup(){const y=X();Z();const a=s(null),_=s("WuyuanDev"),e=s(""),t=s(""),h=s(!1),u=s(!1),f=s(!1),c=s(!1),x=s(""),S=s("waiting"),A=[o=>!!o||"请输入电子邮件地址",o=>/.+@.+\..+/.test(o)||"请输入有效的电子邮件地址"];j(()=>{t.value=y.query.token||localStorage.getItem("verificationToken"),e.value=y.query.email||localStorage.getItem("verificationEmail"),t.value&&localStorage.setItem("verificationToken",t.value),e.value&&localStorage.setItem("verificationEmail",e.value),y.query.verified==="true"&&(S.value="success")});const B=async()=>{var o,g;if(!t.value){v("无法重新发送验证邮件：缺少验证令牌");return}u.value=!0;try{const n=await I.resendVerificationEmail(t.value);n.status==="success"?(t.value=n.temporaryToken,localStorage.setItem("verificationToken",t.value),b("验证邮件已重新发送，请查收")):v(n.message||"发送验证邮件失败")}catch(n){console.error("Error resending verification email:",n);const r=((g=(o=n.response)==null?void 0:o.data)==null?void 0:g.message)||"发送验证邮件时出错，请稍后再试";v(r)}finally{u.value=!1}},M=async()=>{var g,n;if(!a.value)return;const{valid:o}=await a.value.validate();if(o){f.value=!0;try{const r=await I.changeRegisterEmail(t.value,x.value);r.status==="success"?(e.value=r.email,t.value=r.temporaryToken,localStorage.setItem("verificationEmail",e.value),localStorage.setItem("verificationToken",t.value),c.value=!1,b("邮箱已更改，请查收验证邮件")):v(r.message||"更改邮箱失败")}catch(r){console.error("Error changing email:",r);const R=((n=(g=r.response)==null?void 0:g.data)==null?void 0:n.message)||"更改邮箱时出错，请稍后再试";v(R)}finally{f.value=!1}}},b=o=>{window.$toast?window.$toast.add({severity:"success",summary:"成功",detail:o,life:3e3}):window.$notify?window.$notify({title:"成功",message:o,type:"success"}):(console.log("Success:",o),alert(o))},v=o=>{window.$toast?window.$toast.add({severity:"error",summary:"错误",detail:o,life:3e3}):window.$notify?window.$notify({title:"错误",message:o,type:"error"}):(console.error("Error:",o),alert(o))};return{appName:_,email:e,token:t,loading:h,resendLoading:u,changeEmailLoading:f,showChangeEmailDialog:c,newEmail:x,verificationStep:S,emailRules:A,emailForm:a,resendVerificationEmail:B,changeEmail:M}}},J={class:"d-flex align-center mb-6"},P={class:"me-3"},Q={class:"text-h5 mb-1"},Y={class:"text-body-1"},$={key:0,class:"mb-4"},ee={key:1,class:"text-center my-4"};function ae(y,a,_,e,t,h){const u=L,f=N;return d(),k("div",null,[i(u,{subtitle:"邮箱验证"},{default:l(()=>[i(C,null,{default:l(()=>[m("div",J,[m("div",P,[e.verificationStep==="success"?(d(),V(w,{key:0,color:"success",icon:"mdi-check-circle",size:"large"})):e.verificationStep==="completed"?(d(),V(w,{key:1,color:"success",icon:"mdi-check-circle",size:"large"})):(d(),V(w,{key:2,icon:"mdi-circle-outline",size:"large"}))]),m("div",null,[m("div",Q,"欢迎来到 "+D(e.appName)+"!",1),m("div",Y,"快完成了！我们向 "+D(e.email)+" 发送了一封激活邮件。请按照邮件中的说明操作来激活您的账户。",1)])]),e.verificationStep==="waiting"?(d(),k("div",$,[a[6]||(a[6]=m("div",{class:"text-body-1 mb-2"},"如果您没有收到邮件，请检查您的垃圾邮件文件夹。",-1)),i(p,{color:"primary",variant:"flat",block:"",class:"mb-3",loading:e.resendLoading,onClick:e.resendVerificationEmail,"prepend-icon":"mdi-email-outline"},{default:l(()=>a[4]||(a[4]=[E(" 重新发送激活电子邮件 ")])),_:1},8,["loading","onClick"]),i(p,{color:"secondary",variant:"flat",block:"",onClick:a[0]||(a[0]=c=>e.showChangeEmailDialog=!0),"prepend-icon":"mdi-pencil"},{default:l(()=>a[5]||(a[5]=[E(" 更改电子邮件地址 ")])),_:1})])):T("",!0),e.verificationStep==="success"?(d(),k("div",ee,[i(w,{color:"success",icon:"mdi-check-circle-outline",size:"x-large",class:"mb-2"}),a[8]||(a[8]=m("div",{class:"text-h6 mb-1"},"邮箱验证成功！",-1)),a[9]||(a[9]=m("div",{class:"text-body-1 mb-4"},"您的账户已激活，现在可以使用所有功能。",-1)),i(p,{color:"primary",variant:"flat",to:"/app/dashboard"},{default:l(()=>a[7]||(a[7]=[E(" 开始使用 ")])),_:1})])):T("",!0)]),_:1})]),_:1}),i(G,{modelValue:e.showChangeEmailDialog,"onUpdate:modelValue":a[3]||(a[3]=c=>e.showChangeEmailDialog=c),"max-width":"500px"},{default:l(()=>[i(z,{title:"更改电子邮件地址"},{default:l(()=>[i(C,null,{default:l(()=>[i(K,{ref:"emailForm",onSubmit:F(e.changeEmail,["prevent"])},{default:l(()=>[i(O,{modelValue:e.newEmail,"onUpdate:modelValue":a[1]||(a[1]=c=>e.newEmail=c),label:"新的电子邮件地址",type:"email",rules:e.emailRules,variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1},8,["onSubmit"])]),_:1}),i(U,null,{default:l(()=>[i(W),i(p,{text:"取消",onClick:a[2]||(a[2]=c=>e.showChangeEmailDialog=!1)}),i(p,{color:"primary",text:"确认",loading:e.changeEmailLoading,onClick:e.changeEmail},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(f,{show:e.loading,text:"请稍候"},null,8,["show"])])}const ve=q(H,[["render",ae]]);export{ve as default};
