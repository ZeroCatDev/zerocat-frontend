import{_ as se,r as g,x as J,w as fe,b as _e,aa as pe,c as v,o,e as l,N as e,a3 as Q,f as i,$ as z,X as n,Z as K,Y as y,F as P,U as D,S as V,L as s,O as p,W as k,a9 as S,i as $,T as ie,Q as M,R as w,aB as ye,j as ge,a4 as be,D as j,n as X,bR as ee,aU as B,aW as R,bC as Ve,aD as he,aA as xe,a1 as le}from"./index-DmjUHmS9.js";import{V as te}from"./VSelect-DdPFEjFf.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-K6yCIr98.js";import"./VSelectionControl-BKa5lNqo.js";const ke={class:"flex-grow-1"},we={key:0,class:"text-grey-600"},Ce={key:1,class:"d-flex align-center"},ze=["src","alt"],Se={class:"text-subtitle-2"},$e={class:"text-caption text-grey-600"},Ie={key:2,class:"flex-grow-1"},Pe={class:"text-subtitle-2 mb-1"},De={class:"d-flex flex-wrap gap-1"},Ne={class:"text-h6"},Ue={class:"pa-4"},Ae={key:1,class:"text-center py-8"},Be={key:2,class:"text-center py-8 text-grey-600"},Me={class:"d-flex align-center gap-2"},Oe={class:"d-flex align-center justify-space-between text-caption text-grey-600"},Te={class:"d-flex align-center gap-3"},Fe={class:"d-flex align-center"},Le={class:"d-flex align-center"},Ee={key:0,class:"mt-2"},Re={key:4,class:"d-flex justify-center mt-6"},Je={key:0,class:"pa-4"},Qe={class:"d-flex align-center justify-space-between mb-3"},We={class:"d-flex flex-wrap gap-2 mb-4"},Xe={key:1,class:"pa-4"},Ye={class:"d-flex align-center justify-space-between mb-3"},Ze={class:"position-absolute",style:{top:"8px",right:"8px"}},qe={class:"d-flex align-center gap-2"},Ge={class:"d-flex align-center justify-space-between text-caption text-grey-600"},He={class:"d-flex align-center gap-3"},Ke={class:"d-flex align-center"},je={class:"d-flex align-center"},el={key:0,class:"mt-2"},ll={__name:"ProjectSelector",props:{modelValue:{type:[Number,Array],default:()=>null},multiple:{type:Boolean,default:!1},limit:{type:Number,default:20}},emits:["update:modelValue"],setup(h,{emit:x}){const r=h,E=x,C=g(!1),N=g(!1),I=g([]),c=g(new Map),O=g(""),d=g("time_down"),b=g(""),T=g(1),W=g(0),U=g(""),ue=[{title:"最新发布",value:"time_down"},{title:"最早发布",value:"time_up"},{title:"最多观看",value:"view_down"},{title:"最少观看",value:"view_up"},{title:"最多点赞",value:"star_down"},{title:"最少点赞",value:"star_up"},{title:"ID降序",value:"id_down"},{title:"ID升序",value:"id_up"}],ne=[{title:"所有",value:""},{title:"公开",value:"public"},{title:"私有",value:"private"}],_=J(()=>Array.from(c.value.values())),A=J(()=>r.multiple||!r.modelValue?null:c.value.get(r.modelValue)||null),oe=J(()=>r.multiple?_.value.length>0:!!r.modelValue&&!!A.value),Y=u=>c.value.has(u),F=async(u=!0)=>{u&&(T.value=1),N.value=!0;try{const t={curr:T.value,limit:r.limit,search_order:d.value,search_state:b.value};O.value&&(t.search_title=O.value);const f=(await le.get("/searchapi",{params:t})).data;I.value=f.projects,W.value=f.totalCount}catch(t){console.error("Failed to load projects:",t)}finally{N.value=!1}},de=()=>{F()},re=u=>{T.value=u,F(!1)},ve=u=>{r.multiple?c.value.has(u.id)?c.value.delete(u.id):c.value.set(u.id,u):(c.value.clear(),c.value.set(u.id,u),E("update:modelValue",u.id),C.value=!1)},Z=u=>{c.value.delete(u)},q=()=>{const u=Array.from(c.value.keys());E("update:modelValue",u),C.value=!1},me=()=>{C.value=!0,I.value.length===0&&F()},G=u=>new Date(u).toLocaleDateString("zh-CN"),ce=async u=>{try{(await le.post("/project/batch",{projectIds:u})).data.data.forEach(f=>{c.value.has(f.id)&&c.value.set(f.id,f)})}catch(t){console.error("Failed to load project details:",t)}},H=async()=>{if(c.value.clear(),r.modelValue){const u=[];r.multiple&&Array.isArray(r.modelValue)?r.modelValue.forEach(t=>{c.value.set(t,{id:t,title:`项目 ${t}`,loading:!0,author:{display_name:"加载中...",username:"",avatar:"",id:0},description:"加载中...",view_count:0,star_count:0,time:new Date().toISOString(),tags:"",state:"public"}),u.push(t)}):!r.multiple&&typeof r.modelValue=="number"&&(c.value.set(r.modelValue,{id:r.modelValue,title:`项目 ${r.modelValue}`,loading:!0,author:{display_name:"加载中...",username:"",avatar:"",id:0},description:"加载中...",view_count:0,star_count:0,time:new Date().toISOString(),tags:"",state:"public"}),u.push(r.modelValue)),u.length>0&&await ce(u)}};return fe(()=>r.modelValue,(u,t)=>{JSON.stringify(u)!==JSON.stringify(t)&&H()},{immediate:!0,deep:!0}),_e(async()=>{H(),U.value=await pe("s3.staticurl")}),(u,t)=>(o(),v("div",null,[l(k,{class:"cursor-pointer",onClick:me,elevation:"1",rounded:"lg"},{default:e(()=>[l(Q,{class:"d-flex align-center justify-space-between"},{default:e(()=>[i("div",ke,[oe.value?!h.multiple&&A.value?(o(),v("div",Ce,[l(K,{size:"32",class:"me-2"},{default:e(()=>[i("img",{src:A.value.author.avatar,alt:A.value.author.display_name},null,8,ze)]),_:1}),i("div",null,[i("div",Se,n(A.value.title),1),i("div",$e,"by "+n(A.value.author.display_name),1)])])):h.multiple?(o(),v("div",Ie,[i("div",Pe,"已选择 "+n(_.value.length)+" 个项目",1),i("div",De,[(o(!0),v(P,null,D(_.value.slice(0,3),a=>(o(),y(V,{key:a.id,size:"small",variant:"outlined",color:"primary"},{default:e(()=>[s(n(a.title),1)]),_:2},1024))),128)),_.value.length>3?(o(),y(V,{key:0,size:"small",variant:"outlined",color:"grey"},{default:e(()=>[s(" +"+n(_.value.length-3),1)]),_:1})):z("",!0)])])):z("",!0):(o(),v("div",we,n(h.multiple?"选择项目...":"选择一个项目..."),1))]),l(p,null,{default:e(()=>t[6]||(t[6]=[s("mdi-chevron-down",-1)])),_:1,__:[6]})]),_:1})]),_:1}),l(xe,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=a=>C.value=a),"max-width":u.$vuetify.display.mobile?void 0:"1200px",fullscreen:u.$vuetify.display.mobile,scrollable:"",transition:"dialog-transition"},{default:e(()=>[l(k,null,{default:e(()=>[l(S,{class:"d-flex align-center justify-space-between pa-4"},{default:e(()=>[i("span",Ne,n(h.multiple?"选择项目":"选择一个项目"),1),l($,{icon:"",variant:"text",onClick:t[0]||(t[0]=a=>C.value=!1)},{default:e(()=>[l(p,null,{default:e(()=>t[7]||(t[7]=[s("mdi-close",-1)])),_:1,__:[7]})]),_:1})]),_:1}),l(ie,{fluid:"",class:"pa-0"},{default:e(()=>[l(M,{"no-gutters":""},{default:e(()=>[l(w,{cols:h.multiple&&_.value.length>0?u.$vuetify.display.mobile?12:8:12,order:u.$vuetify.display.mobile?2:1},{default:e(()=>[i("div",Ue,[l(ye,{modelValue:O.value,"onUpdate:modelValue":t[1]||(t[1]=a=>O.value=a),label:"搜索项目","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:de},null,8,["modelValue"]),l(M,{class:"mb-4"},{default:e(()=>[l(w,{cols:"12",sm:"6"},{default:e(()=>[l(te,{modelValue:d.value,"onUpdate:modelValue":[t[2]||(t[2]=a=>d.value=a),F],items:ue,label:"排序",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(w,{cols:"12",sm:"6"},{default:e(()=>[l(te,{modelValue:b.value,"onUpdate:modelValue":[t[3]||(t[3]=a=>b.value=a),F],items:ne,label:"状态",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),N.value?(o(),y(ge,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):z("",!0),N.value&&I.value.length===0?(o(),v("div",Ae,[l(be,{indeterminate:"",size:"48"}),t[8]||(t[8]=i("div",{class:"mt-4 text-h6"},"加载中...",-1))])):I.value.length===0?(o(),v("div",Be,[l(p,{size:"64",class:"mb-4"},{default:e(()=>t[9]||(t[9]=[s("mdi-folder-open-outline",-1)])),_:1,__:[9]}),t[10]||(t[10]=i("div",{class:"text-h6"},"未找到项目",-1))])):(o(),y(M,{key:3},{default:e(()=>[(o(!0),v(P,null,D(I.value,a=>(o(),y(w,{key:a.id,cols:"6",sm:"6",md:"4",lg:"3"},{default:e(()=>[l(k,{class:j(["project-card",{selected:Y(a.id)}]),rounded:"lg",elevation:"2",onClick:f=>ve(a)},{default:e(()=>{var f;return[l(k,{rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:e(()=>[l(X,{src:U.value+"/scratch_slt/"+a.id,class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":ee},{default:e(()=>[l(B,null,{default:e(()=>[l(S,{class:"text-white"},{default:e(()=>[s(n(a.title),1)]),_:2},1024),l(R,{class:"text-white"},{default:e(()=>[s(n(a.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024),l(B,{"append-avatar":(f=a.author)!=null&&f.avatar?U.value+"/user/"+a.author.avatar:""},{append:e(()=>[i("div",Me,[l(V,{color:a.state==="public"?"success":"warning",size:"small",variant:"outlined"},{default:e(()=>[s(n(a.state==="public"?"公开":"私有"),1)]),_:2},1032,["color"]),Y(a.id)?(o(),y(p,{key:0,color:"primary",size:"24"},{default:e(()=>t[11]||(t[11]=[s(" mdi-check-circle ",-1)])),_:1,__:[11]})):z("",!0)])]),default:e(()=>[l(S,null,{default:e(()=>{var m,L;return[s(n(((m=a.author)==null?void 0:m.display_name)||((L=a.author)==null?void 0:L.username)||"未知用户"),1)]}),_:2},1024),l(R,null,{default:e(()=>{var m;return[s("@"+n(((m=a.author)==null?void 0:m.username)||""),1)]}),_:2},1024)]),_:2},1032,["append-avatar"]),l(B,{class:"pt-0"},{default:e(()=>[i("div",Oe,[i("div",Te,[i("div",Fe,[l(p,{size:"16",class:"me-1"},{default:e(()=>t[12]||(t[12]=[s("mdi-eye",-1)])),_:1,__:[12]}),s(" "+n(a.view_count),1)]),i("div",Le,[l(p,{size:"16",class:"me-1"},{default:e(()=>t[13]||(t[13]=[s("mdi-star",-1)])),_:1,__:[13]}),s(" "+n(a.star_count),1)])]),i("div",null,n(G(a.time)),1)]),a.tags?(o(),v("div",Ee,[(o(!0),v(P,null,D(a.tags.split(","),m=>(o(),y(V,{key:m,size:"x-small",variant:"outlined",class:"me-1"},{default:e(()=>[s(n(m.trim()),1)]),_:2},1024))),128))])):z("",!0)]),_:2},1024)]}),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})),W.value>0?(o(),v("div",Re,[l(Ve,{modelValue:T.value,"onUpdate:modelValue":[t[4]||(t[4]=a=>T.value=a),re],length:Math.ceil(W.value/h.limit),"total-visible":7},null,8,["modelValue","length"])])):z("",!0)])]),_:1},8,["cols","order"]),h.multiple&&_.value.length>0?(o(),y(w,{key:0,cols:u.$vuetify.display.mobile?12:4,class:j({"border-s":!u.$vuetify.display.mobile,"border-b":u.$vuetify.display.mobile}),order:u.$vuetify.display.mobile?1:2},{default:e(()=>[u.$vuetify.display.mobile?(o(),v("div",Je,[i("div",Qe,[t[14]||(t[14]=i("div",{class:"text-h6"},"已选择",-1)),l(V,{color:"primary",size:"small"},{default:e(()=>[s(n(_.value.length),1)]),_:1})]),i("div",We,[(o(!0),v(P,null,D(_.value,a=>(o(),y(V,{key:a.id,closable:"",color:"primary",variant:"elevated","onClick:close":f=>Z(a.id)},{default:e(()=>[l(K,{start:"",size:"24",class:"me-2"},{default:e(()=>[l(X,{src:U.value+"/user/"+a.author.avatar,cover:""},{placeholder:e(()=>[l(p,{size:"12"},{default:e(()=>t[15]||(t[15]=[s("mdi-image",-1)])),_:1,__:[15]})]),_:2},1032,["src"])]),_:2},1024),s(" "+n(a.title),1)]),_:2},1032,["onClick:close"]))),128))]),l($,{color:"primary",variant:"elevated",block:"",size:"large",onClick:q},{default:e(()=>[l(p,{start:""},{default:e(()=>t[16]||(t[16]=[s("mdi-check",-1)])),_:1,__:[16]}),s(" 确认选择 ("+n(_.value.length)+") ",1)]),_:1})])):(o(),v("div",Xe,[i("div",Ye,[t[17]||(t[17]=i("div",{class:"text-h6"},"已选择",-1)),l(V,{color:"primary",size:"small"},{default:e(()=>[s(n(_.value.length),1)]),_:1})]),i("div",null,[l(M,null,{default:e(()=>[(o(!0),v(P,null,D(_.value,a=>(o(),y(w,{key:a.id,cols:"12",sm:"6"},{default:e(()=>[l(k,{class:"selected-item",rounded:"lg",elevation:"2",variant:"outlined",color:"primary"},{default:e(()=>{var f;return[l(k,{rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:e(()=>[l(X,{src:U.value+"/scratch_slt/"+a.id,class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":ee},{default:e(()=>[l(B,null,{default:e(()=>[l(S,{class:"text-white"},{default:e(()=>[s(n(a.title),1)]),_:2},1024),l(R,{class:"text-white"},{default:e(()=>[s(n(a.description),1)]),_:2},1024)]),_:2},1024),i("div",Ze,[l($,{icon:"",size:"small",variant:"elevated",color:"error",onClick:he(m=>Z(a.id),["stop"])},{default:e(()=>[l(p,{size:"16"},{default:e(()=>t[18]||(t[18]=[s("mdi-close",-1)])),_:1,__:[18]})]),_:2},1032,["onClick"])])]),_:2},1032,["src"])]),_:2},1024),l(B,{"append-avatar":(f=a.author)!=null&&f.avatar?U.value+"/user/"+a.author.avatar:""},{append:e(()=>[i("div",qe,[l(V,{color:a.state==="public"?"success":"warning",size:"small",variant:"outlined"},{default:e(()=>[s(n(a.state==="public"?"公开":"私有"),1)]),_:2},1032,["color"])])]),default:e(()=>[l(S,null,{default:e(()=>{var m,L;return[s(n(((m=a.author)==null?void 0:m.display_name)||((L=a.author)==null?void 0:L.username)||"未知用户"),1)]}),_:2},1024),l(R,null,{default:e(()=>{var m;return[s("@"+n(((m=a.author)==null?void 0:m.username)||""),1)]}),_:2},1024)]),_:2},1032,["append-avatar"]),l(B,{class:"pt-0"},{default:e(()=>[i("div",Ge,[i("div",He,[i("div",Ke,[l(p,{size:"16",class:"me-1"},{default:e(()=>t[19]||(t[19]=[s("mdi-eye",-1)])),_:1,__:[19]}),s(" "+n(a.view_count),1)]),i("div",je,[l(p,{size:"16",class:"me-1"},{default:e(()=>t[20]||(t[20]=[s("mdi-star",-1)])),_:1,__:[20]}),s(" "+n(a.star_count),1)])]),i("div",null,n(G(a.time)),1)]),a.tags?(o(),v("div",el,[(o(!0),v(P,null,D(a.tags.split(","),m=>(o(),y(V,{key:m,size:"x-small",variant:"outlined",class:"me-1"},{default:e(()=>[s(n(m.trim()),1)]),_:2},1024))),128))])):z("",!0)]),_:2},1024)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),l($,{color:"primary",variant:"elevated",block:"",class:"mt-3",size:"large",onClick:q},{default:e(()=>[l(p,{start:""},{default:e(()=>t[21]||(t[21]=[s("mdi-check",-1)])),_:1,__:[21]}),s(" 确认选择 ("+n(_.value.length)+") ",1)]),_:1})]))]),_:1},8,["cols","class","order"])):z("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","max-width","fullscreen"])]))}},ae=se(ll,[["__scopeId","data-v-57c5f243"]]),tl={class:"pa-6"},al={class:"mt-3"},sl={class:"mt-3"},il={key:0},ul={class:"d-flex gap-3 mb-3"},nl={class:"mt-4"},ol={class:"mt-2 pa-3 bg-grey-lighten-4 rounded"},dl={__name:"test-project-selector",setup(h){const x=g(null),r=g([]),E=J(()=>({singleSelection:x.value,multipleSelection:r.value,singleType:typeof x.value,multipleType:typeof r.value,multipleLength:Array.isArray(r.value)?r.value.length:"Not an array"})),C=()=>{x.value=null},N=()=>{r.value=[]},I=()=>{x.value=10338},c=()=>{r.value=[10338,10338,789]};return(O,d)=>(o(),v("div",tl,[l(ie,null,{default:e(()=>[d[12]||(d[12]=i("h1",{class:"text-h4 mb-6"},"项目选择器测试",-1)),l(M,null,{default:e(()=>[l(w,{cols:"12",md:"6"},{default:e(()=>[l(k,{class:"mb-4"},{default:e(()=>[l(S,null,{default:e(()=>d[2]||(d[2]=[s("单选模式",-1)])),_:1,__:[2]}),l(Q,null,{default:e(()=>[l(ae,{modelValue:x.value,"onUpdate:modelValue":d[0]||(d[0]=b=>x.value=b),multiple:!1},null,8,["modelValue"]),i("div",al,[d[3]||(d[3]=i("strong",null,"选中的项目ID:",-1)),s(" "+n(x.value||"未选择"),1)])]),_:1})]),_:1})]),_:1}),l(w,{cols:"12",md:"6"},{default:e(()=>[l(k,{class:"mb-4"},{default:e(()=>[l(S,null,{default:e(()=>d[4]||(d[4]=[s("多选模式",-1)])),_:1,__:[4]}),l(Q,null,{default:e(()=>[l(ae,{modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=b=>r.value=b),multiple:!0},null,8,["modelValue"]),i("div",sl,[d[5]||(d[5]=i("strong",null,"选中的项目IDs:",-1)),r.value.length===0?(o(),v("div",il,"未选择")):(o(!0),v(P,{key:1},D(r.value,b=>(o(),y(V,{key:b,class:"me-1 mt-1",size:"small",color:"primary"},{default:e(()=>[s(n(b),1)]),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(M,null,{default:e(()=>[l(w,{cols:"12"},{default:e(()=>[l(k,null,{default:e(()=>[l(S,null,{default:e(()=>d[6]||(d[6]=[s("测试控制",-1)])),_:1,__:[6]}),l(Q,null,{default:e(()=>[i("div",ul,[l($,{onClick:C,color:"warning",variant:"outlined"},{default:e(()=>d[7]||(d[7]=[s(" 清空单选 ",-1)])),_:1,__:[7]}),l($,{onClick:N,color:"warning",variant:"outlined"},{default:e(()=>d[8]||(d[8]=[s(" 清空多选 ",-1)])),_:1,__:[8]}),l($,{onClick:I,color:"primary",variant:"outlined"},{default:e(()=>d[9]||(d[9]=[s(" 设置单选示例值 ",-1)])),_:1,__:[9]}),l($,{onClick:c,color:"primary",variant:"outlined"},{default:e(()=>d[10]||(d[10]=[s(" 设置多选示例值 ",-1)])),_:1,__:[10]})]),i("div",nl,[d[11]||(d[11]=i("h3",null,"当前状态:",-1)),i("pre",ol,n(E.value),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1,__:[12]})]))}},_l=se(dl,[["__scopeId","data-v-653d9add"]]);export{_l as default};
