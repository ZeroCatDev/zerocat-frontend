import{_}from"./ProjectCard-83XBu3R6.js";import{c as P}from"./projectService-CzJs2KlG.js";import{a as x}from"./user-u1zRqFcn.js";import{_ as j,c as l,o as a,w as s,e as y,M as I,N as k,a as r,Q as A,G as p,H as h,ag as T,ad as B,Y as m,O as f,I as F}from"./index-F5qDKYkW.js";import{a as w,V as C}from"./VRow-BSs6Eq-5.js";import{V as g}from"./VChip-BY7N1J0D.js";import{V as M}from"./VPagination-CSU-vS6S.js";const N={components:{ProjectCard:_},props:{projectIds:{type:Array,required:!0},showAuthor:{type:Boolean,default:!1}},data(){return{projects:[],authors:{},loading:!1,VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},watch:{projectIds:{handler(){this.loadData()},immediate:!0,deep:!0},showAuthor:{handler(e){e&&Object.keys(this.authors).length===0&&this.projects.length>0&&this.loadAuthors()}}},methods:{async loadData(){this.loading=!0;try{await this.fetchProjects(),this.projects.length>0&&await this.loadAuthors()}catch(e){console.error("Failed to load data:",e)}finally{this.loading=!1}},async fetchProjects(){try{this.projects=await P(this.projectIds)}catch(e){console.error("Failed to fetch projects:",e),this.projects=[]}},async loadAuthors(){try{const t=[...new Set(this.projects.map(o=>o.authorid))].filter(o=>o);if(t.length===0)return;const i=await x(t),c={};i.forEach(o=>{o&&o.id&&(c[o.id]=o)}),this.authors=c}catch(e){console.error("Failed to load authors:",e)}}}};function b(e,t,i,c,o,u){const d=_;return a(),l(C,null,{default:s(()=>[(a(!0),y(I,null,k(o.projects,n=>(a(),l(w,{key:n.id,cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2"},{default:s(()=>[r(d,{"project-data":n,"author-data":o.authors[n.authorid],"show-author":i.showAuthor},null,8,["project-data","author-data","show-author"])]),_:2},1024))),128))]),_:1})}const V=j(N,[["render",b]]),E={components:{showProjects:V},props:{url:{type:String,required:!0}},data(){return{projectIds:[],page:1,limit:16,totalPage:1,totalCount:0,loading:!1,loadTime:0}},computed:{hasTotalCount(){return this.totalCount>0}},methods:{async fetchProjects(){this.loading=!0;const e=performance.now();try{const t=(await A.get(`${this.url}&curr=${this.page}&limit=${this.limit}`)).data;t.totalCount?(this.projectIds=t.projects,this.totalCount=t.totalCount,this.totalPage=Math.ceil(this.totalCount/this.limit)):this.projectIds=[...this.projectIds,...t.projects]}catch(t){console.error("Failed to fetch projects:",t)}finally{this.loading=!1,this.loadTime=performance.now()-e}},loadMore(){this.page++,this.fetchProjects()}},watch:{url:{handler(){this.page=1,this.fetchProjects()},immediate:!0},page:{handler(){this.fetchProjects()}}}},S={class:"mt-2 text-medium-emphasis"};function v(e,t,i,c,o,u){const d=V;return a(),y(I,null,[r(T,{indeterminate:"",color:"primary",active:o.loading,height:"4"},null,8,["active"]),r(C,null,{default:s(()=>[r(w,{cols:"12"},{default:s(()=>[p("p",S,[r(g,null,{default:s(()=>[r(m,{icon:"mdi-timer",start:""}),h(" 加载耗时: "+f(o.loadTime)+" ms ",1)]),_:1}),o.totalCount?(a(),l(g,{key:0},{default:s(()=>[r(m,{icon:"mdi-counter",start:""}),h(" 总作品数量: "+f(o.totalCount),1)]),_:1})):B("",!0)])]),_:1})]),_:1}),r(d,{projectIds:o.projectIds},null,8,["projectIds"]),t[2]||(t[2]=p("br",null,null,-1)),u.hasTotalCount?(a(),l(M,{key:0,modelValue:o.page,"onUpdate:modelValue":t[0]||(t[0]=n=>o.page=n),length:o.totalPage,onInput:u.fetchProjects,rounded:"circle"},null,8,["modelValue","length","onInput"])):(a(),l(F,{key:1,onClick:u.loadMore,color:"primary"},{default:s(()=>t[1]||(t[1]=[h("继续加载")])),_:1},8,["onClick"])),t[3]||(t[3]=h()),t[4]||(t[4]=p("br",null,null,-1))],64)}const H=j(E,[["render",v]]);export{H as _};
