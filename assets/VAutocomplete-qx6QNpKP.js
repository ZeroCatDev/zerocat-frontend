import{m as Ce,u as pe,a as xe}from"./VSelect-DFY_X-3S.js";import{p as se,aO as _,a9 as C,a$ as z,b0 as Me,aQ as q,b1 as Ie,a4 as Ae,aN as Pe,au as De,i as _e,ar as Ke,I as H,a6 as J,aP as Re,aq as Le,aR as Oe,aT as Q,aU as te,aV as Te,k as Ee,a0 as ae,a as s,T as W,aW as Ne,aa as R,ad as Be,S as ue,M as Ue,Z as ne,aX as je,at as ze,O as He,aY as Qe,ab as We,aZ as oe,b2 as re}from"./index-D4SP7Gxj.js";import{V as Ze}from"./VCheckboxBtn-C9SiDHAI.js";import{V as $e}from"./VChip-oXVLm9ha.js";const Xe=(e,c,t)=>e==null||c==null?-1:e.toString().toLocaleLowerCase().indexOf(c.toString().toLocaleLowerCase()),Ye=se({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Ge(e,c,t){var M;const S=[],m=(t==null?void 0:t.default)??Xe,g=t!=null&&t.filterKeys?q(t.filterKeys):!1,y=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return S;e:for(let k=0;k<e.length;k++){const[w,I=w]=q(e[k]),r={},n={};let V=-1;if((c||y>0)&&!(t!=null&&t.noFilter)){if(typeof w=="object"){const L=g||Object.keys(I);for(const p of L){const E=Ie(I,p),O=(M=t==null?void 0:t.customKeyFilter)==null?void 0:M[p];if(V=O?O(E,c,w):m(E,c,w),V!==-1&&V!==!1)O?r[p]=V:n[p]=V;else if((t==null?void 0:t.filterMode)==="every")continue e}}else V=m(w,c,w),V!==-1&&V!==!1&&(n.title=V);const A=Object.keys(n).length,P=Object.keys(r).length;if(!A&&!P||(t==null?void 0:t.filterMode)==="union"&&P!==y&&!A||(t==null?void 0:t.filterMode)==="intersection"&&(P!==y||!A))continue}S.push({index:k,matches:{...n,...r}})}return S}function Je(e,c,t,S){const m=_([]),g=_(new Map),y=C(()=>z(c));Me(()=>{const k=typeof t=="function"?t():z(t),w=typeof k!="string"&&typeof k!="number"?"":String(k),I=Ge(y.value,w,{customKeyFilter:{...e.customKeyFilter,...z(S==null?void 0:S.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),r=z(c),n=[],V=new Map;I.forEach(A=>{let{index:P,matches:L}=A;const p=r[P];n.push(p),V.set(p.value,L)}),m.value=n,g.value=V});function M(k){return g.value.get(k.value)}return{filteredItems:m,filteredMatches:g,getMatches:M}}function qe(e,c,t){if(c==null)return e;if(Array.isArray(c))throw new Error("Multiple matches is not implemented");return typeof c=="number"&&~c?s(W,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,c)]),s("span",{class:"v-autocomplete__mask"},[e.substr(c,t)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(c+t)])]):e}const el=se({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Ye({filterKeys:["title"]}),...Ce(),...Ae(Pe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...De({transition:!1})},"VAutocomplete"),nl=_e()({name:"VAutocomplete",props:el(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,c){let{slots:t}=c;const{t:S}=Ke(),m=H(),g=_(!1),y=_(!0),M=_(!1),k=H(),w=H(),I=J(e,"menu"),r=C({get:()=>I.value,set:l=>{var a;I.value&&!l&&((a=k.value)!=null&&a.Î¨openChildren.size)||(I.value=l)}}),n=_(-1),V=C(()=>{var l;return(l=m.value)==null?void 0:l.color}),A=C(()=>r.value?e.closeText:e.openText),{items:P,transformIn:L,transformOut:p}=Re(e),{textColorClasses:E,textColorStyles:O}=Le(V),f=J(e,"search",""),o=J(e,"modelValue",[],l=>L(l===null?[null]:q(l)),l=>{const a=p(l);return e.multiple?a:a[0]??null}),ie=C(()=>typeof e.counterValue=="function"?e.counterValue(o.value):typeof e.counterValue=="number"?e.counterValue:o.value.length),N=Oe(e),{filteredItems:Z,getMatches:ce}=Je(e,P,()=>y.value?"":f.value),x=C(()=>e.hideSelected?Z.value.filter(l=>!o.value.some(a=>a.value===l.value)):Z.value),B=C(()=>!!(e.chips||t.chip)),T=C(()=>B.value||!!t.selection),ve=C(()=>o.value.map(l=>l.props.value)),$=C(()=>{var a;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&f.value===((a=x.value[0])==null?void 0:a.title))&&x.value.length>0&&!y.value&&!M.value}),X=C(()=>e.hideNoData&&!x.value.length||N.isReadonly.value||N.isDisabled.value),Y=H(),fe=pe(Y,m);function de(l){e.openOnClear&&(r.value=!0),f.value=""}function me(){X.value||(r.value=!0)}function he(l){X.value||(g.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function ge(l){var a;l.key!==" "&&oe(l)&&((a=m.value)==null||a.focus())}function ye(l){var u,i,F;if(N.isReadonly.value)return;const a=m.value.selectionStart,v=o.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),$.value&&["Enter","Tab"].includes(l.key)&&!o.value.some(d=>{let{value:h}=d;return h===x.value[0].value})&&D(x.value[0]),l.key==="ArrowDown"&&$.value&&((u=Y.value)==null||u.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&T.value&&o.value.length>0&&!f.value)return D(o.value[0],!1);if(~n.value){l.preventDefault();const d=n.value;D(o.value[n.value],!1),n.value=d>=v-1?v-2:d}else l.key==="Backspace"&&!f.value&&(n.value=v-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(n.value<0&&a>0)return;const d=n.value>-1?n.value-1:v-1;o.value[d]?n.value=d:(n.value=-1,m.value.setSelectionRange((i=f.value)==null?void 0:i.length,(F=f.value)==null?void 0:F.length))}else if(l.key==="ArrowRight"){if(n.value<0)return;const d=n.value+1;o.value[d]?n.value=d:(n.value=-1,m.value.setSelectionRange(0,0))}else~n.value&&oe(l)&&(n.value=-1)}function Ve(l){if(re(m.value,":autofill")||re(m.value,":-webkit-autofill")){const a=P.value.find(v=>v.title===l.target.value);a&&D(a)}}function ke(){var l;e.eager&&((l=w.value)==null||l.calculateVisibleItems())}function Fe(){var l;g.value&&(y.value=!0,(l=m.value)==null||l.focus())}function be(l){g.value=!0,setTimeout(()=>{M.value=!0})}function we(l){M.value=!1}function Se(l){(l==null||l===""&&!e.multiple&&!T.value)&&(o.value=[])}const G=_(!1);function D(l){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const v=o.value.findIndex(i=>e.valueComparator(i.value,l.value)),u=a??!~v;if(~v){const i=u?[...o.value,l]:[...o.value];i.splice(v,1),o.value=i}else u&&(o.value=[...o.value,l]);e.clearOnSelect&&(f.value="")}else{const v=a!==!1;o.value=v?[l]:[],f.value=v&&!T.value?l.title:"",te(()=>{r.value=!1,y.value=!0})}}return Q(g,(l,a)=>{var v;l!==a&&(l?(G.value=!0,f.value=e.multiple||T.value?"":String(((v=o.value.at(-1))==null?void 0:v.props.title)??""),y.value=!0,te(()=>G.value=!1)):(!e.multiple&&f.value==null&&(o.value=[]),r.value=!1,o.value.some(u=>{let{title:i}=u;return i===f.value})||(f.value=""),n.value=-1))}),Q(f,l=>{!g.value||G.value||(l&&(r.value=!0),y.value=!l)}),Q(r,()=>{if(!e.hideSelected&&r.value&&o.value.length){const l=x.value.findIndex(a=>o.value.some(v=>a.value===v.value));Te&&window.requestAnimationFrame(()=>{var a;l>=0&&((a=w.value)==null||a.scrollToIndex(l))})}}),Q(()=>e.items,(l,a)=>{r.value||g.value&&!a.length&&l.length&&(r.value=!0)}),Ee(()=>{const l=!!(!e.hideNoData||x.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),a=o.value.length>0,v=ae.filterProps(e);return s(ae,R({ref:m},v,{modelValue:f.value,"onUpdate:modelValue":[u=>f.value=u,Se],focused:g.value,"onUpdate:focused":u=>g.value=u,validationValue:o.externalValue,counterValue:ie.value,dirty:a,onChange:Ve,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!T.value,"v-autocomplete--selecting-index":n.value>-1},e.class],style:e.style,readonly:N.isReadonly.value,placeholder:a?void 0:e.placeholder,"onClick:clear":de,"onMousedown:control":me,onKeydown:ye}),{...t,default:()=>s(W,null,[s(Ne,R({ref:k,modelValue:r.value,"onUpdate:modelValue":u=>r.value=u,activator:"parent",contentClass:"v-autocomplete__content",disabled:X.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:ke,onAfterLeave:Fe},e.menuProps),{default:()=>[l&&s(Be,R({ref:Y,selected:ve.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onKeydown:ge,onFocusin:be,onFocusout:we,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},fe,e.listProps),{default:()=>{var u,i,F;return[(u=t["prepend-item"])==null?void 0:u.call(t),!x.value.length&&!e.hideNoData&&(((i=t["no-data"])==null?void 0:i.call(t))??s(ue,{key:"no-data",title:S(e.noDataText)},null)),s(xe,{ref:w,renderless:!0,items:x.value},{default:d=>{var le;let{item:h,index:K,itemRef:b}=d;const ee=R(h.props,{ref:b,key:h.value,active:$.value&&K===0?!0:void 0,onClick:()=>D(h,null)});return((le=t.item)==null?void 0:le.call(t,{item:h,index:K,props:ee}))??s(ue,R(ee,{role:"option"}),{prepend:U=>{let{isSelected:j}=U;return s(W,null,[e.multiple&&!e.hideSelected?s(Ze,{key:h.value,modelValue:j,ripple:!1,tabindex:"-1"},null):void 0,h.props.prependAvatar&&s(Ue,{image:h.props.prependAvatar},null),h.props.prependIcon&&s(ne,{icon:h.props.prependIcon},null)])},title:()=>{var U,j;return y.value?h.title:qe(h.title,(U=ce(h))==null?void 0:U.title,((j=f.value)==null?void 0:j.length)??0)}})}}),(F=t["append-item"])==null?void 0:F.call(t)]}})]}),o.value.map((u,i)=>{function F(b){b.stopPropagation(),b.preventDefault(),D(u,!1)}const d={"onClick:close":F,onKeydown(b){b.key!=="Enter"&&b.key!==" "||(b.preventDefault(),b.stopPropagation(),F(b))},onMousedown(b){b.preventDefault(),b.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},h=B.value?!!t.chip:!!t.selection,K=h?je(B.value?t.chip({item:u,index:i,props:d}):t.selection({item:u,index:i})):void 0;if(!(h&&!K))return s("div",{key:u.value,class:["v-autocomplete__selection",i===n.value&&["v-autocomplete__selection--selected",E.value]],style:i===n.value?O.value:{}},[B.value?t.chip?s(ze,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>[K]}):s($e,R({key:"chip",closable:e.closableChips,size:"small",text:u.title,disabled:u.props.disabled},d),null):K??s("span",{class:"v-autocomplete__selection-text"},[u.title,e.multiple&&i<o.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[He(",")])])])})]),"append-inner":function(){var d;for(var u=arguments.length,i=new Array(u),F=0;F<u;F++)i[F]=arguments[F];return s(W,null,[(d=t["append-inner"])==null?void 0:d.call(t,...i),e.menuIcon?s(ne,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:he,onClick:Qe,"aria-label":S(A.value),title:S(A.value),tabindex:"-1"},null):void 0])}})}),We({isFocused:g,isPristine:y,menu:r,search:f,filteredItems:Z,select:D},m)}});export{nl as V,Ye as m,Je as u};
