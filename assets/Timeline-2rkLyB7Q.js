import{g as V,p as B,bv as ie,b6 as J,bc as se,bb as ae,d as L,f as i,C as b,D as k,e as n,O as D,h as le,bf as X,H as Y,bd as Q,K as N,I as $,b7 as oe,A as ne,r as re,w as ce,k as I,G as ee,b9 as de,v as me,bw as ue,bx as _e,bi as fe,b8 as p,x as K,E as ve,J as ye,bj as he,_ as ge,by as pe,aa as je,ac as be,c as h,o as m,N as o,F as T,U as W,Y as x,$ as w,X as a,S as j,L as v,W as z,a3 as S,Z as xe,i as ke}from"./index-DJjZltn0.js";const Ce=B({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:$,iconColor:String,lineColor:String,...N(),...Q(),...Y(),...X()},"VTimelineDivider"),Pe=V()({name:"VTimelineDivider",props:Ce(),setup(e,s){let{slots:l}=s;const{sizeClasses:g,sizeStyles:u}=ie(e,"v-timeline-divider__dot"),{backgroundColorStyles:d,backgroundColorClasses:f}=J(()=>e.dotColor),{roundedClasses:t}=se(e,"v-timeline-divider__dot"),{elevationClasses:y}=ae(e),{backgroundColorClasses:C,backgroundColorStyles:P}=J(()=>e.lineColor);return L(()=>i("div",{class:k(["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class]),style:b(e.style)},[i("div",{class:k(["v-timeline-divider__before",C.value]),style:b(P.value)},null),!e.hideDot&&i("div",{key:"dot",class:k(["v-timeline-divider__dot",y.value,t.value,g.value]),style:b(u.value)},[i("div",{class:k(["v-timeline-divider__inner-dot",f.value,t.value]),style:b(d.value)},[l.default?n(le,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},l.default):n(D,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),i("div",{class:k(["v-timeline-divider__after",C.value]),style:b(P.value)},null)])),{}}}),te=B({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:$,iconColor:String,lineInset:[Number,String],side:{type:String,validator:e=>e==null||["start","end"].includes(e)},...N(),...de(),...X(),...Q(),...Y(),...ee()},"VTimelineItem"),De=V()({name:"VTimelineItem",props:te(),setup(e,s){let{slots:l}=s;const{dimensionStyles:g}=oe(e),u=ne(0),d=re();return ce(d,f=>{var t;f&&(u.value=((t=f.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:t.getBoundingClientRect().width)??0)},{flush:"post"}),L(()=>{var f,t;return i("div",{class:k(["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot,"v-timeline-item--side-start":e.side==="start","v-timeline-item--side-end":e.side==="end"},e.class]),style:b([{"--v-timeline-dot-size":I(u.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${I(e.lineInset)})`:I(0)},e.style])},[i("div",{class:"v-timeline-item__body",style:b(g.value)},[(f=l.default)==null?void 0:f.call(l)]),n(Pe,{ref:d,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:l.icon}),e.density!=="compact"&&i("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((t=l.opposite)==null?void 0:t.call(l))])])}),{}}}),Te=B({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...he(te({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...N(),...ye(),...ee(),...ve()},"VTimeline"),ze=V()({name:"VTimeline",props:Te(),setup(e,s){let{slots:l}=s;const{themeClasses:g}=me(e),{densityClasses:u}=ue(e),{rtlClasses:d}=_e();fe({VTimelineDivider:{lineColor:p(()=>e.lineColor)},VTimelineItem:{density:p(()=>e.density),dotColor:p(()=>e.dotColor),fillDot:p(()=>e.fillDot),hideOpposite:p(()=>e.hideOpposite),iconColor:p(()=>e.iconColor),lineColor:p(()=>e.lineColor),lineInset:p(()=>e.lineInset),size:p(()=>e.size)}});const f=K(()=>{const y=e.side?e.side:e.density!=="default"?"end":null;return y&&`v-timeline--side-${y}`}),t=K(()=>{const y=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return y;case"start":return y[0];case"end":return y[1];default:return null}});return L(()=>n(e.tag,{class:k(["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,t.value,{"v-timeline--inset-line":!!e.lineInset},g.value,u.value,f.value,d.value,e.class]),style:b([{"--v-timeline-line-thickness":I(e.lineThickness)},e.style])},l)),{}}}),Se={name:"Timeline",props:{timeline:{type:Object,required:!0,default:()=>({events:[],pagination:{current:1,size:20,total:0}})},isLoadingMore:{type:Boolean,default:!1},username:{type:String,required:!0}},data(){return{events:[],loading:!1,error:null,page:1,hasMore:!0,s3BucketUrl:"",projectInfoMap:new Map,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},project_star:{text:"给项目点了星标",label:"星标",color:"primary",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",bio:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}}},async mounted(){this.s3BucketUrl=await je("s3.staticurl"),this.timeline.events.length>0&&await this.fetchProjectInfoForEvents(this.timeline.events)},watch:{"timeline.events":{immediate:!0,async handler(e){e.length>0&&await this.fetchProjectInfoForEvents(e)}}},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchProjectInfoForEvents(e){const s=e.filter(l=>{var g;return((g=l.target)==null?void 0:g.type)==="project"}).map(l=>l.target.id);s.length>0&&await this.fetchProjectInfo(s)},async fetchProjectInfo(e){try{(await pe(e)).forEach(l=>{this.projectInfoMap.set(l.id,l)})}catch(s){console.error("Error fetching project info:",s)}},getProjectLink(e){if(!e)return"";const s=this.projectInfoMap.get(e);return s?`/${s.author.username}/${s.name||s.id}`:`/project/${e}`},loadMore(){this.$emit("load-more")},getUpdatedFields(e){return e!=null&&e.length?e.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},getTargetContent(e,s){if(!e)return"";switch(e.type){case"project":return e.title||`项目 #${e.id}`;case"user":return e.display_name||`用户 #${e.id}`;case"projectlist":return`项目列表 #${e.id}`;default:return`${e.type} #${e.id}`}},getFieldDisplayName(e){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[e]||e}}},Ie={class:"timeline-item-content"},we={class:"event-header"},Ve={class:"text-h6"},Be={class:"project-info"},Le={class:"font-weight-medium"},Ne={class:"mt-2 text-caption text-medium-emphasis"},Me={class:"d-flex align-center mb-2"},Ee={class:"font-weight-medium"},Fe={class:"rename-details text-body-2"},Re={class:"d-flex align-center"},Oe={class:"d-flex align-center mt-1"},Ue={class:"project-meta text-caption text-medium-emphasis mt-2"},qe={class:"d-flex align-center mb-2"},Ae={class:"font-weight-medium"},Ze={class:"commit-message text-body-2"},Ge={class:"commit-hash text-caption text-medium-emphasis mt-1"},He={class:"d-flex align-center mb-2"},Je={class:"font-weight-medium"},Ke={class:"info-updates text-body-2"},We={class:"d-flex align-center"},Xe={class:"d-flex flex-column mt-1 field-changes"},Ye={class:"old-value"},Qe={class:"ml-2"},$e={class:"new-value"},et={class:"ml-2 text-info"},tt={class:"project-meta text-caption text-medium-emphasis mt-2"},it={key:3,class:"event-content pa-2"},st={key:0,class:"text-body-2"},at={key:1,class:"text-body-2"},lt={key:2,class:"text-body-2 text-medium-emphasis"},ot={class:"d-flex justify-center mt-4 mb-4"},nt={key:1,class:"text-medium-emphasis"};function rt(e,s,l,g,u,d){const f=be("router-link");return m(),h(T,null,[n(ze,{align:"start",class:"mt-4",side:"end"},{default:o(()=>[(m(!0),h(T,null,W(l.timeline.events,t=>(m(),x(De,{key:t.id,"dot-color":"primary",size:"small"},{opposite:o(()=>[v(a(new Date(t.created_at).toLocaleString()),1)]),icon:o(()=>[n(xe,{image:u.s3BucketUrl+"/user/"+t.actor.avatar},null,8,["image"])]),default:o(()=>{var y,C,P,M,E,F,R,O,U,q,A,Z;return[i("div",Ie,[i("div",we,[i("h3",Ve,a(t.actor.display_name)+" "+a(((y=u.eventTypes[t.type])==null?void 0:y.text)||"进行了操作"),1),n(j,{color:((C=u.eventTypes[t.type])==null?void 0:C.color)||"primary",class:"ml-2",size:"x-small"},{default:o(()=>{var r;return[v(a(((r=u.eventTypes[t.type])==null?void 0:r.label)||t.type),1)]}),_:2},1032,["color"])]),(P=u.eventTypes[t.type])!=null&&P.isProject?(m(),x(f,{key:0,to:d.getProjectLink((M=t.target)==null?void 0:M.id),class:"text-decoration-none"},{default:o(()=>{var r;return[v(a((r=t.event_data)==null?void 0:r.project_title),1)]}),_:2},1032,["to"])):w("",!0),s[4]||(s[4]=i("div",{class:"mb-2"},null,-1)),(E=u.eventTypes[t.type])!=null&&E.isProject&&!["project_rename","project_commit"].includes(t.type)?(m(),x(z,{key:1,to:d.getProjectLink((F=t.target)==null?void 0:F.id),class:"mb-3 project-event"},{default:o(()=>[n(S,null,{default:o(()=>{var r,c;return[i("div",Be,[n(D,{class:"mr-2",color:"primary",icon:"mdi-source-repository"}),i("span",Le,a(((r=t.event_data)==null?void 0:r.project_name)||"未命名项目"),1),i("div",Ne,a((c=t.event_data)==null?void 0:c.project_description),1)])]}),_:2},1024)]),_:2},1032,["to"])):["project_rename","project_commit","project_info_update"].includes(t.type)?(m(),h(T,{key:2},[t.type==="project_rename"?(m(),x(z,{key:0,to:d.getProjectLink((R=t.target)==null?void 0:R.id),class:"rename-card mb-3"},{default:o(()=>[n(S,null,{default:o(()=>{var r;return[i("div",Me,[n(D,{class:"mr-2",color:"warning",icon:"mdi-rename-box"}),i("span",Ee,a((r=t.event_data)==null?void 0:r.project_title),1)]),i("div",Fe,[i("div",Re,[s[0]||(s[0]=i("span",{class:"text-medium-emphasis"},"从",-1)),n(j,{class:"mx-2",color:"surface-variant",size:"small"},{default:o(()=>{var c;return[v(a((c=t.event_data)==null?void 0:c.old_name),1)]}),_:2},1024)]),i("div",Oe,[s[1]||(s[1]=i("span",{class:"text-medium-emphasis"},"到",-1)),n(j,{class:"mx-2",color:"warning",size:"small"},{default:o(()=>{var c;return[v(a((c=t.event_data)==null?void 0:c.new_name),1)]}),_:2},1024)])]),i("div",Ue,[n(j,{class:"mr-1",size:"x-small"},{default:o(()=>{var c;return[v(a((c=t.event_data)==null?void 0:c.project_type),1)]}),_:2},1024),n(j,{size:"x-small"},{default:o(()=>{var c;return[v(a((c=t.event_data)==null?void 0:c.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_commit"?(m(),x(z,{key:1,to:d.getProjectLink((O=t.target)==null?void 0:O.id),class:"commit-card mb-3"},{default:o(()=>[n(S,null,{default:o(()=>{var r,c,_;return[i("div",qe,[n(D,{class:"mr-2",color:"info",icon:"mdi-source-commit"}),i("span",Ae,"分支: "+a((r=t.event_data)==null?void 0:r.branch),1)]),i("div",Ze,a((c=t.event_data)==null?void 0:c.commit_message),1),i("div",Ge," 提交ID: "+a((_=t.event_data)==null?void 0:_.commit_id.substring(0,7)),1)]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_info_update"?(m(),x(z,{key:2,to:d.getProjectLink((U=t.target)==null?void 0:U.id),class:"info-update-card mb-3"},{default:o(()=>[n(S,null,{default:o(()=>{var r,c;return[i("div",He,[n(D,{class:"mr-2",color:"info",icon:"mdi-file-document-edit"}),i("span",Je,a((r=t.event_data)==null?void 0:r.project_title),1)]),i("div",Ke,[(m(!0),h(T,null,W((c=t.event_data)==null?void 0:c.updated_fields,_=>{var G,H;return m(),h("div",{key:_,class:"update-item mb-2"},[i("div",We,[n(j,{class:"mr-2",color:"info",size:"x-small"},{default:o(()=>[v(a(d.getFieldDisplayName(_)),1)]),_:2},1024)]),i("div",Xe,[i("div",Ye,[s[2]||(s[2]=i("span",{class:"text-medium-emphasis"},"从：",-1)),i("span",Qe,a((G=t.event_data)==null?void 0:G.old_values[_]),1)]),i("div",$e,[s[3]||(s[3]=i("span",{class:"text-medium-emphasis"},"到：",-1)),i("span",et,a((H=t.event_data)==null?void 0:H.new_values[_]),1)])])])}),128))]),i("div",tt,[n(j,{class:"mr-1",size:"x-small"},{default:o(()=>{var _;return[v(a((_=t.event_data)==null?void 0:_.project_type),1)]}),_:2},1024),n(j,{size:"x-small"},{default:o(()=>{var _;return[v(a((_=t.event_data)==null?void 0:_.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):w("",!0)],64)):(m(),h("div",it,[t.type==="user_profile_update"?(m(),h("div",st," 更新了："+a(d.getUpdatedFields((q=t.event_data)==null?void 0:q.updated_fields)),1)):((A=t.target)==null?void 0:A.type)==="project"?(m(),h("div",at,[i("span",null,a(((Z=u.eventTypes[t.type])==null?void 0:Z.text)||"操作了"),1),n(f,{to:d.getProjectLink(t.target.id),class:"text-decoration-none ml-1"},{default:o(()=>{var r;return[v(a(((r=t.event_data)==null?void 0:r.project_name)||t.target.title||`项目 #${t.target.id}`),1)]}),_:2},1032,["to"])])):(m(),h("div",lt,a(d.getTargetContent(t.target,t.type)),1))]))])]}),_:2},1024))),128))]),_:1}),i("div",ot,[d.hasMoreEvents?(m(),x(ke,{key:0,loading:l.isLoadingMore,variant:"tonal",onClick:d.loadMore},{default:o(()=>s[5]||(s[5]=[v(" 加载更多 ",-1)])),_:1,__:[5]},8,["loading","onClick"])):l.timeline.events.length>0?(m(),h("div",nt," 没有更多内容了 ")):w("",!0)])],64)}const dt=ge(Se,[["render",rt],["__scopeId","data-v-1cef0e31"]]);export{dt as _};
