import{_ as U}from"./Timeline-C7xeVeog.js";import{_ as I,a as M}from"./UserFollowers-DY291wjo.js";import{_ as F,a as N}from"./Comment-CzB8I6F9.js";import{g as Y}from"./projectListService-D9KVKasP.js";import{_ as L,c as g,o as i,Y as a,N as r,e,a3 as x,a4 as G,W as c,F as k,a5 as J,L as u,U as S,R as y,Q as v,a1 as j,i as P,f as o,X as n,a6 as $,a7 as h,a8 as ee,Z as te,n as se,$ as w,S as p,O as d,T as V,a9 as re,aa as le,M as oe,ab as ie}from"./index-CqDYMkg5.js";import{_ as ne}from"./Projects-CWLRtAPc.js";import{_ as A}from"./UserRelationControls-BBYAsz8L.js";import{_ as E}from"./TimeAgo-DefCx_l6.js";import{_ as B}from"./PageAnalytics-r7gEuZ8L.js";/* empty css                        */import"./_commonjsHelpers-BosuxZz1.js";import"./VTextarea-BMQ0gWum.js";import"./ProjectCard-BYWSBxv8.js";import"./VSpacer-BmIOKXlY.js";const ae={name:"UserProjectLists",props:{userId:{type:[Number,String],required:!0},projectLists:{type:Array,default:()=>[]}},data(){return{loading:!1,localLists:[]}},computed:{lists(){return this.projectLists.length>0?this.projectLists:this.localLists}},watch:{userId:{immediate:!0,handler(t){t&&this.projectLists.length===0&&this.fetchUserLists()}}},methods:{async fetchUserLists(){this.loading=!0;try{const t=await Y(this.userId);t.status==="success"?this.localLists=t.data||[]:console.error("获取用户列表失败:",t.message)}catch(t){console.error("获取用户列表失败:",t)}finally{this.loading=!1}}}};function ue(t,s,b,C,l,f){return i(),g("div",null,[l.loading?(i(),a(c,{key:0,class:"mb-4"},{default:r(()=>[e(x,{class:"text-center"},{default:r(()=>[e(G,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(i(),g(k,{key:1},[f.lists.length===0?(i(),a(c,{key:0,class:"mb-4"},{default:r(()=>[e(x,{class:"text-center"},{default:r(()=>[e(J,{type:"info",variant:"tonal"},{default:r(()=>s[0]||(s[0]=[u(" 该用户暂无公开项目列表 ")])),_:1,__:[0]})]),_:1})]),_:1})):(i(),a(v,{key:1},{default:r(()=>[(i(!0),g(k,null,S(f.lists,m=>(i(),a(y,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:m.id},{default:r(()=>[e(c,{rounded:"lg"},{default:r(()=>[e(c,{to:"/app/projectlist/"+m.id,rounded:"lg",title:m.title,subtitle:m.description,variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))],64))])}const D=L(ae,[["render",ue]]),ce={name:"FollowStats",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},data(){return{followersCount:0,followingCount:0,loading:!1}},mounted(){this.fetchFollowStats()},watch:{userId:{handler(){this.fetchFollowStats()}}},methods:{async fetchFollowStats(){try{this.loading=!0;const t=await j.get(`/follows/followers/${this.userId}`,{params:{limit:1,offset:0}});t.data.success&&(this.followersCount=t.data.data.total);const s=await j.get(`/follows/following/${this.userId}`,{params:{limit:1,offset:0}});s.data.success&&(this.followingCount=s.data.data.total)}catch(t){console.error("获取关注统计失败:",t)}finally{this.loading=!1}}}},de={class:"font-weight-bold"},me={class:"font-weight-bold"};function _e(t,s,b,C,l,f){return i(),a(v,{class:"follow-stats"},{default:r(()=>[e(y,null,{default:r(()=>[e(P,{variant:"text",to:`/${b.username}?tab=followers`,class:"stats-btn"},{default:r(()=>[o("span",de,n(l.followersCount),1),s[0]||(s[0]=o("span",{class:"text-body-2 text-medium-emphasis"},"关注者",-1))]),_:1,__:[0]},8,["to"])]),_:1}),e(y,null,{default:r(()=>[e(P,{variant:"text",to:`/${b.username}?tab=following`,class:"stats-btn"},{default:r(()=>[o("span",me,n(l.followingCount),1),s[1]||(s[1]=o("span",{class:"text-body-2 text-medium-emphasis"},"正在关注",-1))]),_:1,__:[1]},8,["to"])]),_:1})]),_:1})}const R=L(ce,[["render",_e],["__scopeId","data-v-d6d9b628"]]),pe={components:{Comment:N,Markdown:F,TimeAgo:E,UserProjectLists:D,UserRelationControls:A,FollowStats:R,UserFollowers:M,UserFollowing:I,Timeline:U,PageAnalytics:B},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},isLoadingMore:!1,localuser:ie,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",bio:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"},VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},watch:{"$route.query.tab"(t){this.tab=t||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await le(this.username),oe({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){try{const t=await j({url:`/projectlist/userid/${this.user.id}/public`,method:"get"});t.data&&t.data.data&&(this.lists=t.data.data)}catch(t){console.error("获取用户项目列表失败:",t),this.lists=[]}},async fetchTimeline(t=1){try{const s=await j.get(`/timeline/user/${this.user.id}`,{params:{page:t,limit:this.timeline.pagination.size}});s.data.status==="success"&&(t===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(t){return t!=null&&t.length?t.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!this.isLoadingMore)try{this.isLoadingMore=!0,await this.fetchTimeline(this.timeline.pagination.current+1)}finally{this.isLoadingMore=!1}},getTargetContent(t,s){if(!t)return"";switch(t.type){case"project":return t.title||`项目 #${t.id}`;case"user":return t.display_name||`用户 #${t.id}`;case"projectlist":return`项目列表 #${t.id}`;default:return`${t.type} #${t.id}`}},getFieldDisplayName(t){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[t]||t}}},fe={class:"font-weight-medium text-primary"},he={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},ge={class:"mt-2 text-body-1 text-medium-emphasis user-motto"},ye={class:"mt-2 text-medium-emphasis"},be=["href"];function we(t,s,b,C,l,f){const m=B,q=E,z=A,W=R,Z=F,K=ne,H=D,T=N,O=M,Q=I,X=U;return i(),g("div",null,[e(m,{"target-type":"user","target-id":l.user.id},null,8,["target-id"]),e(V,null,{default:r(()=>[e($,{modelValue:l.tab,"onUpdate:modelValue":s[0]||(s[0]=_=>l.tab=_)},{default:r(()=>[e(h,{value:"home"},{default:r(()=>[e(ee,{class:"mt-8"},{default:r(()=>[e(v,{class:"d-flex align-center"},{default:r(()=>[e(y,null,{default:r(()=>[o("p",fe,n(l.user.type==="administrator"?"ZeroCat 管理员":"开发者"),1),o("p",he,[u(n(l.user.display_name)+" ",1),e(te,{size:"52",class:"ma-2"},{default:r(()=>[e(se,{src:l.VITE_APP_S3_BUCKET+"/user/"+l.user.avatar},null,8,["src"])]),_:1})]),o("p",ge,n(l.user.motto),1),o("p",ye,[e(p,{class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-account-circle",start:""}),u(" #"+n(l.user.id),1)]),_:1}),e(p,{class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-clock",start:""}),e(q,{date:l.user.regTime},null,8,["date"]),s[1]||(s[1]=u(" 注册 "))]),_:1,__:[1]}),l.user.location?(i(),a(p,{key:0,class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-map-marker",start:""}),u(" "+n(l.user.location),1)]),_:1})):w("",!0),l.user.birthday?(i(),a(p,{key:1,class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-cake-variant",start:""}),u(" "+n(new Date(l.user.birthday).toLocaleDateString()),1)]),_:1})):w("",!0),l.user.url?(i(),a(p,{key:2,class:"mr-2","append-icon":"mdi-open-in-new"},{default:r(()=>[e(d,{icon:"mdi-web",start:""}),o("a",{href:l.user.url,target:"_blank",class:"text-decoration-none"},n(l.user.url),9,be)]),_:1})):w("",!0),l.user.isActive?w("",!0):(i(),a(p,{key:3,color:"error"},{default:r(()=>[e(d,{icon:"mdi-alert-circle",start:""}),s[2]||(s[2]=u(" 异常 "))]),_:1,__:[2]}))]),e(z,{"user-id":l.user.id,username:l.username,"display-name":l.user.display_name},null,8,["user-id","username","display-name"]),e(W,{"user-id":l.user.id,username:l.username,class:"mt-3"},null,8,["user-id","username"])]),_:1})]),_:1})]),_:1}),s[4]||(s[4]=o("br",null,null,-1)),e(c,{title:"关于我",subtitle:"README.md"},{default:r(()=>[e(x,{class:"markdown-body"},{default:r(()=>[s[3]||(s[3]=o("br",null,null,-1)),e(Z,null,{default:r(()=>[u(n(l.user.bio),1)]),_:1})]),_:1,__:[3]})]),_:1}),e(K,{url:l.url},null,8,["url"]),e(v,null,{default:r(()=>[(i(!0),g(k,null,S(l.lists,_=>(i(),a(y,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:_.id},{default:r(()=>[e(c,{rounded:"lg"},{default:r(()=>[e(c,{to:"/app/projectlist/"+_.id,rounded:"lg",title:_.title,subtitle:_.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[5]||(s[5]=o("br",null,null,-1)),e(H,{"user-id":l.user.id,"project-lists":l.lists},null,8,["user-id","project-lists"]),s[6]||(s[6]=o("br",null,null,-1)),e(T,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1,__:[4,5,6]}),e(h,{value:"comment"},{default:r(()=>[e(T,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1}),e(h,{value:"followers"},{default:r(()=>[e(V,null,{default:r(()=>[s[7]||(s[7]=o("h2",{class:"text-h5 mb-4"},"关注者",-1)),e(O,{"user-id":l.user.id,"show-all":!1},null,8,["user-id"])]),_:1,__:[7]})]),_:1}),e(h,{value:"following"},{default:r(()=>[e(V,null,{default:r(()=>[s[8]||(s[8]=o("h2",{class:"text-h5 mb-4"},"正在关注",-1)),e(Q,{"user-id":l.user.id,"show-all":!1},null,8,["user-id"])]),_:1,__:[8]})]),_:1}),e(h,{value:"timeline"},{default:r(()=>[e(c,{class:"mt-4",variant:"flat"},{default:r(()=>[e(re,{class:"d-flex align-center"},{default:r(()=>[e(d,{icon:"mdi-timeline-clock",color:"primary",class:"mr-2"}),u(" "+n(l.user.display_name)+" 的动态 ",1)]),_:1}),e(x,null,{default:r(()=>[e(X,{timeline:l.timeline,"is-loading-more":l.isLoadingMore,onLoadMore:f.loadMoreEvents},null,8,["timeline","is-loading-more","onLoadMore"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const Se=L(pe,[["render",we],["__scopeId","data-v-855f64d5"]]);export{Se as default};
