import{d as t,l as o}from"./db-BzvkWQI0.js";import{J as u}from"./index-BdsR-OvF.js";async function l(e){return Array.isArray(e)||(e=[e]),Promise.all(e.map(r=>t.users.get(Number(r)).then(s=>s||{id:r,cached:!1}))).then(r=>e.length===1?r[0]:r)}async function n(e){if(e.id=Number(e.id),await t.users.get(e.id))return await t.users.put(e),`用户 ${e.display_name} 更新成功.`;{const s=await t.users.add(e);return`用户 ${e.display_name} 成功缓存. 获取到id为 ${s}`}}async function m(e){try{return Array.isArray(e)||(e=[e]),(await Promise.all(e.map(async s=>await n(s)))).join(`
`)}catch(r){return`添加缓存失败: ${r}`}}async function y(e){try{const r=await t.users.get(Number(e));return r?(await t.users.delete(Number(e)),`用户 ${r.display_name} 删除成功.`):`删除 ${e} 失败: User not found`}catch(r){return`删除 ${e} 失败: ${r}`}}async function h(e){Array.isArray(e)||(e=[e]);try{return(await Promise.all(e.map(async s=>{const a=await u.get(`/api/getuserinfo?id=${s}`);if(console.log(a),a.status==="ok"){const i={id:a.info.user.id,display_name:a.info.user.display_name,motto:a.info.user.motto,images:a.info.user.images,regTime:a.info.user.regTime,sex:a.info.user.sex,username:a.info.user.username};return await n(i)}else return`刷新 ${s} 失败: ${a.status}`}))).join(`
`)}catch(r){return`刷新 ${e} 失败: ${r}`}}function g(e,r){return Array.isArray(e)||(e=[e]),o(()=>t.users.where("id").anyOf(e).toArray()).subscribe(r)}export{m as a,h as b,l as f,g as l,y as r};
