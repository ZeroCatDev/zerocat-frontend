import{_ as de}from"./Projects-CAyWseHr.js";import{o as Ae}from"./openEdit-DBNuVmNU.js";import{p as Re,a4 as Ue,aM as Ee,au as Me,i as Ne,ar as Oe,I as B,aN as E,a6 as ne,a9 as C,aO as Be,aq as Le,aP as Ke,aQ as qe,aR as M,aS as N,aT as ue,aU as He,k as ze,a0 as _,a as t,T as J,aV as We,aa as D,ad as Ze,S as se,M as Ge,Z as re,aW as Je,at as Qe,O as R,aX as Xe,ab as Ye,aY as $e,aZ as el,_ as ll,H as tl,G as al,J as ee,o as ol,c as nl,w as i,N as A,L as G,R as ul,$ as sl,W as ie,aE as rl,a3 as il}from"./index-DFXp_gwa.js";import{a as g,V as ce}from"./VRow-BPw0P95U.js";import{m as cl,u as dl,a as ml,V as O}from"./VSelect-Cw7wYxU_.js";import{m as vl,u as fl,V as pl}from"./VAutocomplete-BwZ4CKoJ.js";import{V as hl}from"./VTextarea-r60QuJsE.js";import{V as bl}from"./VCheckboxBtn-iJ3fkjhf.js";import{V as me}from"./VChip-BaHLS7Nk.js";import{V as gl,a as Vl,b as yl,c as xl}from"./VExpansionPanels-Ddv1pBZ7.js";import{V as Pl}from"./VSpacer-BtE4vAQZ.js";import{V as Cl}from"./VDialog-DPA3zrHc.js";import{V as kl}from"./VContainer-7Lbhzs9X.js";import"./showProjects-DQ6UlAfp.js";import"./project-CXVVnjWk.js";import"./db-pMm_QNmp.js";import"./user-DGcsKU_e.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-CM-6iJ09.js";/* empty css              */import"./VSelectionControl-B0Wk9RH2.js";function wl(e,a,y){if(a==null)return e;if(Array.isArray(a))throw new Error("Multiple matches is not implemented");return typeof a=="number"&&~a?t(J,null,[t("span",{class:"v-combobox__unmask"},[e.substr(0,a)]),t("span",{class:"v-combobox__mask"},[e.substr(a,y)]),t("span",{class:"v-combobox__unmask"},[e.substr(a+y)])]):e}const jl=Re({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...vl({filterKeys:["title"]}),...cl({hideNoData:!0,returnObject:!0}),...Ue(Ee({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Me({transition:!1})},"VCombobox"),Il=Ne()({name:"VCombobox",props:jl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,a){var te;let{emit:y,slots:c}=a;const{t:o}=Oe(),f=B(),P=E(!1),n=E(!0),T=E(!1),L=B(),U=B(),K=ne(e,"menu"),p=C({get:()=>K.value,set:l=>{var u;K.value&&!l&&((u=L.value)!=null&&u.ΨopenChildren.size)||(K.value=l)}}),m=E(-1);let Q=!1;const ve=C(()=>{var l;return(l=f.value)==null?void 0:l.color}),le=C(()=>p.value?e.closeText:e.openText),{items:fe,transformIn:pe,transformOut:he}=Be(e),{textColorClasses:be,textColorStyles:ge}=Le(ve),r=ne(e,"modelValue",[],l=>pe(Ke(l)),l=>{const u=he(l);return e.multiple?u:u[0]??null}),q=qe(e),H=C(()=>!!(e.chips||c.chip)),w=C(()=>H.value||!!c.selection),j=E(!e.multiple&&!w.value?((te=r.value[0])==null?void 0:te.title)??"":""),h=C({get:()=>j.value,set:l=>{var u;if(j.value=l??"",!e.multiple&&!w.value&&(r.value=[M(e,l)]),l&&e.multiple&&((u=e.delimiters)!=null&&u.length)){const v=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));v.length>1&&(v.forEach(s=>{s=s.trim(),s&&k(M(e,s))}),j.value="")}l||(m.value=-1),n.value=!l}}),Ve=C(()=>typeof e.counterValue=="function"?e.counterValue(r.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?r.value.length:h.value.length);N(j,l=>{Q?ue(()=>Q=!1):P.value&&!p.value&&(p.value=!0),y("update:search",l)}),N(r,l=>{var u;!e.multiple&&!w.value&&(j.value=((u=l[0])==null?void 0:u.title)??"")});const{filteredItems:z,getMatches:ye}=fl(e,fe,()=>n.value?"":h.value),I=C(()=>e.hideSelected?z.value.filter(l=>!r.value.some(u=>u.value===l.value)):z.value),xe=C(()=>r.value.map(l=>l.value)),X=C(()=>{var u;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&h.value===((u=I.value[0])==null?void 0:u.title))&&I.value.length>0&&!n.value&&!T.value}),Y=C(()=>e.hideNoData&&!I.value.length||q.isReadonly.value||q.isDisabled.value),$=B(),Pe=dl($,f);function Ce(l){Q=!0,e.openOnClear&&(p.value=!0)}function ke(){Y.value||(p.value=!0)}function we(l){Y.value||(P.value&&(l.preventDefault(),l.stopPropagation()),p.value=!p.value)}function je(l){var u;$e(l)&&((u=f.value)==null||u.focus())}function Ie(l){var s;if(el(l)||q.isReadonly.value)return;const u=f.value.selectionStart,v=r.value.length;if((m.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(p.value=!0),["Escape"].includes(l.key)&&(p.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(X.value&&["Enter","Tab"].includes(l.key)&&!r.value.some(d=>{let{value:x}=d;return x===I.value[0].value})&&k(z.value[0]),n.value=!0),l.key==="ArrowDown"&&X.value&&((s=$.value)==null||s.focus("next")),l.key==="Enter"&&h.value&&(k(M(e,h.value)),w.value&&(j.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&w.value&&r.value.length>0&&!h.value)return k(r.value[0],!1);if(~m.value){const d=m.value;k(r.value[m.value],!1),m.value=d>=v-1?v-2:d}else l.key==="Backspace"&&!h.value&&(m.value=v-1)}if(e.multiple){if(l.key==="ArrowLeft"){if(m.value<0&&u>0)return;const d=m.value>-1?m.value-1:v-1;r.value[d]?m.value=d:(m.value=-1,f.value.setSelectionRange(h.value.length,h.value.length))}if(l.key==="ArrowRight"){if(m.value<0)return;const d=m.value+1;r.value[d]?m.value=d:(m.value=-1,f.value.setSelectionRange(0,0))}}}function Se(){var l;e.eager&&((l=U.value)==null||l.calculateVisibleItems())}function De(){var l;P.value&&(n.value=!0,(l=f.value)==null||l.focus())}function k(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const v=r.value.findIndex(d=>e.valueComparator(d.value,l.value)),s=u??!~v;if(~v){const d=s?[...r.value,l]:[...r.value];d.splice(v,1),r.value=d}else s&&(r.value=[...r.value,l]);e.clearOnSelect&&(h.value="")}else{const v=u!==!1;r.value=v?[l]:[],j.value=v&&!w.value?l.title:"",ue(()=>{p.value=!1,n.value=!0})}}function _e(l){P.value=!0,setTimeout(()=>{T.value=!0})}function Te(l){T.value=!1}function Fe(l){(l==null||l===""&&!e.multiple&&!w.value)&&(r.value=[])}return N(P,(l,u)=>{if(!(l||l===u)&&(m.value=-1,p.value=!1,h.value)){if(e.multiple){k(M(e,h.value));return}if(!w.value)return;r.value.some(v=>{let{title:s}=v;return s===h.value})?j.value="":k(M(e,h.value))}}),N(p,()=>{if(!e.hideSelected&&p.value&&r.value.length){const l=I.value.findIndex(u=>r.value.some(v=>e.valueComparator(v.value,u.value)));He&&window.requestAnimationFrame(()=>{var u;l>=0&&((u=U.value)==null||u.scrollToIndex(l))})}}),N(()=>e.items,(l,u)=>{p.value||P.value&&!u.length&&l.length&&(p.value=!0)}),ze(()=>{const l=!!(!e.hideNoData||I.value.length||c["prepend-item"]||c["append-item"]||c["no-data"]),u=r.value.length>0,v=_.filterProps(e);return t(_,D({ref:f},v,{modelValue:h.value,"onUpdate:modelValue":[s=>h.value=s,Fe],focused:P.value,"onUpdate:focused":s=>P.value=s,validationValue:r.externalValue,counterValue:Ve.value,dirty:u,class:["v-combobox",{"v-combobox--active-menu":p.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!w.value,"v-combobox--selecting-index":m.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:q.isReadonly.value,placeholder:u?void 0:e.placeholder,"onClick:clear":Ce,"onMousedown:control":ke,onKeydown:Ie}),{...c,default:()=>t(J,null,[t(We,D({ref:L,modelValue:p.value,"onUpdate:modelValue":s=>p.value=s,activator:"parent",contentClass:"v-combobox__content",disabled:Y.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Se,onAfterLeave:De},e.menuProps),{default:()=>[l&&t(Ze,D({ref:$,selected:xe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:s=>s.preventDefault(),onKeydown:je,onFocusin:_e,onFocusout:Te,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},Pe,e.listProps),{default:()=>{var s,d,x;return[(s=c["prepend-item"])==null?void 0:s.call(c),!I.value.length&&!e.hideNoData&&(((d=c["no-data"])==null?void 0:d.call(c))??t(se,{key:"no-data",title:o(e.noDataText)},null)),t(ml,{ref:U,renderless:!0,items:I.value},{default:S=>{var oe;let{item:b,index:F,itemRef:V}=S;const ae=D(b.props,{ref:V,key:b.value,active:X.value&&F===0?!0:void 0,onClick:()=>k(b,null)});return((oe=c.item)==null?void 0:oe.call(c,{item:b,index:F,props:ae}))??t(se,D(ae,{role:"option"}),{prepend:W=>{let{isSelected:Z}=W;return t(J,null,[e.multiple&&!e.hideSelected?t(bl,{key:b.value,modelValue:Z,ripple:!1,tabindex:"-1"},null):void 0,b.props.prependAvatar&&t(Ge,{image:b.props.prependAvatar},null),b.props.prependIcon&&t(re,{icon:b.props.prependIcon},null)])},title:()=>{var W,Z;return n.value?b.title:wl(b.title,(W=ye(b))==null?void 0:W.title,((Z=h.value)==null?void 0:Z.length)??0)}})}}),(x=c["append-item"])==null?void 0:x.call(c)]}})]}),r.value.map((s,d)=>{function x(V){V.stopPropagation(),V.preventDefault(),k(s,!1)}const S={"onClick:close":x,onKeydown(V){V.key!=="Enter"&&V.key!==" "||(V.preventDefault(),V.stopPropagation(),x(V))},onMousedown(V){V.preventDefault(),V.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},b=H.value?!!c.chip:!!c.selection,F=b?Je(H.value?c.chip({item:s,index:d,props:S}):c.selection({item:s,index:d})):void 0;if(!(b&&!F))return t("div",{key:s.value,class:["v-combobox__selection",d===m.value&&["v-combobox__selection--selected",be.value]],style:d===m.value?ge.value:{}},[H.value?c.chip?t(Qe,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:s.title}}},{default:()=>[F]}):t(me,D({key:"chip",closable:e.closableChips,size:"small",text:s.title,disabled:s.props.disabled},S),null):F??t("span",{class:"v-combobox__selection-text"},[s.title,e.multiple&&d<r.value.length-1&&t("span",{class:"v-combobox__selection-comma"},[R(",")])])])})]),"append-inner":function(){var S;for(var s=arguments.length,d=new Array(s),x=0;x<s;x++)d[x]=arguments[x];return t(J,null,[(S=c["append-inner"])==null?void 0:S.call(c,...d),(!e.hideNoData||e.items.length)&&e.menuIcon?t(re,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:we,onClick:Xe,"aria-label":o(le.value),title:o(le.value),tabindex:"-1"},null):void 0])}})}),Ye({isFocused:P,isPristine:n,menu:p,search:h,selectionIndex:m,filteredItems:z,select:k},f)}}),Sl={components:{Projects:de},data(){return{localuser:tl,projectstates:[{state:"私密",abbr:"private"},{state:"开源",abbr:"public"}],projecthistory:[{state:"关闭",abbr:"0"},{state:"开启",abbr:"1"}],searchstates:[{state:"所有",abbr:""},{state:"私密",abbr:"private"},{state:"开源",abbr:"public"}],typeitems:[{name:"所有",type:""},{name:"Scratch",type:"scratch"},{name:"Python",type:"python"}],orderitems:[{name:"观看量升序",type:"view_up"},{name:"观看量降序",type:"view_down"},{name:"时间升序",type:"time_up"},{name:"时间降序",type:"time_down"},{name:"序号升序",type:"id_up"},{name:"序号降序",type:"id_down"}],currentProjectID:0,dialog:!1,currentProject:{},previousProject:{},search:{title:"",type:"",description:"",source:"",order:"view_up",authorid:"",type:"",state:"",tag:""},aboutTags:{items:["动画","故事","音乐","硬核","艺术","水"],chips:B({}),selected:[]},url:""}},async created(){this.localuser.islogin==!1&&this.$router.push("/account/login"),await this.onPageChange()},setup(){al({title:"我的作品"})},methods:{removetag(e){chips.value.splice(chips.value.indexOf(e),1)},projecttypeProps(e){return{title:e.name,subtitle:e.department}},async onPageChange(e=1){this.url=`/searchapi?search_userid=${this.localuser.user.userid}&search_type=${this.search.type}&search_title=${this.search.title}&search_source=${this.search.source}&search_description=${this.search.description}&search_orderby=${this.search.order}&search_state=${this.search.state}&search_tag=${this.search.tag}`},resetSearch(){this.search={title:"",type:"scratch",description:"",source:"",order:"view_up",authorid:"",state:"public",tag:"",limit:20},this.onPageChange()},openinfo(e,a){this.currentProjectID=e,this.currentProject=a,this.previousProject={...a},this.aboutTags.chips=this.currentProject.tags.map(y=>y.name),this.dialog=!0},openpushpage(e){this.$router.push("/projects/"+e+"/push")},pushproject(e,a){ee({url:"/project/"+e+"/push",method:"post"}).then(y=>{console.log(y),this.$toast.add({severity:"info",summary:"info",detail:y.message,life:3e3}),this.onPageChange()}).catch(y=>{console.log(y),this.$toast.add({severity:"error",summary:"失败",detail:"失败",life:3e3})})},openedit(e,a){this.$toast.add({severity:"info",summary:"info",detail:`尝试打开${a.type}编辑器并编辑${e}号作品`,life:3e3}),Ae(e,a.type)},deleteProject(){this.$toast.add({severity:"error",summary:"info",detail:`尝试删除${this.currentProjectID}号作品`,life:3e3}),ee({url:"/project/"+this.currentProjectID,method:"delete"}).then(e=>{console.log(e),this.$toast.add({severity:"info",summary:"info",detail:e.message,life:3e3}),this.onPageChange(),this.dialog=!1}).catch(e=>{console.log(e),this.$toast.add({severity:"error",summary:"error",detail:"删除失败",life:3e3})})},SaveProjectsInfo(){this.currentProject.tags=this.aboutTags.chips.map(e=>e),ee({url:"/project/"+this.currentProjectID,method:"put",data:this.currentProject}).then(e=>{console.log(e),this.$toast.add({severity:"info",summary:"info",detail:e.message,life:3e3}),this.dialog=!1,this.onPageChange()}).catch(e=>{console.log(e),this.$toast.add({severity:"error",summary:"error",detail:"修改失败",life:3e3})})}}};function Dl(e,a,y,c,o,f){const P=de;return ol(),nl(kl,null,{default:i(()=>[t(ce,null,{default:i(()=>[t(g,{cols:"6"},{default:i(()=>[t(_,{label:"作品名 包含："+o.search.title,modelValue:o.search.title,"onUpdate:modelValue":a[0]||(a[0]=n=>o.search.title=n)},null,8,["label","modelValue"])]),_:1}),t(g,{cols:"6"},{default:i(()=>[t(_,{label:"作品描述 包含："+o.search.description,modelValue:o.search.description,"onUpdate:modelValue":a[1]||(a[1]=n=>o.search.description=n)},null,8,["label","modelValue"])]),_:1}),t(g,{cols:"6"},{default:i(()=>[t(_,{label:"作品内容 包含："+o.search.source,modelValue:o.search.source,"onUpdate:modelValue":a[2]||(a[2]=n=>o.search.source=n)},null,8,["label","modelValue"])]),_:1}),t(g,{cols:"6"},{default:i(()=>[t(_,{"control-variant":"用户ID",label:"用户ID 为："+o.search.authorid,modelValue:o.localuser.user.userid,"onUpdate:modelValue":a[3]||(a[3]=n=>o.localuser.user.userid=n),disabled:""},null,8,["label","modelValue"])]),_:1}),t(g,{cols:"3"},{default:i(()=>[t(O,{modelValue:o.search.order,"onUpdate:modelValue":a[4]||(a[4]=n=>o.search.order=n),items:o.orderitems,"item-title":"name","item-value":"type",label:"排序"},null,8,["modelValue","items"])]),_:1}),t(g,{cols:"3"},{default:i(()=>[t(O,{modelValue:o.search.type,"onUpdate:modelValue":a[5]||(a[5]=n=>o.search.type=n),items:o.typeitems,"item-title":"name","item-value":"type",label:"项目类型"},null,8,["modelValue","items"])]),_:1}),t(g,{cols:"3"},{default:i(()=>[t(O,{modelValue:o.search.state,"onUpdate:modelValue":a[6]||(a[6]=n=>o.search.state=n),items:o.searchstates,"item-title":"state","item-value":"abbr",label:"项目状态"},null,8,["modelValue","items"])]),_:1}),t(g,{cols:"3"},{default:i(()=>[t(pl,{label:"标签 为："+o.search.tag,items:["","动画","故事","音乐","硬核","艺术","水"],modelValue:o.search.tag,"onUpdate:modelValue":a[7]||(a[7]=n=>o.search.tag=n)},null,8,["label","modelValue"])]),_:1}),t(g,{cols:"12"},{default:i(()=>[t(A,{color:"primary",variant:"flat",rounded:"xl",onClick:a[8]||(a[8]=n=>f.onPageChange()),"append-icon":"mdi-magnify"},{default:i(()=>a[18]||(a[18]=[R("搜索")])),_:1}),t(A,{color:"",variant:"flat",rounded:"xl",onClick:a[9]||(a[9]=n=>{o.search.order="view_up",o.search.type="",o.search.authorid="",o.search.source="",o.search.description="",o.search.title="",o.search.state="public",f.onPageChange()})},{default:i(()=>a[19]||(a[19]=[R("重置")])),_:1})]),_:1})]),_:1}),a[23]||(a[23]=G("br",null,null,-1)),a[24]||(a[24]=G("br",null,null,-1)),t(P,{url:o.url,actions:[{name:"信息",function:f.openinfo},{name:"编辑",function:f.openedit},{name:"推送页",function:f.openpushpage}]},null,8,["url","actions"]),t(Cl,{modelValue:o.dialog,"onUpdate:modelValue":a[17]||(a[17]=n=>o.dialog=n),"max-width":"70vw",persistent:"",origin:"center center"},{default:i(()=>[t(ul,{"prepend-icon":"mdi-xml",title:"作品信息"},{default:i(()=>[t(sl,null,{default:i(()=>[t(ce,{dense:""},{default:i(()=>[t(g,{cols:"12",md:"12",sm:"12"},{default:i(()=>[t(_,{label:"标题",required:"",modelValue:o.currentProject.title,"onUpdate:modelValue":a[10]||(a[10]=n=>o.currentProject.title=n),hint:"将会在首页展示"},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",md:"12",sm:"12"},{default:i(()=>[t(hl,{hint:"介绍作品类型，玩法，并向对这个作品有帮助的人致谢！",label:"简介",modelValue:o.currentProject.description,"onUpdate:modelValue":a[11]||(a[11]=n=>o.currentProject.description=n)},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",sm:"6"},{default:i(()=>[t(O,{items:["scratch","python","text"],label:"类型",required:"",hint:"不建议你改",modelValue:o.currentProject.type,"onUpdate:modelValue":a[12]||(a[12]=n=>o.currentProject.type=n)},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",sm:"6"},{default:i(()=>[t(O,{modelValue:o.currentProject.state,"onUpdate:modelValue":a[13]||(a[13]=n=>o.currentProject.state=n),items:o.projectstates,"item-title":"state","item-value":"abbr",label:"项目状态",hint:"我们鼓励开源"},null,8,["modelValue","items"])]),_:1}),t(g,{cols:"12"},{default:i(()=>[t(Il,{modelValue:o.aboutTags.chips,"onUpdate:modelValue":a[14]||(a[14]=n=>o.aboutTags.chips=n),items:o.aboutTags.items,label:"标签","prepend-icon":"mdi-tag",variant:"solo",chips:"",multiple:""},{selection:i(({attrs:n,item:T,select:L,selected:U})=>[t(me,D(n,{"model-value":U,closable:"",onClick:L,"onClick:close":K=>f.removetag(T)}),{default:i(()=>[G("strong",null,ie(T.name),1),a[20]||(a[20]=R("  ")),a[21]||(a[21]=G("span",null,"(interest)",-1))]),_:2},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue","items"])]),_:1}),t(gl,null,{default:i(()=>[t(Vl,null,{default:i(()=>[t(yl,null,{default:i(()=>a[22]||(a[22]=[R("详细数据")])),_:1}),t(xl,null,{default:i(()=>[R(ie(o.currentProject),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(rl),t(il,null,{default:i(()=>[t(A,{color:"error",text:"删除",variant:"tonal",onClick:f.deleteProject},null,8,["onClick"]),t(A,{color:"text",text:"一键推送",variant:"tonal",onClick:a[15]||(a[15]=n=>f.pushproject(o.currentProject.id))}),t(Pl),t(A,{text:"取消",variant:"plain",onClick:a[16]||(a[16]=n=>o.dialog=!1)}),t(A,{color:"primary",text:"保存",variant:"tonal",onClick:f.SaveProjectsInfo},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Xl=ll(Sl,[["render",Dl]]);export{Xl as default};
