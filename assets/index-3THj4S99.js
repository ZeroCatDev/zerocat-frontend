import{_ as D,Y as m,o as i,N as l,e as a,Q as _,R as y,W as f,a9 as p,f as V,i as n,L as s,a3 as h,ad as C,c as x,F as j,U as k,ae as v,af as b,X as c,ag as N,$ as T,O as F,aA as B,aF as L,aB as U,aE as g,T as I,aG as S,aH as H,am as P,ak as q,al as z,M as A}from"./index-CqDYMkg5.js";import{V as w}from"./VSpacer-BmIOKXlY.js";import{V as E}from"./VSelect-ByyaaPA0.js";import"./VCheckboxBtn-8mXxa5va.js";import"./VSelectionControl-DLr9dD2N.js";const R={data(){return{project:{},branches:[],showNewBranchDialog:!1,showDeleteDialog:!1,branchToDelete:"",loading:!1,valid:!1,newBranch:{name:"",source:""}}},async mounted(){await this.initializeProject()},methods:{async initializeProject(){const o=this.$route.params.username,e=this.$route.params.projectname;if(o==="proxy"){this.$router.replace(`/app${this.$route.path}`);return}const u=await q(o,e);if(u.id===0){z.show404();return}this.project=u,await this.loadBranches(),A({title:`分支 · ${this.project.title}`})},async loadBranches(){const o=await P(this.project.id);this.branches=o.data||[]},async createBranch(){if(this.$refs.form.validate())try{this.loading=!0,await H(this.project.id,this.newBranch.name,this.newBranch.source),await this.loadBranches(),this.showNewBranchDialog=!1,this.newBranch.name="",this.newBranch.source=""}catch(o){console.error("创建分支失败:",o),alert("创建分支失败: "+(o.message||"未知错误"))}finally{this.loading=!1}},confirmDeleteBranch(o){this.branchToDelete=o,this.showDeleteDialog=!0},async deleteBranch(){try{this.loading=!0,await S(this.project.id,this.branchToDelete),await this.loadBranches(),this.showDeleteDialog=!1,this.branchToDelete=""}catch(o){console.error("删除分支失败:",o),alert("删除分支失败: "+(o.message||"未知错误"))}finally{this.loading=!1}}}},G={class:"text-caption"};function M(o,e,u,O,r,d){return i(),m(I,null,{default:l(()=>[a(_,null,{default:l(()=>[a(y,{cols:"12"},{default:l(()=>[a(f,null,{default:l(()=>[a(p,{class:"d-flex align-center"},{default:l(()=>[e[9]||(e[9]=V("span",null,"分支",-1)),a(w),a(n,{color:"primary","prepend-icon":"mdi-source-branch-plus",onClick:e[0]||(e[0]=t=>r.showNewBranchDialog=!0)},{default:l(()=>e[8]||(e[8]=[s("新建分支")])),_:1,__:[8]})]),_:1,__:[9]}),a(h,null,{default:l(()=>[a(C,null,{default:l(()=>[(i(!0),x(j,null,k(r.branches,t=>(i(),m(v,{key:t.name,value:t.name},{prepend:l(()=>[a(F,{color:t.name===r.project.default_branch?"primary":""},{default:l(()=>e[10]||(e[10]=[s("mdi-source-branch")])),_:2,__:[10]},1032,["color"])]),append:l(()=>[a(n,{variant:"text",to:`/${o.$route.params.username}/${o.$route.params.projectname}/tree/${t.name}`},{default:l(()=>e[11]||(e[11]=[s("查看")])),_:2,__:[11]},1032,["to"]),t.name!==r.project.default_branch?(i(),m(n,{key:0,variant:"text",color:"error",onClick:Q=>d.confirmDeleteBranch(t.name)},{default:l(()=>e[12]||(e[12]=[s("删除")])),_:2,__:[12]},1032,["onClick"])):T("",!0)]),default:l(()=>[a(b,null,{default:l(()=>[s(c(t.name),1)]),_:2},1024),a(N,null,{default:l(()=>[V("span",G,"最新提交: "+c(t.latest_commit_hash.substring(0,7)),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(B,{modelValue:r.showNewBranchDialog,"onUpdate:modelValue":e[5]||(e[5]=t=>r.showNewBranchDialog=t),"max-width":"500px"},{default:l(()=>[a(f,null,{default:l(()=>[a(p,null,{default:l(()=>e[13]||(e[13]=[s("新建分支")])),_:1,__:[13]}),a(h,null,{default:l(()=>[a(L,{ref:"form",modelValue:r.valid,"onUpdate:modelValue":e[3]||(e[3]=t=>r.valid=t)},{default:l(()=>[a(U,{modelValue:r.newBranch.name,"onUpdate:modelValue":e[1]||(e[1]=t=>r.newBranch.name=t),label:"分支名称",rules:[t=>!!t||"分支名称不能为空"],required:""},null,8,["modelValue","rules"]),a(E,{modelValue:r.newBranch.source,"onUpdate:modelValue":e[2]||(e[2]=t=>r.newBranch.source=t),items:r.branches,"item-title":"name","item-value":"name",label:"源分支",rules:[t=>!!t||"请选择源分支"],required:""},null,8,["modelValue","items","rules"])]),_:1},8,["modelValue"])]),_:1}),a(g,null,{default:l(()=>[a(w),a(n,{color:"primary",text:"",onClick:e[4]||(e[4]=t=>r.showNewBranchDialog=!1)},{default:l(()=>e[14]||(e[14]=[s("取消")])),_:1,__:[14]}),a(n,{color:"primary",onClick:d.createBranch,disabled:!r.valid,loading:r.loading},{default:l(()=>e[15]||(e[15]=[s("创建")])),_:1,__:[15]},8,["onClick","disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(B,{modelValue:r.showDeleteDialog,"onUpdate:modelValue":e[7]||(e[7]=t=>r.showDeleteDialog=t),"max-width":"500px"},{default:l(()=>[a(f,null,{default:l(()=>[a(p,null,{default:l(()=>e[16]||(e[16]=[s("删除分支")])),_:1,__:[16]}),a(h,null,{default:l(()=>[s(' 确定要删除分支 "'+c(r.branchToDelete)+'" 吗？此操作不可撤销。 ',1)]),_:1}),a(g,null,{default:l(()=>[a(w),a(n,{color:"primary",text:"",onClick:e[6]||(e[6]=t=>r.showDeleteDialog=!1)},{default:l(()=>e[17]||(e[17]=[s("取消")])),_:1,__:[17]}),a(n,{color:"error",onClick:d.deleteBranch,loading:r.loading},{default:l(()=>e[18]||(e[18]=[s("删除")])),_:1,__:[18]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Z=D(R,[["render",M]]);export{Z as default};
