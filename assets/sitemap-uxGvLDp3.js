import{_ as L,r as p,b as B,Y as F,o as N,N as a,e as l,W as v,a9 as _,f as H,i as C,L as t,a3 as V,Q as G,R as k,ad as R,ae as g,af as b,ag as c,X as i,O as U,bs as $,T as D,a1 as x}from"./index-CBVViWLW.js";import{V as E}from"./VSpacer-DSay_XwU.js";import{V as T}from"./VSwitch-BG3SrQPP.js";import"./VSelectionControl-CjtwrSH1.js";const M={__name:"sitemap",setup(O){const d=p(!1),m=p(!1),u=p({enabled:!1,autoUpdate:!1}),n=p({enabled:!1,autoUpdate:!1,updateCron:"",currentFileHash:"",lastFullUpdate:"",lastIncrementalUpdate:"",isGenerating:!1,isTaskScheduled:!1}),r=p({show:!1,text:"",color:"success"}),f=async()=>{d.value=!0;try{const s=await x.get("/admin/sitemap/status");if(s.status===200&&s.data.status==="success"){const e=s.data.data;n.value=e,u.value.enabled=e.enabled,u.value.autoUpdate=e.autoUpdate}}catch{w("加载状态失败")}d.value=!1},y=async()=>{d.value=!0;try{const s=await x.post("/admin/sitemap/settings",{enabled:u.value.enabled,autoUpdate:u.value.autoUpdate});s.status===200&&s.data.status==="success"&&(I("设置已更新"),f())}catch{w("保存设置失败"),f()}d.value=!1},S=async s=>{m.value=!0;try{const e=await x.post("/admin/sitemap/generate",{type:s});e.status===200&&e.data.status==="success"&&(I("站点地图生成成功"),f())}catch{w("生成站点地图失败")}m.value=!1},I=s=>{r.value={show:!0,text:s,color:"success"}},w=s=>{r.value={show:!0,text:s,color:"error"}};return B(()=>{f()}),(s,e)=>(N(),F(D,{fluid:""},{default:a(()=>[l(v,null,{default:a(()=>[l(_,{class:"d-flex align-center"},{default:a(()=>[e[6]||(e[6]=H("span",null,"站点地图管理",-1)),l(E),l(C,{color:"primary",onClick:f,loading:d.value,"prepend-icon":"mdi-refresh"},{default:a(()=>e[5]||(e[5]=[t(" 刷新 ")])),_:1,__:[5]},8,["loading"])]),_:1,__:[6]}),l(V,null,{default:a(()=>[l(G,null,{default:a(()=>[l(k,{cols:"12",md:"6"},{default:a(()=>[l(v,{variant:"outlined"},{default:a(()=>[l(_,null,{default:a(()=>e[7]||(e[7]=[t("基本设置")])),_:1,__:[7]}),l(V,null,{default:a(()=>[l(T,{modelValue:u.value.enabled,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.enabled=o),label:"启用站点地图",disabled:d.value,onChange:y},null,8,["modelValue","disabled"]),l(T,{modelValue:u.value.autoUpdate,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.autoUpdate=o),label:"启用自动更新",disabled:d.value||!u.value.enabled,onChange:y},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(v,{variant:"outlined"},{default:a(()=>[l(_,null,{default:a(()=>e[8]||(e[8]=[t("当前状态")])),_:1,__:[8]}),l(V,null,{default:a(()=>[l(R,null,{default:a(()=>[l(g,null,{prepend:a(()=>[l(U,{color:n.value.isGenerating?"warning":"success"},{default:a(()=>[t(i(n.value.isGenerating?"mdi-cog-sync":"mdi-check-circle"),1)]),_:1},8,["color"])]),default:a(()=>[l(b,null,{default:a(()=>e[9]||(e[9]=[t("生成状态")])),_:1,__:[9]}),l(c,null,{default:a(()=>[t(i(n.value.isGenerating?"正在生成中":"空闲"),1)]),_:1})]),_:1}),l(g,null,{prepend:a(()=>[l(U,null,{default:a(()=>e[10]||(e[10]=[t("mdi-clock-outline")])),_:1,__:[10]})]),default:a(()=>[l(b,null,{default:a(()=>e[11]||(e[11]=[t("最后全量更新")])),_:1,__:[11]}),l(c,null,{default:a(()=>[t(i(n.value.lastFullUpdate||"从未更新"),1)]),_:1})]),_:1}),l(g,null,{prepend:a(()=>[l(U,null,{default:a(()=>e[12]||(e[12]=[t("mdi-clock-outline")])),_:1,__:[12]})]),default:a(()=>[l(b,null,{default:a(()=>e[13]||(e[13]=[t("最后增量更新")])),_:1,__:[13]}),l(c,null,{default:a(()=>[t(i(n.value.lastIncrementalUpdate||"从未更新"),1)]),_:1})]),_:1}),l(g,null,{prepend:a(()=>[l(U,null,{default:a(()=>e[14]||(e[14]=[t("mdi-file-document-outline")])),_:1,__:[14]})]),default:a(()=>[l(b,null,{default:a(()=>e[15]||(e[15]=[t("当前文件哈希")])),_:1,__:[15]}),l(c,{class:"text-truncate"},{default:a(()=>[t(i(n.value.currentFileHash||"无"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(G,{class:"mt-4"},{default:a(()=>[l(k,null,{default:a(()=>[l(v,{variant:"outlined"},{default:a(()=>[l(_,null,{default:a(()=>e[16]||(e[16]=[t("手动生成")])),_:1,__:[16]}),l(V,null,{default:a(()=>[l(C,{color:"primary",loading:m.value,disabled:!u.value.enabled||n.value.isGenerating,class:"mr-2",onClick:e[2]||(e[2]=o=>S("full")),"prepend-icon":"mdi-refresh"},{default:a(()=>e[17]||(e[17]=[t(" 全量生成 ")])),_:1,__:[17]},8,["loading","disabled"]),l(C,{loading:m.value,disabled:!u.value.enabled||n.value.isGenerating,onClick:e[3]||(e[3]=o=>S("incremental")),"prepend-icon":"mdi-refresh"},{default:a(()=>e[18]||(e[18]=[t(" 增量更新 ")])),_:1,__:[18]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l($,{modelValue:r.value.show,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.show=o),color:r.value.color,timeout:3e3},{default:a(()=>[t(i(r.value.text),1)]),_:1},8,["modelValue","color"])]),_:1}))}},j=L(M,[["__scopeId","data-v-679fa7ab"]]);export{j as default};
