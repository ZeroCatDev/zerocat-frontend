import{_ as K,Y as S,o as m,N as s,e as l,R as y,S as c,Z as _,af as w,L as a,P as d,a9 as V,ab as Q,a1 as B,a0 as N,a2 as U,a3 as D,a4 as x,ai as h,aj as T,ak as P,al as A,T as z,U as f,i as g,c as v,F as E,X as O,O as $,f as R,D as ss,W as ls,b6 as ts,b7 as j,r as q,b as es,b8 as C,eY as as,b9 as b,eZ as os,e_ as ns,e$ as is}from"./index-DHBb6a3D.js";import{V as J}from"./VTextarea-BjrHIGag.js";import"https://static.geetest.com/v4/gt4.js";const rs={name:"NotificationDebugPage",setup(){const r=ts(),t=j({browser:"Unknown",os:"Unknown"}),u=j({permission:!1,subscription:!1,serverTest:!1,notifications:!1,unreadCount:!1,subscriptions:!1,markAllRead:!1}),o=q([]),p=q([]),i=(e,L,I=null)=>{p.value.unshift({level:e,message:L,data:I,timestamp:new Date().toLocaleTimeString()}),p.value.length>100&&(p.value=p.value.slice(0,100))},n=(e,L,I=!0)=>{o.value.unshift({title:e,data:L,success:I,timestamp:new Date().toLocaleTimeString()}),o.value.length>10&&(o.value=o.value.slice(0,10))},k=e=>{switch(e){case"granted":return"success";case"denied":return"error";default:return"warning"}},F=async()=>{u.permission=!0;try{const e=await C.requestPermission();await r.loadPushStatus(),i("success",`权限请求成功: ${e}`),b(`权限已${e==="granted"?"授予":"拒绝"}`,"success")}catch(e){i("error","权限请求失败",e),b(e.message||"权限请求失败","error")}finally{u.permission=!1}},Y=async()=>{u.subscription=!0;try{if(r.pushStatus.subscribed)await C.unsubscribe(),i("success","取消订阅成功"),b("已取消推送订阅","success");else{const e=await C.subscribe();i("success","订阅成功",e),b("推送订阅成功","success")}await r.loadPushStatus()}catch(e){i("error","订阅操作失败",e),b(e.message||"订阅操作失败","error")}finally{u.subscription=!1}},Z=async()=>{u.serverTest=!0;try{const e=await is();i("success","服务器测试通知发送成功",e),n("服务器测试通知",e),b("服务器测试通知已发送","success")}catch(e){i("error","服务器测试通知发送失败",e),n("服务器测试通知",e,!1),b(e.message||"服务器测试失败","error")}finally{u.serverTest=!1}},M=async()=>{u.notifications=!0;try{const e=await ns();i("success","获取通知列表成功",e),n("通知列表",e)}catch(e){i("error","获取通知列表失败",e),n("通知列表",e,!1)}finally{u.notifications=!1}},W=async()=>{u.unreadCount=!0;try{const e=await os();i("success","获取未读数量成功",e),n("未读数量",e)}catch(e){i("error","获取未读数量失败",e),n("未读数量",e,!1)}finally{u.unreadCount=!1}},X=async()=>{u.subscriptions=!0;try{const e=await C.getServerSubscriptions();i("success","获取订阅列表成功",e),n("订阅列表",e)}catch(e){i("error","获取订阅列表失败",e),n("订阅列表",e,!1)}finally{u.subscriptions=!1}},G=async()=>{u.markAllRead=!0;try{const e=await as();i("success","标记全部已读成功",e),n("标记全部已读",e),b("所有通知已标记为已读","success")}catch(e){i("error","标记全部已读失败",e),n("标记全部已读",e,!1)}finally{u.markAllRead=!1}},H=()=>{p.value=[],o.value=[],i("info","日志已清空")};return es(async()=>{i("info","调试页面初始化"),await r.loadPushStatus();const e=C.getDeviceInfo();Object.assign(t,e)}),{deviceInfo:t,loading:u,apiResponses:o,logs:p,getPermissionColor:k,requestPermission:F,toggleSubscription:Y,sendTestNotification,sendServerTestNotification:Z,fetchNotifications:M,fetchUnreadCount:W,fetchSubscriptions:X,markAllAsRead:G,clearLogs:H,...r}}},us={class:"console-container"},ds={class:"log-timestamp"},fs={class:"log-level"},cs={class:"log-message"},ms={key:0,class:"log-data"},gs={key:0,class:"text-center py-4 text-grey"};function bs(r,t,u,o,p,i){return m(),S(ls,null,{default:s(()=>[l(y,null,{default:s(()=>[l(c,{cols:"12"},{default:s(()=>[l(_,null,{default:s(()=>[l(w,null,{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[0]||(t[0]=[a("mdi-bug",-1)])]),_:1}),t[1]||(t[1]=a(" 通知系统调试面板 ",-1))]),_:1}),l(V,null,{default:s(()=>[l(Q,{type:"info",class:"mb-4"},{default:s(()=>[...t[2]||(t[2]=[a(" 此页面仅用于开发和调试目的，包含各种通知功能的测试工具。 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(y,null,{default:s(()=>[l(c,{cols:"12",md:"6"},{default:s(()=>[l(_,null,{default:s(()=>[l(w,null,{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[3]||(t[3]=[a("mdi-web",-1)])]),_:1}),t[4]||(t[4]=a(" 浏览器推送调试 ",-1))]),_:1}),l(V,null,{default:s(()=>[l(B,{variant:"accordion",class:"mb-4"},{default:s(()=>[l(U,null,{default:s(()=>[l(D,null,{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[5]||(t[5]=[a("mdi-information",-1)])]),_:1}),t[6]||(t[6]=a(" 系统状态 ",-1))]),_:1}),l(x,null,{default:s(()=>[l(h,{density:"compact"},{default:s(()=>[l(T,null,{default:s(()=>[l(P,null,{default:s(()=>[...t[7]||(t[7]=[a("浏览器支持",-1)])]),_:1}),l(A,null,{default:s(()=>[l(z,{color:r.pushStatus.supported?"success":"error",size:"small"},{default:s(()=>[a(f(r.pushStatus.supported?"支持":"不支持"),1)]),_:1},8,["color"])]),_:1})]),_:1}),l(T,null,{default:s(()=>[l(P,null,{default:s(()=>[...t[8]||(t[8]=[a("通知权限",-1)])]),_:1}),l(A,null,{default:s(()=>[l(z,{color:o.getPermissionColor(r.pushStatus.permission),size:"small"},{default:s(()=>[a(f(r.pushStatus.permission),1)]),_:1},8,["color"])]),_:1})]),_:1}),l(T,null,{default:s(()=>[l(P,null,{default:s(()=>[...t[9]||(t[9]=[a("订阅状态",-1)])]),_:1}),l(A,null,{default:s(()=>[l(z,{color:r.pushStatus.subscribed?"success":"warning",size:"small"},{default:s(()=>[a(f(r.pushStatus.subscribed?"已订阅":"未订阅"),1)]),_:1},8,["color"])]),_:1})]),_:1}),l(T,null,{default:s(()=>[l(P,null,{default:s(()=>[...t[10]||(t[10]=[a("设备信息",-1)])]),_:1}),l(A,null,{default:s(()=>[a(f(o.deviceInfo.browser)+" / "+f(o.deviceInfo.os),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r.pushStatus.subscription?(m(),S(U,{key:0},{default:s(()=>[l(D,null,{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[11]||(t[11]=[a("mdi-code-json",-1)])]),_:1}),t[12]||(t[12]=a(" 订阅详情 ",-1))]),_:1}),l(x,null,{default:s(()=>[l(J,{"model-value":JSON.stringify(r.pushStatus.subscription,null,2),readonly:"",variant:"outlined",rows:"10",class:"code-textarea"},null,8,["model-value"])]),_:1})]),_:1})):N("",!0)]),_:1}),l(y,null,{default:s(()=>[l(c,{cols:"12",sm:"6"},{default:s(()=>[l(g,{block:"",color:"primary",loading:o.loading.permission,onClick:o.requestPermission},{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[13]||(t[13]=[a("mdi-shield-check",-1)])]),_:1}),t[14]||(t[14]=a(" 请求权限 ",-1))]),_:1},8,["loading","onClick"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:s(()=>[l(g,{block:"",color:r.pushStatus.subscribed?"error":"success",loading:o.loading.subscription,onClick:o.toggleSubscription},{default:s(()=>[l(d,{start:""},{default:s(()=>[a(f(r.pushStatus.subscribed?"mdi-bell-off":"mdi-bell"),1)]),_:1}),a(" "+f(r.pushStatus.subscribed?"取消订阅":"订阅推送"),1)]),_:1},8,["color","loading","onClick"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:s(()=>[l(g,{block:"",color:"warning",loading:o.loading.serverTest,onClick:o.sendServerTestNotification},{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[15]||(t[15]=[a("mdi-server",-1)])]),_:1}),t[16]||(t[16]=a(" 测试服务器推送 ",-1))]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",md:"6"},{default:s(()=>[l(_,null,{default:s(()=>[l(w,null,{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[17]||(t[17]=[a("mdi-api",-1)])]),_:1}),t[18]||(t[18]=a(" API调试 ",-1))]),_:1}),l(V,null,{default:s(()=>[l(y,null,{default:s(()=>[l(c,{cols:"12"},{default:s(()=>[l(g,{block:"",color:"primary",loading:o.loading.notifications,onClick:o.fetchNotifications,class:"mb-2"},{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[19]||(t[19]=[a("mdi-download",-1)])]),_:1}),t[20]||(t[20]=a(" 获取通知列表 ",-1))]),_:1},8,["loading","onClick"])]),_:1}),l(c,{cols:"12"},{default:s(()=>[l(g,{block:"",color:"success",loading:o.loading.unreadCount,onClick:o.fetchUnreadCount,class:"mb-2"},{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[21]||(t[21]=[a("mdi-counter",-1)])]),_:1}),t[22]||(t[22]=a(" 获取未读数量 ",-1))]),_:1},8,["loading","onClick"])]),_:1}),l(c,{cols:"12"},{default:s(()=>[l(g,{block:"",color:"info",loading:o.loading.subscriptions,onClick:o.fetchSubscriptions,class:"mb-2"},{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[23]||(t[23]=[a("mdi-devices",-1)])]),_:1}),t[24]||(t[24]=a(" 获取订阅列表 ",-1))]),_:1},8,["loading","onClick"])]),_:1}),l(c,{cols:"12"},{default:s(()=>[l(g,{block:"",color:"warning",loading:o.loading.markAllRead,onClick:o.markAllAsRead,class:"mb-2"},{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[25]||(t[25]=[a("mdi-check-all",-1)])]),_:1}),t[26]||(t[26]=a(" 标记全部已读 ",-1))]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),o.apiResponses.length>0?(m(),S(B,{key:0,variant:"accordion",class:"mt-4"},{default:s(()=>[(m(!0),v(E,null,O(o.apiResponses,(n,k)=>(m(),S(U,{key:k},{default:s(()=>[l(D,null,{default:s(()=>[l(d,{start:"",color:n.success?"success":"error"},{default:s(()=>[a(f(n.success?"mdi-check":"mdi-alert"),1)]),_:2},1032,["color"]),a(" "+f(n.title)+" - "+f(n.timestamp),1)]),_:2},1024),l(x,null,{default:s(()=>[l(J,{"model-value":JSON.stringify(n.data,null,2),readonly:"",variant:"outlined",rows:"8",class:"code-textarea"},null,8,["model-value"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(y,null,{default:s(()=>[l(c,{cols:"12"},{default:s(()=>[l(_,null,{default:s(()=>[l(w,null,{default:s(()=>[l(d,{start:""},{default:s(()=>[...t[27]||(t[27]=[a("mdi-console",-1)])]),_:1}),t[28]||(t[28]=a(" 控制台日志 ",-1)),l($),l(g,{icon:"mdi-delete",size:"small",color:"error",onClick:o.clearLogs},null,8,["onClick"])]),_:1}),l(V,null,{default:s(()=>[R("div",us,[(m(!0),v(E,null,O(o.logs,(n,k)=>(m(),v("div",{key:k,class:ss(["log-entry",`log-${n.level}`])},[R("span",ds,f(n.timestamp),1),R("span",fs,"["+f(n.level.toUpperCase())+"]",1),R("span",cs,f(n.message),1),n.data?(m(),v("pre",ms,f(JSON.stringify(n.data,null,2)),1)):N("",!0)],2))),128)),o.logs.length===0?(m(),v("div",gs," 暂无日志 ")):N("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const vs=K(rs,[["render",bs],["__scopeId","data-v-ae50f336"]]);export{vs as default};
