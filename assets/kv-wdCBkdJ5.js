import{a6 as _,_ as X,r as s,b as ee,Y as ae,o as le,N as l,e as a,R,S as E,f as h,i as v,L as u,aG as K,Z as F,U as g,m as te,aF as z,af as M,a9 as Y,aK as oe,aI as se,aJ as j,O as q,aY as ne,W as re}from"./index-GWdhxD4_.js";import{V as ue}from"./VDataTableServer-DJmk1OLP.js";import{V as ie}from"./VTooltip-DCChnZ8Y.js";import{V as de}from"./VTextarea-Bgv-dRtA.js";import"https://static.geetest.com/v4/gt4.js";import"./VDataTable-ZFfJLEDM.js";import"./VTable-BvkZqM60.js";import"./filter-Dk4gp4Rx.js";async function A(i){var r;try{return(await _.get(`/cachekv/${encodeURIComponent(i)}`)).data}catch(n){if(((r=n.response)==null?void 0:r.status)===404)return;throw n}}async function ce(i,r){return(await _.post(`/cachekv/${encodeURIComponent(i)}`,r)).data.data}async function ve(i){var r;try{return await _.delete(`/cachekv/${encodeURIComponent(i)}`),!0}catch(n){if(((r=n.response)==null?void 0:r.status)===404)return!1;throw n}}async function me({page:i=1,limit:r=20,showValue:n=!1,total:V=!1}={}){const f=await _.get("/cachekv",{params:{page:i,limit:r,showValue:n,total:V}});return{items:f.data.data,pagination:f.data.pagination}}const fe={class:"font-weight-medium"},pe={class:"value-preview"},ye={class:"value-full"},ge={__name:"kv",setup(i){const r=[{title:"缓存键",key:"key",sortable:!0},{title:"缓存值",key:"value",sortable:!1},{title:"操作",key:"actions",sortable:!1,align:"end"}],n=s([]),V=s(!1),f=s(!1),U=s(!1),k=s(""),w=s(!1),x=s(!1),p=s(null),D=s(null),O=s(null),b=s(1),I=s(10),S=s(0),N=s([]),m=s({show:!1,text:"",color:"success"}),d=s({key:"",value:""});async function G(t){b.value=t.page,I.value=t.itemsPerPage,N.value=t.sortBy,await C()}async function C(){var t,e,o,y;V.value=!0;try{if(k.value.trim()){const c=await A(k.value.trim());n.value=[{columns:{key:k.value.trim(),value:c}}],S.value=1}else{const c=await me({page:b.value,limit:I.value,showValue:!0,sortField:(e=(t=N.value)==null?void 0:t[0])==null?void 0:e.key,sortOrder:(y=(o=N.value)==null?void 0:o[0])==null?void 0:y.order,total:!0});n.value=c.items.map(H=>({columns:H})),S.value=c.pagination.total,b.value=c.pagination.page,I.value=c.pagination.limit}}catch(c){$("Failed to load items"),console.error("Error loading items:",c),n.value=[],S.value=0}finally{V.value=!1}}function T(t){try{if(typeof t=="string"){const e=JSON.parse(t);return JSON.stringify(e,null,2)}return JSON.stringify(t,null,2)}catch{return t}}async function B(){if(O.value.validate()){f.value=!0;try{const t=d.value.value;let e;try{e=JSON.parse(t)}catch{e=t}await ce(d.value.key,e),P(p.value?"Item updated successfully":"Item created successfully"),J(),C()}catch(t){$("Failed to save item"),console.error("Error saving item:",t)}finally{f.value=!1}}}function L(t){p.value=t,d.value={key:t.key,value:T(t.value)},w.value=!0}function Q(t){D.value=t,x.value=!0}async function W(){if(D.value){U.value=!0;try{await ve(D.value),P("Item deleted successfully"),x.value=!1,C()}catch(t){$("Failed to delete item"),console.error("Error deleting item:",t)}finally{U.value=!1}}}function J(){w.value=!1,p.value=null,d.value={key:"",value:""}}function P(t){m.value={show:!0,text:t,color:"success"}}function $(t){m.value={show:!0,text:t,color:"error"}}function Z(){b.value=1,C()}return ee(async()=>{C(),console.log(await A("ces1_d9978c65"))}),(t,e)=>(le(),ae(re,null,{default:l(()=>[a(R,{class:"mb-4"},{default:l(()=>[a(E,{class:"d-flex justify-space-between align-center",cols:"12"},{default:l(()=>[e[10]||(e[10]=h("h1",{class:"text-h4"},"缓存管理",-1)),a(v,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>w.value=!0)},{default:l(()=>[...e[9]||(e[9]=[u(" 创建缓存 ",-1)])]),_:1})]),_:1})]),_:1}),a(R,{class:"mb-4"},{default:l(()=>[a(E,{cols:"12",sm:"6"},{default:l(()=>[a(K,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),clearable:"",density:"comfortable","hide-details":"",label:"缓存键",placeholder:"输入缓存键以读取特定缓存","prepend-inner-icon":"mdi-key",variant:"outlined",onInput:Z},null,8,["modelValue"])]),_:1})]),_:1}),a(F,null,{default:l(()=>[a(ue,{headers:r,items:n.value,"items-length":S.value,"items-per-page":I.value,"items-per-page-options":[10,25,50,100],loading:V.value,page:b.value,class:"elevation-1","onUpdate:options":G},{"item.key":l(({item:o})=>[h("div",fe,g(o.columns.key),1)]),"item.value":l(({item:o})=>[a(ie,{location:"bottom"},{activator:l(({props:y})=>[h("div",te({class:"text-truncate",style:{"max-width":"300px"}},y),[h("pre",pe,g(T(o.columns.value)),1)],16)]),default:l(()=>[h("pre",ye,g(T(o.columns.value)),1)]),_:2},1024)]),"item.actions":l(({item:o})=>[a(v,{color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:y=>L(o.columns)},null,8,["onClick"]),a(v,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:y=>Q(o.columns.key)},null,8,["onClick"])]),_:1},8,["items","items-length","items-per-page","loading","page"])]),_:1}),a(z,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=o=>w.value=o),"max-width":"600px"},{default:l(()=>[a(F,null,{default:l(()=>[a(M,{class:"text-h5 pa-4"},{default:l(()=>[u(g(p.value?"编辑缓存":"创建缓存"),1)]),_:1}),a(Y,{class:"pa-4"},{default:l(()=>[a(oe,{ref_key:"form",ref:O,onSubmit:se(B,["prevent"])},{default:l(()=>[a(K,{modelValue:d.value.key,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.key=o),readonly:!!p.value,rules:[o=>!!o||"Key is required"],class:"mb-4",label:"缓存键",variant:"outlined"},null,8,["modelValue","readonly","rules"]),a(de,{modelValue:d.value.value,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.value=o),hint:"支持 JSON 格式",rules:[o=>!!o||"缓存值是必填的"],class:"font-monospace",label:"缓存值","persistent-hint":"",rows:"8",variant:"outlined"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),a(j,{class:"pa-4"},{default:l(()=>[a(q),a(v,{variant:"text",onClick:J},{default:l(()=>[...e[11]||(e[11]=[u(" 取消 ",-1)])]),_:1}),a(v,{loading:f.value,color:"primary",onClick:B},{default:l(()=>[u(g(p.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(z,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value=o),"max-width":"400px"},{default:l(()=>[a(F,null,{default:l(()=>[a(M,{class:"text-h5 pa-4"},{default:l(()=>[...e[12]||(e[12]=[u(" 确认删除 ",-1)])]),_:1}),a(Y,{class:"pa-4"},{default:l(()=>[...e[13]||(e[13]=[u(" 确定要删除这个缓存吗？此操作无法撤销。 ",-1)])]),_:1}),a(j,{class:"pa-4"},{default:l(()=>[a(q),a(v,{variant:"text",onClick:e[5]||(e[5]=o=>x.value=!1)},{default:l(()=>[...e[14]||(e[14]=[u(" 取消 ",-1)])]),_:1}),a(v,{loading:U.value,color:"error",onClick:W},{default:l(()=>[...e[15]||(e[15]=[u(" 删除 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ne,{modelValue:m.value.show,"onUpdate:modelValue":e[8]||(e[8]=o=>m.value.show=o),color:m.value.color,timeout:3e3},{actions:l(()=>[a(v,{variant:"text",onClick:e[7]||(e[7]=o=>m.value.show=!1)},{default:l(()=>[...e[16]||(e[16]=[u(" 关闭 ",-1)])]),_:1})]),default:l(()=>[u(g(m.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},Se=X(ge,[["__scopeId","data-v-34ba04c1"]]);export{Se as default};
