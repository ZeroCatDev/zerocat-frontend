import{_ as G,ac as H,Y as O,o as J,N as l,e,Q as K,R as P,W as b,a9 as x,L as i,i as s,O as m,X as d,S as F,aA as I,$ as L,a3 as _,ah as Z,ai as S,a6 as $,a7 as w,ad as h,ae as c,af as g,ag as V,f as U,aF as ee,aB as le,aE as p,T as ae,r as u,b as te,a1 as q}from"./index-CD7vfFJn.js";import{V as D}from"./VSpacer-46C6LS8S.js";import{V as oe}from"./VDataTable-BvZn8toR.js";import{V as ie}from"./VSelect-CajQH1Py.js";import{V as ne}from"./VTextarea-DNSQVqVM.js";import"./VCheckboxBtn-Bt6AjPyr.js";import"./VSelectionControl-BCgSGn4C.js";import"./VTable-BHdCsNAU.js";import"./filter-FGazsIlh.js";const de={name:"CodeRunAdmin",setup(){const N=u([]),a=u(!1),f=u(null),t=u(!1),C=u(!1),k=u(!1),r=u(0),o=u(!1),v=u(!1),y=u({request_url:"",status:"",device_config:""}),B=[{title:"设备名称",value:"device_name"},{title:"设备ID",value:"id"},{title:"请求地址",value:"request_url"},{title:"状态",value:"status"},{title:"最后报告",value:"last_report"},{title:"操作",value:"actions",sortable:!1}],R=["active","inactive","error"],T=async()=>{a.value=!0;try{const n=await q.get("/admin/coderun/devices");n.data.success&&(N.value=n.data.devices)}catch(n){console.error("Failed to fetch devices:",n)}finally{a.value=!1}},A=n=>{f.value=n,t.value=!0},W=n=>{f.value=n,y.value={request_url:n.request_url||"",status:n.status||"active",device_config:JSON.stringify(n.device_config||{},null,2)},C.value=!0},E=n=>{f.value=n,k.value=!0},M=async()=>{o.value=!0;try{const n={...y.value,device_config:JSON.parse(y.value.device_config)};(await q.put(`/admin/coderun/devices/${f.value.id}`,n)).data.success&&(await T(),C.value=!1)}catch(n){console.error("Failed to save device config:",n)}finally{o.value=!1}},Q=async()=>{v.value=!0;try{(await q.delete(`/admin/coderun/devices/${f.value.id}`)).data.success&&(await T(),k.value=!1)}catch(n){console.error("Failed to delete device:",n)}finally{v.value=!1}},X=n=>{switch(n){case"active":return"success";case"error":return"error";default:return"warning"}},Y=n=>n?new Date(n).toLocaleString():"未知",j=n=>{try{return n&&JSON.parse(n),!0}catch{return"请输入有效的 JSON 格式"}};return te(()=>{T()}),{devices:N,loading:a,headers:B,selectedDevice:f,detailsDialog:t,configDialog:C,deleteDialog:k,activeTab:r,editConfig:y,statusOptions:R,saving:o,deleting:v,refreshDevices:T,openDeviceDetails:A,openDeviceConfig:W,confirmDelete:E,saveDeviceConfig:M,deleteDevice:Q,getStatusColor:X,formatDateTime:Y,validateJson:j}}};function ue(N,a,f,t,C,k){const r=H("v-list-item-content");return J(),O(ae,{fluid:""},{default:l(()=>[e(K,null,{default:l(()=>[e(P,{cols:"12"},{default:l(()=>[e(b,null,{default:l(()=>[e(x,{class:"d-flex align-center"},{default:l(()=>[a[13]||(a[13]=i(" CodeRun 设备管理 ")),e(D),e(s,{color:"primary",onClick:t.refreshDevices,loading:t.loading},{default:l(()=>[e(m,{left:""},{default:l(()=>a[11]||(a[11]=[i("mdi-refresh")])),_:1,__:[11]}),a[12]||(a[12]=i(" 刷新 "))]),_:1,__:[12]},8,["onClick","loading"])]),_:1,__:[13]}),e(oe,{headers:t.headers,items:t.devices,loading:t.loading,"items-per-page":10,class:"elevation-1"},{"item.status":l(({item:o})=>[e(F,{color:t.getStatusColor(o.status),small:""},{default:l(()=>[i(d(o.status),1)]),_:2},1032,["color"])]),"item.last_report":l(({item:o})=>[i(d(t.formatDateTime(o.last_report)),1)]),"item.actions":l(({item:o})=>[e(s,{icon:"",small:"",onClick:v=>t.openDeviceDetails(o)},{default:l(()=>[e(m,null,{default:l(()=>a[14]||(a[14]=[i("mdi-eye")])),_:1,__:[14]})]),_:2},1032,["onClick"]),e(s,{icon:"",small:"",onClick:v=>t.openDeviceConfig(o)},{default:l(()=>[e(m,null,{default:l(()=>a[15]||(a[15]=[i("mdi-cog")])),_:1,__:[15]})]),_:2},1032,["onClick"]),e(s,{icon:"",small:"",color:"error",onClick:v=>t.confirmDelete(o)},{default:l(()=>[e(m,null,{default:l(()=>a[16]||(a[16]=[i("mdi-delete")])),_:1,__:[16]})]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1}),e(I,{modelValue:t.detailsDialog,"onUpdate:modelValue":a[3]||(a[3]=o=>t.detailsDialog=o),"max-width":"800px"},{default:l(()=>[t.selectedDevice?(J(),O(b,{key:0},{default:l(()=>[e(x,null,{default:l(()=>[i(" 设备详情: "+d(t.selectedDevice.device_name)+" ",1),e(D),e(s,{icon:"",onClick:a[0]||(a[0]=o=>t.detailsDialog=!1)},{default:l(()=>[e(m,null,{default:l(()=>a[17]||(a[17]=[i("mdi-close")])),_:1,__:[17]})]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(Z,{modelValue:t.activeTab,"onUpdate:modelValue":a[1]||(a[1]=o=>t.activeTab=o)},{default:l(()=>[e(S,{value:"basic-info"},{default:l(()=>a[18]||(a[18]=[i("基本信息")])),_:1,__:[18]}),e(S,{value:"docker-info"},{default:l(()=>a[19]||(a[19]=[i("Docker 信息")])),_:1,__:[19]}),e(S,{value:"system-info"},{default:l(()=>a[20]||(a[20]=[i("系统信息")])),_:1,__:[20]}),e(S,{value:"runtime-info"},{default:l(()=>a[21]||(a[21]=[i("运行时信息")])),_:1,__:[21]})]),_:1},8,["modelValue"]),e($,{modelValue:t.activeTab,"onUpdate:modelValue":a[2]||(a[2]=o=>t.activeTab=o)},{default:l(()=>[e(w,{value:"basic-info"},{default:l(()=>[e(h,null,{default:l(()=>[e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[22]||(a[22]=[i("设备 ID")])),_:1,__:[22]}),e(V,null,{default:l(()=>[i(d(t.selectedDevice.id),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[23]||(a[23]=[i("设备名称")])),_:1,__:[23]}),e(V,null,{default:l(()=>[i(d(t.selectedDevice.device_name),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[24]||(a[24]=[i("状态")])),_:1,__:[24]}),e(V,null,{default:l(()=>[e(F,{color:t.getStatusColor(t.selectedDevice.status),small:""},{default:l(()=>[i(d(t.selectedDevice.status),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[25]||(a[25]=[i("创建时间")])),_:1,__:[25]}),e(V,null,{default:l(()=>[i(d(t.formatDateTime(t.selectedDevice.created_at)),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[26]||(a[26]=[i("最后更新")])),_:1,__:[26]}),e(V,null,{default:l(()=>[i(d(t.formatDateTime(t.selectedDevice.updated_at)),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[27]||(a[27]=[i("最后报告")])),_:1,__:[27]}),e(V,null,{default:l(()=>[i(d(t.formatDateTime(t.selectedDevice.last_report)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{value:"docker-info"},{default:l(()=>[e(_,null,{default:l(()=>[U("pre",null,d(JSON.stringify(t.selectedDevice.docker_info,null,2)),1)]),_:1})]),_:1}),e(w,{value:"system-info"},{default:l(()=>[e(_,null,{default:l(()=>[U("pre",null,d(JSON.stringify(t.selectedDevice.system_info,null,2)),1)]),_:1})]),_:1}),e(w,{value:"runtime-info"},{default:l(()=>[e(_,null,{default:l(()=>[U("pre",null,d(JSON.stringify(t.selectedDevice.coderun_info,null,2)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):L("",!0)]),_:1},8,["modelValue"]),e(I,{modelValue:t.configDialog,"onUpdate:modelValue":a[8]||(a[8]=o=>t.configDialog=o),"max-width":"600px"},{default:l(()=>[t.selectedDevice?(J(),O(b,{key:0},{default:l(()=>[e(x,null,{default:l(()=>[i(" 设备配置: "+d(t.selectedDevice.device_name)+" ",1),e(D),e(s,{icon:"",onClick:a[4]||(a[4]=o=>t.configDialog=!1)},{default:l(()=>[e(m,null,{default:l(()=>a[28]||(a[28]=[i("mdi-close")])),_:1,__:[28]})]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(ee,{ref:"configForm"},{default:l(()=>[e(le,{modelValue:t.editConfig.request_url,"onUpdate:modelValue":a[5]||(a[5]=o=>t.editConfig.request_url=o),label:"请求 URL",required:""},null,8,["modelValue"]),e(ie,{modelValue:t.editConfig.status,"onUpdate:modelValue":a[6]||(a[6]=o=>t.editConfig.status=o),items:t.statusOptions,label:"状态",required:""},null,8,["modelValue","items"]),e(ne,{modelValue:t.editConfig.device_config,"onUpdate:modelValue":a[7]||(a[7]=o=>t.editConfig.device_config=o),label:"设备配置 (JSON)",rows:"10",rules:[t.validateJson]},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(p,null,{default:l(()=>[e(D),e(s,{color:"primary",onClick:t.saveDeviceConfig,loading:t.saving},{default:l(()=>a[29]||(a[29]=[i(" 保存 ")])),_:1,__:[29]},8,["onClick","loading"])]),_:1})]),_:1})):L("",!0)]),_:1},8,["modelValue"]),e(I,{modelValue:t.deleteDialog,"onUpdate:modelValue":a[10]||(a[10]=o=>t.deleteDialog=o),"max-width":"400px"},{default:l(()=>[e(b,null,{default:l(()=>[e(x,null,{default:l(()=>a[30]||(a[30]=[i("确认删除")])),_:1,__:[30]}),e(_,null,{default:l(()=>{var o;return[i(' 确定要删除设备 "'+d((o=t.selectedDevice)==null?void 0:o.device_name)+'" 吗？此操作无法撤销。 ',1)]}),_:1}),e(p,null,{default:l(()=>[e(D),e(s,{text:"",onClick:a[9]||(a[9]=o=>t.deleteDialog=!1)},{default:l(()=>a[31]||(a[31]=[i(" 取消 ")])),_:1,__:[31]}),e(s,{color:"error",onClick:t.deleteDevice,loading:t.deleting},{default:l(()=>a[32]||(a[32]=[i(" 删除 ")])),_:1,__:[32]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const De=G(de,[["render",ue],["__scopeId","data-v-3a22804c"]]);export{De as default};
