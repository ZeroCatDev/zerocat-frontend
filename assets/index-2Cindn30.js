import{_ as k,b2 as v,b3 as w,c as y,o as V,e as a,N as n,aF as R,aD as L,Q as S,R as d,aB as C,i as u,f as M,b4 as B,r as p,ab as z,M as A,b5 as D}from"./index-DmjUHmS9.js";import{_ as b}from"./AuthCard-GTSMpBHm.js";import"https://static.geetest.com/v4/gt4.js";const F={components:{LoadingDialog:w,Recaptcha:v,AuthCard:b},setup(){const _=B(),l=p(null),i=p(""),e=p(!1),c=p(!1),f=[t=>!!t||"必须填写邮箱",t=>/.+@.+\..+/.test(t)||"不符合格式"];z.isLogin.value===!0&&_.push("/app/dashboard"),A({title:"魔术链接登录"});const m=async()=>{var t,o,h;if(!i.value||!/.+@.+\..+/.test(i.value)){s("请输入正确的邮箱地址");return}if(!c.value){e.value=!0;try{const r=(t=l.value)==null?void 0:t.getResponse();if(!r){s("请完成人机验证"),e.value=!1;return}const x=await D.generateMagicLink(i.value,window.location.origin+"/app/account/magiclink/validate",r);x.status==="success"?(g("登录链接已发送到您的邮箱"),c.value=!0):s(x.message||"发送失败")}catch(r){s(((h=(o=r.response)==null?void 0:o.data)==null?void 0:h.message)||r.message)}finally{e.value=!1}}},g=t=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"success",summary:"成功",detail:t,life:3e3})},s=t=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"error",summary:"错误",detail:t,life:3e3})};return{email:i,loading:e,linkSent:c,recaptcha:l,emailRules:f,sendMagicLink:m}}},N={class:"d-flex flex-wrap justify-start gap-2"};function T(_,l,i,e,c,f){const m=v,g=b,s=w;return V(),y("div",null,[a(g,{subtitle:"魔术链接登录"},{default:n(()=>[a(R,{onSubmit:L(e.sendMagicLink,["prevent"])},{default:n(()=>[a(S,null,{default:n(()=>[a(d,{cols:"12"},{default:n(()=>[a(C,{modelValue:e.email,"onUpdate:modelValue":l[0]||(l[0]=t=>e.email=t),rules:e.emailRules,label:"邮箱",type:"text",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12"},{default:n(()=>[a(m,{ref:"recaptcha",recaptchaId:"recaptcha-div"},null,512)]),_:1}),a(d,{cols:"12"},{default:n(()=>[a(u,{disabled:e.linkSent,loading:e.loading,text:e.linkSent?"已发送，请检查邮箱":"发送登录链接","append-icon":"mdi-arrow-right",class:"text-none",color:"primary",rounded:"xl",size:"large",variant:"flat",onClick:e.sendMagicLink},null,8,["disabled","loading","text","onClick"])]),_:1}),a(d,{cols:"12"},{default:n(()=>[M("div",N,[a(u,{"append-icon":"mdi-arrow-right",class:"text-none",color:"white",rounded:"xl",size:"large",text:"密码登录",to:"/app/account/login",variant:"text"}),a(u,{"append-icon":"mdi-arrow-right",class:"text-none",color:"white",rounded:"xl",size:"large",text:"注册",to:"/app/account/register",variant:"text"}),a(u,{"append-icon":"mdi-arrow-right",class:"text-none",color:"white",rounded:"xl",size:"large",text:"找回密码",to:"/app/account/retrieve",variant:"text"})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),a(s,{show:e.loading,text:"处理中"},null,8,["show"])])}const I=k(F,[["render",T]]);export{I as default};
