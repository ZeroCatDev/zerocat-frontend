import{_ as T,Y as m,o as r,N as t,e as s,$ as p,W as b,n as A,bR as I,aU as S,S as k,L as n,a9 as V,X as u,aW as z,Q as g,R as x,aE as B,i as _,a3 as w,aB as Q,O as y,f as o,c as h,F as D,U as P,bC as N,aA as j,Z as M,a4 as H,T as R,a1 as q,aa as W,M as Z}from"./index-DtKAxHsk.js";import{V as U}from"./VSelect-CLC6V_6T.js";import{V as X}from"./VSkeletonLoader-BDJ78-d6.js";import{V as O}from"./VSpacer-CFVqpMjn.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-g1l4zUQ2.js";import"./VSelectionControl-DMoYNkco.js";const Y={name:"ExtensionCard",props:{extension:{type:Object,required:!0},s3BucketUrl:{type:String,required:!0}},computed:{extensionTags(){var i;return(i=this.extension.project)!=null&&i.tags?Array.isArray(this.extension.project.tags)?this.extension.project.tags:[]:[]}},emits:["view-extension","open-docs"]};function G(i,e,c,E,l,d){return r(),m(b,{class:"box-shadow",rounded:"lg"},{default:t(()=>[s(b,{to:"/app/extensions/"+c.extension.id,rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:t(()=>[s(A,{src:c.extension.image?c.s3BucketUrl+"/material/asset/"+c.extension.image+".png":"",class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":I},{default:t(()=>[s(S,null,{default:t(()=>[s(k,{size:"small",color:"primary",variant:"tonal"},{default:t(()=>e[0]||(e[0]=[n(" 扩展 ",-1)])),_:1,__:[0]}),s(V,null,{default:t(()=>{var v;return[n(u(((v=c.extension)==null?void 0:v.name)||"加载中..."),1)]}),_:1}),s(z,null,{default:t(()=>{var v;return[n(u(((v=c.extension)==null?void 0:v.description)||""),1)]}),_:1})]),_:1})]),_:1},8,["src"])]),_:1},8,["to"]),c.extension.author?(r(),m(S,{key:0,"append-avatar":c.extension.author.avatar?c.s3BucketUrl+"/user/"+c.extension.author.avatar:""},{default:t(()=>[s(V,null,{default:t(()=>[n(u(c.extension.author.display_name||c.extension.author.username||"未知用户"),1)]),_:1}),s(z,null,{default:t(()=>[n(u(c.extension.author.username||""),1)]),_:1})]),_:1},8,["append-avatar"])):p("",!0)]),_:1})}const L=T(Y,[["render",G],["__scopeId","data-v-4e3eb411"]]),J={name:"ExtensionsMarket",components:{ExtensionCard:L},setup(){Z({title:"扩展市场 - ZeroCat"})},data(){return{loading:!1,extensions:[],currentPage:1,totalPages:1,totalCount:0,limit:20,searchQuery:"",sortBy:"created_at",sortOrder:"desc",activeFilters:{search:"",sort:"created_at",order:"desc",scratchCompatible:null},s3BucketUrl:"",showDetailDialog:!1,selectedExtension:null,showDocsDialog:!1,docsLoading:!1,docsContent:"",sortOptions:[{title:"最新发布",value:"created_at"},{title:"最近更新",value:"updated_at"},{title:"星标数",value:"stars"},{title:"查看数",value:"views"},{title:"点赞数",value:"likes"},{title:"综合排序",value:"popularity"},{title:"名称排序",value:"name"},{title:"作者排序",value:"author"}],orderOptions:[{title:"降序",value:"desc"},{title:"升序",value:"asc"}],searchTimeout:null,scratchCompatibleFilter:null,scratchCompatibleOptions:[{title:"所有",value:null},{title:"兼容原版Scratch",value:!0},{title:"不兼容原版Scratch",value:!1}]}},computed:{hasActiveFilters(){return Object.values(this.activeFilters).some(i=>i!==""&&i!==null&&i!==void 0)},selectedExtensionTags(){var i,e;return(e=(i=this.selectedExtension)==null?void 0:i.project)!=null&&e.tags?Array.isArray(this.selectedExtension.project.tags)?this.selectedExtension.project.tags:[]:[]},activeFiltersCount(){let i=0;return this.searchQuery&&i++,this.scratchCompatibleFilter!==null&&i++,i}},async created(){this.s3BucketUrl=await W("s3.staticurl"),await this.fetchExtensions()},methods:{async fetchExtensions(){var i,e,c,E;this.loading=!0;try{const l={page:this.currentPage,limit:this.limit,...this.activeFilters},d=await q.get("/extensions/marketplace",{params:l});(i=d.data)!=null&&i.data&&(this.extensions=d.data.data.extensions||[],this.totalCount=((e=d.data.data.pagination)==null?void 0:e.total)||0,this.totalPages=((c=d.data.data.pagination)==null?void 0:c.total_pages)||1,this.currentPage=((E=d.data.data.pagination)==null?void 0:E.page)||1)}catch(l){console.error("Failed to fetch extensions:",l),this.extensions=[],this.totalCount=0,this.totalPages=1}finally{this.loading=!1}},handleSearch(){this.activeFilters.search=this.searchQuery,this.currentPage=1,this.fetchExtensions()},handleFilterChange(){this.activeFilters.scratchCompatible=this.scratchCompatibleFilter,this.currentPage=1,this.fetchExtensions()},handleSortChange(){this.activeFilters.sort=this.sortBy,this.activeFilters.order=this.sortOrder,this.currentPage=1,this.fetchExtensions()},resetFilters(){this.searchQuery="",this.scratchCompatibleFilter=null,this.sortBy="created_at",this.sortOrder="desc",this.activeFilters={search:"",sort:"created_at",order:"desc",scratchCompatible:null},this.currentPage=1,this.fetchExtensions()},handlePageChange(i){this.currentPage=i,this.fetchExtensions()},resetAllFilters(){this.activeFilters={search:"",sort:"created_at",order:"desc",scratchCompatible:null},this.currentPage=1,this.fetchExtensions()},viewExtension(i){this.selectedExtension=i,this.showDetailDialog=!0},async openDocs(i){this.showDocsDialog=!0,this.docsLoading=!0,this.docsContent="";try{await new Promise(e=>setTimeout(e,1e3)),this.docsContent=`
          <div class="docs-content">
            <h2>${i.name} 扩展文档</h2>
            <p>这里是 <strong>${i.name}</strong> 扩展的使用文档。</p>
            <p><strong>文档路径:</strong> ${i.docs_url||"暂无"}</p>
            <p>要查看完整文档，请访问扩展的项目页面。</p>

            <h3>使用说明</h3>
            <p>1. 下载扩展文件</p>
            <p>2. 将扩展文件放入项目的扩展目录</p>
            <p>3. 在项目中使用扩展功能</p>

            <h3>示例代码</h3>
            <pre><code>// 示例代码将在这里显示
// 请访问项目页面查看完整示例</code></pre>
          </div>
        `}catch(e){console.error("Failed to load docs:",e),this.docsContent=""}finally{this.docsLoading=!1}}}},K={class:"d-flex align-center"},$={class:"text-body-2"},ee={key:0,class:"ml-2"},te={class:"text-body-1 text-grey mt-2"},se={class:"mt-2 text-caption text-grey-darken-1"},le={key:0},ne={class:"flex-grow-1"},oe={class:"text-h5 font-weight-bold"},ie={class:"text-subtitle-1 text-grey-darken-1"},ae={class:"text-body-1 mb-4"},re={class:"text-center"},de={class:"text-h6 font-weight-bold text-amber"},ue={class:"text-center"},ce={class:"text-h6 font-weight-bold text-green"},me={class:"text-center"},fe={class:"text-h6 font-weight-bold text-red"},xe={key:0,class:"mb-4"},pe={class:"mb-4"},ge={class:"text-caption text-grey mt-1"},he={key:1,class:"mb-4"},_e={class:"d-flex justify-center gap-4"},ye={key:0,class:"text-center py-8"},ve=["innerHTML"],be={key:2,class:"text-center py-8 text-grey"};function Ce(i,e,c,E,l,d){const v=L;return r(),m(R,null,{default:t(()=>[s(g,null,{default:t(()=>[s(x,{cols:"12"},{default:t(()=>[s(b,{class:"mb-4"},{default:t(()=>[s(S,{"prepend-icon":"mdi-puzzle"},{default:t(()=>[s(V,null,{default:t(()=>e[11]||(e[11]=[n(" 扩展市场 ",-1)])),_:1,__:[11]}),s(z,null,{default:t(()=>e[12]||(e[12]=[n(" 发现和使用社区开发的扩展来增强您的项目功能 ",-1)])),_:1,__:[12]})]),_:1}),s(B,null,{default:t(()=>[s(_,{color:"primary",to:"/app/extensions/my"},{default:t(()=>e[13]||(e[13]=[n(" 我的扩展 ",-1)])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})]),_:1}),s(b,{variant:"flat",class:"mb-4"},{default:t(()=>[s(w,null,{default:t(()=>[s(g,null,{default:t(()=>[s(x,{cols:"12",md:"4"},{default:t(()=>[s(Q,{modelValue:l.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchQuery=a),label:"搜索扩展","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"",density:"compact",onInput:d.handleSearch,onClear:d.handleSearch},null,8,["modelValue","onInput","onClear"])]),_:1}),s(x,{cols:"12",md:"2"},{default:t(()=>[s(U,{modelValue:l.scratchCompatibleFilter,"onUpdate:modelValue":[e[1]||(e[1]=a=>l.scratchCompatibleFilter=a),d.handleFilterChange],items:l.scratchCompatibleOptions,label:"Scratch兼容性",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(x,{cols:"12",md:"3"},{default:t(()=>[s(U,{modelValue:l.sortBy,"onUpdate:modelValue":[e[2]||(e[2]=a=>l.sortBy=a),d.handleSortChange],items:l.sortOptions,label:"排序方式",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(x,{cols:"12",md:"3"},{default:t(()=>[s(U,{modelValue:l.sortOrder,"onUpdate:modelValue":[e[3]||(e[3]=a=>l.sortOrder=a),d.handleSortChange],items:l.orderOptions,label:"排序方向",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1}),s(g,null,{default:t(()=>[s(x,{cols:"12",class:"text-center"},{default:t(()=>[s(_,{variant:"outlined",color:"grey",size:"small",onClick:d.resetFilters,class:"mr-2"},{default:t(()=>[s(y,{start:""},{default:t(()=>e[14]||(e[14]=[n("mdi-refresh",-1)])),_:1,__:[14]}),e[15]||(e[15]=n(" 重置筛选 ",-1))]),_:1,__:[15]},8,["onClick"]),d.activeFiltersCount>0?(r(),m(k,{key:0,color:"primary",variant:"outlined",size:"small"},{default:t(()=>[n(u(d.activeFiltersCount)+" 个筛选条件 ",1)]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),!l.loading&&l.extensions.length>0?(r(),m(g,{key:0},{default:t(()=>[s(x,{cols:"12"},{default:t(()=>[s(b,{variant:"flat",class:"mb-4"},{default:t(()=>[s(w,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",K,[s(y,{class:"mr-2",color:"primary"},{default:t(()=>e[16]||(e[16]=[n("mdi-information",-1)])),_:1,__:[16]}),o("span",$,[e[17]||(e[17]=n(" 共找到 ",-1)),o("strong",null,u(l.totalCount),1),e[18]||(e[18]=n(" 个扩展 ",-1)),l.activeFilters.search?(r(),h("span",ee,' (搜索: "'+u(l.activeFilters.search)+'") ',1)):p("",!0)])])]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0),s(g,null,{default:t(()=>[s(x,{cols:"12"},{default:t(()=>[l.loading?(r(),m(g,{key:0},{default:t(()=>[(r(),h(D,null,P(12,a=>s(x,{key:a,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[s(X,{type:"card",class:"extension-skeleton"})]),_:2},1024)),64))]),_:1})):l.extensions.length===0?(r(),m(g,{key:1},{default:t(()=>[s(x,{cols:"12",class:"text-center py-16"},{default:t(()=>[s(y,{size:"80",color:"grey-lighten-1"},{default:t(()=>e[19]||(e[19]=[n("mdi-puzzle-outline",-1)])),_:1,__:[19]}),e[21]||(e[21]=o("h2",{class:"text-h5 mt-4 text-grey-darken-1"},"暂无扩展",-1)),o("p",te,u(d.hasActiveFilters?"没有找到匹配的扩展":"扩展市场暂时为空"),1),d.hasActiveFilters?(r(),m(_,{key:0,variant:"outlined",color:"primary",class:"mt-4",onClick:d.resetAllFilters},{default:t(()=>e[20]||(e[20]=[n(" 清除所有筛选条件 ",-1)])),_:1,__:[20]},8,["onClick"])):p("",!0)]),_:1,__:[21]})]),_:1})):(r(),m(g,{key:2},{default:t(()=>[(r(!0),h(D,null,P(l.extensions,a=>(r(),m(x,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[s(v,{extension:a,"s3-bucket-url":l.s3BucketUrl,onViewExtension:d.viewExtension,onOpenDocs:d.openDocs},null,8,["extension","s3-bucket-url","onViewExtension","onOpenDocs"])]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),!l.loading&&l.extensions.length>0?(r(),m(g,{key:1},{default:t(()=>[s(x,{cols:"12",class:"text-center"},{default:t(()=>[s(N,{modelValue:l.currentPage,"onUpdate:modelValue":[e[4]||(e[4]=a=>l.currentPage=a),d.handlePageChange],length:l.totalPages,"total-visible":7},null,8,["modelValue","length","onUpdate:modelValue"]),o("div",se,[n(" 第 "+u(l.currentPage)+" 页，共 "+u(l.totalPages)+" 页 ",1),l.totalCount>0?(r(),h("span",le," (每页 "+u(l.limit)+" 条，共 "+u(l.totalCount)+" 条) ",1)):p("",!0)])]),_:1})]),_:1})):p("",!0),s(j,{modelValue:l.showDetailDialog,"onUpdate:modelValue":e[7]||(e[7]=a=>l.showDetailDialog=a),"max-width":"900",persistent:""},{default:t(()=>[l.selectedExtension?(r(),m(b,{key:0},{default:t(()=>[s(V,{class:"d-flex align-center"},{default:t(()=>{var a,C;return[s(M,{class:"mr-3",size:"56"},{default:t(()=>[l.selectedExtension.image?(r(),m(A,{key:0,src:l.s3BucketUrl+"/extension/"+l.selectedExtension.image},null,8,["src"])):(r(),m(y,{key:1,size:"28",color:"primary"},{default:t(()=>e[22]||(e[22]=[n("mdi-puzzle",-1)])),_:1,__:[22]}))]),_:1}),o("div",ne,[o("div",oe,u(l.selectedExtension.name),1),o("div",ie," by "+u(((a=l.selectedExtension.author)==null?void 0:a.display_name)||((C=l.selectedExtension.author)==null?void 0:C.username)||"未知开发者"),1)]),s(_,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=F=>l.showDetailDialog=!1)})]}),_:1}),s(w,null,{default:t(()=>{var a,C,F;return[o("p",ae,u(l.selectedExtension.description),1),s(g,{class:"mb-4"},{default:t(()=>[s(x,{cols:"12",sm:"4"},{default:t(()=>{var f;return[o("div",re,[o("div",de,u(((f=l.selectedExtension.project)==null?void 0:f.star_count)||0),1),e[23]||(e[23]=o("div",{class:"text-caption text-grey-darken-1"},"星标",-1))])]}),_:1}),s(x,{cols:"12",sm:"4"},{default:t(()=>{var f;return[o("div",ue,[o("div",ce,u(((f=l.selectedExtension.project)==null?void 0:f.view_count)||0),1),e[24]||(e[24]=o("div",{class:"text-caption text-grey-darken-1"},"查看",-1))])]}),_:1}),s(x,{cols:"12",sm:"4"},{default:t(()=>{var f;return[o("div",me,[o("div",fe,u(((f=l.selectedExtension.project)==null?void 0:f.like_count)||0),1),e[25]||(e[25]=o("div",{class:"text-caption text-grey-darken-1"},"点赞",-1))])]}),_:1})]),_:1}),d.selectedExtensionTags.length>0?(r(),h("div",xe,[e[26]||(e[26]=o("h3",{class:"text-subtitle-1 mb-2"},"标签",-1)),(r(!0),h(D,null,P(d.selectedExtensionTags,f=>(r(),m(k,{key:f,class:"mr-2 mb-2",variant:"outlined",color:"primary"},{default:t(()=>[n(u(f),1)]),_:2},1024))),128))])):p("",!0),o("div",pe,[e[27]||(e[27]=o("h3",{class:"text-subtitle-1 mb-2"},"兼容性",-1)),s(k,{color:(a=l.selectedExtension)!=null&&a.scratchCompatible?"orange":"grey",variant:"outlined","prepend-icon":"mdi-puzzle"},{default:t(()=>{var f;return[n(u((f=l.selectedExtension)!=null&&f.scratchCompatible?"兼容原版Scratch":"不兼容原版Scratch"),1)]}),_:1},8,["color"]),o("p",ge,u((C=l.selectedExtension)!=null&&C.scratchCompatible?"此扩展可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)]),l.selectedExtension.sample_project?(r(),h("div",he,[e[28]||(e[28]=o("h3",{class:"text-subtitle-1 mb-2"},"示例项目",-1)),s(k,{class:"mr-2 mb-2",variant:"outlined",color:"blue"},{default:t(()=>[n(u(l.selectedExtension.sample_project),1)]),_:1})])):p("",!0),o("div",_e,[s(_,{color:"primary",size:"large",href:(F=l.selectedExtension.project)==null?void 0:F.url,target:"_blank"},{default:t(()=>[s(y,{start:""},{default:t(()=>e[29]||(e[29]=[n("mdi-open-in-new",-1)])),_:1,__:[29]}),e[30]||(e[30]=n(" 查看扩展项目 ",-1))]),_:1,__:[30]},8,["href"]),l.selectedExtension.has_docs?(r(),m(_,{key:0,color:"orange",size:"large",variant:"outlined",onClick:e[6]||(e[6]=f=>d.openDocs(l.selectedExtension))},{default:t(()=>[s(y,{start:""},{default:t(()=>e[31]||(e[31]=[n("mdi-book-open-variant",-1)])),_:1,__:[31]}),e[32]||(e[32]=n(" 查看文档 ",-1))]),_:1,__:[32]})):p("",!0)])]}),_:1})]),_:1})):p("",!0)]),_:1},8,["modelValue"]),s(j,{modelValue:l.showDocsDialog,"onUpdate:modelValue":e[10]||(e[10]=a=>l.showDocsDialog=a),"max-width":"1000",persistent:""},{default:t(()=>[s(b,null,{default:t(()=>[s(V,{class:"d-flex align-center"},{default:t(()=>[s(y,{class:"mr-2",color:"orange"},{default:t(()=>e[33]||(e[33]=[n("mdi-book-open-variant",-1)])),_:1,__:[33]}),e[34]||(e[34]=n(" 扩展文档 ",-1)),s(O),s(_,{icon:"mdi-close",variant:"text",onClick:e[8]||(e[8]=a=>l.showDocsDialog=!1)})]),_:1,__:[34]}),s(w,{style:{"max-height":"600px","overflow-y":"auto"}},{default:t(()=>[l.docsLoading?(r(),h("div",ye,[s(H,{indeterminate:"",color:"primary"}),e[35]||(e[35]=o("p",{class:"mt-4 text-grey-darken-1"},"加载文档中...",-1))])):l.docsContent?(r(),h("div",{key:1,innerHTML:l.docsContent},null,8,ve)):(r(),h("div",be,[s(y,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[36]||(e[36]=[n("mdi-file-document-outline",-1)])),_:1,__:[36]}),e[37]||(e[37]=o("p",{class:"text-h6 mt-4 text-grey-darken-1"},"无法加载文档内容",-1)),e[38]||(e[38]=o("p",{class:"text-body-2 text-grey"},"请访问扩展项目页面查看完整文档",-1))]))]),_:1}),s(B,null,{default:t(()=>[s(O),s(_,{onClick:e[9]||(e[9]=a=>l.showDocsDialog=!1)},{default:t(()=>e[39]||(e[39]=[n("关闭",-1)])),_:1,__:[39]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ue=T(J,[["render",Ce],["__scopeId","data-v-0f097f38"]]);export{Ue as default};
