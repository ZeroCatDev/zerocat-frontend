import{_ as X}from"./Comment-DtU16hLz.js";import{_ as Y}from"./Projects-DSPVi5kC.js";import{f as P,p as S,U as oe,n as Z,t as p,y as ne,s as re,i as I,a as i,W as x,X as de,E as ee,Y as te,B as ie,k as B,Z as se,u as ce,$ as me,R as ue,a0 as _e,a1 as w,A as ae,j as he,l as fe,a2 as ye,a3 as pe,a4 as ve,a5 as A,z as ge,a6 as Ce,a7 as xe,_ as be,c as C,o as r,w as a,a8 as ke,a9 as D,G as o,J as je,H as f,O as n,P as H,aa as Te,e as y,M as T,N as G,K as j,ab as z,ac as V,I as Ve,Q as J,T as we}from"./index-k4gPH1Df.js";import{g as De}from"./user-DMRBZstx.js";import{V as K,a as Q}from"./VRow-bRloVk-8.js";import{V as g}from"./VChip-C2n00A73.js";import{V as ze}from"./VContainer-CQTPAMSu.js";import"./VForm-CvX4t5l9.js";import"./VTextarea-Nili1ILe.js";import"./VDialog-BZAzYHc7.js";import"./showProjects-DB-dWfvI.js";import"./projectService-4F_CxuWV.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-9H0eLtap.js";/* empty css              */const Pe=S({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:se,iconColor:String,lineColor:String,...B(),...ie(),...te(),...ee()},"VTimelineDivider"),Se=P()({name:"VTimelineDivider",props:Pe(),setup(e,s){let{slots:c}=s;const{sizeClasses:v,sizeStyles:l}=oe(e,"v-timeline-divider__dot"),{backgroundColorStyles:u,backgroundColorClasses:_}=Z(p(e,"dotColor")),{roundedClasses:m}=ne(e,"v-timeline-divider__dot"),{elevationClasses:t}=re(e),{backgroundColorClasses:b,backgroundColorStyles:k}=Z(p(e,"lineColor"));return I(()=>i("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[i("div",{class:["v-timeline-divider__before",b.value],style:k.value},null),!e.hideDot&&i("div",{key:"dot",class:["v-timeline-divider__dot",t.value,m.value,v.value],style:l.value},[i("div",{class:["v-timeline-divider__inner-dot",_.value,m.value],style:u.value},[c.default?i(de,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},c.default):i(x,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),i("div",{class:["v-timeline-divider__after",b.value],style:k.value},null)])),{}}}),le=S({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:se,iconColor:String,lineInset:[Number,String],...B(),...he(),...ee(),...ie(),...te(),...ae()},"VTimelineItem"),Ie=P()({name:"VTimelineItem",props:le(),setup(e,s){let{slots:c}=s;const{dimensionStyles:v}=ce(e),l=me(0),u=ue();return _e(u,_=>{var m;_&&(l.value=((m=_.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:m.getBoundingClientRect().width)??0)},{flush:"post"}),I(()=>{var _,m;return i("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":w(l.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${w(e.lineInset)})`:w(0)},e.style]},[i("div",{class:"v-timeline-item__body",style:v.value},[(_=c.default)==null?void 0:_.call(c)]),i(Se,{ref:u,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:c.icon}),e.density!=="compact"&&i("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((m=c.opposite)==null?void 0:m.call(c))])])}),{}}}),Be=S({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...xe(le({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...B(),...Ce(),...ae(),...ge()},"VTimeline"),$e=P()({name:"VTimeline",props:Be(),setup(e,s){let{slots:c}=s;const{themeClasses:v}=fe(e),{densityClasses:l}=ye(e),{rtlClasses:u}=pe();ve({VTimelineDivider:{lineColor:p(e,"lineColor")},VTimelineItem:{density:p(e,"density"),dotColor:p(e,"dotColor"),fillDot:p(e,"fillDot"),hideOpposite:p(e,"hideOpposite"),iconColor:p(e,"iconColor"),lineColor:p(e,"lineColor"),lineInset:p(e,"lineInset"),size:p(e,"size")}});const _=A(()=>{const t=e.side?e.side:e.density!=="default"?"end":null;return t&&`v-timeline--side-${t}`}),m=A(()=>{const t=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return t;case"start":return t[0];case"end":return t[1];default:return null}});return I(()=>i(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,m.value,{"v-timeline--inset-line":!!e.lineInset},v.value,l.value,_.value,u.value,e.class],style:[{"--v-timeline-line-thickness":w(e.lineThickness)},e.style]},c)),{}}}),Le={components:{Projects:Y,Comment:X},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},currentPage:1,isLoadingMore:!1,pageSize:20,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},comment_create:{text:"发表了评论",label:"评论",color:"secondary"},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0}},fieldDisplayNames:{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await De(this.username),we({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await J({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(e=1){try{const s=await J.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});s.data.status==="success"&&(e===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(e){return e!=null&&e.length?e.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}},getTargetContent(e,s){if(!e)return"";switch(e.type){case"project":return e.title||`项目 #${e.id}`;case"user":return e.display_name||`用户 #${e.id}`;case"comment":return this.getCommentTargetContent(e,s);case"projectlist":return`项目列表 #${e.id}`;default:return`${e.type} #${e.id}`}},getCommentTargetContent(e,s){var l;if(!e.page&&!((l=e.page)!=null&&l.type))return`评论 #${e.id}`;const{type:c,id:v}=e.page||{};switch(c){case"project":return`在作品 ${e.title} 下的评论`;case"user":return`在用户 ${e.display_name} 主页下的评论`;default:return`在 ${c} #${v} 下的评论`}}}},Me={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},Re={class:"mt-2 text-body-1 text-medium-emphasis"},Ee={class:"mt-2 text-medium-emphasis"},Ne={class:"timeline-item-content"},Ue={class:"event-header mb-2"},Fe={class:"text-h6"},Oe={class:"project-info"},qe={class:"font-weight-medium"},We={class:"mt-2 text-caption text-medium-emphasis"},Ze={class:"d-flex align-center mb-2"},Ae={class:"font-weight-medium"},He={class:"rename-details text-body-2"},Ge={class:"d-flex align-center"},Je={class:"d-flex align-center mt-1"},Ke={class:"project-meta text-caption text-medium-emphasis mt-2"},Qe={class:"d-flex align-center mb-2"},Xe={class:"font-weight-medium"},Ye={class:"commit-message text-body-2"},et={class:"commit-hash text-caption text-medium-emphasis mt-1"},tt={key:2,class:"event-content pa-2"},it=["href"],st=["href"],at={key:2,class:"comment-text mt-2"},lt={key:1,class:"text-body-2"},ot={key:2,class:"text-body-2 text-medium-emphasis"},nt={class:"d-flex justify-center mt-4 mb-4"},rt={key:1,class:"text-medium-emphasis"};function dt(e,s,c,v,l,u){const _=Y,m=X;return r(),C(ze,null,{default:a(()=>[i(ke,{modelValue:l.tab,"onUpdate:modelValue":s[0]||(s[0]=t=>l.tab=t)},{default:a(()=>[i(D,{value:"home"},{default:a(()=>[i(je,{class:"mt-8"},{default:a(()=>[i(K,{class:"d-flex align-center"},{default:a(()=>[i(Q,null,{default:a(()=>[s[2]||(s[2]=o("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),o("p",Me,[f(n(l.user.display_name)+" ",1),i(H,{size:"52",class:"ma-2"},{default:a(()=>[i(Te,{src:"https://s4-1.wuyuan.1r.ink/user/"+l.user.images},null,8,["src"])]),_:1})]),o("p",Re,n(l.user.motto),1),o("p",Ee,[i(g,null,{default:a(()=>[i(x,{icon:"mdi-account-circle",start:""}),f(" ID:"+n(l.user.id),1)]),_:1}),i(g,null,{default:a(()=>[i(x,{icon:"mdi-clock",start:""}),f(" "+n(l.user.regTime)+"注册 ",1)]),_:1}),i(g,null,{default:a(()=>[i(x,{icon:"mdi-tag",start:""}),s[1]||(s[1]=f(" 创作者 "))]),_:1})])]),_:1})]),_:1})]),_:1}),s[3]||(s[3]=o("br",null,null,-1)),i(_,{url:l.url},null,8,["url"]),i(K,null,{default:a(()=>[(r(!0),y(T,null,G(l.lists,t=>(r(),C(Q,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:t.id},{default:a(()=>[i(j,{rounded:"lg"},{default:a(()=>[i(j,{to:"/app/projectlist/"+t.id,rounded:"lg",title:t.title,subtitle:t.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[4]||(s[4]=o("br",null,null,-1)),i(m,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1}),i(D,{value:"comment"},{default:a(()=>[i(m,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1}),i(D,{value:"timeline"},{default:a(()=>[i($e,{side:"end",align:"start",class:"mt-4"},{default:a(()=>[(r(!0),y(T,null,G(l.timeline.events,t=>(r(),C(Ie,{key:t.id,size:"small","dot-color":"primary"},{opposite:a(()=>[f(n(new Date(t.created_at).toLocaleString()),1)]),icon:a(()=>[i(H,{image:"https://s4-1.wuyuan.1r.ink/user/"+l.user.images},null,8,["image"])]),default:a(()=>{var b,k,$,L,M,R,E,N,U,F,O,q;return[o("div",Ne,[o("div",Ue,[o("h3",Fe,n(t.actor.display_name)+" "+n(((b=l.eventTypes[t.type])==null?void 0:b.text)||"进行了操作"),1),i(g,{size:"x-small",color:((k=l.eventTypes[t.type])==null?void 0:k.color)||"primary",class:"ml-2"},{default:a(()=>{var h;return[f(n(((h=l.eventTypes[t.type])==null?void 0:h.label)||t.type),1)]}),_:2},1032,["color"])]),($=l.eventTypes[t.type])!=null&&$.isProject&&!["project_rename","project_commit"].includes(t.type)?(r(),C(j,{key:0,class:"mb-3 project-event",to:`/app/link/project?id=${(L=t.target)==null?void 0:L.id}`},{default:a(()=>[i(z,null,{default:a(()=>{var h,d;return[o("div",Oe,[i(x,{icon:"mdi-source-repository",color:"primary",class:"mr-2"}),o("span",qe,n(((h=t.event_data)==null?void 0:h.project_name)||"未命名项目"),1),o("div",We,n((d=t.event_data)==null?void 0:d.project_description),1)])]}),_:2},1024)]),_:2},1032,["to"])):["project_rename","project_commit"].includes(t.type)?(r(),y(T,{key:1},[t.type==="project_rename"?(r(),C(j,{key:0,class:"rename-card mb-3",to:`/app/link/project?id=${(M=t.target)==null?void 0:M.id}`},{default:a(()=>[i(z,null,{default:a(()=>{var h;return[o("div",Ze,[i(x,{icon:"mdi-rename-box",color:"warning",class:"mr-2"}),o("span",Ae,n((h=t.event_data)==null?void 0:h.project_title),1)]),o("div",He,[o("div",Ge,[s[5]||(s[5]=o("span",{class:"text-medium-emphasis"},"从",-1)),i(g,{size:"small",class:"mx-2",color:"surface-variant"},{default:a(()=>{var d;return[f(n((d=t.event_data)==null?void 0:d.old_name),1)]}),_:2},1024)]),o("div",Je,[s[6]||(s[6]=o("span",{class:"text-medium-emphasis"},"到",-1)),i(g,{size:"small",class:"mx-2",color:"warning"},{default:a(()=>{var d;return[f(n((d=t.event_data)==null?void 0:d.new_name),1)]}),_:2},1024)])]),o("div",Ke,[i(g,{size:"x-small",class:"mr-1"},{default:a(()=>{var d;return[f(n((d=t.event_data)==null?void 0:d.project_type),1)]}),_:2},1024),i(g,{size:"x-small"},{default:a(()=>{var d;return[f(n((d=t.event_data)==null?void 0:d.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):t.type==="project_commit"?(r(),C(j,{key:1,class:"commit-card mb-3",to:`/app/link/project?id=${(R=t.target)==null?void 0:R.id}`},{default:a(()=>[i(z,null,{default:a(()=>{var h,d,W;return[o("div",Qe,[i(x,{icon:"mdi-source-commit",color:"info",class:"mr-2"}),o("span",Xe,"分支: "+n((h=t.event_data)==null?void 0:h.branch),1)]),o("div",Ye,n((d=t.event_data)==null?void 0:d.commit_message),1),o("div",et," 提交ID: "+n((W=t.event_data)==null?void 0:W.commit_id.substring(0,7)),1)]}),_:2},1024)]),_:2},1032,["to"])):V("",!0)],64)):(r(),y("div",tt,[t.type==="comment_create"?(r(),y(T,{key:0},[((E=t.target)==null?void 0:E.type)==="project"?(r(),y("a",{key:0,href:`/app/link/project?id=${t.target.id}#comment-${t.target.id}`,class:"text-decoration-none"}," 在作品「"+n(((N=t.event_data)==null?void 0:N.project_name)||`#${t.target.id}`)+"」中 ",9,it)):((U=t.target)==null?void 0:U.type)==="user"?(r(),y("a",{key:1,href:`/app/link/user?id=${t.target.id}#comment-${t.target.id}`,class:"text-decoration-none"}," 在用户「"+n(((F=t.event_data)==null?void 0:F.user_name)||`#${t.target.id}`)+"」主页中 ",9,st)):V("",!0),(O=t.event_data)!=null&&O.comment_text?(r(),y("p",at,n(t.event_data.comment_text),1)):V("",!0)],64)):t.type==="user_profile_update"?(r(),y("div",lt," 更新了："+n(u.getUpdatedFields((q=t.event_data)==null?void 0:q.updated_fields)),1)):(r(),y("div",ot,n(u.getTargetContent(t.target,t.type)),1))]))])]}),_:2},1024))),128))]),_:1}),o("div",nt,[u.hasMoreEvents?(r(),C(Ve,{key:0,loading:l.isLoadingMore,variant:"tonal",onClick:u.loadMoreEvents},{default:a(()=>s[7]||(s[7]=[f(" 加载更多 ")])),_:1},8,["loading","onClick"])):l.timeline.events.length>0?(r(),y("div",rt," 没有更多内容了 ")):V("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Tt=be(Le,[["render",dt],["__scopeId","data-v-56f1f873"]]);export{Tt as default};
