import{_ as w,a1 as a,ab as b,c as k,o as c,e as l,N as i,L as t,X as n,i as u,ad as V,Y as h,$ as m,ae as f,D as B,m as y,az as x,W as C,a9 as F,a3 as v,f as p,aE as S,aA as U,bJ as _}from"./index-CqDYMkg5.js";import{V as L}from"./VTextarea-BMQ0gWum.js";import{V as I}from"./VSpacer-BmIOKXlY.js";const R={name:"UserRelationControls",props:{userId:{type:Number,required:!0},username:{type:String,required:!0},displayName:{type:String,required:!0}},data(){return{isFollowing:!1,isBlocking:!1,followLoading:!1,blockLoading:!1,blockDialog:!1,blockReason:"",localuser:b,targetUsername:this.displayName||this.username,snackbar:{show:!1,text:"",color:"success"}}},mounted(){this.localuser.user.id&&this.checkRelationships()},watch:{userId:{handler(){this.checkRelationships()},immediate:!0}},methods:{async checkRelationships(){if(this.localuser.user.id)try{const e=await a.get(`/follows/relationships/${this.userId}`);if(e.data.success){const{isFollowing:s,isBlocking:g}=e.data.data;this.isFollowing=s,this.isBlocking=g}}catch(e){console.error("检查用户关系失败:",e)}},async toggleFollow(){if(!this.localuser.user.id){this.$router.push("/login");return}try{this.followLoading=!0,this.isFollowing?(await a.delete(`/follows/${this.userId}`),this.isFollowing=!1,this.showSnackbar(`已取消关注 ${this.targetUsername}`,"info")):(await a.post(`/follows/${this.userId}`),this.isFollowing=!0,this.showSnackbar(`已成功关注 ${this.targetUsername}`,"success"))}catch(e){console.error("关注操作失败:",e),this.showSnackbar(e.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.followLoading=!1}},toggleBlock(){if(!this.localuser.user.id){this.$router.push("/login");return}this.blockDialog=!0},async confirmBlockAction(){try{if(this.blockLoading=!0,this.isBlocking)await a.delete(`/follows/block/${this.userId}`),this.isBlocking=!1,this.showSnackbar(`已取消拉黑 ${this.targetUsername}`,"success");else{const e=this.blockReason?{reason:this.blockReason}:{};await a.post(`/follows/block/${this.userId}`,e),this.isBlocking=!0,this.isFollowing&&(await a.delete(`/follows/${this.userId}`),this.isFollowing=!1),this.showSnackbar(`已拉黑 ${this.targetUsername}`,"success")}this.blockDialog=!1,this.blockReason=""}catch(e){console.error("拉黑操作失败:",e),this.showSnackbar(e.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.blockLoading=!1}},sendMessage(){this.showSnackbar("私信功能即将上线","info")},reportUser(){this.showSnackbar("举报功能即将上线","info")},showSnackbar(e,s="success"){this.snackbar.text=e,this.snackbar.color=s,this.snackbar.show=!0}}},D={key:0},N={key:1};function A(e,s,g,T,o,d){return c(),k("div",null,[l(u,{loading:o.followLoading,variant:o.isFollowing?"outlined":"tonal",color:"primary","prepend-icon":o.isFollowing?"mdi-check":"mdi-account-plus",onClick:d.toggleFollow,rounded:"pill"},{default:i(()=>[t(n(o.isFollowing?"已关注":"关注"),1)]),_:1},8,["loading","variant","prepend-icon","onClick"]),l(x,{location:"bottom"},{activator:i(({props:r})=>[l(u,y({icon:"mdi-dots-vertical",variant:"text",size:"small",class:"ml-2"},r),null,16)]),default:i(()=>[l(V,{density:"compact",width:"150"},{default:i(()=>[l(f,{"prepend-icon":o.isBlocking?"mdi-account-cancel":"mdi-account-remove",title:o.isBlocking?"取消拉黑":"拉黑用户",class:B({"text-error":!o.isBlocking}),onClick:d.toggleBlock},null,8,["prepend-icon","title","class","onClick"]),o.isFollowing?(c(),h(f,{key:0,"prepend-icon":"mdi-account-remove",title:"取消关注",onClick:d.toggleFollow},null,8,["onClick"])):m("",!0)]),_:1})]),_:1}),l(U,{modelValue:o.blockDialog,"onUpdate:modelValue":s[2]||(s[2]=r=>o.blockDialog=r),"max-width":"400px"},{default:i(()=>[l(C,null,{default:i(()=>[l(F,{class:"text-h5 text-center pa-4"},{default:i(()=>[t(n(o.isBlocking?"取消拉黑用户":"拉黑用户"),1)]),_:1}),l(v,{class:"pa-4"},{default:i(()=>[o.isBlocking?(c(),k("p",D,[s[5]||(s[5]=t(" 确定要取消拉黑 ")),p("strong",null,n(o.targetUsername),1),s[6]||(s[6]=t(" 吗？取消拉黑后，该用户可以查看您的内容并与您互动。 "))])):(c(),k("p",N,[s[7]||(s[7]=t(" 确定要拉黑 ")),p("strong",null,n(o.targetUsername),1),s[8]||(s[8]=t(" 吗？拉黑后，该用户将无法关注您，也无法查看您的动态或与您互动。 "))])),o.isBlocking?m("",!0):(c(),h(L,{key:2,modelValue:o.blockReason,"onUpdate:modelValue":s[0]||(s[0]=r=>o.blockReason=r),label:"拉黑原因（可选）",placeholder:"请简要说明拉黑原因...",variant:"outlined",rows:"3",class:"mt-4","hide-details":""},null,8,["modelValue"]))]),_:1}),l(S,{class:"pa-4 pt-0"},{default:i(()=>[l(I),l(u,{variant:"text",onClick:s[1]||(s[1]=r=>o.blockDialog=!1)},{default:i(()=>s[9]||(s[9]=[t(" 取消 ")])),_:1,__:[9]}),l(u,{color:o.isBlocking?"primary":"error",loading:o.blockLoading,onClick:d.confirmBlockAction,variant:"tonal"},{default:i(()=>[t(n(o.isBlocking?"取消拉黑":"拉黑"),1)]),_:1},8,["color","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(_,{modelValue:o.snackbar.show,"onUpdate:modelValue":s[4]||(s[4]=r=>o.snackbar.show=r),color:o.snackbar.color,timeout:3e3},{actions:i(()=>[l(u,{variant:"text",onClick:s[3]||(s[3]=r=>o.snackbar.show=!1)},{default:i(()=>s[10]||(s[10]=[t(" 关闭 ")])),_:1,__:[10]})]),default:i(()=>[t(n(o.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const M=w(R,[["render",A]]);export{M as _};
