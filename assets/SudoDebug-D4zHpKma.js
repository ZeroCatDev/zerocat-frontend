import{aZ as U,b7 as H,r as T,b as J,a5 as E,c as $,o as k,e,M as l,f as B,X as x,$ as I,Y as _,ae as c,L as t,a8 as p,i as f,S as M,aB as r,O as Q,T as m,j as X,U as j,_ as Z,x as z,eP as G,Q as q,R as y,b0 as D,ah as K,ai as P,aj as L,ak as R,aA as W,aa as h,aY as ee,F as le}from"./index-3iUuPb_9.js";import{V as se}from"./VTextarea-BfezW_TO.js";import"https://static.geetest.com/v4/gt4.js";const ae={class:"sudo-example"},te={__name:"SudoExample",setup(F){const o=U(),d=H({basic:!1,optional:!1,api:!1,auto:!1}),n=T(null),C=async()=>{d.basic=!0,n.value=null;try{const u=await o.requireSudo({title:"删除重要数据",subtitle:"此操作不可逆，请验证您的身份",persistent:!0});n.value={success:!0,message:"获取到sudo token",token:u.substring(0,20)+"...",action:"模拟执行了需要sudo权限的操作"},console.log("执行需要sudo权限的操作，token:",u)}catch(u){n.value={success:!1,message:u.message,type:u.type}}finally{d.basic=!1}},w=()=>{n.value={isValid:o.isSudoValid(),token:o.getSudoToken(),expiresIn:o.tokenExpiresIn,expiresAt:o.expiresAt,formattedTime:o.formatTime(o.tokenExpiresIn)}},S=()=>{o.clearSudo(),n.value={success:!0,message:"Sudo token已清除"}},b=async()=>{d.api=!0,n.value=null;try{const u=await o.requireSudo({title:"API操作认证",subtitle:"此API调用需要管理员权限"}),s=o.addSudoToRequest({method:"delete",url:"/admin/users/123",data:{reason:"违规操作"}});console.log("发送带有sudo token的请求:",s),n.value={success:!0,message:"模拟API请求成功",requestConfig:s}}catch(u){n.value={success:!1,message:u.message}}finally{d.api=!1}},v=async()=>{var u;d.auto=!0,n.value=null;try{const s=await E({method:"post",url:"/admin/settings",data:{setting:"important_config",value:"new_value"},requireSudo:!0});n.value={success:!0,message:"自动处理sudo的API请求成功",data:s.data}}catch(s){n.value={success:!1,message:s.message,details:(u=s.response)==null?void 0:u.data}}finally{d.auto=!1}};return J(()=>{o.createSudoInterceptor(E)}),(u,s)=>(k(),$("div",ae,[e(j,null,{default:l(()=>[s[9]||(s[9]=B("h2",null,"Sudo管理系统使用示例",-1)),e(_,{class:"mb-4"},{default:l(()=>[e(c,null,{default:l(()=>s[0]||(s[0]=[t("基本用法",-1)])),_:1,__:[0]}),e(p,null,{default:l(()=>[e(f,{onClick:C,color:"primary",loading:d.basic,class:"mr-2"},{default:l(()=>s[1]||(s[1]=[t(" 需要Sudo认证的操作 ",-1)])),_:1,__:[1]},8,["loading"]),e(f,{onClick:w,color:"info",class:"mr-2"},{default:l(()=>s[2]||(s[2]=[t(" 检查Sudo状态 ",-1)])),_:1,__:[2]}),e(f,{onClick:S,color:"warning"},{default:l(()=>s[3]||(s[3]=[t(" 清除Sudo Token ",-1)])),_:1,__:[3]})]),_:1})]),_:1}),e(_,{class:"mb-4"},{default:l(()=>[e(c,null,{default:l(()=>s[4]||(s[4]=[t("HTTP请求集成",-1)])),_:1,__:[4]}),e(p,null,{default:l(()=>[e(f,{onClick:b,color:"primary",loading:d.api,class:"mr-2"},{default:l(()=>s[5]||(s[5]=[t(" 发送需要Sudo的API请求 ",-1)])),_:1,__:[5]},8,["loading"]),e(f,{onClick:v,color:"secondary",loading:d.auto},{default:l(()=>s[6]||(s[6]=[t(" 自动处理Sudo的API请求 ",-1)])),_:1,__:[6]},8,["loading"])]),_:1})]),_:1}),e(_,{class:"mb-4"},{default:l(()=>[e(c,null,{default:l(()=>s[7]||(s[7]=[t("当前Sudo状态",-1)])),_:1,__:[7]}),e(p,null,{default:l(()=>[e(M,{color:r(o).isTokenValid?"success":"error",variant:"tonal",class:"mr-2"},{default:l(()=>[e(Q,{icon:r(o).isTokenValid?"mdi-shield-check":"mdi-shield-off",class:"mr-1"},null,8,["icon"]),t(" "+m(r(o).isTokenValid?"已认证":"未认证"),1)]),_:1},8,["color"]),r(o).isTokenValid?(k(),x(M,{key:0,color:"info",variant:"tonal"},{default:l(()=>[t(" 剩余: "+m(r(o).tokenExpiresIn),1)]),_:1})):I("",!0),r(o).isLoading==!0?(k(),x(X,{key:1,indeterminate:"",color:"primary",class:"mt-2"})):I("",!0)]),_:1})]),_:1}),n.value?(k(),x(_,{key:0},{default:l(()=>[e(c,null,{default:l(()=>s[8]||(s[8]=[t("操作结果",-1)])),_:1,__:[8]}),e(p,null,{default:l(()=>[B("pre",null,m(n.value),1)]),_:1})]),_:1})):I("",!0)]),_:1,__:[9]})]))}},oe={class:"sudo-debug"},ue={__name:"SudoDebug",setup(F){const{requireSudo:o,isSudoValid:d,clearSudo:n,isLoading:C,tokenExpiresIn:w,sudoToken:S,expiresAt:b}=U(),v=z(()=>d()),u=T(!1),s=T(null),V=T({show:!1,text:"",color:"success"}),N=(i,a=!0)=>{V.value={show:!0,text:i,color:a?"success":"error"}},O=async()=>{try{const i=await o({title:"测试强制认证",subtitle:"这是一个测试用的强制认证对话框",persistent:!0});N("强制认证成功！")}catch(i){N(i.message||"认证失败",!1)}},Y=async()=>{var i,a;u.value=!0,s.value=null;try{const g=await E({method:"get",url:"/api/admin/test",requireSudo:!0});s.value={success:!0,message:"请求成功！响应数据："+JSON.stringify(g.data)}}catch(g){s.value={success:!1,message:"请求失败："+(((a=(i=g.response)==null?void 0:i.data)==null?void 0:a.message)||g.message)}}finally{u.value=!1}};return(i,a)=>{const g=G;return k(),$(le,null,[e(te),B("div",oe,[e(g),e(j,null,{default:l(()=>[e(_,{class:"mb-4"},{default:l(()=>[e(c,null,{default:l(()=>a[2]||(a[2]=[t("Sudo Token 调试页面",-1)])),_:1,__:[2]}),e(p,null,{default:l(()=>[e(q,null,{default:l(()=>[e(y,{cols:"12",md:"6"},{default:l(()=>[e(D,null,{default:l(()=>a[3]||(a[3]=[t("当前Token状态",-1)])),_:1,__:[3]}),e(K,null,{default:l(()=>[e(P,null,{default:l(()=>[e(L,null,{default:l(()=>a[4]||(a[4]=[t("Token 有效性:",-1)])),_:1,__:[4]}),e(R,null,{default:l(()=>[e(M,{color:v.value?"success":"error"},{default:l(()=>[t(m(v.value?"有效":"无效"),1)]),_:1},8,["color"])]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(L,null,{default:l(()=>a[5]||(a[5]=[t("剩余时间:",-1)])),_:1,__:[5]}),e(R,null,{default:l(()=>[t(m(r(w))+"秒",1)]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(L,null,{default:l(()=>a[6]||(a[6]=[t("过期时间:",-1)])),_:1,__:[6]}),e(R,null,{default:l(()=>[t(m(r(b)?new Date(r(b)).toLocaleString():"无"),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(y,{cols:"12",md:"6"},{default:l(()=>[e(D,null,{default:l(()=>a[7]||(a[7]=[t("当前Token",-1)])),_:1,__:[7]}),e(se,{modelValue:r(S),"onUpdate:modelValue":a[0]||(a[0]=A=>W(S)?S.value=A:null),readonly:"",label:"Sudo Token",rows:"3",class:"token-display"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{class:"mb-4"},{default:l(()=>[e(c,null,{default:l(()=>a[8]||(a[8]=[t("认证测试",-1)])),_:1,__:[8]}),e(p,null,{default:l(()=>[e(q,null,{default:l(()=>[e(y,{cols:"12",md:"6"},{default:l(()=>[e(f,{color:"primary",class:"mb-2 me-2",onClick:O,loading:r(C)},{default:l(()=>a[9]||(a[9]=[t(" 测试认证 ",-1)])),_:1,__:[9]},8,["loading"]),e(f,{color:"error",class:"mb-2",onClick:r(n),disabled:!v.value},{default:l(()=>a[10]||(a[10]=[t(" 清除Token ",-1)])),_:1,__:[10]},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(c,null,{default:l(()=>a[11]||(a[11]=[t("API 测试",-1)])),_:1,__:[11]}),e(p,null,{default:l(()=>[e(q,null,{default:l(()=>[e(y,{cols:"12",md:"6"},{default:l(()=>[e(f,{color:"info",class:"mb-2 me-2",onClick:Y,loading:u.value},{default:l(()=>a[12]||(a[12]=[t(" 测试需要Sudo的API请求 ",-1)])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1}),s.value?(k(),x(h,{key:0,type:s.value.success?"success":"error",class:"mt-4"},{default:l(()=>[t(m(s.value.message),1)]),_:1},8,["type"])):I("",!0)]),_:1})]),_:1})]),_:1}),e(ee,{modelValue:V.value.show,"onUpdate:modelValue":a[1]||(a[1]=A=>V.value.show=A),color:V.value.color,timeout:3e3},{default:l(()=>[t(m(V.value.text),1)]),_:1},8,["modelValue","color"])])],64)}}},ie=Z(ue,[["__scopeId","data-v-b832bc29"]]);export{ie as default};
