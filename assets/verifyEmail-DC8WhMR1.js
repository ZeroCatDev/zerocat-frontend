import{r as i,w as x,a0 as T,X as C,o as _,P as s,h as o,U as h,ax as S,N as d,W as v,a1 as q,i as U,Z as A,as as D,k}from"./index-CgnhFUSh.js";import{V as b}from"./VTextField-WUANx533.js";import{V as E}from"./VAlert-jafP2gQJ.js";import{V as F}from"./VSpacer-CJT8cHsI.js";import{V as I}from"./VDialog-DldvZv1o.js";const j={__name:"verifyEmail",props:{modelValue:Boolean,email:{type:String,required:!0},title:{type:String,default:"验证邮箱"}},emits:["update:modelValue","verified"],setup(m,{expose:w,emit:B}){const c=m,V=B,u=i(c.modelValue),r=i(""),l=i(""),n=i("info"),f=i(!1),p={required:e=>!!e||"此字段为必填项",length:e=>(e==null?void 0:e.length)===6||"验证码必须是6位数字"};x(()=>u.value,e=>{V("update:modelValue",e),e&&g()}),x(()=>c.modelValue,e=>{u.value=e});const g=async()=>{var e,a;l.value="",f.value=!0;try{const t=await T.post("/account/send-verification-code",{email:c.email});t.data.status==="success"?(l.value="验证码已发送",n.value="success"):(l.value=t.data.message,n.value="error")}catch(t){l.value=((a=(e=t.response)==null?void 0:e.data)==null?void 0:a.message)||"发送验证码失败",n.value="error"}finally{f.value=!1}},N=()=>{if(!r.value||r.value.length!==6){l.value="请输入6位验证码",n.value="error";return}V("verified",r.value),y()},y=()=>{u.value=!1,r.value="",l.value=""};return w({sendCode:g}),(e,a)=>(_(),C(I,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=t=>u.value=t),"max-width":"400px"},{default:s(()=>[o(h,null,{default:s(()=>[o(S,null,{default:s(()=>[d(v(m.title),1)]),_:1}),o(q,null,{default:s(()=>[U("p",null,"验证码将发送到邮箱 "+v(m.email),1),o(b,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=t=>r.value=t),label:"验证码",rules:[p.required,p.length],maxlength:"6",variant:"outlined",class:"mt-4"},null,8,["modelValue","rules"]),l.value?(_(),C(E,{key:0,type:n.value,variant:"tonal",class:"mt-3"},{default:s(()=>[d(v(l.value),1)]),_:1},8,["type"])):A("",!0)]),_:1}),o(D,null,{default:s(()=>[o(F),o(k,{color:"grey",variant:"text",onClick:y},{default:s(()=>a[2]||(a[2]=[d("取消")])),_:1,__:[2]}),o(k,{color:"primary",loading:f.value,onClick:N},{default:s(()=>a[3]||(a[3]=[d(" 确认 ")])),_:1,__:[3]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{j as _};
