import{_ as N}from"./Comment-DgaEL_XM.js";import{_ as O}from"./Projects-YU_kUD-Z.js";import{f as V,p as j,U as J,n as z,t as h,y as K,s as Q,i as w,a as n,W as b,X,E as F,Y as q,B as A,k as D,Z as W,u as Y,$ as ee,R as te,a0 as ie,a1 as k,A as Z,j as se,l as ae,a2 as ne,a3 as re,a4 as le,a5 as E,z as oe,a6 as ue,a7 as ce,_ as de,c as y,o as f,w as u,a8 as me,a9 as I,G as _,J as fe,H as g,O as m,P as he,aa as ge,e as p,M as P,N as $,K as T,ab as B,ac as L,ad as x,I as _e,Q as M,T as ye}from"./index-lx3J_yFF.js";import{g as ve,a as pe}from"./user-DfWt985V.js";import{g as Ce}from"./projectService-Cix9WfPn.js";import{V as R,a as U}from"./VRow-Cw9fLF4-.js";import{V as C}from"./VChip-DDPj30M7.js";import{V as Te}from"./VContainer-BjckCR_B.js";import"./VForm-Nh0L88D2.js";import"./VTextarea-BdKmU4VL.js";import"./VDialog-At0nAwCH.js";import"./showProjects-BhokDuNJ.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-NicuDFje.js";/* empty css              */const be=j({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:W,iconColor:String,lineColor:String,...D(),...A(),...q(),...F()},"VTimelineDivider"),ke=V()({name:"VTimelineDivider",props:be(),setup(e,t){let{slots:r}=t;const{sizeClasses:c,sizeStyles:s}=J(e,"v-timeline-divider__dot"),{backgroundColorStyles:i,backgroundColorClasses:o}=z(h(e,"dotColor")),{roundedClasses:l}=K(e,"v-timeline-divider__dot"),{elevationClasses:a}=Q(e),{backgroundColorClasses:d,backgroundColorStyles:v}=z(h(e,"lineColor"));return w(()=>n("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[n("div",{class:["v-timeline-divider__before",d.value],style:v.value},null),!e.hideDot&&n("div",{key:"dot",class:["v-timeline-divider__dot",a.value,l.value,c.value],style:s.value},[n("div",{class:["v-timeline-divider__inner-dot",o.value,l.value],style:i.value},[r.default?n(X,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},r.default):n(b,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),n("div",{class:["v-timeline-divider__after",d.value],style:v.value},null)])),{}}}),H=j({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:W,iconColor:String,lineInset:[Number,String],...D(),...se(),...F(),...A(),...q(),...Z()},"VTimelineItem"),Ie=V()({name:"VTimelineItem",props:H(),setup(e,t){let{slots:r}=t;const{dimensionStyles:c}=Y(e),s=ee(0),i=te();return ie(i,o=>{var l;o&&(s.value=((l=o.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:l.getBoundingClientRect().width)??0)},{flush:"post"}),w(()=>{var o,l;return n("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":k(s.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${k(e.lineInset)})`:k(0)},e.style]},[n("div",{class:"v-timeline-item__body",style:c.value},[(o=r.default)==null?void 0:o.call(r)]),n(ke,{ref:i,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:r.icon}),e.density!=="compact"&&n("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((l=r.opposite)==null?void 0:l.call(r))])])}),{}}}),xe=j({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...ce(H({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...D(),...ue(),...Z(),...oe()},"VTimeline"),Ve=V()({name:"VTimeline",props:xe(),setup(e,t){let{slots:r}=t;const{themeClasses:c}=ae(e),{densityClasses:s}=ne(e),{rtlClasses:i}=re();le({VTimelineDivider:{lineColor:h(e,"lineColor")},VTimelineItem:{density:h(e,"density"),dotColor:h(e,"dotColor"),fillDot:h(e,"fillDot"),hideOpposite:h(e,"hideOpposite"),iconColor:h(e,"iconColor"),lineColor:h(e,"lineColor"),lineInset:h(e,"lineInset"),size:h(e,"size")}});const o=E(()=>{const a=e.side?e.side:e.density!=="default"?"end":null;return a&&`v-timeline--side-${a}`}),l=E(()=>{const a=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return a;case"start":return a[0];case"end":return a[1];default:return null}});return w(()=>n(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,l.value,{"v-timeline--inset-line":!!e.lineInset},c.value,s.value,o.value,i.value,e.class],style:[{"--v-timeline-line-thickness":k(e.lineThickness)},e.style]},r)),{}}}),je={components:{Projects:O,Comment:N},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},projectInfo:{},userInfo:{},currentPage:1,isLoadingMore:!1,pageSize:20}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await pe(this.username),ye({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await M({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(e=1){try{const t=await M.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});t.data.status==="success"&&(e===1?this.timeline=t.data.data:(this.timeline.events=[...this.timeline.events,...t.data.data.events],this.timeline.pagination=t.data.data.pagination),await this.fetchRelatedInfo())}catch(t){console.error("Failed to fetch timeline:",t)}},async fetchRelatedInfo(){const e=new Set,t=new Set,r=(this.currentPage-1)*this.pageSize;this.timeline.events.slice(r).forEach(s=>{var i,o,l,a,d,v,S;try{["project_create","project_delete","project_fork","project_publish"].includes(s.type)&&(i=s.target)!=null&&i.id&&e.add(s.target.id),s.type==="comment_create"&&(((l=(o=s.target)==null?void 0:o.page)==null?void 0:l.type)==="project"&&((a=s.target.page)!=null&&a.id)?e.add(s.target.page.id):((v=(d=s.target)==null?void 0:d.page)==null?void 0:v.type)==="user"&&((S=s.target.page)!=null&&S.id)&&t.add(s.target.page.id))}catch(G){console.warn("Error processing event:",s,G)}});try{if(e.size>0){const s=await Ce(Array.from(e)),i=new Set;s.forEach(o=>{o&&o.id&&(this.projectInfo[o.id]=o,o.authorid&&i.add(o.authorid))}),i.forEach(o=>{o&&t.add(o)})}t.size>0&&(await ve(Array.from(t))).forEach(i=>{i&&i.id&&(this.userInfo[i.id]=i,Object.values(this.projectInfo).forEach(o=>{o&&o.authorid===i.id&&(o.author_username=i.username)}))})}catch(s){console.error("Error fetching related info:",s)}},getTargetLink(e){var t,r,c,s;if(!e)return null;try{const i=e.id||((t=e.page)==null?void 0:t.id),o=e.type||((r=e.page)==null?void 0:r.type);if(!o||!i)return null;switch(o){case"comment":{if(!((c=e.page)!=null&&c.type)||!((s=e.page)!=null&&s.id))return null;const{type:l,id:a}=e.page;if(l==="project"){const d=this.projectInfo[a];return!(d!=null&&d.author_username)||!(d!=null&&d.name)?null:`/${d.author_username}/${d.name}`}if(l==="user"){const d=this.userInfo[a];return d!=null&&d.username?`/${d.username}`:null}return null}case"project":{const l=this.projectInfo[i];return!(l!=null&&l.author_username)||!(l!=null&&l.name)?null:`/${l.author_username}/${l.name}`}case"user":{const l=this.userInfo[i];return l!=null&&l.username?`/${l.username}`:null}case"projectlist":return`/projectlist/${i}`;default:return null}}catch(i){return console.warn("Error generating target link:",i),null}},getTargetContent(e,t){if(!e)return"";try{switch(e.type){case"comment":return this.getCommentTargetContent(e,t);case"project":return this.getProjectTargetContent(e,t);case"user":return this.getUserTargetContent(e,t);default:return`未知目标类型 #${(e==null?void 0:e.id)||"未知"}`}}catch(r){return console.warn("Error generating target content:",r),"内容获取失败"}},getCommentTargetContent(e,t){var s;if(!e.page&&!((s=e.page)!=null&&s.type))return`评论 #${e.id}`;const{type:r,id:c}=e.page||{};switch(r){case"project":{const i=this.projectInfo[c];return i?`在作品 ${i.title} 下的评论`:`在作品 #${c} 下的评论`}case"user":{const i=this.userInfo[c];return i?`在用户 ${i.display_name} 主页下的评论`:`在用户 #${c} 主页下的评论`}default:return`在 ${r} #${c} 下的评论`}},getProjectTargetContent(e,t){const r=this.projectInfo[e.id];if(!r)return`项目 #${e.id}`;if(t==="project_publish"){const c=r.state==="public"?"公开":"私有";return`${r.title||r.name}（${c}）`}return r.title||r.name},getUserTargetContent(e,t){const r=this.userInfo[e.id];return r?r.display_name:`用户 #${e.id}`},getEventChipText(e){return{project_create:"新建项目",project_delete:"删除项目",project_fork:"复刻项目",project_publish:"发布项目",comment_create:"评论",user_profile_update:"个人资料",user_register:"用户注册"}[e]||e},getEventColor(e){return{project_create:"success",project_delete:"error",project_fork:"warning",project_publish:"info",comment_create:"secondary",user_profile_update:"info",user_register:"primary"}[e]||"primary"},getEventDisplayText(e){const t=e.actor.display_name;switch(e.type){case"project_create":return`${t} 创建了新项目`;case"project_delete":return`${t} 删除了项目`;case"project_fork":return`${t} 复刻了项目`;case"project_publish":return`${t} 发布了项目`;case"comment_create":return`${t} 发表了评论`;case"user_profile_update":{const r=e.event_data.updated_fields.map(c=>this.getFieldDisplayName(c)).join("、");return`${t} 更新了个人资料（${r}）`}case"user_register":return`${t} 加入了 ZeroCat`;default:return`${t} 进行了操作`}},getFieldDisplayName(e){return{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}[e]||e},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}}}},we={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},De={class:"mt-2 text-body-1 text-medium-emphasis"},Se={class:"mt-2 text-medium-emphasis"},ze={key:0,class:"text-body-2 mt-1 text-grey"},Ee={key:0,class:"text-body-2 mt-1 text-grey"},Pe={class:"d-flex justify-center mt-4 mb-4"},$e={key:1,class:"text-medium-emphasis"};function Be(e,t,r,c,s,i){const o=O,l=N;return f(),y(Te,null,{default:u(()=>[n(me,{modelValue:s.tab,"onUpdate:modelValue":t[0]||(t[0]=a=>s.tab=a)},{default:u(()=>[n(I,{value:"home"},{default:u(()=>[n(fe,{class:"mt-8"},{default:u(()=>[n(R,{class:"d-flex align-center"},{default:u(()=>[n(U,null,{default:u(()=>[t[2]||(t[2]=_("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),_("p",we,[g(m(s.user.display_name)+" ",1),n(he,{size:"52",class:"ma-2"},{default:u(()=>[n(ge,{src:"https://s4-1.wuyuan.1r.ink/user/"+s.user.images},null,8,["src"])]),_:1})]),_("p",De,m(s.user.motto),1),_("p",Se,[n(C,null,{default:u(()=>[n(b,{icon:"mdi-account-circle",start:""}),g(" ID:"+m(s.user.id),1)]),_:1}),n(C,null,{default:u(()=>[n(b,{icon:"mdi-clock",start:""}),g(" "+m(s.user.regTime)+"注册 ",1)]),_:1}),n(C,null,{default:u(()=>[n(b,{icon:"mdi-tag",start:""}),t[1]||(t[1]=g(" 创作者 "))]),_:1})])]),_:1})]),_:1})]),_:1}),t[3]||(t[3]=_("br",null,null,-1)),n(o,{url:s.url},null,8,["url"]),n(R,null,{default:u(()=>[(f(!0),p(P,null,$(s.lists,a=>(f(),y(U,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:a.id},{default:u(()=>[n(T,{rounded:"lg"},{default:u(()=>[n(T,{to:"/app/projectlist/"+a.id,rounded:"lg",title:a.title,subtitle:a.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t[4]||(t[4]=_("br",null,null,-1)),n(l,{url:"user-"+s.user.id,name:"用户"},null,8,["url"])]),_:1}),n(I,{value:"comment"},{default:u(()=>[n(l,{url:"user-"+s.user.id,name:"用户"},null,8,["url"])]),_:1}),n(I,{value:"timeline"},{default:u(()=>[n(Ve,{side:"end",align:"start",class:"mt-4"},{default:u(()=>[(f(!0),p(P,null,$(s.timeline.events,a=>(f(),y(Ie,{key:a.id,size:"small","dot-color":"primary"},{opposite:u(()=>[g(m(new Date(a.created_at).toLocaleString()),1)]),default:u(()=>[i.getTargetLink(a.target)?(f(),y(T,{key:0,class:"elevation-1",to:i.getTargetLink(a.target)},{default:u(()=>[n(B,{class:"text-subtitle-1"},{default:u(()=>[g(m(i.getEventDisplayText(a)),1)]),_:2},1024),n(L,null,{default:u(()=>[n(C,{size:"small",color:i.getEventColor(a.type),class:"mr-2"},{default:u(()=>[g(m(i.getEventChipText(a.type)),1)]),_:2},1032,["color"]),_("div",null,m(i.getTargetContent(a.target,a.type)),1),a.event_data.comment_text?(f(),p("div",ze,m(a.event_data.comment_text),1)):x("",!0)]),_:2},1024)]),_:2},1032,["to"])):(f(),y(T,{key:1,class:"elevation-1"},{default:u(()=>[n(B,{class:"text-subtitle-1"},{default:u(()=>[g(m(i.getEventDisplayText(a)),1)]),_:2},1024),n(L,null,{default:u(()=>[n(C,{size:"small",color:i.getEventColor(a.type),class:"mr-2"},{default:u(()=>[g(m(i.getEventChipText(a.type)),1)]),_:2},1032,["color"]),_("div",null,m(i.getTargetContent(a.target,a.type)),1),a.event_data.comment_text?(f(),p("div",Ee,m(a.event_data.comment_text),1)):x("",!0)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1}),_("div",Pe,[i.hasMoreEvents?(f(),y(_e,{key:0,loading:s.isLoadingMore,variant:"tonal",onClick:i.loadMoreEvents},{default:u(()=>t[5]||(t[5]=[g(" 加载更多 ")])),_:1},8,["loading","onClick"])):s.timeline.events.length>0?(f(),p("div",$e," 没有更多内容了 ")):x("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Qe=de(je,[["render",Be],["__scopeId","data-v-6a8a0598"]]);export{Qe as default};
