import{g as pe,p as ge,ar as ye,x as j,b1 as D,bb as be,d as Ve,e as t,f as k,a0 as ke,F as Z,m as K,b9 as we,a1 as G,_ as xe,r as i,b as he,Y as _e,o as Se,N as n,Q as ee,R as ae,i as x,L as g,aB as te,W as z,X as C,aA as le,a9 as oe,a3 as se,aF as De,aD as Pe,aE as ne,bs as Te,T as Ce}from"./index-CBVViWLW.js";import{c as Ie,a as Be,b as Fe,d as Ne,u as Re,p as Ue,e as Ee,f as Oe,g as $e,h as Ge,i as He,j as Je,k as re,l as ue,m as ie,n as Le,o as qe,q as Ae}from"./VDataTable-BTDZqIbZ.js";import{V as de}from"./VTable-Cm0Hi_jm.js";import{V as je}from"./VTooltip-BaHoKha0.js";import{V as ze}from"./VTextarea-DczsXGSJ.js";import{V as ce}from"./VSpacer-DSay_XwU.js";import"./VSelect-Bg1CO2nR.js";import"./VCheckboxBtn-DXIZw2i6.js";import"./VSelectionControl-CjtwrSH1.js";import"./filter-D01WU43V.js";const Ke=ge({itemsLength:{type:[Number,String],required:!0},...Ae(),...qe(),...Le()},"VDataTableServer"),Me=pe()({name:"VDataTableServer",props:Ke(),emits:{"update:modelValue":a=>!0,"update:page":a=>!0,"update:itemsPerPage":a=>!0,"update:sortBy":a=>!0,"update:options":a=>!0,"update:expanded":a=>!0,"update:groupBy":a=>!0},setup(a,d){let{attrs:u,slots:l}=d;const{groupBy:v}=Ie(a),{sortBy:y,multiSort:h,mustSort:_}=Be(a),{page:m,itemsPerPage:f}=Fe(a),{disableSort:I}=ye(a),R=j(()=>parseInt(a.itemsLength,10)),{columns:w,headers:P}=Ne(a,{groupBy:v,showSelect:D(()=>a.showSelect),showExpand:D(()=>a.showExpand)}),{items:b}=Re(a,w),{toggleSort:T}=Ue({sortBy:y,multiSort:h,mustSort:_,page:m}),{opened:V,isGroupOpen:p,toggleGroup:H,extractRows:S}=Ee({groupBy:v,sortBy:y,disableSort:I}),{pageCount:B,setItemsPerPage:U}=Oe({page:m,itemsPerPage:f,itemsLength:R}),{flatItems:E}=$e(b,v,V),{isSelected:J,select:L,selectAll:O,toggleSelect:$,someSelected:F,allSelected:q}=Ge(a,{allItems:b,currentPage:b}),{isExpanded:s,toggleExpand:e}=He(a),o=j(()=>S(b.value));Je({page:m,itemsPerPage:f,sortBy:y,groupBy:v,search:D(()=>a.search)}),we("v-data-table",{toggleSort:T,sortBy:y}),be({VDataTableRows:{hideNoData:D(()=>a.hideNoData),noDataText:D(()=>a.noDataText),loading:D(()=>a.loading),loadingText:D(()=>a.loadingText)}});const r=j(()=>({page:m.value,itemsPerPage:f.value,sortBy:y.value,pageCount:B.value,toggleSort:T,setItemsPerPage:U,someSelected:F.value,allSelected:q.value,isSelected:J,select:L,selectAll:O,toggleSelect:$,isExpanded:s,toggleExpand:e,isGroupOpen:p,toggleGroup:H,items:o.value.map(c=>c.raw),internalItems:o.value,groupedItems:E.value,columns:w.value,headers:P.value}));Ve(()=>{const c=re.filterProps(a),A=ue.filterProps(a),me=ie.filterProps(a),fe=de.filterProps(a);return t(de,K({class:["v-data-table",{"v-data-table--loading":a.loading},a.class],style:a.style},fe,{fixedHeader:a.fixedHeader||a.sticky}),{top:()=>{var N;return(N=l.top)==null?void 0:N.call(l,r.value)},default:()=>{var N,M,Q,W,X,Y;return l.default?l.default(r.value):k(Z,null,[(N=l.colgroup)==null?void 0:N.call(l,r.value),!a.hideDefaultHeader&&k("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[t(ue,A,l)]),(M=l.thead)==null?void 0:M.call(l,r.value),!a.hideDefaultBody&&k("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(Q=l["body.prepend"])==null?void 0:Q.call(l,r.value),l.body?l.body(r.value):t(ie,K(u,me,{items:E.value}),l),(W=l["body.append"])==null?void 0:W.call(l,r.value)]),(X=l.tbody)==null?void 0:X.call(l,r.value),(Y=l.tfoot)==null?void 0:Y.call(l,r.value)])},bottom:()=>l.bottom?l.bottom(r.value):!a.hideDefaultFooter&&k(Z,null,[t(ke,null,null),t(re,c,{prepend:l["footer.prepend"]})])})})}});async function ve(a){var d;try{return(await G.get(`/cachekv/${encodeURIComponent(a)}`)).data}catch(u){if(((d=u.response)==null?void 0:d.status)===404)return;throw u}}async function Qe(a,d){return(await G.post(`/cachekv/${encodeURIComponent(a)}`,d)).data.data}async function We(a){var d;try{return await G.delete(`/cachekv/${encodeURIComponent(a)}`),!0}catch(u){if(((d=u.response)==null?void 0:d.status)===404)return!1;throw u}}async function Xe({page:a=1,limit:d=20,showValue:u=!1,total:l=!1}={}){const v=await G.get("/cachekv",{params:{page:a,limit:d,showValue:u,total:l}});return{items:v.data.data,pagination:v.data.pagination}}const Ye={class:"font-weight-medium"},Ze={class:"value-preview"},ea={class:"value-full"},aa={__name:"kv",setup(a){const d=[{title:"缓存键",key:"key",sortable:!0},{title:"缓存值",key:"value",sortable:!1},{title:"操作",key:"actions",sortable:!1,align:"end"}],u=i([]),l=i(!1),v=i(!1),y=i(!1),h=i(""),_=i(!1),m=i(!1),f=i(null),I=i(null),R=i(null),w=i(1),P=i(10),b=i(0),T=i([]),V=i({show:!1,text:"",color:"success"}),p=i({key:"",value:""});async function H(s){w.value=s.page,P.value=s.itemsPerPage,T.value=s.sortBy,await S()}async function S(){var s,e,o,r;l.value=!0;try{if(h.value.trim()){const c=await ve(h.value.trim());u.value=[{columns:{key:h.value.trim(),value:c}}],b.value=1}else{const c=await Xe({page:w.value,limit:P.value,showValue:!0,sortField:(e=(s=T.value)==null?void 0:s[0])==null?void 0:e.key,sortOrder:(r=(o=T.value)==null?void 0:o[0])==null?void 0:r.order,total:!0});u.value=c.items.map(A=>({columns:A})),b.value=c.pagination.total,w.value=c.pagination.page,P.value=c.pagination.limit}}catch(c){F("Failed to load items"),console.error("Error loading items:",c),u.value=[],b.value=0}finally{l.value=!1}}function B(s){try{if(typeof s=="string"){const e=JSON.parse(s);return JSON.stringify(e,null,2)}return JSON.stringify(s,null,2)}catch{return s}}async function U(){if(R.value.validate()){v.value=!0;try{const s=p.value.value;let e;try{e=JSON.parse(s)}catch{e=s}await Qe(p.value.key,e),$(f.value?"Item updated successfully":"Item created successfully"),O(),S()}catch(s){F("Failed to save item"),console.error("Error saving item:",s)}finally{v.value=!1}}}function E(s){f.value=s,p.value={key:s.key,value:B(s.value)},_.value=!0}function J(s){I.value=s,m.value=!0}async function L(){if(I.value){y.value=!0;try{await We(I.value),$("Item deleted successfully"),m.value=!1,S()}catch(s){F("Failed to delete item"),console.error("Error deleting item:",s)}finally{y.value=!1}}}function O(){_.value=!1,f.value=null,p.value={key:"",value:""}}function $(s){V.value={show:!0,text:s,color:"success"}}function F(s){V.value={show:!0,text:s,color:"error"}}function q(){w.value=1,S()}return he(async()=>{S(),console.log(await ve("ces1_d9978c65"))}),(s,e)=>(Se(),_e(Ce,null,{default:n(()=>[t(ee,{class:"mb-4"},{default:n(()=>[t(ae,{cols:"12",class:"d-flex justify-space-between align-center"},{default:n(()=>[e[10]||(e[10]=k("h1",{class:"text-h4"},"缓存管理",-1)),t(x,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>_.value=!0)},{default:n(()=>e[9]||(e[9]=[g(" 创建缓存 ")])),_:1,__:[9]})]),_:1,__:[10]})]),_:1}),t(ee,{class:"mb-4"},{default:n(()=>[t(ae,{cols:"12",sm:"6"},{default:n(()=>[t(te,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=o=>h.value=o),label:"缓存键","prepend-inner-icon":"mdi-key",variant:"outlined",density:"comfortable","hide-details":"",onInput:q,clearable:"",placeholder:"输入缓存键以读取特定缓存"},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:n(()=>[t(Me,{headers:d,items:u.value,loading:l.value,"items-per-page":P.value,page:w.value,"items-length":b.value,"onUpdate:options":H,"items-per-page-options":[10,25,50,100],class:"elevation-1"},{"item.key":n(({item:o})=>[k("div",Ye,C(o.columns.key),1)]),"item.value":n(({item:o})=>[t(je,{location:"bottom"},{activator:n(({props:r})=>[k("div",K({class:"text-truncate",style:{"max-width":"300px"}},r),[k("pre",Ze,C(B(o.columns.value)),1)],16)]),default:n(()=>[k("pre",ea,C(B(o.columns.value)),1)]),_:2},1024)]),"item.actions":n(({item:o})=>[t(x,{icon:"mdi-pencil",size:"small",color:"primary",variant:"text",onClick:r=>E(o.columns)},null,8,["onClick"]),t(x,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:r=>J(o.columns.key)},null,8,["onClick"])]),_:1},8,["items","loading","items-per-page","page","items-length"])]),_:1}),t(le,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),"max-width":"600px"},{default:n(()=>[t(z,null,{default:n(()=>[t(oe,{class:"text-h5 pa-4"},{default:n(()=>[g(C(f.value?"编辑缓存":"创建缓存"),1)]),_:1}),t(se,{class:"pa-4"},{default:n(()=>[t(De,{onSubmit:Pe(U,["prevent"]),ref_key:"form",ref:R},{default:n(()=>[t(te,{modelValue:p.value.key,"onUpdate:modelValue":e[2]||(e[2]=o=>p.value.key=o),label:"缓存键",readonly:!!f.value,rules:[o=>!!o||"Key is required"],variant:"outlined",class:"mb-4"},null,8,["modelValue","readonly","rules"]),t(ze,{modelValue:p.value.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value.value=o),label:"缓存值",rules:[o=>!!o||"缓存值是必填的"],variant:"outlined",hint:"支持 JSON 格式","persistent-hint":"",class:"font-monospace",rows:"8"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),t(ne,{class:"pa-4"},{default:n(()=>[t(ce),t(x,{variant:"text",onClick:O},{default:n(()=>e[11]||(e[11]=[g(" 取消 ")])),_:1,__:[11]}),t(x,{color:"primary",onClick:U,loading:v.value},{default:n(()=>[g(C(f.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value=o),"max-width":"400px"},{default:n(()=>[t(z,null,{default:n(()=>[t(oe,{class:"text-h5 pa-4"},{default:n(()=>e[12]||(e[12]=[g(" 确认删除 ")])),_:1,__:[12]}),t(se,{class:"pa-4"},{default:n(()=>e[13]||(e[13]=[g(" 确定要删除这个缓存吗？此操作无法撤销。 ")])),_:1,__:[13]}),t(ne,{class:"pa-4"},{default:n(()=>[t(ce),t(x,{variant:"text",onClick:e[5]||(e[5]=o=>m.value=!1)},{default:n(()=>e[14]||(e[14]=[g(" 取消 ")])),_:1,__:[14]}),t(x,{color:"error",onClick:L,loading:y.value},{default:n(()=>e[15]||(e[15]=[g(" 删除 ")])),_:1,__:[15]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Te,{modelValue:V.value.show,"onUpdate:modelValue":e[8]||(e[8]=o=>V.value.show=o),color:V.value.color,timeout:3e3},{actions:n(()=>[t(x,{variant:"text",onClick:e[7]||(e[7]=o=>V.value.show=!1)},{default:n(()=>e[16]||(e[16]=[g(" 关闭 ")])),_:1,__:[16]})]),default:n(()=>[g(C(V.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},va=xe(aa,[["__scopeId","data-v-fa0af028"]]);export{va as default};
