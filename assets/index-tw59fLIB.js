import{f as K,p as Q,i as j,a as s,A as q,k as J,_ as W,R as i,av as X,r as b,e as k,o as d,w as a,ab as I,G as L,ac as w,c as V,ad as Y,ag as x,M as B,N as O,L as P,ah as T,H as m,O as p,ai as Z,I as S,K as $,ay as ee,Q as _,S as N}from"./index-lx3J_yFF.js";import{_ as te}from"./verifyEmail-BpRr3c3q.js";import{V as ae}from"./VAlert-Cb4-elty.js";import"./VSpacer-DjpRYB0U.js";/* empty css              */import"./VDialog-At0nAwCH.js";const se=Q({start:Boolean,end:Boolean,...J(),...q()},"VListItemAction"),oe=K()({name:"VListItemAction",props:se(),setup(c,f){let{slots:l}=f;return j(()=>s(c.tag,{class:["v-list-item-action",{"v-list-item-action--start":c.start,"v-list-item-action--end":c.end},c.class],style:c.style},l)),{}}}),le={class:"oauth-binding"},ne={__name:"index",setup(c){const f=i([]),l=i(""),r=i("info"),g=i(!1),y=i(""),C=i(""),F=i([]),U="https://zerocat-api.houlangs.com",h={google:{backgroundColor:"#4285F4",color:"#FFFFFF"},microsoft:{backgroundColor:"#F25022",color:"#FFFFFF"},github:{backgroundColor:"#333333",color:"#FFFFFF"},default:{backgroundColor:"#CCCCCC",color:"#000000"}},A=async()=>{var o,e;try{const t=await _.post("/account/oauth/bound",{userid:N.user.value.id});t.data.status==="success"?f.value=t.data.data:(l.value=t.data.message,r.value="error")}catch(t){l.value=((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"获取绑定的 OAuth 账号失败",r.value="error"}},E=async()=>{var o,e;try{const t=await _.get("/account/emails");if(t.data.status==="success"){const n=t.data.data.find(v=>v.is_primary);n&&(y.value=n.contact_value)}else l.value=t.data.message,r.value="error"}catch(t){l.value=((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"获取邮箱列表失败",r.value="error"}},z=async()=>{var o,e;try{const t=await _.get("/account/oauth/providers");t.data.status==="success"?F.value=t.data.data:(l.value=t.data.message,r.value="error")}catch(t){l.value=((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"获取可绑定的 OAuth 提供商失败",r.value="error"}},D=(o,e)=>{C.value=e,g.value=!0},M=async o=>{var e,t;try{const u=await _.post("/account/confirm-unlink-oauth",{email:y.value,code:o,provider:C.value});u.data.status==="success"?(l.value="成功解绑 OAuth 账号",r.value="success",A()):(l.value=u.data.message||"解绑失败",r.value="error")}catch(u){l.value=((t=(e=u.response)==null?void 0:e.data)==null?void 0:t.message)||"解绑 OAuth 账号失败",r.value="error"}},R=o=>{window.location.href=`${U}/account/oauth/bind/${o}?token=${N.getToken()}`},G=o=>h[o]||h.default;return X(()=>{A(),E(),z()}),(o,e)=>{const t=b("v-list-item-content"),u=b("v-list-item-group");return d(),k("div",le,[s($,null,{default:a(()=>[s(I,null,{default:a(()=>e[1]||(e[1]=[L("h2",null,"已绑定的 OAuth 账号",-1)])),_:1}),s(w,null,{default:a(()=>[s(x,null,{default:a(()=>[s(u,null,{default:a(()=>[(d(!0),k(B,null,O(f.value,(n,v)=>(d(),V(P,{key:v},{default:a(()=>[s(t,null,{default:a(()=>[s(T,null,{default:a(()=>[m(p(n.contact_value),1)]),_:2},1024),s(Z,null,{default:a(()=>[m(p(n.contact_type),1)]),_:2},1024)]),_:2},1024),s(oe,null,{default:a(()=>[s(S,{onClick:H=>D(n.contact_value,n.contact_type),color:"red"},{default:a(()=>e[2]||(e[2]=[m("解绑")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l.value?(d(),V(ae,{key:0,type:r.value},{default:a(()=>[m(p(l.value),1)]),_:1},8,["type"])):Y("",!0)]),_:1})]),_:1}),s(te,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),email:y.value,onVerified:M},null,8,["modelValue","email"]),s($,{class:"mt-4"},{default:a(()=>[s(I,null,{default:a(()=>e[3]||(e[3]=[L("h2",null,"可绑定的 OAuth 提供商",-1)])),_:1}),s(w,null,{default:a(()=>[e[4]||(e[4]=m(" 不论怎样，你都需要确保对绑定账户内邮箱完全的控制。 ")),s(x,null,{default:a(()=>[(d(!0),k(B,null,O(F.value,(n,v)=>(d(),V(P,{key:v},{default:a(()=>[s(t,null,{default:a(()=>[s(T,null,{default:a(()=>[s(S,{style:ee(G(n.id)),onClick:H=>R(n.id)},{default:a(()=>[m(p(n.name),1)]),_:2},1032,["style","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})])}}},ve=W(ne,[["__scopeId","data-v-14a90040"]]);export{ve as default};
