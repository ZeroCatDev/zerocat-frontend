import{_ as v}from"./EditProjectListConfig-HzomiNq3.js";import{o as A}from"./openEdit-AJJkPSPH.js";import{_ as V,a1 as B,Y as c,o as r,N as i,e as t,a3 as x,Q as f,R as d,aB as w,a0 as M,aE as k,i as p,W as C,r as S,b as z,aa as F,ab as j,f as m,S as T,L as h,X as g,c as I,$ as L,Z as q,n as O,aD as R,a4 as H,a5 as Q,F as W,U as X,aA as b,T as Y,M as Z}from"./index-B7oF1r_k.js";import{V as G}from"./VSelect-9uej9JMI.js";import{V as y}from"./VSpacer-BXETznO2.js";import{e as J,f as K}from"./projectListService-D2C2eq5W.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-BUatQX3c.js";import"./VSelectionControl-D--hWwCI.js";const $={data(){return{projectInfo:{title:"",description:"",state:"private"},listStates:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],loading:!1,newId:0,openEdit:A}},props:{callback:{type:Function,required:!1},close:{type:Function,required:!1}},methods:{show(){this.projectInfo={title:"",description:"",state:"private"},this.loading=!1,this.newId=0},async newProjectList(){if(this.projectInfo.title){this.loading=!0;try{const e=await B.post("/projectlist/lists/create",this.projectInfo);this.$toast.add({severity:"info",summary:e.data.status==="success"?"成功":"错误",detail:e.data.message||"创建项目列表",life:3e3}),e.data.status==="success"&&(this.newId=e.data.data.id,this.callback&&this.callback(),this.close&&this.close())}catch(e){console.error("创建项目列表失败:",e),this.$toast.add({severity:"error",summary:"错误",detail:"创建项目列表失败",life:3e3})}finally{this.loading=!1}}}}};function tt(e,s,a,_,l,n){return r(),c(C,{"prepend-icon":"mdi-format-list-bulleted",title:"新建列表",border:""},{default:i(()=>[t(x,null,{default:i(()=>[t(f,{dense:""},{default:i(()=>[t(d,{cols:"12"},{default:i(()=>[t(w,{label:"标题",required:"",hint:"将便于查找",modelValue:l.projectInfo.title,"onUpdate:modelValue":s[0]||(s[0]=o=>l.projectInfo.title=o),rules:[o=>!!o||"标题不能为空"]},null,8,["modelValue","rules"])]),_:1}),t(d,{cols:"12"},{default:i(()=>[t(w,{label:"简介",hint:"简要描述列表内容",modelValue:l.projectInfo.description,"onUpdate:modelValue":s[1]||(s[1]=o=>l.projectInfo.description=o)},null,8,["modelValue"])]),_:1}),t(d,{cols:"12"},{default:i(()=>[t(G,{modelValue:l.projectInfo.state,"onUpdate:modelValue":s[2]||(s[2]=o=>l.projectInfo.state=o),items:l.listStates,"item-title":"state","item-value":"abbr",label:"列表状态"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(M),t(k,null,{default:i(()=>[t(y),t(p,{text:"关闭",variant:"plain",onClick:s[3]||(s[3]=o=>a.close())}),t(p,{color:"primary",text:"创建",variant:"tonal",onClick:n.newProjectList,loading:l.loading,disabled:!l.projectInfo.title},null,8,["onClick","loading","disabled"])]),_:1})]),_:1})}const D=V($,[["render",tt]]),et={props:{list:{type:Object,required:!0}},data(){return{projectCount:0,loading:!1,error:null}},computed:{isOwner(){const e=j.user.value;return e&&e.id===(this.list.authorid||this.list.userId)}},async created(){await this.fetchProjectCount()},setup(){const e=S(null);return z(async()=>{e.value=await F("s3.staticurl")}),{s3BucketUrl:e,getUserAvatar:a=>!a||!a.avatar?"":`${e.value}/user/${a.avatar}`}},methods:{async fetchProjectCount(){var e;if(this.list.projects)this.projectCount=this.list.projects.length;else try{this.loading=!0;const s=await J(this.list.id);s.status==="success"&&s.data&&(this.projectCount=((e=s.data.projects)==null?void 0:e.length)||0)}catch(s){console.error(`获取列表 ${this.list.id} 项目数量失败:`,s)}finally{this.loading=!1}},formatDate(e){return e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知"}}},st={class:"d-flex align-center"},it={class:"text-caption"},lt={class:"mt-2 d-flex align-center"},at={class:"text-caption"},ot={key:0,class:"text-caption"};function rt(e,s,a,_,l,n){return r(),c(C,{title:a.list.title,subtitle:a.list.description||"无描述",class:"h-100",to:`/app/projectlist/${a.list.id}`},{default:i(()=>[t(x,null,{default:i(()=>[m("div",st,[t(T,{color:a.list.state==="public"?"success":"warning",size:"small",class:"mr-2"},{default:i(()=>[h(g(a.list.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),m("span",it,g(n.formatDate(a.list.updateTime||a.list.updatedAt)),1)]),m("div",lt,[m("span",at,"项目数: "+g(l.projectCount),1),t(y),a.list.author?(r(),I("span",ot,[t(q,{size:"16",class:"mr-1"},{default:i(()=>[t(O,{src:_.getUserAvatar(a.list.author),alt:"用户头像"},null,8,["src"])]),_:1}),h(" "+g(a.list.author.display_name||a.list.author.username||`用户${a.list.authorid}`),1)])):L("",!0)])]),_:1}),t(k,null,{default:i(()=>[n.isOwner?(r(),c(p,{key:0,icon:"mdi-pencil",variant:"text",size:"small",onClick:s[0]||(s[0]=R(o=>e.$emit("edit",a.list.id),["stop","prevent"])),color:"primary"})):L("",!0),t(y),t(p,{icon:"mdi-eye",variant:"text",size:"small",to:`/app/projectlist/${a.list.id}`},null,8,["to"])]),_:1})]),_:1},8,["title","subtitle","to"])}const P=V(et,[["render",rt]]),nt={components:{NewProjectList:D,EditProjectListConfig:v,ProjectListItem:P},data(){return{loading:!0,myLists:[],newListDialog:!1,editDialog:!1,selectedListId:null}},async created(){await this.fetchMyLists()},methods:{async fetchMyLists(){this.loading=!0;try{const e=await K();e.status==="success"?this.myLists=e.data||[]:this.$toast.add({severity:"error",summary:"错误",detail:e.message||"获取列表失败",life:3e3})}catch(e){console.error("获取我的列表失败:",e),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},openNewListDialog(){this.newListDialog=!0},openEditDialog(e){this.selectedListId=e,this.editDialog=!0}}};function ct(e,s,a,_,l,n){const o=P,N=D,E=v;return r(),c(Y,null,{default:i(()=>[t(f,null,{default:i(()=>[t(d,{cols:"12",class:"d-flex align-center mb-4"},{default:i(()=>[s[3]||(s[3]=m("h2",{class:"text-h5"},"我的项目列表",-1)),t(y),t(p,{color:"primary","prepend-icon":"mdi-plus",onClick:n.openNewListDialog},{default:i(()=>s[2]||(s[2]=[h(" 新建列表 ")])),_:1,__:[2]},8,["onClick"])]),_:1,__:[3]})]),_:1}),l.loading?(r(),c(f,{key:0},{default:i(()=>[t(d,{cols:"12",class:"text-center"},{default:i(()=>[t(H,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):l.myLists.length===0?(r(),c(f,{key:1},{default:i(()=>[t(d,{cols:"12"},{default:i(()=>[t(Q,{type:"info",variant:"tonal"},{default:i(()=>s[4]||(s[4]=[h(' 您还没有创建任何项目列表，点击右上角的"新建列表"按钮创建一个吧！ ')])),_:1,__:[4]})]),_:1})]),_:1})):(r(),c(f,{key:2},{default:i(()=>[(r(!0),I(W,null,X(l.myLists,u=>(r(),c(d,{key:u.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:i(()=>[t(o,{list:u,onEdit:n.openEditDialog},null,8,["list","onEdit"])]),_:2},1024))),128))]),_:1})),t(b,{modelValue:l.newListDialog,"onUpdate:modelValue":s[0]||(s[0]=u=>l.newListDialog=u),"max-width":"600px"},{default:i(()=>[t(N,{callback:n.fetchMyLists,close:()=>l.newListDialog=!1},null,8,["callback","close"])]),_:1},8,["modelValue"]),t(b,{modelValue:l.editDialog,"onUpdate:modelValue":s[1]||(s[1]=u=>l.editDialog=u),"max-width":"600px"},{default:i(()=>[l.selectedListId?(r(),c(E,{key:0,listid:l.selectedListId,callback:n.fetchMyLists,close:()=>l.editDialog=!1},null,8,["listid","callback","close"])):L("",!0)]),_:1},8,["modelValue"])]),_:1})}const U=V(nt,[["render",ct]]),dt={components:{ProjectListsView:U},async created(){j.isLogin.value===!1&&this.$router.push("/app/account/login")},data(){return{localuser:j}},name:"projectlist",setup(){Z({title:"我的项目列表"})}};function ut(e,s,a,_,l,n){const o=U;return r(),c(o)}const Lt=V(dt,[["render",ut]]);export{Lt as default};
