import{_ as h}from"./LoadingDialog-DhWUxim1.js";import{_ as y,a2 as x,a as v,o as c,j as p,f as o,w as r,t as V,a6 as C,af as n,l as d,k as _,v as b,q as R,F as k,y as f,B as I,A as B}from"./index-CPHzaj2E.js";import{V as w,a as l}from"./VRow-BQRo9nRu.js";import{V as P}from"./VForm-fRD1ZAo8.js";import"./VDialog-hJYrN8SW.js";/* empty css              */const T={components:{LoadingDialog:h},data(){return{email:"",password:"",password2:"",show1:!1,show2:!1,loading:!1,loadingText:"正在处理...",showVerificationInput:!1,verificationCode:"",countdown:0,rules:{required:t=>!!t||"此字段为必填项",length:t=>(t==null?void 0:t.length)===6||"验证码必须是6位数字"},emailRules:[t=>t?!0:"必须填写邮箱",t=>/.+@.+\..+/.test(t)?!0:"不符合格式"],passwordRules:[t=>t?!0:"必须填写密码"],password2Rules:[t=>t?!0:"必须填写密码",t=>t===this.password?!0:"必须与前者相同"]}},created(){B.isLogin.value==!0&&this.$router.push("/")},setup(){I({title:"重设密码"})},methods:{startResetPassword(){if(!this.email||!this.password||!this.password2){this.$toast.add({severity:"error",summary:"错误",detail:"请填写所有必填字段",life:3e3});return}if(this.password!==this.password2){this.$toast.add({severity:"error",summary:"错误",detail:"两次输入的密码不一致",life:3e3});return}this.sendVerificationCode(),this.showVerificationInput=!0},async sendVerificationCode(){var t,s;if(!(this.countdown>0)){this.loading=!0,this.loadingText="正在发送验证码...";try{const i=await f.post("/account/retrievePassword",{email:this.email});i.data.status==="success"?(this.$toast.add({severity:"success",summary:"成功",detail:"验证码已发送",life:3e3}),this.startCountdown()):this.$toast.add({severity:"error",summary:"错误",detail:i.data.message,life:3e3})}catch(i){this.$toast.add({severity:"error",summary:"错误",detail:((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.message)||"发送验证码失败",life:3e3})}finally{this.loading=!1}}},startCountdown(){this.countdown=60;const t=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(t)},1e3)},async handleResetPassword(){var t,s;if(!this.verificationCode||this.verificationCode.length!==6){this.$toast.add({severity:"error",summary:"错误",detail:"请输入6位验证码",life:3e3});return}this.loading=!0,this.loadingText="正在重设密码...";try{const i=await f.post("/account/reset-password",{email:this.email,verificationCode:this.verificationCode,newPassword:this.password});i.data.status==="success"?(this.$toast.add({severity:"success",summary:"成功",detail:"密码重置成功",life:3e3}),this.$router.push("/app/account/login")):this.$toast.add({severity:"error",summary:"错误",detail:i.data.message,life:3e3})}catch(i){this.$toast.add({severity:"error",summary:"错误",detail:((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.message)||"重置密码失败",life:3e3})}finally{this.loading=!1}}}},N={class:"auth-wrapper d-flex align-center justify-center pa-4"};function F(t,s,i,U,e,u){const m=x("v-cardtext"),g=h;return c(),v(k,null,[p("div",N,[o(R,{class:"auth-card pa-4 pt-7","max-width":"448",border:"",rounded:"lg"},{default:r(()=>[o(w,null,{default:r(()=>[o(l,{cols:"12"},{default:r(()=>[o(m,null,{default:r(()=>s[7]||(s[7]=[p("h5",{class:"text-h5 font-weight-semibold mb-1"}," 欢迎来到ZeroCatNext！ 👋🏻 ",-1),p("p",{class:"mb-0"},"重设密码",-1)])),_:1})]),_:1})]),_:1}),o(m,null,{default:r(()=>[o(P,null,{default:r(()=>[o(w,null,{default:r(()=>[o(l,{cols:"12"},{default:r(()=>[o(n,{label:"邮箱",type:"text",modelValue:e.email,"onUpdate:modelValue":s[0]||(s[0]=a=>e.email=a),variant:"outlined",rules:e.emailRules},null,8,["modelValue","rules"])]),_:1}),e.showVerificationInput?(c(),V(l,{key:0,cols:"12"},{default:r(()=>[o(n,{modelValue:e.verificationCode,"onUpdate:modelValue":s[1]||(s[1]=a=>e.verificationCode=a),label:"验证码",variant:"outlined",maxlength:"6",rules:[e.rules.required,e.rules.length]},null,8,["modelValue","rules"]),o(d,{class:"mb-4",variant:"text",onClick:u.sendVerificationCode,disabled:e.countdown>0},{default:r(()=>[_(b(e.countdown>0?`${e.countdown}秒后重新发送`:"发送验证码"),1)]),_:1},8,["onClick","disabled"])]),_:1})):C("",!0),o(l,{cols:"12"},{default:r(()=>[o(n,{label:"新密码",modelValue:e.password,"onUpdate:modelValue":s[2]||(s[2]=a=>e.password=a),variant:"outlined",rules:e.passwordRules,"append-icon":e.show1?"mdi-eye":"mdi-eye-off",type:e.show1?"text":"password","onClick:append":s[3]||(s[3]=a=>e.show1=!e.show1)},null,8,["modelValue","rules","append-icon","type"]),o(n,{label:"确认密码",modelValue:e.password2,"onUpdate:modelValue":s[4]||(s[4]=a=>e.password2=a),variant:"outlined",rules:e.password2Rules,"append-icon":e.show2?"mdi-eye":"mdi-eye-off",type:e.show2?"text":"password","onClick:append":s[5]||(s[5]=a=>e.show2=!e.show2)},null,8,["modelValue","rules","append-icon","type"])]),_:1}),o(l,{cols:"12"},{default:r(()=>[o(d,{class:"text-none",color:"primary",rounded:"xl",text:e.showVerificationInput?"确认重设":"获取验证码",variant:"flat",size:"large",onClick:s[6]||(s[6]=a=>e.showVerificationInput?u.handleResetPassword():u.startResetPassword()),"append-icon":"mdi-arrow-right"},null,8,["text"])]),_:1}),o(l,{cols:"12"},{default:r(()=>[o(d,{class:"text-none",color:"white",rounded:"xl",text:"登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/login"}),o(d,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o(g,{show:e.loading,message:e.loadingText},null,8,["show","message"])],64)}const E=y(T,[["render",F]]);export{E as default};
