import{_ as x,o as p,Y as k,N as r,e as t,R as V,S as f,f as o,i as n,C as i,Z as b,aK as w,aI as U,a9 as _,aG as c,c as g,F as v,X as A,a5 as R,aJ as C,O as S,af as y,ab as T,aY as L,U as O,W as B,a6 as F,aZ as I}from"./index-C30_-gqw.js";import{V as N}from"./VTextarea-DN100mDs.js";import"https://static.geetest.com/v4/gt4.js";const M={name:"NewOAuthApplication",data(){return{form:{name:"",description:"",homepage_url:"",redirect_uris:[""],scopes:["profile"]},loading:!1,snackbar:{show:!1,text:"",color:"success"},sudoManager:I()}},methods:{async saveApplication(){this.loading=!0;try{const a=await this.sudoManager.requireSudo({title:"创建 OAuth 应用",subtitle:`您正在创建名为"${this.form.name}"的OAuth应用。此操作需要验证您的身份。`,persistent:!0}),e=await F.post("/oauth/applications",{name:this.form.name,description:this.form.description,homepage_url:this.form.homepage_url,redirect_uris:this.form.redirect_uris.filter(h=>h.trim()),type:"oauth",scopes:this.form.scopes},{headers:{"X-Sudo-Token":a}});this.showSuccess("应用创建成功"),this.$router.push("/app/oauth/applications/"+e.data.client_id)}catch(a){a.type!=="cancelled"&&(this.showError("创建应用失败"),console.error("Failed to create application:",a))}this.loading=!1},addRedirectUri(){this.form.redirect_uris||(this.form.redirect_uris=[]),this.form.redirect_uris.push("")},removeRedirectUri(a){this.form.redirect_uris&&this.form.redirect_uris.length>1&&this.form.redirect_uris.splice(a,1)},showSuccess(a){this.snackbar={show:!0,text:a,color:"success"}},showError(a){this.snackbar={show:!0,text:a,color:"error"}}}},q={class:"d-flex align-center"};function D(a,e,h,E,s,m){return p(),k(B,{fluid:""},{default:r(()=>[t(V,{class:"mb-4"},{default:r(()=>[t(f,null,{default:r(()=>[o("div",q,[t(n,{to:"/app/oauth/applications",class:"mr-4","prepend-icon":"mdi-arrow-left",variant:"text"},{default:r(()=>[...e[4]||(e[4]=[i(" 返回应用列表 ",-1)])]),_:1}),e[5]||(e[5]=o("h1",{class:"text-h4"},"创建 OAuth 应用",-1))])]),_:1})]),_:1}),t(V,null,{default:r(()=>[t(f,{cols:"12",md:"8"},{default:r(()=>[t(b,null,{default:r(()=>[t(w,{ref:"form",onSubmit:U(m.saveApplication,["prevent"])},{default:r(()=>[t(_,null,{default:r(()=>[e[7]||(e[7]=o("h2",{class:"text-h6 mb-4"},"基本信息",-1)),t(c,{modelValue:s.form.name,"onUpdate:modelValue":e[0]||(e[0]=l=>s.form.name=l),rules:[l=>!!l||"应用名称是必填的"],class:"mb-4",label:"应用名称",required:""},null,8,["modelValue","rules"]),t(N,{modelValue:s.form.description,"onUpdate:modelValue":e[1]||(e[1]=l=>s.form.description=l),class:"mb-4",hint:"简要描述你的应用，帮助用户了解应用的用途",label:"应用描述",rows:"3"},null,8,["modelValue"]),t(c,{modelValue:s.form.homepage_url,"onUpdate:modelValue":e[2]||(e[2]=l=>s.form.homepage_url=l),rules:[l=>!l||/^https?:\/\/.+/.test(l)||"请输入有效的URL（以http://或https://开头）"],class:"mb-4",hint:"你的应用的完整URL",label:"应用主页"},null,8,["modelValue","rules"]),e[8]||(e[8]=o("h2",{class:"text-h6 mb-4 mt-6"},"回调设置",-1)),(p(!0),g(v,null,A(s.form.redirect_uris,(l,d)=>(p(),g("div",{key:d,class:"d-flex mb-2"},[t(c,{modelValue:s.form.redirect_uris[d],"onUpdate:modelValue":u=>s.form.redirect_uris[d]=u,rules:[u=>!!u||"回调URL是必填的",u=>/^https?:\/\/.+/.test(u)||"请输入有效的URL（以http://或https://开头）"],class:"mr-2",label:"授权回调URL",required:""},null,8,["modelValue","onUpdate:modelValue","rules"]),t(n,{disabled:s.form.redirect_uris.length===1,color:"error",icon:"mdi-delete",variant:"text",onClick:u=>m.removeRedirectUri(d)},null,8,["disabled","onClick"])]))),128)),t(n,{class:"mt-2","prepend-icon":"mdi-plus",variant:"text",onClick:m.addRedirectUri},{default:r(()=>[...e[6]||(e[6]=[i(" 添加回调URL ",-1)])]),_:1},8,["onClick"])]),_:1}),t(R),t(C,{class:"pa-4"},{default:r(()=>[t(S),t(n,{to:"/app/oauth/applications",class:"mr-2",variant:"outlined"},{default:r(()=>[...e[9]||(e[9]=[i(" 取消 ",-1)])]),_:1}),t(n,{loading:s.loading,color:"primary",type:"submit"},{default:r(()=>[...e[10]||(e[10]=[i(" 创建应用 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),t(f,{cols:"12",md:"4"},{default:r(()=>[t(b,null,{default:r(()=>[t(y,{class:"text-h6"},{default:r(()=>[...e[11]||(e[11]=[i(" 创建说明 ",-1)])]),_:1}),t(_,null,{default:r(()=>[e[13]||(e[13]=o("p",{class:"text-body-2 mb-4"}," OAuth应用允许其他应用通过OAuth2.0协议访问你的API。创建应用后，你将获得客户端ID和密钥。 ",-1)),t(T,{class:"mb-4",type:"info",variant:"tonal"},{default:r(()=>[...e[12]||(e[12]=[o("h4",{class:"text-subtitle-1 font-weight-bold mb-2"},"重要提示",-1),o("ul",{class:"ml-4"},[o("li",null,"客户端密钥只会显示一次，请妥善保管"),o("li",null,"回调URL必须使用HTTPS（本地开发除外）"),o("li",null,"谨慎选择应用权限范围")],-1)])]),_:1}),e[14]||(e[14]=o("p",{class:"text-body-2"},[i(" 需要帮助？查看我们的 "),o("a",{class:"text-decoration-none",href:"#",target:"_blank"},"OAuth应用开发指南"),i("。 ")],-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(L,{modelValue:s.snackbar.show,"onUpdate:modelValue":e[3]||(e[3]=l=>s.snackbar.show=l),color:s.snackbar.color,timeout:3e3},{default:r(()=>[i(O(s.snackbar.text),1)]),_:1},8,["modelValue","color"])]),_:1})}const Z=x(M,[["render",D],["__scopeId","data-v-0ec8f933"]]);export{Z as default};
