import{_ as b}from"./LoadingDialog-mLUpwCAn.js";import{_ as T}from"./AuthCard-B8eBVh_O.js";import{_ as A,a as y,o as V,h as t,N as i,Z as S,K as w,X as _,j as f,M as h,O as M,S as N,an as R,aq as B,b1 as F,b3 as U,r,e as j}from"./index-DKqePUrh.js";import{A as x}from"./authService-CyJyiAfk.js";import{V as z}from"./VForm-BVXfDvnz.js";import{V as K}from"./VTextField-i-JnkifG.js";import{V as O}from"./VSpacer-e-NAsH-v.js";import{V as X}from"./VDialog-DDRRILQ3.js";import"./VRow-MTxZhg05.js";/* empty css              */import"./VInput-yqi59OEB.js";/* empty css                   */const Z={components:{AuthCard:T,LoadingDialog:b},setup(){const v=F();U();const a=r(null),m=r(""),e=r(""),E=r(!1),g=r(!1),c=r(!1),p=r(!1),s=r(""),k=r("waiting"),D=[o=>!!o||"请输入电子邮件地址",o=>/.+@.+\..+/.test(o)||"请输入有效的电子邮件地址"];j(()=>{e.value=v.query.token||localStorage.getItem("verificationToken"),m.value=v.query.email||localStorage.getItem("verificationEmail"),e.value&&localStorage.setItem("verificationToken",e.value),m.value&&localStorage.setItem("verificationEmail",m.value),v.query.verified==="true"&&(k.value="success")});const I=async()=>{var o,u;if(!e.value){d("无法重新发送验证邮件：缺少验证令牌");return}g.value=!0;try{const l=await x.resendVerificationEmail(e.value);l.status==="success"?(e.value=l.temporaryToken,localStorage.setItem("verificationToken",e.value),C("验证邮件已重新发送，请查收")):d(l.message||"发送验证邮件失败")}catch(l){console.error("Error resending verification email:",l);const n=((u=(o=l.response)==null?void 0:o.data)==null?void 0:u.message)||"发送验证邮件时出错，请稍后再试";d(n)}finally{g.value=!1}},L=async()=>{var u,l;if(!a.value)return;const{valid:o}=await a.value.validate();if(o){c.value=!0;try{const n=await x.changeRegisterEmail(e.value,s.value);n.status==="success"?(m.value=n.email,e.value=n.temporaryToken,localStorage.setItem("verificationEmail",m.value),localStorage.setItem("verificationToken",e.value),p.value=!1,C("邮箱已更改，请查收验证邮件")):d(n.message||"更改邮箱失败")}catch(n){console.error("Error changing email:",n);const q=((l=(u=n.response)==null?void 0:u.data)==null?void 0:l.message)||"更改邮箱时出错，请稍后再试";d(q)}finally{c.value=!1}}},C=o=>{window.$toast?window.$toast.add({severity:"success",summary:"成功",detail:o,life:3e3}):window.$notify?window.$notify({title:"成功",message:o,type:"success"}):(console.log("Success:",o),alert(o))},d=o=>{window.$toast?window.$toast.add({severity:"error",summary:"错误",detail:o,life:3e3}):window.$notify?window.$notify({title:"错误",message:o,type:"error"}):(console.error("Error:",o),alert(o))};return{email:m,token:e,loading:E,resendLoading:g,changeEmailLoading:c,showChangeEmailDialog:p,newEmail:s,verificationStep:k,emailRules:D,emailForm:a,resendVerificationEmail:I,changeEmail:L}}},G={key:0},H={key:1,class:"text-center my-4"};function J(v,a,m,e,E,g){const c=T,p=b;return V(),y("div",null,[t(c,{subtitle:`快完成了！我们向 ${e.email} 发送了一封激活邮件。请按照邮件中的说明操作来激活您的账户。`},{default:i(()=>[t(S,null,{default:i(()=>[a[9]||(a[9]=w(" 如果您没有收到邮件，请检查您的垃圾邮件文件夹。 ")),e.verificationStep==="waiting"?(V(),y("div",G,[t(f,{color:"primary",variant:"flat",block:"",class:"mb-3",loading:e.resendLoading,onClick:e.resendVerificationEmail,"prepend-icon":"mdi-email-outline"},{default:i(()=>a[4]||(a[4]=[w(" 重新发送激活电子邮件 ")])),_:1},8,["loading","onClick"]),t(f,{color:"secondary",variant:"flat",block:"",onClick:a[0]||(a[0]=s=>e.showChangeEmailDialog=!0),"prepend-icon":"mdi-pencil"},{default:i(()=>a[5]||(a[5]=[w(" 更改电子邮件地址 ")])),_:1})])):_("",!0),e.verificationStep==="success"?(V(),y("div",H,[t(M,{color:"success",icon:"mdi-check-circle-outline",size:"x-large",class:"mb-2"}),a[7]||(a[7]=h("div",{class:"text-h6 mb-1"},"邮箱验证成功！",-1)),a[8]||(a[8]=h("div",{class:"text-body-1 mb-4"},"您的账户已激活，现在可以使用所有功能。",-1)),t(f,{color:"primary",variant:"flat",to:"/app/dashboard"},{default:i(()=>a[6]||(a[6]=[w(" 开始使用 ")])),_:1})])):_("",!0)]),_:1})]),_:1},8,["subtitle"]),t(X,{modelValue:e.showChangeEmailDialog,"onUpdate:modelValue":a[3]||(a[3]=s=>e.showChangeEmailDialog=s),"max-width":"500px"},{default:i(()=>[t(N,{title:"更改电子邮件地址"},{default:i(()=>[t(S,null,{default:i(()=>[t(z,{ref:"emailForm",onSubmit:R(e.changeEmail,["prevent"])},{default:i(()=>[t(K,{modelValue:e.newEmail,"onUpdate:modelValue":a[1]||(a[1]=s=>e.newEmail=s),label:"新的电子邮件地址",type:"email",rules:e.emailRules,variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1},8,["onSubmit"])]),_:1}),t(B,null,{default:i(()=>[t(O),t(f,{text:"取消",onClick:a[2]||(a[2]=s=>e.showChangeEmailDialog=!1)}),t(f,{color:"primary",text:"确认",loading:e.changeEmailLoading,onClick:e.changeEmail},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(p,{show:e.loading,text:"请稍候"},null,8,["show"])])}const re=A(Z,[["render",J]]);export{re as default};
