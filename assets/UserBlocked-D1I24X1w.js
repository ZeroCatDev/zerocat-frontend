import{_ as V,a1 as p,ab as x,ac as U,c as u,o as r,Y as c,e as l,N as s,R as b,a4 as w,Q as g,f as m,F as y,U as C,$ as B,aN as v,a9 as I,L as i,X as d,aP as N,i as h,Z as S,n as T,a3 as M,W as A,bJ as P}from"./index-CqDYMkg5.js";const E={name:"UserBlocked",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1}},data(){return{blockedUsers:[],loading:!0,loadingMore:!1,unblockingId:null,totalBlockedUsers:0,localuser:x,VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com",snackbar:{show:!1,text:"",color:"success"}}},computed:{hasMoreBlockedUsers(){return this.blockedUsers.length<this.totalBlockedUsers&&this.showAll}},watch:{userId:{immediate:!0,handler(o,e){o&&o!==e&&this.fetchBlockedUsers()}}},methods:{async fetchBlockedUsers(o=!1){if(this.userId)try{o?this.loadingMore=!0:this.loading=!0;const e=o?this.blockedUsers.length:0,n=this.showAll?this.limit:Math.min(this.limit,5),k=await p.get("/follows/blocked",{params:{limit:n,offset:e}});if(k.data.success){const t=k.data.data;o?this.blockedUsers=[...this.blockedUsers,...t.blocked]:this.blockedUsers=t.blocked,this.totalBlockedUsers=t.total}}catch(e){console.error("获取拉黑用户失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async unblockUser(o,e){try{this.unblockingId=o,await p.delete(`/follows/block/${o}`),this.blockedUsers=this.blockedUsers.filter(n=>n.user.id!==o),this.totalBlockedUsers--,this.showSnackbar(`已取消拉黑 ${e}`,"success")}catch(n){console.error("取消拉黑失败:",n),this.showSnackbar(n.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.unblockingId=null}},async loadMoreBlockedUsers(){await this.fetchBlockedUsers(!0)},showSnackbar(o,e="success"){this.snackbar={show:!0,text:o,color:e}}}},z={class:"user-blocked"},F={class:"text-caption text-medium-emphasis"},K={class:"d-flex justify-center mt-4 mb-4"},L={key:1,class:"text-medium-emphasis"};function R(o,e,n,k,t,f){const _=U("router-link");return r(),u("div",z,[t.loading?(r(),c(g,{key:0},{default:s(()=>[l(b,{cols:"12",class:"text-center"},{default:s(()=>[l(w,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):t.blockedUsers.length===0?(r(),c(g,{key:1},{default:s(()=>[l(b,{cols:"12",class:"text-center"},{default:s(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无拉黑用户",-1)])),_:1,__:[2]})]),_:1})):(r(),u(y,{key:2},[(r(!0),u(y,null,C(t.blockedUsers,a=>(r(),c(A,{key:a.id,class:"mb-3",hover:""},{default:s(()=>[l(v,null,{prepend:s(()=>[l(_,{to:`/${a.user.username}`},{default:s(()=>[l(S,{size:"50"},{default:s(()=>[l(T,{src:t.VITE_APP_S3_BUCKET+"/user/"+a.user.avatar,alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:s(()=>[l(h,{variant:"outlined",color:"error",size:"small",loading:t.unblockingId===a.user.id,onClick:j=>f.unblockUser(a.user.id,a.user.display_name)},{default:s(()=>e[3]||(e[3]=[i(" 取消拉黑 ")])),_:2,__:[3]},1032,["loading","onClick"])]),default:s(()=>[l(I,null,{default:s(()=>[l(_,{to:`/${a.user.username}`,class:"text-decoration-none"},{default:s(()=>[i(d(a.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),l(N,{class:"text-truncate"},{default:s(()=>[i(d(a.metadata.reason)+" - "+d(a.created_at),1)]),_:2},1024)]),_:2},1024),a.reason?(r(),c(M,{key:0,class:"pt-0"},{default:s(()=>[m("p",F,[e[4]||(e[4]=m("strong",null,"拉黑原因:",-1)),i(" "+d(a.reason),1)])]),_:2},1024)):B("",!0)]),_:2},1024))),128)),m("div",K,[f.hasMoreBlockedUsers?(r(),c(h,{key:0,loading:t.loadingMore,variant:"tonal",onClick:f.loadMoreBlockedUsers},{default:s(()=>e[5]||(e[5]=[i(" 加载更多 ")])),_:1,__:[5]},8,["loading","onClick"])):t.blockedUsers.length>0?(r(),u("div",L," 没有更多内容了 ")):B("",!0)])],64)),l(P,{modelValue:t.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=a=>t.snackbar.show=a),color:t.snackbar.color,timeout:3e3},{actions:s(()=>[l(h,{variant:"text",onClick:e[0]||(e[0]=a=>t.snackbar.show=!1)},{default:s(()=>e[6]||(e[6]=[i(" 关闭 ")])),_:1,__:[6]})]),default:s(()=>[i(d(t.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const D=V(E,[["render",R],["__scopeId","data-v-bddbfd80"]]);export{D as _};
