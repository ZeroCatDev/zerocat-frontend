import{_ as U}from"./Comment-D73LR3-3.js";import{_ as N}from"./Projects-BGb091-k.js";import{f as V,p as j,U as H,n as S,t as h,y as G,s as J,i as w,a,W as b,X as K,E as O,Y as F,B as q,k as D,Z as A,u as Q,$ as X,R as Y,a0 as ee,a1 as k,A as W,j as te,l as ie,a2 as se,a3 as ne,a4 as ae,a5 as z,z as re,a6 as le,a7 as oe,_ as ue,c as y,o as f,w as u,a8 as ce,a9 as I,G as g,J as de,H as _,O as m,P as me,aa as fe,e as v,M as E,N as P,K as T,ab as $,ac as B,ad as x,I as he,Q as L,T as _e}from"./index-lA30JOpC.js";import{g as ge,a as ye}from"./user-CkoqosMH.js";import{g as ve}from"./projectService-DZI5y-n5.js";import{V as M,a as R}from"./VRow-DmDRscHs.js";import{V as p}from"./VChip-DcVIQwGO.js";import{V as pe}from"./VContainer-D3Zkhk8X.js";import"./VForm-CWOLEV-e.js";import"./VTextarea-BQ-mGZoR.js";import"./VDialog-BLDCPA2x.js";import"./showProjects-Dep_qwiE.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-B3doEXZ_.js";/* empty css              */const Ce=j({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:A,iconColor:String,lineColor:String,...D(),...q(),...F(),...O()},"VTimelineDivider"),Te=V()({name:"VTimelineDivider",props:Ce(),setup(e,t){let{slots:r}=t;const{sizeClasses:c,sizeStyles:s}=H(e,"v-timeline-divider__dot"),{backgroundColorStyles:i,backgroundColorClasses:o}=S(h(e,"dotColor")),{roundedClasses:l}=G(e,"v-timeline-divider__dot"),{elevationClasses:n}=J(e),{backgroundColorClasses:d,backgroundColorStyles:C}=S(h(e,"lineColor"));return w(()=>a("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[a("div",{class:["v-timeline-divider__before",d.value],style:C.value},null),!e.hideDot&&a("div",{key:"dot",class:["v-timeline-divider__dot",n.value,l.value,c.value],style:s.value},[a("div",{class:["v-timeline-divider__inner-dot",o.value,l.value],style:i.value},[r.default?a(K,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},r.default):a(b,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),a("div",{class:["v-timeline-divider__after",d.value],style:C.value},null)])),{}}}),Z=j({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:A,iconColor:String,lineInset:[Number,String],...D(),...te(),...O(),...q(),...F(),...W()},"VTimelineItem"),be=V()({name:"VTimelineItem",props:Z(),setup(e,t){let{slots:r}=t;const{dimensionStyles:c}=Q(e),s=X(0),i=Y();return ee(i,o=>{var l;o&&(s.value=((l=o.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:l.getBoundingClientRect().width)??0)},{flush:"post"}),w(()=>{var o,l;return a("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":k(s.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${k(e.lineInset)})`:k(0)},e.style]},[a("div",{class:"v-timeline-item__body",style:c.value},[(o=r.default)==null?void 0:o.call(r)]),a(Te,{ref:i,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:r.icon}),e.density!=="compact"&&a("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((l=r.opposite)==null?void 0:l.call(r))])])}),{}}}),ke=j({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...oe(Z({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...D(),...le(),...W(),...re()},"VTimeline"),Ie=V()({name:"VTimeline",props:ke(),setup(e,t){let{slots:r}=t;const{themeClasses:c}=ie(e),{densityClasses:s}=se(e),{rtlClasses:i}=ne();ae({VTimelineDivider:{lineColor:h(e,"lineColor")},VTimelineItem:{density:h(e,"density"),dotColor:h(e,"dotColor"),fillDot:h(e,"fillDot"),hideOpposite:h(e,"hideOpposite"),iconColor:h(e,"iconColor"),lineColor:h(e,"lineColor"),lineInset:h(e,"lineInset"),size:h(e,"size")}});const o=z(()=>{const n=e.side?e.side:e.density!=="default"?"end":null;return n&&`v-timeline--side-${n}`}),l=z(()=>{const n=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return n;case"start":return n[0];case"end":return n[1];default:return null}});return w(()=>a(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,l.value,{"v-timeline--inset-line":!!e.lineInset},c.value,s.value,o.value,i.value,e.class],style:[{"--v-timeline-line-thickness":k(e.lineThickness)},e.style]},r)),{}}}),xe={components:{Projects:N,Comment:U},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},projectInfo:{},userInfo:{},currentPage:1,isLoadingMore:!1,pageSize:20}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await ye(this.username),_e({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await L({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(e=1){try{const t=await L.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});t.data.status==="success"&&(e===1?this.timeline=t.data.data:(this.timeline.events=[...this.timeline.events,...t.data.data.events],this.timeline.pagination=t.data.data.pagination),await this.fetchRelatedInfo())}catch(t){console.error("Failed to fetch timeline:",t)}},async fetchRelatedInfo(){const e=new Set,t=new Set,r=(this.currentPage-1)*this.pageSize;this.timeline.events.slice(r).forEach(s=>{var i,o,l,n,d;try{["project_create","project_delete","project_fork","project_publish","comment_create"].includes(s.type)&&(i=s.target)!=null&&i.id&&e.add(s.target.id),s.type==="comment_create"&&((o=s.event_data.page)==null?void 0:o.type)==="project"&&e.add(s.event_data.page.id),s.type==="comment_create"&&((n=(l=s.target)==null?void 0:l.page)==null?void 0:n.type)==="user"&&(d=s.target.page)!=null&&d.id&&t.add(s.target.page.id)}catch(C){console.warn("Error processing event:",s,C)}});try{if(e.size>0){const s=await ve(Array.from(e)),i=new Set;s.forEach(o=>{o&&o.id?(this.projectInfo[o.id]=o,o.authorid&&i.add(o.authorid)):console.warn("Project data is missing for ID:",o.id)}),i.forEach(o=>{o&&t.add(o)})}t.size>0&&(await ge(Array.from(t))).forEach(i=>{i&&i.id&&(this.userInfo[i.id]=i,Object.values(this.projectInfo).forEach(o=>{o&&o.authorid===i.id&&(o.author_username=i.username)}))})}catch(s){console.error("Error fetching related info:",s)}},getTargetLink(e){var t,r,c,s;if(!e)return null;try{const i=e.id||((t=e.page)==null?void 0:t.id),o=e.type||((r=e.page)==null?void 0:r.type);if(!o||!i)return null;switch(o){case"comment":{if(!((c=e.page)!=null&&c.type)||!((s=e.page)!=null&&s.id))return null;const{type:l,id:n}=e.page;if(l==="project"){const d=this.projectInfo[n];return!(d!=null&&d.author_username)||!(d!=null&&d.name)?null:`/${d.author_username}/${d.name}`}if(l==="user"){const d=this.userInfo[n];return d!=null&&d.username?`/${d.username}`:null}return null}case"project":{const l=this.projectInfo[i];return!(l!=null&&l.author_username)||!(l!=null&&l.name)?null:`/${l.author_username}/${l.name}`}case"user":{const l=this.userInfo[i];return l!=null&&l.username?`/${l.username}`:null}case"projectlist":return`/projectlist/${i}`;default:return null}}catch(i){return console.warn("Error generating target link:",i),null}},getTargetContent(e,t){if(!e)return"";try{switch(e.type){case"comment":return this.getCommentTargetContent(e,t);case"project":return this.getProjectTargetContent(e,t);case"user":return this.getUserTargetContent(e,t);default:return`未知目标类型 #${(e==null?void 0:e.id)||"未知"}`}}catch(r){return console.warn("Error generating target content:",r),"内容获取失败"}},getCommentTargetContent(e,t){var s;if(!e.page&&!((s=e.page)!=null&&s.type))return`评论 #${e.id}`;const{type:r,id:c}=e.page||{};switch(r){case"project":{const i=this.projectInfo[c];return i?`在作品 ${i.title} 下的评论`:`在作品 #${c} 下的评论`}case"user":{const i=this.userInfo[c];return i?`在用户 ${i.display_name} 主页下的评论`:`在用户 #${c} 主页下的评论`}default:return`在 ${r} #${c} 下的评论`}},getProjectTargetContent(e,t){const r=this.projectInfo[e.id];if(!r)return`项目 #${e.id}`;if(t==="project_publish"){const c=r.state==="public"?"公开":"私有";return`${r.title||r.name}（${c}）`}return r.title||r.name},getUserTargetContent(e,t){const r=this.userInfo[e.id];return r?r.display_name:`用户 #${e.id}`},getEventChipText(e){return{project_create:"新建项目",project_delete:"删除项目",project_fork:"复刻项目",project_publish:"发布项目",comment_create:"评论",user_profile_update:"个人资料",user_register:"用户注册"}[e]||e},getEventColor(e){return{project_create:"success",project_delete:"error",project_fork:"warning",project_publish:"info",comment_create:"secondary",user_profile_update:"info",user_register:"primary"}[e]||"primary"},getEventDisplayText(e){const t=e.actor.display_name;switch(e.type){case"project_create":return`${t} 创建了新项目`;case"project_delete":return`${t} 删除了项目`;case"project_fork":return`${t} 复刻了项目`;case"project_publish":return`${t} 发布了项目`;case"comment_create":return`${t} 发表了评论`;case"user_profile_update":{const r=e.event_data.updated_fields.map(c=>this.getFieldDisplayName(c)).join("、");return`${t} 更新了个人资料（${r}）`}case"user_register":return`${t} 加入了 ZeroCat`;default:return`${t} 进行了操作`}},getFieldDisplayName(e){return{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"}[e]||e},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}}}},Ve={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},je={class:"mt-2 text-body-1 text-medium-emphasis"},we={class:"mt-2 text-medium-emphasis"},De={key:0,class:"text-body-2 mt-1 text-grey"},Se={key:0,class:"text-body-2 mt-1 text-grey"},ze={class:"d-flex justify-center mt-4 mb-4"},Ee={key:1,class:"text-medium-emphasis"};function Pe(e,t,r,c,s,i){const o=N,l=U;return f(),y(pe,null,{default:u(()=>[a(ce,{modelValue:s.tab,"onUpdate:modelValue":t[0]||(t[0]=n=>s.tab=n)},{default:u(()=>[a(I,{value:"home"},{default:u(()=>[a(de,{class:"mt-8"},{default:u(()=>[a(M,{class:"d-flex align-center"},{default:u(()=>[a(R,null,{default:u(()=>[t[2]||(t[2]=g("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),g("p",Ve,[_(m(s.user.display_name)+" ",1),a(me,{size:"52",class:"ma-2"},{default:u(()=>[a(fe,{src:"https://s4-1.wuyuan.1r.ink/user/"+s.user.images},null,8,["src"])]),_:1})]),g("p",je,m(s.user.motto),1),g("p",we,[a(p,null,{default:u(()=>[a(b,{icon:"mdi-account-circle",start:""}),_(" ID:"+m(s.user.id),1)]),_:1}),a(p,null,{default:u(()=>[a(b,{icon:"mdi-clock",start:""}),_(" "+m(s.user.regTime)+"注册 ",1)]),_:1}),a(p,null,{default:u(()=>[a(b,{icon:"mdi-tag",start:""}),t[1]||(t[1]=_(" 创作者 "))]),_:1})])]),_:1})]),_:1})]),_:1}),t[3]||(t[3]=g("br",null,null,-1)),a(o,{url:s.url},null,8,["url"]),a(M,null,{default:u(()=>[(f(!0),v(E,null,P(s.lists,n=>(f(),y(R,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:n.id},{default:u(()=>[a(T,{rounded:"lg"},{default:u(()=>[a(T,{to:"/app/projectlist/"+n.id,rounded:"lg",title:n.title,subtitle:n.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t[4]||(t[4]=g("br",null,null,-1)),a(l,{url:"user-"+s.user.id,name:"用户"},null,8,["url"])]),_:1}),a(I,{value:"comment"},{default:u(()=>[a(l,{url:"user-"+s.user.id,name:"用户"},null,8,["url"])]),_:1}),a(I,{value:"timeline"},{default:u(()=>[a(Ie,{side:"end",align:"start",class:"mt-4"},{default:u(()=>[(f(!0),v(E,null,P(s.timeline.events,n=>(f(),y(be,{key:n.id,size:"small","dot-color":"primary"},{opposite:u(()=>[_(m(new Date(n.created_at).toLocaleString()),1)]),default:u(()=>[i.getTargetLink(n.target)?(f(),y(T,{key:0,class:"elevation-1",to:i.getTargetLink(n.target)},{default:u(()=>[a($,{class:"text-subtitle-1"},{default:u(()=>[_(m(i.getEventDisplayText(n)),1)]),_:2},1024),a(B,null,{default:u(()=>[a(p,{size:"small",color:i.getEventColor(n.type),class:"mr-2"},{default:u(()=>[_(m(i.getEventChipText(n.type)),1)]),_:2},1032,["color"]),g("div",null,m(i.getTargetContent(n.target,n.type)),1),n.event_data.comment_text?(f(),v("div",De,m(n.event_data.comment_text),1)):x("",!0)]),_:2},1024)]),_:2},1032,["to"])):(f(),y(T,{key:1,class:"elevation-1"},{default:u(()=>[a($,{class:"text-subtitle-1"},{default:u(()=>[_(m(i.getEventDisplayText(n)),1)]),_:2},1024),a(B,null,{default:u(()=>[a(p,{size:"small",color:i.getEventColor(n.type),class:"mr-2"},{default:u(()=>[_(m(i.getEventChipText(n.type)),1)]),_:2},1032,["color"]),g("div",null,m(i.getTargetContent(n.target,n.type)),1),n.event_data.comment_text?(f(),v("div",Se,m(n.event_data.comment_text),1)):x("",!0)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1}),g("div",ze,[i.hasMoreEvents?(f(),y(he,{key:0,loading:s.isLoadingMore,variant:"tonal",onClick:i.loadMoreEvents},{default:u(()=>t[5]||(t[5]=[_(" 加载更多 ")])),_:1},8,["loading","onClick"])):s.timeline.events.length>0?(f(),v("div",Ee," 没有更多内容了 ")):x("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Je=ue(xe,[["render",Pe],["__scopeId","data-v-5cfb5486"]]);export{Je as default};
