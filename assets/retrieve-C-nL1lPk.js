import{_ as b}from"./LoadingDialog-BwXkkSld.js";import{_ as k}from"./AuthCard-CuqiWb9S.js";import{_ as D,a as L,o as C,h as s,P as i,ap as q,X as y,Z as P,k as w,N as E,W as F,b4 as I,r,A as W,al as Z,O as H}from"./index-BctWDPHB.js";import{A as _}from"./authService-Cp-BUhns.js";import{V as M}from"./VForm-Cn_R_Pyx.js";import{V as O,a as f}from"./VRow-CrlTTS1d.js";import{V as p}from"./VTextField-qJ1QuwJY.js";import"./VDialog-B4X6Kxmw.js";import"./VInput-CTxpQVcW.js";/* empty css              *//* empty css                   */import"./VField-D6j28sJF.js";const X={components:{LoadingDialog:b,AuthCard:k},setup(){const v=I(),a=r(""),m=r(""),e=r(""),g=r(""),x=r(1),d=r(!1),u=r(0),t=r(!1),R=r(!1),V=r("处理中..."),T={required:o=>!!o||"此字段为必填项",length:o=>(o==null?void 0:o.length)===6||"验证码必须是6位数字"},A=[o=>!!o||"必须填写邮箱",o=>/.+@.+\..+/.test(o)||"不符合格式"],z=[o=>!!o||"必须填写密码",o=>o.length>=8||"密码至少需要8个字符",o=>/[A-Za-z]/.test(o)&&/[0-9]/.test(o)||"密码必须包含字母和数字"],B=W(()=>[o=>!!o||"必须确认密码",o=>o===e.value||"两次输入的密码不一致"]);Z.isLogin.value===!0&&v.push("/app/explore"),H({title:"重设密码"});const N=async()=>{var o,l;if(!(u.value>0)){if(!a.value||!/.+@.+\..+/.test(a.value)){c("请输入正确的邮箱地址");return}d.value=!0,V.value="正在发送验证码...";try{const n=await _.sendPasswordResetCode(a.value);n.status==="success"?(h("验证码已发送到您的邮箱"),x.value=2,U()):c(n.message||"发送验证码失败")}catch(n){c(((l=(o=n.response)==null?void 0:o.data)==null?void 0:l.message)||"发送验证码失败")}finally{d.value=!1}}},S=async()=>{var o,l;if(!m.value||m.value.length!==6){c("请输入6位验证码");return}if(!e.value||e.value!==g.value){c("请确保输入了密码且两次输入一致");return}d.value=!0,V.value="正在重设密码...";try{const n=await _.resetPasswordWithCode(a.value,m.value,e.value);n.status==="success"?(h("密码重置成功，请使用新密码登录"),setTimeout(()=>{v.push("/app/account/login")},2e3)):c(n.message||"重置密码失败")}catch(n){c(((l=(o=n.response)==null?void 0:o.data)==null?void 0:l.message)||"重置密码失败")}finally{d.value=!1}},U=()=>{u.value=60;const o=setInterval(()=>{u.value--,u.value<=0&&clearInterval(o)},1e3)},h=o=>{var l;(l=this==null?void 0:this.$toast)==null||l.add({severity:"success",summary:"成功",detail:o,life:3e3})},c=o=>{var l;(l=this==null?void 0:this.$toast)==null||l.add({severity:"error",summary:"错误",detail:o,life:3e3})};return{email:a,verificationCode:m,password:e,confirmPassword:g,step:x,loading:d,countdown:u,showPassword:t,showConfirmPassword:R,loadingText:V,rules:T,emailRules:A,passwordRules:z,confirmPasswordRules:B,sendVerificationCode:N,resetPassword:S}}};function j(v,a,m,e,g,x){const d=k,u=b;return C(),L("div",null,[s(d,{subtitle:"重设密码"},{default:i(()=>[s(M,{onSubmit:a[7]||(a[7]=q(()=>{},["prevent"]))},{default:i(()=>[s(O,null,{default:i(()=>[s(f,{cols:"12"},{default:i(()=>[s(p,{label:"邮箱",type:"text",modelValue:e.email,"onUpdate:modelValue":a[0]||(a[0]=t=>e.email=t),variant:"outlined",rules:e.emailRules,disabled:e.step>1},null,8,["modelValue","rules","disabled"])]),_:1}),e.step>=2?(C(),y(f,{key:0,cols:"12"},{default:i(()=>[s(p,{modelValue:e.verificationCode,"onUpdate:modelValue":a[1]||(a[1]=t=>e.verificationCode=t),label:"验证码",variant:"outlined",maxlength:"6",rules:[e.rules.required,e.rules.length]},null,8,["modelValue","rules"]),s(w,{class:"mb-4",variant:"text",onClick:e.sendVerificationCode,disabled:e.countdown>0},{default:i(()=>[E(F(e.countdown>0?`${e.countdown}秒后重新发送`:"重新发送验证码"),1)]),_:1},8,["onClick","disabled"])]),_:1})):P("",!0),e.step>=2?(C(),y(f,{key:1,cols:"12"},{default:i(()=>[s(p,{label:"新密码",modelValue:e.password,"onUpdate:modelValue":a[2]||(a[2]=t=>e.password=t),variant:"outlined",rules:e.passwordRules,"append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",type:e.showPassword?"text":"password","onClick:append":a[3]||(a[3]=t=>e.showPassword=!e.showPassword)},null,8,["modelValue","rules","append-icon","type"]),s(p,{label:"确认密码",modelValue:e.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=t=>e.confirmPassword=t),variant:"outlined",rules:e.confirmPasswordRules,"append-icon":e.showConfirmPassword?"mdi-eye":"mdi-eye-off",type:e.showConfirmPassword?"text":"password","onClick:append":a[5]||(a[5]=t=>e.showConfirmPassword=!e.showConfirmPassword)},null,8,["modelValue","rules","append-icon","type"])]),_:1})):P("",!0),s(f,{cols:"12"},{default:i(()=>[s(w,{class:"text-none",color:"primary",rounded:"xl",text:e.step===1?"获取验证码":"重设密码",variant:"flat",size:"large",onClick:a[6]||(a[6]=t=>e.step===1?e.sendVerificationCode():e.resetPassword()),"append-icon":"mdi-arrow-right",loading:e.loading},null,8,["text","loading"])]),_:1}),s(f,{cols:"12"},{default:i(()=>[s(w,{class:"text-none",color:"white",rounded:"xl",text:"登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/login"}),s(w,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"})]),_:1})]),_:1})]),_:1})]),_:1}),s(u,{show:e.loading,text:e.loadingText},null,8,["show","text"])])}const re=D(X,[["render",j]]);export{re as default};
