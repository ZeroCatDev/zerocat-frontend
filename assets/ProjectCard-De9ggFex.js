import{c as j}from"./projectService-DC80S6NH.js";import{a as m}from"./user-B1yyLxxw.js";import{_ as g}from"./43-lazyload-CBkwrR6M.js";import{_ as I,T as l,o as u,N as a,h as o,W as y,R as c,q as D,ar as n,as as d,K as s,S as h,at as p}from"./index-BoardjOA.js";const A={props:{projectData:{type:Object,default:null},projectId:{type:[Number,String],default:null},authorData:{type:Object,default:null},showAuthor:{type:Boolean,default:!1}},data(){return{project:null,author:null,loading:!1,VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},created(){this.initializeData()},watch:{projectData:{handler(){this.initializeData()},deep:!0},authorData:{handler(){this.initializeData()},deep:!0},projectId(){this.initializeData()},showAuthor(){this.loadAuthorIfNeeded()}},methods:{initializeData(){this.projectData?this.project=this.projectData:this.projectId&&this.fetchProject(this.projectId),this.authorData?this.author=this.authorData:this.loadAuthorIfNeeded()},loadAuthorIfNeeded(){var r;this.showAuthor&&!this.author&&((r=this.project)!=null&&r.authorid)&&this.fetchAuthor(this.project.authorid)},getProjectLink(){var r;return this.project?this.project.name&&((r=this.author)!=null&&r.username)?`/${this.author.username}/${this.project.name}`:`/app/link/project?id=${this.project.id}`:""},async fetchProject(r){if(!this.loading){this.loading=!0;try{const t=await j([r]);t&&t.length>0&&(this.project=t[0],this.loadAuthorIfNeeded())}catch(t){console.error("Failed to fetch project:",t)}finally{this.loading=!1}}},async fetchAuthor(r){if(!(!this.showAuthor||this.authorData))try{const t=await m([r]);t&&t.length>0&&(this.author=t[0])}catch(t){console.error("Failed to fetch author:",t)}}}};function P(r,t,f,V,e,_){return u(),l(c,{rounded:"lg",class:"box-shadow"},{default:a(()=>[o(c,{to:_.getProjectLink(),style:{"aspect-ratio":"4/3"},rounded:"lg"},{default:a(()=>[o(D,{src:e.project?e.VITE_APP_S3_BUCKET+"/scratch_slt/"+e.project.id:"",class:"align-end","lazy-src":g,height:"100%",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",cover:""},{default:a(()=>[o(n,null,{default:a(()=>[o(d,null,{default:a(()=>{var i;return[s(h(((i=e.project)==null?void 0:i.title)||"加载中..."),1)]}),_:1}),o(p,null,{default:a(()=>{var i;return[s(h(((i=e.project)==null?void 0:i.description)||""),1)]}),_:1})]),_:1})]),_:1},8,["src"])]),_:1},8,["to"]),f.showAuthor&&e.author?(u(),l(n,{key:0,"append-avatar":e.author.images?e.VITE_APP_S3_BUCKET+"/user/"+e.author.images:""},{default:a(()=>[o(d,null,{default:a(()=>[s(h(e.author.display_name||e.author.username||"未知用户"),1)]),_:1}),o(p,null,{default:a(()=>[s(h(e.author.username||""),1)]),_:1})]),_:1},8,["append-avatar"])):y("",!0)]),_:1})}const T=I(A,[["render",P],["__scopeId","data-v-344c9fbf"]]);export{T as _};
