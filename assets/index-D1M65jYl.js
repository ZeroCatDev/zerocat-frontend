import{_ as v}from"./LoadingDialog-BsPFae49.js";import{_ as w}from"./AuthCard-BmjRfnYf.js";import{_ as k}from"./Recaptcha-DHzw24Js.js";import{_ as V,a as y,o as b,h as t,P as n,ap as L,k as d,i as R,b4 as S,r as u,al as C,O as M}from"./index-XUUb1OfO.js";import{A as z}from"./authService-DCm_SNPw.js";import{V as A}from"./VForm-DeJUwvQb.js";import{V as B,a as p}from"./VRow-CLVTyibo.js";import{V as T}from"./VTextField-DAtkSgVq.js";import"./VDialog-BP2snORb.js";import"https://static.geetest.com/v4/gt4.js";import"./VInput-CwLlTEft.js";/* empty css              *//* empty css                   */import"./VField-ufV-l5ih.js";const D={components:{LoadingDialog:v,Recaptcha:k,AuthCard:w},setup(){const _=S(),r=u(null),i=u(""),e=u(!1),c=u(!1),g=[a=>!!a||"必须填写邮箱",a=>/.+@.+\..+/.test(a)||"不符合格式"];C.isLogin.value===!0&&_.push("/app/explore"),M({title:"魔术链接登录"});const m=async()=>{var a,o,h;if(!i.value||!/.+@.+\..+/.test(i.value)){s("请输入正确的邮箱地址");return}if(!c.value){e.value=!0;try{const l=(a=r.value)==null?void 0:a.getResponse();if(!l){s("请完成人机验证"),e.value=!1;return}const x=await z.generateMagicLink(i.value,window.location.origin+"/app/account/magiclink/validate",l);x.status==="success"?(f("登录链接已发送到您的邮箱"),c.value=!0):s(x.message||"发送失败")}catch(l){s(((h=(o=l.response)==null?void 0:o.data)==null?void 0:h.message)||l.message)}finally{e.value=!1}}},f=a=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"success",summary:"成功",detail:a,life:3e3})},s=a=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"error",summary:"错误",detail:a,life:3e3})};return{email:i,loading:e,linkSent:c,recaptcha:r,emailRules:g,sendMagicLink:m}}},E={class:"d-flex flex-wrap justify-start gap-2"};function F(_,r,i,e,c,g){const m=k,f=w,s=v;return b(),y("div",null,[t(f,{subtitle:"魔术链接登录"},{default:n(()=>[t(A,{onSubmit:L(e.sendMagicLink,["prevent"])},{default:n(()=>[t(B,null,{default:n(()=>[t(p,{cols:"12"},{default:n(()=>[t(T,{label:"邮箱",type:"text",modelValue:e.email,"onUpdate:modelValue":r[0]||(r[0]=a=>e.email=a),variant:"outlined",rules:e.emailRules},null,8,["modelValue","rules"])]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(m,{ref:"recaptcha",recaptchaId:"recaptcha-div"},null,512)]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(d,{class:"text-none",color:"primary",rounded:"xl",text:e.linkSent?"已发送，请检查邮箱":"发送登录链接",variant:"flat",size:"large",onClick:e.sendMagicLink,"append-icon":"mdi-arrow-right",loading:e.loading,disabled:e.linkSent},null,8,["text","onClick","loading","disabled"])]),_:1}),t(p,{cols:"12"},{default:n(()=>[R("div",E,[t(d,{class:"text-none",color:"white",rounded:"xl",text:"密码登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/login"}),t(d,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),t(d,{class:"text-none",color:"white",rounded:"xl",text:"找回密码",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),t(s,{show:e.loading,text:"处理中"},null,8,["show"])])}const Y=V(D,[["render",F]]);export{Y as default};
