import{_ as ve}from"./Projects-CW-STLq1.js";import{g as Re,p as Ee,a as Me,r as M,A as R,bZ as Be,ca as Le,u as Y,b_ as Oe,x as S,b$ as Ne,w as z,av as oe,bW as Ke,d as ze,aB as I,e as a,f as k,O as ue,cd as qe,F as G,az as He,m as j,ad as We,ae as se,a0 as me,aO as Ze,Z as Qe,c2 as Xe,C as Ye,D as Ge,S as fe,h as Je,L as A,bs as $e,c3 as el,bt as ll,c5 as tl,c6 as re,c0 as al,c7 as ie,_ as nl,Y as ol,o as ul,N as r,Q as ce,R as b,i as T,aA as sl,W as rl,a3 as il,X as de,aE as cl,T as dl,a1 as J,ab as $,M as vl}from"./index-r6fcKOtS.js";import{u as ml,a as fl,m as pl,V as E}from"./VSelect-CqzpKYmd.js";import{u as hl,h as gl,m as Vl}from"./filter-ZWPO1MUK.js";import{V as yl}from"./VCheckboxBtn-ClUg9APb.js";import{V as bl}from"./VTextarea-BZoez_Kc.js";import{V as Pl}from"./VCombobox-DeZfogg9.js";import{V as Cl,a as xl,b as kl,c as wl}from"./VExpansionPanels-Dv3iViqx.js";import{V as Sl}from"./VSpacer-BLecZNSl.js";import"./ProjectCard-D_K6EfRS.js";import"https://static.geetest.com/v4/gt4.js";import"./VSelectionControl-Qfuz-I_M.js";const jl=Ee({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Vl({filterKeys:["title"]}),...pl(),...ll(tl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...el({transition:!1})},"VAutocomplete"),_l=Re()({name:"VAutocomplete",props:jl(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,n){let{slots:u}=n;const{t:B}=Me(),t=M(),V=R(!1),C=R(!0),o=R(!1),F=M(),U=M(),v=R(-1),{items:q,transformIn:pe,transformOut:he}=Be(e),{textColorClasses:ge,textColorStyles:Ve}=Le(()=>{var l;return(l=t.value)==null?void 0:l.color}),y=Y(e,"search",""),c=Y(e,"modelValue",[],l=>pe(l===null?[null]:Oe(l)),l=>{const s=he(l);return e.multiple?s:s[0]??null}),ye=S(()=>typeof e.counterValue=="function"?e.counterValue(c.value):typeof e.counterValue=="number"?e.counterValue:c.value.length),L=Ne(e),{filteredItems:H,getMatches:be}=hl(e,q,()=>C.value?"":y.value),w=S(()=>e.hideSelected?H.value.filter(l=>!c.value.some(s=>s.value===l.value)):H.value),O=S(()=>!!(e.chips||u.chip)),D=S(()=>O.value||!!u.selection),Pe=S(()=>c.value.map(l=>l.props.value)),W=S(()=>{var s;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&y.value===((s=w.value[0])==null?void 0:s.title))&&w.value.length>0&&!C.value&&!o.value}),N=S(()=>e.hideNoData&&!w.value.length||L.isReadonly.value||L.isDisabled.value),Z=Y(e,"menu"),h=S({get:()=>Z.value,set:l=>{var s;Z.value&&!l&&((s=F.value)!=null&&s.ΨopenChildren.size)||l&&N.value||(Z.value=l)}}),ee=S(()=>h.value?e.closeText:e.openText),Q=M(),Ce=ml(Q,t);function xe(l){e.openOnClear&&(h.value=!0),y.value=""}function ke(){N.value||(h.value=!0)}function we(l){N.value||(V.value&&(l.preventDefault(),l.stopPropagation()),h.value=!h.value)}function Se(l){var s;(re(l)||l.key==="Backspace")&&((s=t.value)==null||s.focus())}function je(l){var i,p,P,x,d;if(L.isReadonly.value)return;const s=(i=t.value)==null?void 0:i.selectionStart,f=c.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(h.value=!0),["Escape"].includes(l.key)&&(h.value=!1),W.value&&["Enter","Tab"].includes(l.key)&&!c.value.some(m=>{let{value:g}=m;return g===w.value[0].value})&&_(w.value[0]),l.key==="ArrowDown"&&W.value&&((p=Q.value)==null||p.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&D.value&&c.value.length>0&&!y.value)return _(c.value[0],!1);if(~v.value){l.preventDefault();const m=v.value;_(c.value[v.value],!1),v.value=m>=f-1?f-2:m}else l.key==="Backspace"&&!y.value&&(v.value=f-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(v.value<0&&s&&s>0)return;const m=v.value>-1?v.value-1:f-1;if(c.value[m])v.value=m;else{const g=((P=y.value)==null?void 0:P.length)??null;v.value=-1,(x=t.value)==null||x.setSelectionRange(g,g)}}else if(l.key==="ArrowRight"){if(v.value<0)return;const m=v.value+1;c.value[m]?v.value=m:(v.value=-1,(d=t.value)==null||d.setSelectionRange(0,0))}else~v.value&&re(l)&&(v.value=-1)}function _e(l){if(ie(t.value,":autofill")||ie(t.value,":-webkit-autofill")){const s=q.value.find(f=>f.title===l.target.value);s&&_(s)}}function Ie(){var l;e.eager&&((l=U.value)==null||l.calculateVisibleItems())}function De(){var l;V.value&&(C.value=!0,(l=t.value)==null||l.focus())}function Te(l){V.value=!0,setTimeout(()=>{o.value=!0})}function Ae(l){o.value=!1}function Fe(l){(l==null||l===""&&!e.multiple&&!D.value)&&(c.value=[])}const X=R(!1);function _(l){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const f=c.value.findIndex(p=>(e.valueComparator||al)(p.value,l.value)),i=s??!~f;if(~f){const p=i?[...c.value,l]:[...c.value];p.splice(f,1),c.value=p}else i&&(c.value=[...c.value,l]);e.clearOnSelect&&(y.value="")}else{const f=s!==!1;c.value=f?[l]:[],y.value=f&&!D.value?l.title:"",oe(()=>{h.value=!1,C.value=!0})}}return z(V,(l,s)=>{var f;l!==s&&(l?(X.value=!0,y.value=e.multiple||D.value?"":String(((f=c.value.at(-1))==null?void 0:f.props.title)??""),C.value=!0,oe(()=>X.value=!1)):(!e.multiple&&y.value==null&&(c.value=[]),h.value=!1,(e.multiple||D.value)&&(y.value=""),v.value=-1))}),z(y,l=>{!V.value||X.value||(l&&(h.value=!0),C.value=!l)}),z(h,()=>{if(!e.hideSelected&&h.value&&c.value.length){const l=w.value.findIndex(s=>c.value.some(f=>s.value===f.value));Ke&&window.requestAnimationFrame(()=>{var s;l>=0&&((s=U.value)==null||s.scrollToIndex(l))})}}),z(()=>e.items,(l,s)=>{h.value||V.value&&!s.length&&l.length&&(h.value=!0)}),ze(()=>{const l=!!(!e.hideNoData||w.value.length||u["prepend-item"]||u["append-item"]||u["no-data"]),s=c.value.length>0,f=I.filterProps(e);return a(I,j({ref:t},f,{modelValue:y.value,"onUpdate:modelValue":[i=>y.value=i,Fe],focused:V.value,"onUpdate:focused":i=>V.value=i,validationValue:c.externalValue,counterValue:ye.value,dirty:s,onChange:_e,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":h.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!D.value,"v-autocomplete--selecting-index":v.value>-1},e.class],style:e.style,readonly:L.isReadonly.value,placeholder:s?void 0:e.placeholder,"onClick:clear":xe,"onMousedown:control":ke,onKeydown:je}),{...u,default:()=>k(G,null,[a(He,j({ref:F,modelValue:h.value,"onUpdate:modelValue":i=>h.value=i,activator:"parent",contentClass:"v-autocomplete__content",disabled:N.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Ie,onAfterLeave:De},e.menuProps),{default:()=>[l&&a(We,j({ref:Q,filterable:!0,selected:Pe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:i=>i.preventDefault(),onKeydown:Se,onFocusin:Te,onFocusout:Ae,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},Ce,e.listProps),{default:()=>{var i,p,P;return[(i=u["prepend-item"])==null?void 0:i.call(u),!w.value.length&&!e.hideNoData&&(((p=u["no-data"])==null?void 0:p.call(u))??a(se,{key:"no-data",title:B(e.noDataText)},null)),a(fl,{ref:U,renderless:!0,items:w.value,itemKey:"value"},{default:x=>{var te,ae,ne;let{item:d,index:m,itemRef:g}=x;const le=j(d.props,{ref:g,key:d.value,active:W.value&&m===0?!0:void 0,onClick:()=>_(d,null)});return d.type==="divider"?((te=u.divider)==null?void 0:te.call(u,{props:d.raw,index:m}))??a(me,j(d.props,{key:`divider-${m}`}),null):d.type==="subheader"?((ae=u.subheader)==null?void 0:ae.call(u,{props:d.raw,index:m}))??a(Ze,j(d.props,{key:`subheader-${m}`}),null):((ne=u.item)==null?void 0:ne.call(u,{item:d,index:m,props:le}))??a(se,j(le,{role:"option"}),{prepend:K=>{let{isSelected:Ue}=K;return k(G,null,[e.multiple&&!e.hideSelected?a(yl,{key:d.value,modelValue:Ue,ripple:!1,tabindex:"-1"},null):void 0,d.props.prependAvatar&&a(Qe,{image:d.props.prependAvatar},null),d.props.prependIcon&&a(ue,{icon:d.props.prependIcon},null)])},title:()=>{var K;return C.value?d.title:gl("v-autocomplete",d.title,(K=be(d))==null?void 0:K.title)}})}}),(P=u["append-item"])==null?void 0:P.call(u)]}})]}),c.value.map((i,p)=>{function P(g){g.stopPropagation(),g.preventDefault(),_(i,!1)}const x={"onClick:close":P,onKeydown(g){g.key!=="Enter"&&g.key!==" "||(g.preventDefault(),g.stopPropagation(),P(g))},onMousedown(g){g.preventDefault(),g.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},d=O.value?!!u.chip:!!u.selection,m=d?Xe(O.value?u.chip({item:i,index:p,props:x}):u.selection({item:i,index:p})):void 0;if(!(d&&!m))return k("div",{key:i.value,class:Ge(["v-autocomplete__selection",p===v.value&&["v-autocomplete__selection--selected",ge.value]]),style:Ye(p===v.value?Ve.value:{})},[O.value?u.chip?a(Je,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:i.title}}},{default:()=>[m]}):a(fe,j({key:"chip",closable:e.closableChips,size:"small",text:i.title,disabled:i.props.disabled},x),null):m??k("span",{class:"v-autocomplete__selection-text"},[i.title,e.multiple&&p<c.value.length-1&&k("span",{class:"v-autocomplete__selection-comma"},[A(",")])])])})]),"append-inner":function(){var x,d;for(var i=arguments.length,p=new Array(i),P=0;P<i;P++)p[P]=arguments[P];return k(G,null,[(x=u["append-inner"])==null?void 0:x.call(u,...p),e.menuIcon?a(ue,{class:"v-autocomplete__menu-icon",color:(d=t.value)==null?void 0:d.fieldIconColor,icon:e.menuIcon,onMousedown:we,onClick:qe,"aria-label":B(ee.value),title:B(ee.value),tabindex:"-1"},null):void 0])}})}),$e({isFocused:V,isPristine:C,menu:h,search:y,filteredItems:H,select:_},t)}}),Il={components:{Projects:ve},data(){return{localuser:$,projectstates:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],projecthistory:[{state:"关闭",abbr:"0"},{state:"开启",abbr:"1"}],searchstates:[{state:"所有",abbr:""},{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],typeitems:[{name:"所有",type:""},{name:"Scratch",type:"scratch"},{name:"Python",type:"python"}],orderitems:[{name:"观看量升序",type:"view_up"},{name:"观看量降序",type:"view_down"},{name:"时间升序",type:"time_up"},{name:"时间降序",type:"time_down"},{name:"序号升序",type:"id_up"},{name:"序号降序",type:"id_down"}],currentProjectID:0,dialog:!1,currentProject:{},previousProject:{},search:{title:"",type:"",description:"",source:"",order:"view_up",authorid:"",type:"",state:"",tag:""},aboutTags:{items:["动画","故事","音乐","硬核","艺术","水"],chips:M({}),selected:[]},url:""}},async created(){$.isLogin.value===!1&&this.$router.push("/app/account/login"),await this.onPageChange()},setup(){vl({title:"我的作品"})},methods:{removetag(e){chips.value.splice(chips.value.indexOf(e),1)},projecttypeProps(e){return{title:e.name,subtitle:e.department}},async onPageChange(e=1){this.url=`/searchapi?search_userid=${$.user.value.id}&search_type=${this.search.type}&search_title=${this.search.title}&search_source=${this.search.source}&search_description=${this.search.description}&search_orderby=${this.search.order}&search_state=${this.search.state}&search_tag=${this.search.tag}`},resetSearch(){this.search={title:"",type:"scratch",description:"",source:"",order:"view_up",authorid:"",state:"public",tag:"",limit:20},this.onPageChange()},openinfo(e,n){this.currentProjectID=e,this.currentProject=n,this.previousProject={...n},this.aboutTags.chips=this.currentProject.tags.map(u=>u.name),this.dialog=!0},async pushproject(e){try{const n=await J.post(`/project/${e}/push`);console.log(n.data),this.$toast.add({severity:"info",summary:"info",detail:n.data.message,life:3e3}),this.onPageChange()}catch(n){console.log(n),this.$toast.add({severity:"error",summary:"失败",detail:"失败",life:3e3})}},async deleteProject(){try{const e=await J.delete(`/project/edit/${this.currentProjectID}`);console.log(e.data),this.$toast.add({severity:"info",summary:"info",detail:e.data.message,life:3e3}),this.onPageChange(),this.dialog=!1}catch(e){console.log(e),this.$toast.add({severity:"error",summary:"error",detail:"删除失败",life:3e3})}},async SaveProjectsInfo(){this.currentProject.tags=this.aboutTags.chips.map(e=>e);try{const e=await J.put(`/project/id/${this.currentProjectID}`,this.currentProject);console.log(e.data),this.$toast.add({severity:"info",summary:"info",detail:e.data.message,life:3e3}),this.dialog=!1,this.onPageChange()}catch(e){console.log(e),this.$toast.add({severity:"error",summary:"error",detail:"修改失败",life:3e3})}}}};function Dl(e,n,u,B,t,V){const C=ve;return ul(),ol(dl,null,{default:r(()=>[a(ce,null,{default:r(()=>[a(b,{cols:"6"},{default:r(()=>[a(I,{modelValue:t.search.title,"onUpdate:modelValue":n[0]||(n[0]=o=>t.search.title=o),label:"作品名 包含："+t.search.title},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"6"},{default:r(()=>[a(I,{modelValue:t.search.description,"onUpdate:modelValue":n[1]||(n[1]=o=>t.search.description=o),label:"作品描述 包含："+t.search.description},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"6"},{default:r(()=>[a(I,{modelValue:t.search.source,"onUpdate:modelValue":n[2]||(n[2]=o=>t.search.source=o),label:"作品内容 包含："+t.search.source},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"6"},{default:r(()=>[a(I,{modelValue:t.localuser.user.id,"onUpdate:modelValue":n[3]||(n[3]=o=>t.localuser.user.id=o),label:"用户ID 为："+t.search.authorid,"control-variant":"用户ID",disabled:""},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(E,{modelValue:t.search.order,"onUpdate:modelValue":n[4]||(n[4]=o=>t.search.order=o),items:t.orderitems,"item-title":"name","item-value":"type",label:"排序"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(E,{modelValue:t.search.type,"onUpdate:modelValue":n[5]||(n[5]=o=>t.search.type=o),items:t.typeitems,"item-title":"name","item-value":"type",label:"项目类型"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(E,{modelValue:t.search.state,"onUpdate:modelValue":n[6]||(n[6]=o=>t.search.state=o),items:t.searchstates,"item-title":"state","item-value":"abbr",label:"项目状态"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(_l,{modelValue:t.search.tag,"onUpdate:modelValue":n[7]||(n[7]=o=>t.search.tag=o),items:["","动画","故事","音乐","硬核","艺术","水"],label:"标签 为："+t.search.tag},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"12"},{default:r(()=>[a(T,{"append-icon":"mdi-magnify",color:"primary",rounded:"xl",variant:"flat",onClick:n[8]||(n[8]=o=>V.onPageChange())},{default:r(()=>n[18]||(n[18]=[A("搜索 ",-1)])),_:1,__:[18]}),a(T,{color:"",rounded:"xl",variant:"flat",onClick:n[9]||(n[9]=o=>{t.search.order="view_up",t.search.type="",t.search.authorid="",t.search.source="",t.search.description="",t.search.title="",t.search.state="public",V.onPageChange()})},{default:r(()=>n[19]||(n[19]=[A("重置 ",-1)])),_:1,__:[19]})]),_:1})]),_:1}),n[23]||(n[23]=k("br",null,null,-1)),n[24]||(n[24]=k("br",null,null,-1)),a(C,{url:t.url},null,8,["url"]),a(sl,{modelValue:t.dialog,"onUpdate:modelValue":n[17]||(n[17]=o=>t.dialog=o),"max-width":"70vw",origin:"center center",persistent:""},{default:r(()=>[a(rl,{"prepend-icon":"mdi-xml",title:"作品信息"},{default:r(()=>[a(il,null,{default:r(()=>[a(ce,{dense:""},{default:r(()=>[a(b,{cols:"12",md:"12",sm:"12"},{default:r(()=>[a(I,{modelValue:t.currentProject.title,"onUpdate:modelValue":n[10]||(n[10]=o=>t.currentProject.title=o),hint:"将会在首页展示",label:"标题",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"12",sm:"12"},{default:r(()=>[a(bl,{modelValue:t.currentProject.description,"onUpdate:modelValue":n[11]||(n[11]=o=>t.currentProject.description=o),hint:"介绍作品类型，玩法，并向对这个作品有帮助的人致谢！",label:"简介"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",sm:"6"},{default:r(()=>[a(E,{modelValue:t.currentProject.type,"onUpdate:modelValue":n[12]||(n[12]=o=>t.currentProject.type=o),items:["scratch","python","text"],hint:"不建议你改",label:"类型",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",sm:"6"},{default:r(()=>[a(E,{modelValue:t.currentProject.state,"onUpdate:modelValue":n[13]||(n[13]=o=>t.currentProject.state=o),items:t.projectstates,hint:"我们鼓励开源","item-title":"state","item-value":"abbr",label:"项目状态"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"12"},{default:r(()=>[a(Pl,{modelValue:t.aboutTags.chips,"onUpdate:modelValue":n[14]||(n[14]=o=>t.aboutTags.chips=o),items:t.aboutTags.items,chips:"",label:"标签",multiple:"","prepend-icon":"mdi-tag",variant:"solo"},{selection:r(({attrs:o,item:F,select:U,selected:v})=>[a(fe,j({"model-value":v,closable:""},o,{onClick:U,"onClick:close":q=>V.removetag(F)}),{default:r(()=>[k("strong",null,de(F.name),1),n[20]||(n[20]=A("  ",-1)),n[21]||(n[21]=k("span",null,"(interest)",-1))]),_:2,__:[20,21]},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue","items"])]),_:1}),a(Cl,null,{default:r(()=>[a(xl,null,{default:r(()=>[a(kl,null,{default:r(()=>n[22]||(n[22]=[A("详细数据",-1)])),_:1,__:[22]}),a(wl,null,{default:r(()=>[A(de(t.currentProject),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(me),a(cl,null,{default:r(()=>[a(T,{color:"error",text:"删除",variant:"tonal",onClick:V.deleteProject},null,8,["onClick"]),a(T,{color:"text",text:"一键推送",variant:"tonal",onClick:n[15]||(n[15]=o=>V.pushproject(t.currentProject.id))}),a(Sl),a(T,{text:"取消",variant:"plain",onClick:n[16]||(n[16]=o=>t.dialog=!1)}),a(T,{color:"primary",text:"保存",variant:"tonal",onClick:V.SaveProjectsInfo},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[23,24]})}const zl=nl(Il,[["render",Dl]]);export{zl as default};
