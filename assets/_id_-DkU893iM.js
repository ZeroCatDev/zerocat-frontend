import{_ as w}from"./EditProjectListConfig-CrSkIt8R.js";import{_ as j}from"./ProjectCard-CV5RgkN6.js";import{_ as v,a1 as D,ab as P,r as b,b as L,aa as T,Y as o,o as i,N as e,c as I,e as a,Q as f,R as _,a4 as B,F as y,W as U,$ as V,a9 as A,f as n,X as d,S as N,L as p,i as E,aW as S,a3 as z,Z as O,n as F,a5 as M,U as R,aA as W,T as q,M as x,ew as H}from"./index-DnUjCeK2.js";import{V as Q}from"./VSpacer-BFiVag9N.js";import"./VSelect-BRjm05sd.js";import"./VCheckboxBtn-DRO8QGQu.js";import"./VSelectionControl-8vMVl1cT.js";import"https://static.geetest.com/v4/gt4.js";const X={props:{listId:{type:String,required:!0}},components:{EditProjectListConfig:w,ProjectCard:j},setup(){const t=b(null);return L(async()=>{t.value=await T("s3.staticurl")}),{s3BucketUrl:t,getUserAvatar:c=>!c||!c.avatar?"":`${t.value}/user/${c.avatar}`}},data(){return{loading:!0,listInfo:{},isOwner:!1,editDialog:!1,error:null}},computed:{hasProjects(){return this.listInfo.projects&&this.listInfo.projects.length>0}},async created(){await this.fetchProjectList()},methods:{async fetchProjectList(){this.loading=!0;try{const t=await D.get(`/projectlist/lists/listid/${this.listId}`);if(t.data.status==="success"){this.listInfo=t.data.data;const l=P.user.value;this.isOwner=l&&l.id===this.listInfo.authorid}else this.$toast.add({severity:"error",summary:"错误",detail:t.data.message||"获取列表失败",life:3e3})}catch(t){console.error("获取列表失败:",t),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},openEditDialog(){this.editDialog=!0},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知"}}},Y={class:"d-flex align-center mb-2"},Z={class:"text-caption"},G={class:"d-flex flex-wrap"},J={class:"text-caption mr-4"},K={class:"text-caption"};function $(t,l,c,h,s,u){const m=j,k=w;return i(),o(q,null,{default:e(()=>[s.loading?(i(),o(f,{key:0},{default:e(()=>[a(_,{class:"text-center",cols:"12"},{default:e(()=>[a(B,{color:"primary",indeterminate:""})]),_:1})]),_:1})):(i(),I(y,{key:1},[a(f,null,{default:e(()=>[a(_,{cols:"12"},{default:e(()=>[a(U,{class:"mb-4"},{default:e(()=>[a(A,{class:"d-flex align-center"},{default:e(()=>[n("span",null,d(s.listInfo.title||"未命名列表"),1),a(N,{color:s.listInfo.state==="public"?"success":"warning",class:"ml-2",size:"small"},{default:e(()=>[p(d(s.listInfo.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),a(Q),s.isOwner?(i(),o(E,{key:0,color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:u.openEditDialog},null,8,["onClick"])):V("",!0)]),_:1}),s.listInfo.description?(i(),o(S,{key:0},{default:e(()=>[p(d(s.listInfo.description),1)]),_:1})):V("",!0),a(z,null,{default:e(()=>{var r,g;return[n("div",Y,[a(O,{class:"mr-2",size:"24"},{default:e(()=>[a(F,{src:h.getUserAvatar(s.listInfo.author),alt:"用户头像"},null,8,["src"])]),_:1}),n("span",Z,d(((r=s.listInfo.author)==null?void 0:r.display_name)||((g=s.listInfo.author)==null?void 0:g.username)||"未知用户"),1)]),n("div",G,[n("span",J,"创建于: "+d(u.formatDate(s.listInfo.createTime)),1),n("span",K,"更新于: "+d(u.formatDate(s.listInfo.updateTime)),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),u.hasProjects?(i(),o(f,{key:1},{default:e(()=>[a(_,{cols:"12"},{default:e(()=>[l[2]||(l[2]=n("h3",{class:"text-h6 mb-4"},"项目列表",-1)),a(f,null,{default:e(()=>[(i(!0),I(y,null,R(s.listInfo.projects,r=>(i(),o(_,{key:r.id,cols:"12",lg:"3",md:"4",sm:"6"},{default:e(()=>[a(m,{author:r.author,project:r,"show-author":!0},null,8,["author","project"])]),_:2},1024))),128))]),_:1})]),_:1,__:[2]})]),_:1})):(i(),o(f,{key:0},{default:e(()=>[a(_,{class:"text-center",cols:"12"},{default:e(()=>[a(M,{type:"info",variant:"tonal"},{default:e(()=>l[1]||(l[1]=[p(" 此列表暂无项目 ",-1)])),_:1,__:[1]})]),_:1})]),_:1}))],64)),a(W,{modelValue:s.editDialog,"onUpdate:modelValue":l[0]||(l[0]=r=>s.editDialog=r),"max-width":"600px"},{default:e(()=>[a(k,{callback:u.fetchProjectList,close:()=>s.editDialog=!1,listid:c.listId},null,8,["callback","close","listid"])]),_:1},8,["modelValue"])]),_:1})}const C=v(X,[["render",$],["__scopeId","data-v-4b49ae69"]]),tt={components:{showProjectList:C},data(){return{listId:this.$route.params.id,listTitle:"项目列表"}},async mounted(){try{const t=await H(this.listId);t&&t.title&&(this.listTitle=t.title,this.updatePageTitle())}catch(t){console.error("获取列表信息失败:",t)}},methods:{updatePageTitle(){x({title:this.listTitle})}},setup(){x({title:"项目列表"})}};function et(t,l,c,h,s,u){const m=C;return i(),o(m,{listId:s.listId},null,8,["listId"])}const ut=v(tt,[["render",et]]);export{ut as default};
