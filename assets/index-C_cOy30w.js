import{_ as b}from"./EditProjectListConfig-JJZWGZws.js";import{o as E}from"./openEdit-AJJkPSPH.js";import{_ as y,X as B,T as c,o as r,N as o,h as e,Y as x,ah as M,ao as v,j as p,R as C,ag as j,M as f,K as _,S as h,a as k,W as I,U as z,q as S,al as q,Z as F,F as T,Q as O,L as R}from"./index-BxEavA_P.js";import{V as m,a as d}from"./VRow-Cn2wrwA_.js";import{V as L}from"./VTextField-BFzTklJI.js";import{V as H}from"./VSelect-BkUNLi6G.js";import{V as g}from"./VSpacer-DlIrFA2m.js";import{a as K}from"./user-CEpNNJ7L.js";import{e as Q,f as W}from"./projectListService-CvcY-ji7.js";import{V as X}from"./VChip-D-oyIJaW.js";import{V as Y}from"./VAlert-CsrWXBjI.js";import{V as w}from"./VDialog-DZE4_IwT.js";import{V as Z}from"./VContainer-DTlUtd82.js";/* empty css              *//* empty css                   */import"./VInput-DpFKJkus.js";import"./VCheckboxBtn-D9DWVxPh.js";import"./VSelectionControl-BCmYg8Cf.js";const G={data(){return{projectInfo:{title:"",description:"",state:"private"},listStates:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],loading:!1,newId:0,openEdit:E}},props:{callback:{type:Function,required:!1},close:{type:Function,required:!1}},methods:{show(){this.projectInfo={title:"",description:"",state:"private"},this.loading=!1,this.newId=0},async newProjectList(){if(this.projectInfo.title){this.loading=!0;try{const t=await B.post("/projectlist/lists/create",this.projectInfo);this.$toast.add({severity:"info",summary:t.data.status==="success"?"成功":"错误",detail:t.data.message||"创建项目列表",life:3e3}),t.data.status==="success"&&(this.newId=t.data.data.id,this.callback&&this.callback(),this.close&&this.close())}catch(t){console.error("创建项目列表失败:",t),this.$toast.add({severity:"error",summary:"错误",detail:"创建项目列表失败",life:3e3})}finally{this.loading=!1}}}}};function J(t,s,l,V,i,n){return r(),c(C,{"prepend-icon":"mdi-format-list-bulleted",title:"新建列表",border:""},{default:o(()=>[e(x,null,{default:o(()=>[e(m,{dense:""},{default:o(()=>[e(d,{cols:"12"},{default:o(()=>[e(L,{label:"标题",required:"",hint:"将便于查找",modelValue:i.projectInfo.title,"onUpdate:modelValue":s[0]||(s[0]=a=>i.projectInfo.title=a),rules:[a=>!!a||"标题不能为空"]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(L,{label:"简介",hint:"简要描述列表内容",modelValue:i.projectInfo.description,"onUpdate:modelValue":s[1]||(s[1]=a=>i.projectInfo.description=a)},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(H,{modelValue:i.projectInfo.state,"onUpdate:modelValue":s[2]||(s[2]=a=>i.projectInfo.state=a),items:i.listStates,"item-title":"state","item-value":"abbr",label:"列表状态"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(M),e(v,null,{default:o(()=>[e(g),e(p,{text:"关闭",variant:"plain",onClick:s[3]||(s[3]=a=>l.close())}),e(p,{color:"primary",text:"创建",variant:"tonal",onClick:n.newProjectList,loading:i.loading,disabled:!i.projectInfo.title},null,8,["onClick","loading","disabled"])]),_:1})]),_:1})}const D=y(G,[["render",J]]),$={props:{list:{type:Object,required:!0}},data(){return{authorInfo:null,projectCount:0,loading:!1}},computed:{isOwner(){const t=j.user.value;return t&&t.id===(this.list.authorid||this.list.userId)}},async created(){await this.fetchAuthorInfo(),await this.fetchProjectCount()},methods:{async fetchAuthorInfo(){const t=this.list.authorid||this.list.userId;if(t)try{this.authorInfo=await K(t)}catch(s){console.error(`获取用户 ${t} 信息失败:`,s)}},async fetchProjectCount(){var t;if(this.list.projects)this.projectCount=this.list.projects.length;else try{this.loading=!0;const s=await Q(this.list.id);s.status==="success"&&s.data&&(this.projectCount=((t=s.data.projects)==null?void 0:t.length)||0)}catch(s){console.error(`获取列表 ${this.list.id} 项目数量失败:`,s)}finally{this.loading=!1}},getAvatarUrl(t){return t?t.avatar?t.avatar:t.images?`https://zerocat-bitiful.houlangs.com/user/${t.images}`:"":""},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知"}}},tt={class:"d-flex align-center"},et={class:"text-caption"},st={class:"mt-2 d-flex align-center"},it={class:"text-caption"},ot={key:0,class:"text-caption"};function lt(t,s,l,V,i,n){return r(),c(C,{title:l.list.title,subtitle:l.list.description||"无描述",class:"h-100",to:`/app/projectlist/${l.list.id}`},{default:o(()=>[e(x,null,{default:o(()=>[f("div",tt,[e(X,{color:l.list.state==="public"?"success":"warning",size:"small",class:"mr-2"},{default:o(()=>[_(h(l.list.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),f("span",et,h(n.formatDate(l.list.updateTime||l.list.updatedAt)),1)]),f("div",st,[f("span",it,"项目数: "+h(i.projectCount),1),e(g),i.authorInfo?(r(),k("span",ot,[e(z,{size:"16",class:"mr-1"},{default:o(()=>[e(S,{src:n.getAvatarUrl(i.authorInfo),alt:"用户头像"},null,8,["src"])]),_:1}),_(" "+h(i.authorInfo.username||i.authorInfo.display_name||`用户${l.list.authorid||l.list.userId}`),1)])):I("",!0)])]),_:1}),e(v,null,{default:o(()=>[n.isOwner?(r(),c(p,{key:0,icon:"mdi-pencil",variant:"text",size:"small",onClick:s[0]||(s[0]=q(a=>t.$emit("edit",l.list.id),["stop","prevent"])),color:"primary"})):I("",!0),e(g),e(p,{icon:"mdi-eye",variant:"text",size:"small",to:`/app/projectlist/${l.list.id}`},null,8,["to"])]),_:1})]),_:1},8,["title","subtitle","to"])}const P=y($,[["render",lt]]),at={components:{NewProjectList:D,EditProjectListConfig:b,ProjectListItem:P},data(){return{loading:!0,myLists:[],newListDialog:!1,editDialog:!1,selectedListId:null}},async created(){await this.fetchMyLists()},methods:{async fetchMyLists(){this.loading=!0;try{const t=await W();t.status==="success"?this.myLists=t.data||[]:this.$toast.add({severity:"error",summary:"错误",detail:t.message||"获取列表失败",life:3e3})}catch(t){console.error("获取我的列表失败:",t),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},openNewListDialog(){this.newListDialog=!0},openEditDialog(t){this.selectedListId=t,this.editDialog=!0}}};function rt(t,s,l,V,i,n){const a=P,U=D,A=b;return r(),c(Z,null,{default:o(()=>[e(m,null,{default:o(()=>[e(d,{cols:"12",class:"d-flex align-center mb-4"},{default:o(()=>[s[3]||(s[3]=f("h2",{class:"text-h5"},"我的项目列表",-1)),e(g),e(p,{color:"primary","prepend-icon":"mdi-plus",onClick:n.openNewListDialog},{default:o(()=>s[2]||(s[2]=[_(" 新建列表 ")])),_:1},8,["onClick"])]),_:1})]),_:1}),i.loading?(r(),c(m,{key:0},{default:o(()=>[e(d,{cols:"12",class:"text-center"},{default:o(()=>[e(F,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):i.myLists.length===0?(r(),c(m,{key:1},{default:o(()=>[e(d,{cols:"12"},{default:o(()=>[e(Y,{type:"info",variant:"tonal"},{default:o(()=>s[4]||(s[4]=[_(' 您还没有创建任何项目列表，点击右上角的"新建列表"按钮创建一个吧！ ')])),_:1})]),_:1})]),_:1})):(r(),c(m,{key:2},{default:o(()=>[(r(!0),k(T,null,O(i.myLists,u=>(r(),c(d,{key:u.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[e(a,{list:u,onEdit:n.openEditDialog},null,8,["list","onEdit"])]),_:2},1024))),128))]),_:1})),e(w,{modelValue:i.newListDialog,"onUpdate:modelValue":s[0]||(s[0]=u=>i.newListDialog=u),"max-width":"600px"},{default:o(()=>[e(U,{callback:n.fetchMyLists,close:()=>i.newListDialog=!1},null,8,["callback","close"])]),_:1},8,["modelValue"]),e(w,{modelValue:i.editDialog,"onUpdate:modelValue":s[1]||(s[1]=u=>i.editDialog=u),"max-width":"600px"},{default:o(()=>[i.selectedListId?(r(),c(A,{key:0,listid:i.selectedListId,callback:n.fetchMyLists,close:()=>i.editDialog=!1},null,8,["listid","callback","close"])):I("",!0)]),_:1},8,["modelValue"])]),_:1})}const N=y(at,[["render",rt]]),nt={components:{ProjectListsView:N},async created(){j.isLogin.value===!1&&this.$router.push("/app/account/login")},data(){return{localuser:j}},name:"projectlist",setup(){R({title:"我的项目列表"})}};function ct(t,s,l,V,i,n){const a=N;return r(),c(a)}const kt=y(nt,[["render",ct]]);export{kt as default};
