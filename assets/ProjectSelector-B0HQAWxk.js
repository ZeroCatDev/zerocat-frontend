import{_ as ce,r as p,x as R,w as ve,b as me,aa as fe,c,o,e as a,N as e,a3 as _e,f as n,$ as b,X as u,Z as q,Y as y,F as w,U as k,S as h,L as i,O as _,W as C,a9 as A,i as O,T as ye,Q as F,R as z,aB as pe,j as ge,a4 as he,D as H,n as J,bR as K,aU as S,aW as M,bC as be,cv as Ve,aD as xe,aA as we,a1 as j,ab as ke}from"./index-DecJVK_g.js";import{V as ee}from"./VSelect-B1qTPVBI.js";const Ce={class:"flex-grow-1"},ze={key:0,class:"text-grey-600"},Se={key:1,class:"d-flex align-center"},Ne={class:"text-subtitle-2"},$e={class:"text-caption text-grey-600"},Pe={key:2,class:"flex-grow-1"},De={class:"text-subtitle-2 mb-1"},Ie={class:"d-flex flex-wrap gap-1"},Ae={class:"text-h6"},Be={class:"pa-4"},Ue={key:1,class:"text-center py-8"},Oe={key:2,class:"text-center py-8 text-grey-600"},Fe={class:"d-flex align-center gap-2"},Me={class:"d-flex align-center justify-space-between text-caption text-grey-600"},Te={class:"d-flex align-center gap-3"},Le={class:"d-flex align-center"},Ee={class:"d-flex align-center"},Re={key:0,class:"mt-2"},Je={key:4,class:"d-flex justify-center mt-6"},Qe={key:0,class:"pa-4"},We={class:"d-flex align-center justify-space-between mb-3"},Ge={class:"d-flex flex-wrap gap-2 mb-4"},Xe={key:1,class:"pa-4"},Ye={class:"d-flex align-center justify-space-between mb-3"},Ze={class:"position-absolute",style:{top:"8px",right:"8px"}},qe={class:"d-flex align-center gap-2"},He={class:"d-flex align-center justify-space-between text-caption text-grey-600"},Ke={class:"d-flex align-center gap-3"},je={class:"d-flex align-center"},el={class:"d-flex align-center"},ll={key:0,class:"mt-2"},tl={__name:"ProjectSelector",props:{modelValue:{type:[Number,Array],default:()=>null},multiple:{type:Boolean,default:!1},limit:{type:Number,default:20},author:{type:[String,Number,Array],default:null}},emits:["update:modelValue"],setup(g,{emit:le}){const d=g,Q=le,x=p(!1),B=p(!1),N=p([]),v=p(new Map),U=p(""),T=p("time_down"),L=p(""),$=p(1),E=p(0),V=p(""),te=[{title:"最新发布",value:"time_down"},{title:"最早发布",value:"time_up"},{title:"最多观看",value:"view_down"},{title:"最少观看",value:"view_up"},{title:"最多点赞",value:"star_down"},{title:"最少点赞",value:"star_up"},{title:"ID降序",value:"id_down"},{title:"ID升序",value:"id_up"}],ae=[{title:"所有",value:""},{title:"公开",value:"public"},{title:"私有",value:"private"}],m=R(()=>Array.from(v.value.values())),P=R(()=>d.multiple||!d.modelValue?null:v.value.get(d.modelValue)||null),se=R(()=>d.multiple?m.value.length>0:!!d.modelValue&&!!P.value),W=s=>v.value.has(s),ie=async()=>{if(!d.author)return null;if(d.author==="me")return ke.user.value.id;if(Array.isArray(d.author))return d.author.map(l=>Number(l)).filter(l=>!isNaN(l));const s=Number(d.author);return isNaN(s)?null:s},D=async(s=!0)=>{s&&($.value=1),B.value=!0;try{const l={curr:$.value,limit:d.limit,search_orderby:T.value,search_state:L.value};U.value&&(l.search_title=U.value);const t=await ie();t!==null&&(l.search_userid=t);const r=(await j.get("/searchapi",{params:l})).data;N.value=r.projects,E.value=r.totalCount}catch(l){console.error("Failed to load projects:",l)}finally{B.value=!1}},ue=()=>{D()},ne=s=>{$.value=s,D(!1)},oe=s=>{d.multiple?v.value.has(s.id)?v.value.delete(s.id):v.value.set(s.id,s):(v.value.clear(),v.value.set(s.id,s),Q("update:modelValue",s.id),x.value=!1)},G=s=>{v.value.delete(s)},X=()=>{const s=Array.from(v.value.keys());Q("update:modelValue",s),x.value=!1},de=()=>{x.value=!0,N.value.length===0&&D()},Y=s=>new Date(s).toLocaleDateString("zh-CN"),re=async s=>{try{(await j.post("/project/batch",{projectIds:s})).data.data.forEach(f=>{v.value.has(f.id)&&v.value.set(f.id,f)})}catch(l){console.error("Failed to load project details:",l)}},Z=async()=>{if(v.value.clear(),d.modelValue){const s=[];d.multiple&&Array.isArray(d.modelValue)?d.modelValue.forEach(l=>{v.value.set(l,{id:l,title:`项目 ${l}`,loading:!0,author:{display_name:"加载中...",username:"",avatar:"",id:0},description:"加载中...",view_count:0,star_count:0,time:new Date().toISOString(),tags:"",state:"public"}),s.push(l)}):!d.multiple&&typeof d.modelValue=="number"&&(v.value.set(d.modelValue,{id:d.modelValue,title:`项目 ${d.modelValue}`,loading:!0,author:{display_name:"加载中...",username:"",avatar:"",id:0},description:"加载中...",view_count:0,star_count:0,time:new Date().toISOString(),tags:"",state:"public"}),s.push(d.modelValue)),s.length>0&&await re(s)}};return ve(()=>d.modelValue,(s,l)=>{JSON.stringify(s)!==JSON.stringify(l)&&Z()},{immediate:!0,deep:!0}),me(async()=>{Z(),V.value=await fe("s3.staticurl")}),(s,l)=>(o(),c("div",null,[a(C,{class:"cursor-pointer",onClick:de,elevation:"1",rounded:"lg"},{default:e(()=>[a(_e,{class:"d-flex align-center justify-space-between"},{default:e(()=>[n("div",Ce,[se.value?!g.multiple&&P.value?(o(),c("div",Se,[a(q,{class:"me-2",image:V.value+"/user/"+P.value.author.avatar},null,8,["image"]),n("div",null,[n("div",Ne,u(P.value.title),1),n("div",$e," by "+u(P.value.author.display_name),1)])])):g.multiple?(o(),c("div",Pe,[n("div",De," 已选择 "+u(m.value.length)+" 个"+u(g.author==="me"?"我的":"")+"项目 ",1),n("div",Ie,[(o(!0),c(w,null,k(m.value.slice(0,3),t=>(o(),y(h,{key:t.id,size:"small",variant:"outlined",color:"primary"},{default:e(()=>[i(u(t.title),1)]),_:2},1024))),128)),m.value.length>3?(o(),y(h,{key:0,size:"small",variant:"outlined",color:"grey"},{default:e(()=>[i(" +"+u(m.value.length-3),1)]),_:1})):b("",!0)])])):b("",!0):(o(),c("div",ze,u(g.multiple?"选择项目...":"选择一个项目..."),1))]),a(_,null,{default:e(()=>l[6]||(l[6]=[i("mdi-chevron-down",-1)])),_:1,__:[6]})]),_:1})]),_:1}),a(we,{modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=t=>x.value=t),"max-width":s.$vuetify.display.mobile?void 0:"1200px",fullscreen:s.$vuetify.display.mobile,scrollable:"",transition:"dialog-transition"},{default:e(()=>[a(C,{border:"",hover:""},{default:e(()=>[a(A,{class:"d-flex align-center justify-space-between pa-4"},{default:e(()=>[n("span",Ae,u(g.multiple?"选择项目":"选择一个项目"),1),a(O,{icon:"",variant:"text",onClick:l[0]||(l[0]=t=>x.value=!1)},{default:e(()=>[a(_,null,{default:e(()=>l[7]||(l[7]=[i("mdi-close",-1)])),_:1,__:[7]})]),_:1})]),_:1}),a(ye,{fluid:"",class:"pa-0"},{default:e(()=>[a(F,{"no-gutters":""},{default:e(()=>[a(z,{cols:g.multiple&&m.value.length>0?s.$vuetify.display.mobile?12:8:12,order:s.$vuetify.display.mobile?2:1},{default:e(()=>[n("div",Be,[a(pe,{modelValue:U.value,"onUpdate:modelValue":l[1]||(l[1]=t=>U.value=t),label:"搜索项目","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:ue},null,8,["modelValue"]),a(F,{class:"mb-4"},{default:e(()=>[a(z,{cols:"12",sm:"6"},{default:e(()=>[a(ee,{modelValue:T.value,"onUpdate:modelValue":[l[2]||(l[2]=t=>T.value=t),D],items:te,label:"排序",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),a(z,{cols:"12",sm:"6"},{default:e(()=>[a(ee,{modelValue:L.value,"onUpdate:modelValue":[l[3]||(l[3]=t=>L.value=t),D],items:ae,label:"状态",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),B.value?(o(),y(ge,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):b("",!0),B.value&&N.value.length===0?(o(),c("div",Ue,[a(he,{indeterminate:"",size:"48"}),l[8]||(l[8]=n("div",{class:"mt-4 text-h6"},"加载中...",-1))])):N.value.length===0?(o(),c("div",Oe,[a(_,{size:"64",class:"mb-4"},{default:e(()=>l[9]||(l[9]=[i("mdi-folder-open-outline",-1)])),_:1,__:[9]}),l[10]||(l[10]=n("div",{class:"text-h6"},"未找到项目",-1))])):(o(),y(F,{key:3},{default:e(()=>[(o(!0),c(w,null,k(N.value,t=>(o(),y(z,{key:t.id,cols:"6",sm:"6",md:"4",lg:"3"},{default:e(()=>[a(C,{class:H(["project-card",{selected:W(t.id)}]),rounded:"lg",elevation:"2",onClick:f=>oe(t)},{default:e(()=>{var f;return[a(C,{rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:e(()=>[a(J,{src:V.value+"/scratch_slt/"+t.id,class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":K},{default:e(()=>[a(S,null,{default:e(()=>[a(A,{class:"text-white"},{default:e(()=>[i(u(t.title),1)]),_:2},1024),a(M,{class:"text-white"},{default:e(()=>[i(u(t.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024),a(S,{"append-avatar":(f=t.author)!=null&&f.avatar?V.value+"/user/"+t.author.avatar:""},{append:e(()=>[n("div",Fe,[a(h,{color:t.state==="public"?"success":"warning",size:"small",variant:"outlined"},{default:e(()=>[i(u(t.state==="public"?"公开":"私有"),1)]),_:2},1032,["color"]),W(t.id)?(o(),y(_,{key:0,color:"primary",size:"24"},{default:e(()=>l[11]||(l[11]=[i(" mdi-check-circle ",-1)])),_:1,__:[11]})):b("",!0)])]),default:e(()=>[a(A,null,{default:e(()=>{var r,I;return[i(u(((r=t.author)==null?void 0:r.display_name)||((I=t.author)==null?void 0:I.username)||"未知用户"),1)]}),_:2},1024),a(M,null,{default:e(()=>{var r;return[i("@"+u(((r=t.author)==null?void 0:r.username)||""),1)]}),_:2},1024)]),_:2},1032,["append-avatar"]),a(S,{class:"pt-0"},{default:e(()=>[n("div",Me,[n("div",Te,[n("div",Le,[a(_,{size:"16",class:"me-1"},{default:e(()=>l[12]||(l[12]=[i("mdi-eye",-1)])),_:1,__:[12]}),i(" "+u(t.view_count),1)]),n("div",Ee,[a(_,{size:"16",class:"me-1"},{default:e(()=>l[13]||(l[13]=[i("mdi-star",-1)])),_:1,__:[13]}),i(" "+u(t.star_count),1)])]),n("div",null,u(Y(t.time)),1)]),t.tags?(o(),c("div",Re,[(o(!0),c(w,null,k(t.tags.split(","),r=>(o(),y(h,{key:r,size:"x-small",variant:"outlined",class:"me-1"},{default:e(()=>[i(u(r.trim()),1)]),_:2},1024))),128))])):b("",!0)]),_:2},1024)]}),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})),E.value>0?(o(),c("div",Je,[a(be,{modelValue:$.value,"onUpdate:modelValue":[l[4]||(l[4]=t=>$.value=t),ne],length:Math.ceil(E.value/g.limit),"total-visible":7},null,8,["modelValue","length"])])):b("",!0)])]),_:1},8,["cols","order"]),g.multiple&&m.value.length>0?(o(),y(z,{key:0,cols:s.$vuetify.display.mobile?12:4,class:H({"border-s":!s.$vuetify.display.mobile,"border-b":s.$vuetify.display.mobile}),order:s.$vuetify.display.mobile?1:2},{default:e(()=>[s.$vuetify.display.mobile?(o(),c("div",Qe,[n("div",We,[l[14]||(l[14]=n("div",{class:"text-h6"},"已选择",-1)),a(h,{border:"",size:"small"},{default:e(()=>[i(u(m.value.length),1)]),_:1})]),n("div",Ge,[a(Ve,{column:""},{default:e(()=>[(o(!0),c(w,null,k(m.value,t=>(o(),y(h,{key:t.id,closable:"",border:"",variant:"text","onClick:close":f=>G(t.id)},{default:e(()=>[a(q,{start:"",size:"24",class:"me-2"},{default:e(()=>[a(J,{src:V.value+"/user/"+t.author.avatar,cover:""},{placeholder:e(()=>[a(_,{size:"12"},{default:e(()=>l[15]||(l[15]=[i("mdi-image",-1)])),_:1,__:[15]})]),_:2},1032,["src"])]),_:2},1024),i(" "+u(t.title),1)]),_:2},1032,["onClick:close"]))),128))]),_:1})]),a(O,{color:"primary",variant:"elevated",block:"",size:"large",onClick:X},{default:e(()=>[a(_,{start:""},{default:e(()=>l[16]||(l[16]=[i("mdi-check",-1)])),_:1,__:[16]}),i(" 确认选择 ("+u(m.value.length)+") ",1)]),_:1})])):(o(),c("div",Xe,[n("div",Ye,[l[17]||(l[17]=n("div",{class:"text-h6"},"已选择",-1)),a(h,{color:"primary",size:"small"},{default:e(()=>[i(u(m.value.length),1)]),_:1})]),n("div",null,[a(F,null,{default:e(()=>[(o(!0),c(w,null,k(m.value,t=>(o(),y(z,{key:t.id,cols:"12",sm:"6"},{default:e(()=>[a(C,{rounded:"lg",elevation:"2",border:"",hover:""},{default:e(()=>{var f;return[a(C,{rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:e(()=>[a(J,{src:V.value+"/scratch_slt/"+t.id,class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":K},{default:e(()=>[a(S,null,{default:e(()=>[a(A,{class:"text-white"},{default:e(()=>[i(u(t.title),1)]),_:2},1024),a(M,{class:"text-white"},{default:e(()=>[i(u(t.description),1)]),_:2},1024)]),_:2},1024),n("div",Ze,[a(O,{icon:"",size:"small",variant:"elevated",color:"error",onClick:xe(r=>G(t.id),["stop"])},{default:e(()=>[a(_,{size:"16"},{default:e(()=>l[18]||(l[18]=[i("mdi-close",-1)])),_:1,__:[18]})]),_:2},1032,["onClick"])])]),_:2},1032,["src"])]),_:2},1024),a(S,{"append-avatar":(f=t.author)!=null&&f.avatar?V.value+"/user/"+t.author.avatar:""},{append:e(()=>[n("div",qe,[a(h,{color:t.state==="public"?"success":"warning",size:"small",variant:"outlined"},{default:e(()=>[i(u(t.state==="public"?"公开":"私有"),1)]),_:2},1032,["color"])])]),default:e(()=>[a(A,null,{default:e(()=>{var r,I;return[i(u(((r=t.author)==null?void 0:r.display_name)||((I=t.author)==null?void 0:I.username)||"未知用户"),1)]}),_:2},1024),a(M,null,{default:e(()=>{var r;return[i("@"+u(((r=t.author)==null?void 0:r.username)||""),1)]}),_:2},1024)]),_:2},1032,["append-avatar"]),a(S,{class:"pt-0"},{default:e(()=>[n("div",He,[n("div",Ke,[n("div",je,[a(_,{size:"16",class:"me-1"},{default:e(()=>l[19]||(l[19]=[i("mdi-eye",-1)])),_:1,__:[19]}),i(" "+u(t.view_count),1)]),n("div",el,[a(_,{size:"16",class:"me-1"},{default:e(()=>l[20]||(l[20]=[i("mdi-star",-1)])),_:1,__:[20]}),i(" "+u(t.star_count),1)])]),n("div",null,u(Y(t.time)),1)]),t.tags?(o(),c("div",ll,[(o(!0),c(w,null,k(t.tags.split(","),r=>(o(),y(h,{key:r,size:"x-small",variant:"outlined",class:"me-1"},{default:e(()=>[i(u(r.trim()),1)]),_:2},1024))),128))])):b("",!0)]),_:2},1024)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),a(O,{color:"primary",variant:"elevated",block:"",class:"mt-3",size:"large",onClick:X},{default:e(()=>[a(_,{start:""},{default:e(()=>l[21]||(l[21]=[i("mdi-check",-1)])),_:1,__:[21]}),i(" 确认选择 ("+u(m.value.length)+") ",1)]),_:1})]))]),_:1},8,["cols","class","order"])):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","max-width","fullscreen"])]))}},il=ce(tl,[["__scopeId","data-v-f64fdad2"]]);export{il as _};
