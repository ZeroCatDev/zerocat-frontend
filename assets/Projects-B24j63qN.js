import{c as w}from"./projectService-Bwb405Na.js";import{a as x}from"./user-0eg1TJXV.js";import{_ as T}from"./43-lazyload-CBkwrR6M.js";import{_,c as i,o as l,w as e,e as g,M as j,N as k,a as o,K as p,aa as A,al as b,am as B,H as n,O as d,an as E,Q as S,G as h,at as M,ac as N,W as m,I as U}from"./index-KvBOkYOg.js";import{a as I,V}from"./VRow-BkGKqcrg.js";import{V as f}from"./VChip-BQEjepel.js";import{V as v}from"./VPagination-Cz2ChgOD.js";const K={props:{projectIds:{type:Array,required:!0}},data(){return{projects:[],authorIds:[],authors:{},VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},watch:{projectIds:{handler(){this.fetchProjects()},immediate:!0,deep:!0}},methods:{async fetchProjects(){const s=await w(this.projectIds);this.projects=s.map(t=>({...t,author:{display_name:"加载中..."}})),this.updateAuthorIds()},updateAuthorIds(){this.authorIds=[...new Set(this.projects.map(s=>s.authorid))],this.fetchAuthors()},async fetchAuthors(){const s=await x(this.authorIds),t={};s.forEach(u=>{t[u.id]=u}),this.authors=t,this.updateProjectAuthors()},updateProjectAuthors(){this.projects=this.projects.map(s=>({...s,author:this.authors[s.authorid]||{display_name:"未知用户"}}))}}};function $(s,t,u,y,r,c){return l(),i(V,null,{default:e(()=>[(l(!0),g(j,null,k(r.projects,a=>(l(),i(I,{key:a.id,cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2"},{default:e(()=>[o(p,{rounded:"lg",border:""},{default:e(()=>[o(p,{to:`/${a.author.username}/${a.name}`,style:{"aspect-ratio":"4/3"},rounded:"lg"},{default:e(()=>[o(A,{src:r.VITE_APP_S3_BUCKET+"/scratch_slt/"+a.id,class:"align-end","lazy-src":T,height:"100%",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",cover:""},{default:e(()=>[o(b,null,{default:e(()=>[o(B,null,{default:e(()=>[n(d(a.title||"未缓存"),1)]),_:2},1024),o(E,null,{default:e(()=>[n(d(a.description||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["to"])]),_:2},1024)]),_:2},1024))),128))]),_:1})}const C=_(K,[["render",$]]),q={components:{showProjects:C},props:{url:{type:String,required:!0}},data(){return{projectIds:[],page:1,limit:16,totalPage:1,totalCount:0,loading:!1,loadTime:0}},computed:{hasTotalCount(){return this.totalCount>0}},methods:{async fetchProjects(){this.loading=!0;const s=performance.now();try{const t=(await S.get(`${this.url}&curr=${this.page}&limit=${this.limit}`)).data;t.totalCount?(this.projectIds=t.projects,this.totalCount=t.totalCount,this.totalPage=Math.ceil(this.totalCount/this.limit)):this.projectIds=[...this.projectIds,...t.projects]}catch(t){console.error("Failed to fetch projects:",t)}finally{this.loading=!1,this.loadTime=performance.now()-s}},loadMore(){this.page++,this.fetchProjects()}},watch:{url:{handler(){this.page=1,this.fetchProjects()},immediate:!0},page:{handler(){this.fetchProjects()}}}},z={class:"mt-2 text-medium-emphasis"};function F(s,t,u,y,r,c){const a=C;return l(),g(j,null,[o(M,{indeterminate:"",color:"primary",active:r.loading,height:"4"},null,8,["active"]),o(V,null,{default:e(()=>[o(I,{cols:"12"},{default:e(()=>[h("p",z,[o(f,null,{default:e(()=>[o(m,{icon:"mdi-timer",start:""}),n(" 加载耗时: "+d(r.loadTime)+" ms ",1)]),_:1}),r.totalCount?(l(),i(f,{key:0},{default:e(()=>[o(m,{icon:"mdi-counter",start:""}),n(" 总作品数量: "+d(r.totalCount),1)]),_:1})):N("",!0)])]),_:1})]),_:1}),o(a,{projectIds:r.projectIds},null,8,["projectIds"]),t[2]||(t[2]=h("br",null,null,-1)),c.hasTotalCount?(l(),i(v,{key:0,modelValue:r.page,"onUpdate:modelValue":t[0]||(t[0]=P=>r.page=P),length:r.totalPage,onInput:c.fetchProjects,rounded:"circle"},null,8,["modelValue","length","onInput"])):(l(),i(U,{key:1,onClick:c.loadMore,color:"primary"},{default:e(()=>t[1]||(t[1]=[n("继续加载")])),_:1},8,["onClick"])),t[3]||(t[3]=n()),t[4]||(t[4]=h("br",null,null,-1))],64)}const W=_(q,[["render",F]]);export{W as _};
