import{_ as $,ag as h,X as q,o as F,M as a,e,Q as ee,R as le,Y as k,ae as y,L as o,N as c,i as u,O as v,T as d,S as A,aF as x,$ as B,a8 as m,al as ae,am as I,ab as te,ac as S,ah as oe,ai as g,aj as V,ak as D,f as L,aK as ne,aG as M,aC as ie,aJ as R,U as de,r as s,b as ue,a5 as N}from"./index-BpIYSfoU.js";import{V as se}from"./VDataTable-v7vMFTTw.js";import{V as re}from"./VTextarea-BadJBDa9.js";import"https://static.geetest.com/v4/gt4.js";import"./VTable-eHpr1Xrn.js";import"./filter-BVM_tmJl.js";const fe={name:"CodeRunAdmin",setup(){const U=s([]),l=s(!1),f=s(null),t=s(!1),T=s(!1),b=s(!1),r=s(!1),n=s(0),_=s(!1),J=s(!1),O=s(!1),w=s({device_name:"",request_url:"",status:"",device_config:""}),W=[{title:"设备名称",value:"device_name"},{title:"设备ID",value:"id"},{title:"请求地址",value:"request_url"},{title:"状态",value:"status"},{title:"最后报告",value:"last_report"},{title:"操作",value:"actions",sortable:!1}],j=["active","inactive","error"],C=async()=>{l.value=!0;try{const i=await N.get("/admin/coderun/devices");i.data.success&&(U.value=i.data.devices)}catch(i){console.error("Failed to fetch devices:",i)}finally{l.value=!1}},G=i=>{f.value=i,t.value=!0},K=i=>{f.value=i,w.value={device_name:i.device_name||"",request_url:i.request_url||"",status:i.status||"active",device_config:JSON.stringify(i.device_config||{},null,2)},T.value=!0},Q=i=>{f.value=i,b.value=!0},X=()=>{r.value=!0},Y=async()=>{_.value=!0;try{const i={...w.value,device_config:JSON.parse(w.value.device_config)};(await N.put(`/admin/coderun/devices/${f.value.id}`,i)).data.success&&(await C(),T.value=!1)}catch(i){console.error("Failed to save device config:",i)}finally{_.value=!1}},p=async()=>{J.value=!0;try{(await N.delete(`/admin/coderun/devices/${f.value.id}`)).data.success&&(await C(),b.value=!1)}catch(i){console.error("Failed to delete device:",i)}finally{J.value=!1}},z=async()=>{O.value=!0;try{(await N.delete("/admin/coderun/devices/inactive/all")).data.success&&(await C(),r.value=!1)}catch(i){console.error("Failed to delete all inactive devices:",i)}finally{O.value=!1}},E=i=>{switch(i){case"active":return"success";case"error":return"error";default:return"warning"}},H=i=>i?new Date(i).toLocaleString():"未知",P=i=>{try{return i&&JSON.parse(i),!0}catch{return"请输入有效的 JSON 格式"}};return ue(()=>{C()}),{devices:U,loading:l,headers:W,selectedDevice:f,detailsDialog:t,configDialog:T,deleteDialog:b,deleteInactiveDialog:r,activeTab:n,editConfig:w,statusOptions:j,saving:_,deleting:J,deletingInactive:O,refreshDevices:C,openDeviceDetails:G,openDeviceConfig:K,confirmDelete:Q,confirmDeleteInactive:X,saveDeviceConfig:Y,deleteDevice:p,deleteAllInactive:z,getStatusColor:E,formatDateTime:H,validateJson:P}}};function ve(U,l,f,t,T,b){const r=h("v-list-item-content");return F(),q(de,{fluid:""},{default:a(()=>[e(ee,null,{default:a(()=>[e(le,{cols:"12"},{default:a(()=>[e(k,null,{default:a(()=>[e(y,{class:"d-flex align-center"},{default:a(()=>[l[18]||(l[18]=o(" CodeRun 设备管理 ",-1)),e(c),e(u,{loading:t.loading,color:"primary",onClick:t.refreshDevices},{default:a(()=>[e(v,{left:""},{default:a(()=>l[14]||(l[14]=[o("mdi-refresh",-1)])),_:1,__:[14]}),l[15]||(l[15]=o(" 刷新 ",-1))]),_:1,__:[15]},8,["loading","onClick"]),e(u,{loading:t.loading,class:"ml-2",color:"error",onClick:t.confirmDeleteInactive},{default:a(()=>[e(v,{left:""},{default:a(()=>l[16]||(l[16]=[o("mdi-delete-sweep",-1)])),_:1,__:[16]}),l[17]||(l[17]=o(" 删除所有不活跃设备 ",-1))]),_:1,__:[17]},8,["loading","onClick"])]),_:1,__:[18]}),e(se,{headers:t.headers,items:t.devices,"items-per-page":10,loading:t.loading,class:"elevation-1"},{"item.status":a(({item:n})=>[e(A,{color:t.getStatusColor(n.status),small:""},{default:a(()=>[o(d(n.status),1)]),_:2},1032,["color"])]),"item.last_report":a(({item:n})=>[o(d(t.formatDateTime(n.last_report)),1)]),"item.actions":a(({item:n})=>[e(u,{icon:"",small:"",onClick:_=>t.openDeviceDetails(n)},{default:a(()=>[e(v,null,{default:a(()=>l[19]||(l[19]=[o("mdi-eye",-1)])),_:1,__:[19]})]),_:2},1032,["onClick"]),e(u,{icon:"",small:"",onClick:_=>t.openDeviceConfig(n)},{default:a(()=>[e(v,null,{default:a(()=>l[20]||(l[20]=[o("mdi-cog",-1)])),_:1,__:[20]})]),_:2},1032,["onClick"]),e(u,{color:"error",icon:"",small:"",onClick:_=>t.confirmDelete(n)},{default:a(()=>[e(v,null,{default:a(()=>l[21]||(l[21]=[o("mdi-delete",-1)])),_:1,__:[21]})]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1}),e(x,{modelValue:t.detailsDialog,"onUpdate:modelValue":l[3]||(l[3]=n=>t.detailsDialog=n),"max-width":"800px"},{default:a(()=>[t.selectedDevice?(F(),q(k,{key:0},{default:a(()=>[e(y,null,{default:a(()=>[o(" 设备详情: "+d(t.selectedDevice.device_name)+" ",1),e(c),e(u,{icon:"",onClick:l[0]||(l[0]=n=>t.detailsDialog=!1)},{default:a(()=>[e(v,null,{default:a(()=>l[22]||(l[22]=[o("mdi-close",-1)])),_:1,__:[22]})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(ae,{modelValue:t.activeTab,"onUpdate:modelValue":l[1]||(l[1]=n=>t.activeTab=n)},{default:a(()=>[e(I,{value:"basic-info"},{default:a(()=>l[23]||(l[23]=[o("基本信息",-1)])),_:1,__:[23]}),e(I,{value:"docker-info"},{default:a(()=>l[24]||(l[24]=[o("Docker 信息",-1)])),_:1,__:[24]}),e(I,{value:"system-info"},{default:a(()=>l[25]||(l[25]=[o("系统信息",-1)])),_:1,__:[25]}),e(I,{value:"runtime-info"},{default:a(()=>l[26]||(l[26]=[o("运行时信息",-1)])),_:1,__:[26]})]),_:1},8,["modelValue"]),e(te,{modelValue:t.activeTab,"onUpdate:modelValue":l[2]||(l[2]=n=>t.activeTab=n)},{default:a(()=>[e(S,{value:"basic-info"},{default:a(()=>[e(oe,null,{default:a(()=>[e(g,null,{default:a(()=>[e(r,null,{default:a(()=>[e(V,null,{default:a(()=>l[27]||(l[27]=[o("设备 ID",-1)])),_:1,__:[27]}),e(D,null,{default:a(()=>[o(d(t.selectedDevice.id),1)]),_:1})]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(r,null,{default:a(()=>[e(V,null,{default:a(()=>l[28]||(l[28]=[o("设备名称",-1)])),_:1,__:[28]}),e(D,null,{default:a(()=>[o(d(t.selectedDevice.device_name),1)]),_:1})]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(r,null,{default:a(()=>[e(V,null,{default:a(()=>l[29]||(l[29]=[o("状态",-1)])),_:1,__:[29]}),e(D,null,{default:a(()=>[e(A,{color:t.getStatusColor(t.selectedDevice.status),small:""},{default:a(()=>[o(d(t.selectedDevice.status),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(r,null,{default:a(()=>[e(V,null,{default:a(()=>l[30]||(l[30]=[o("创建时间",-1)])),_:1,__:[30]}),e(D,null,{default:a(()=>[o(d(t.formatDateTime(t.selectedDevice.created_at)),1)]),_:1})]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(r,null,{default:a(()=>[e(V,null,{default:a(()=>l[31]||(l[31]=[o("最后更新",-1)])),_:1,__:[31]}),e(D,null,{default:a(()=>[o(d(t.formatDateTime(t.selectedDevice.updated_at)),1)]),_:1})]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(r,null,{default:a(()=>[e(V,null,{default:a(()=>l[32]||(l[32]=[o("最后报告",-1)])),_:1,__:[32]}),e(D,null,{default:a(()=>[o(d(t.formatDateTime(t.selectedDevice.last_report)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{value:"docker-info"},{default:a(()=>[e(m,null,{default:a(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.docker_info,null,2)),1)]),_:1})]),_:1}),e(S,{value:"system-info"},{default:a(()=>[e(m,null,{default:a(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.system_info,null,2)),1)]),_:1})]),_:1}),e(S,{value:"runtime-info"},{default:a(()=>[e(m,null,{default:a(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.coderun_info,null,2)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"]),e(x,{modelValue:t.configDialog,"onUpdate:modelValue":l[9]||(l[9]=n=>t.configDialog=n),"max-width":"600px"},{default:a(()=>[t.selectedDevice?(F(),q(k,{key:0},{default:a(()=>[e(y,null,{default:a(()=>[o(" 设备配置: "+d(t.selectedDevice.device_name)+" ",1),e(c),e(u,{icon:"",onClick:l[4]||(l[4]=n=>t.configDialog=!1)},{default:a(()=>[e(v,null,{default:a(()=>l[33]||(l[33]=[o("mdi-close",-1)])),_:1,__:[33]})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(ne,{ref:"configForm"},{default:a(()=>[e(M,{modelValue:t.editConfig.device_name,"onUpdate:modelValue":l[5]||(l[5]=n=>t.editConfig.device_name=n),label:"设备名称",required:""},null,8,["modelValue"]),e(M,{modelValue:t.editConfig.request_url,"onUpdate:modelValue":l[6]||(l[6]=n=>t.editConfig.request_url=n),label:"请求 URL",required:""},null,8,["modelValue"]),e(ie,{modelValue:t.editConfig.status,"onUpdate:modelValue":l[7]||(l[7]=n=>t.editConfig.status=n),items:t.statusOptions,label:"状态",required:""},null,8,["modelValue","items"]),e(re,{modelValue:t.editConfig.device_config,"onUpdate:modelValue":l[8]||(l[8]=n=>t.editConfig.device_config=n),rules:[t.validateJson],label:"设备配置 (JSON)",rows:"10"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(R,null,{default:a(()=>[e(c),e(u,{loading:t.saving,color:"primary",onClick:t.saveDeviceConfig},{default:a(()=>l[34]||(l[34]=[o(" 保存 ",-1)])),_:1,__:[34]},8,["loading","onClick"])]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"]),e(x,{modelValue:t.deleteDialog,"onUpdate:modelValue":l[11]||(l[11]=n=>t.deleteDialog=n),"max-width":"400px"},{default:a(()=>[e(k,null,{default:a(()=>[e(y,null,{default:a(()=>l[35]||(l[35]=[o("确认删除",-1)])),_:1,__:[35]}),e(m,null,{default:a(()=>{var n;return[o(' 确定要删除设备 "'+d((n=t.selectedDevice)==null?void 0:n.device_name)+'" 吗？此操作无法撤销。 ',1)]}),_:1}),e(R,null,{default:a(()=>[e(c),e(u,{text:"",onClick:l[10]||(l[10]=n=>t.deleteDialog=!1)},{default:a(()=>l[36]||(l[36]=[o(" 取消 ",-1)])),_:1,__:[36]}),e(u,{loading:t.deleting,color:"error",onClick:t.deleteDevice},{default:a(()=>l[37]||(l[37]=[o(" 删除 ",-1)])),_:1,__:[37]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(x,{modelValue:t.deleteInactiveDialog,"onUpdate:modelValue":l[13]||(l[13]=n=>t.deleteInactiveDialog=n),"max-width":"400px"},{default:a(()=>[e(k,null,{default:a(()=>[e(y,null,{default:a(()=>l[38]||(l[38]=[o("确认批量删除",-1)])),_:1,__:[38]}),e(m,null,{default:a(()=>l[39]||(l[39]=[o(" 确定要删除所有不活跃的设备吗？此操作无法撤销。 ",-1)])),_:1,__:[39]}),e(R,null,{default:a(()=>[e(c),e(u,{text:"",onClick:l[12]||(l[12]=n=>t.deleteInactiveDialog=!1)},{default:a(()=>l[40]||(l[40]=[o(" 取消 ",-1)])),_:1,__:[40]}),e(u,{loading:t.deletingInactive,color:"error",onClick:t.deleteAllInactive},{default:a(()=>l[41]||(l[41]=[o(" 删除 ",-1)])),_:1,__:[41]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ce=$(fe,[["render",ve],["__scopeId","data-v-f1d2438b"]]);export{Ce as default};
