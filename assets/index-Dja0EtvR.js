import{_ as v}from"./LoadingDialog-D4pkQ4LF.js";import{_ as w}from"./AuthCard-Bvs9Xql7.js";import{_ as k}from"./Recaptcha-BKlynUh1.js";import{_ as y,a as V,o as S,h as a,P as n,aP as b,as as L,S as R,T as d,ax as C,k as u,i as M,bc as z,r as p,ao as A,O as B}from"./index-CSunjV9K.js";import{A as T}from"./authService-BpB-HaEN.js";import"https://static.geetest.com/v4/gt4.js";const D={components:{LoadingDialog:v,Recaptcha:k,AuthCard:w},setup(){const f=z(),l=p(null),i=p(""),e=p(!1),c=p(!1),g=[t=>!!t||"必须填写邮箱",t=>/.+@.+\..+/.test(t)||"不符合格式"];A.isLogin.value===!0&&f.push("/app/explore"),B({title:"魔术链接登录"});const m=async()=>{var t,o,h;if(!i.value||!/.+@.+\..+/.test(i.value)){s("请输入正确的邮箱地址");return}if(!c.value){e.value=!0;try{const r=(t=l.value)==null?void 0:t.getResponse();if(!r){s("请完成人机验证"),e.value=!1;return}const x=await T.generateMagicLink(i.value,window.location.origin+"/app/account/magiclink/validate",r);x.status==="success"?(_("登录链接已发送到您的邮箱"),c.value=!0):s(x.message||"发送失败")}catch(r){s(((h=(o=r.response)==null?void 0:o.data)==null?void 0:h.message)||r.message)}finally{e.value=!1}}},_=t=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"success",summary:"成功",detail:t,life:3e3})},s=t=>{var o;(o=this==null?void 0:this.$toast)==null||o.add({severity:"error",summary:"错误",detail:t,life:3e3})};return{email:i,loading:e,linkSent:c,recaptcha:l,emailRules:g,sendMagicLink:m}}},E={class:"d-flex flex-wrap justify-start gap-2"};function F(f,l,i,e,c,g){const m=k,_=w,s=v;return S(),V("div",null,[a(_,{subtitle:"魔术链接登录"},{default:n(()=>[a(b,{onSubmit:L(e.sendMagicLink,["prevent"])},{default:n(()=>[a(R,null,{default:n(()=>[a(d,{cols:"12"},{default:n(()=>[a(C,{label:"邮箱",type:"text",modelValue:e.email,"onUpdate:modelValue":l[0]||(l[0]=t=>e.email=t),variant:"outlined",rules:e.emailRules},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12"},{default:n(()=>[a(m,{ref:"recaptcha",recaptchaId:"recaptcha-div"},null,512)]),_:1}),a(d,{cols:"12"},{default:n(()=>[a(u,{class:"text-none",color:"primary",rounded:"xl",text:e.linkSent?"已发送，请检查邮箱":"发送登录链接",variant:"flat",size:"large",onClick:e.sendMagicLink,"append-icon":"mdi-arrow-right",loading:e.loading,disabled:e.linkSent},null,8,["text","onClick","loading","disabled"])]),_:1}),a(d,{cols:"12"},{default:n(()=>[M("div",E,[a(u,{class:"text-none",color:"white",rounded:"xl",text:"密码登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/login"}),a(u,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),a(u,{class:"text-none",color:"white",rounded:"xl",text:"找回密码",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),a(s,{show:e.loading,text:"处理中"},null,8,["show"])])}const U=y(D,[["render",F]]);export{U as default};
