import{_ as A,a as h,o as d,h as r,N as t,U as p,X as I,av as L,K as n,T as u,aw as M,Z as b,M as g,$ as U,aq as j,j as w,S as q,b1 as R,b3 as D,r as l,y as T,L as E,e as H,ai as K,b4 as P}from"./index-C4W0qgmr.js";import{A as X}from"./authService-DvKtJLCI.js";import{V as S}from"./VAlert-B90XlAqJ.js";import{V as Z}from"./VSpacer-DQCrTi4U.js";/* empty css              */const z={setup(){const x=R(),a=D(),s=l(!0),e=l(""),f=l(""),v=l(!1),c=l(0),m=l(null),i=l(null),C=T(()=>s.value?"正在验证登录":e.value?"验证失败":"验证成功"),B=T(()=>s.value?"请稍候，正在处理您的登录请求":e.value?"登录链接验证失败":"您已成功登录");return E({title:"魔术链接验证"}),H(async()=>{var V,_;if(K.isLogin.value===!0){a.push("/app/explore");return}const y=x.query.token;if(!y){s.value=!1,e.value="缺少验证令牌，无法完成验证";return}try{const o=await X.validateMagicLink(y);o.status==="success"?(s.value=!1,f.value=o.message||"登录成功！",v.value=!0,c.value=5,i.value=setInterval(()=>{c.value--,c.value<=0&&clearInterval(i.value)},1e3),m.value=setTimeout(()=>{var k;const N=((k=o.callback)==null?void 0:k.redirect)||"/app/explore";a.push(N)},5e3)):(s.value=!1,e.value=o.message||"验证失败")}catch(o){s.value=!1,o.value=((_=(V=o.response)==null?void 0:V.data)==null?void 0:_.message)||"验证过程中发生错误"}}),P(()=>{m.value&&clearTimeout(m.value),i.value&&clearInterval(i.value)}),{loading:s,error:e,success:f,loginSuccess:v,countdown:c,pageTitle:C,pageSubtitle:B}}},F={class:"d-flex align-center justify-center pa-4"};function G(x,a,s,e,f,v){return d(),h("div",F,[r(q,{class:"pa-4 pt-7","max-width":"448",border:"",rounded:"lg"},{default:t(()=>[r(L,{class:"text-h5 font-weight-semibold"},{default:t(()=>[n(u(e.pageTitle),1)]),_:1}),r(M,null,{default:t(()=>[n(u(e.pageSubtitle),1)]),_:1}),e.loading?(d(),p(b,{key:0},{default:t(()=>[r(U,{indeterminate:"",color:"primary",class:"mx-auto d-block mb-4"}),a[0]||(a[0]=g("p",{class:"text-center"},"正在验证您的登录链接...",-1))]),_:1})):e.error?(d(),p(b,{key:1},{default:t(()=>[r(S,{type:"error",variant:"tonal",border:"start",class:"mb-4"},{default:t(()=>[n(u(e.error),1)]),_:1}),a[1]||(a[1]=g("p",{class:"text-body-2"}," 验证链接可能已失效或已被使用。请尝试重新获取登录链接，或使用其他方式登录。 ",-1))]),_:1})):e.success?(d(),p(b,{key:2},{default:t(()=>[r(S,{type:"success",variant:"tonal",border:"start",class:"mb-4"},{default:t(()=>[n(u(e.success),1)]),_:1}),a[2]||(a[2]=g("p",{class:"text-body-2"}," 您已成功登录，即将跳转到主页... ",-1))]),_:1})):I("",!0),r(j,null,{default:t(()=>[r(Z),r(w,{color:"primary",variant:"text",to:"/app/account/login",disabled:e.loading||e.countdown>0},{default:t(()=>[n(u(e.countdown>0?`${e.countdown}秒后跳转`:"返回登录"),1)]),_:1},8,["disabled"]),r(w,{color:"primary",variant:"flat",to:"/app/explore",disabled:e.loading||!e.loginSuccess||e.countdown>0},{default:t(()=>a[3]||(a[3]=[n(" 去主页 ")])),_:1},8,["disabled"])]),_:1})]),_:1})])}const $=A(z,[["render",G]]);export{$ as default};
