import{_ as D,Y as m,o as i,N as l,e as a,R as y,S as C,Z as f,af as p,f as V,O as h,i as n,L as s,a9 as c,ai as x,c as j,F as k,X as v,aj as b,ak as N,U as w,al as T,a0 as L,P as F,aF as B,aK as U,aG as I,aC as S,aJ as g,W as P,aL as _,aM as q,ar as z,ap as H,aq as R,a7 as A}from"./index-CMux7lMK.js";import"https://static.geetest.com/v4/gt4.js";const E={data(){return{project:{},branches:[],showNewBranchDialog:!1,showDeleteDialog:!1,branchToDelete:"",loading:!1,valid:!1,newBranch:{name:"",source:""}}},async mounted(){await this.initializeProject()},methods:{async initializeProject(){const o=this.$route.params.username,e=this.$route.params.projectname;if(o==="proxy"){this.$router.replace(`/app${this.$route.path}`);return}const u=await H(o,e);if(u.id===0){R.show404();return}this.project=u,await this.loadBranches(),A({title:`分支 · ${this.project.title}`})},async loadBranches(){const o=await z(this.project.id);this.branches=o.data||[]},async createBranch(){if(this.$refs.form.validate())try{this.loading=!0,await q(this.project.id,this.newBranch.name,this.newBranch.source),await this.loadBranches(),this.showNewBranchDialog=!1,this.newBranch.name="",this.newBranch.source=""}catch(o){console.error("创建分支失败:",o),alert("创建分支失败: "+(o.message||"未知错误"))}finally{this.loading=!1}},confirmDeleteBranch(o){this.branchToDelete=o,this.showDeleteDialog=!0},async deleteBranch(){try{this.loading=!0,await _(this.project.id,this.branchToDelete),await this.loadBranches(),this.showDeleteDialog=!1,this.branchToDelete=""}catch(o){console.error("删除分支失败:",o),alert("删除分支失败: "+(o.message||"未知错误"))}finally{this.loading=!1}}}},G={class:"text-caption"};function J(o,e,u,K,r,d){return i(),m(P,null,{default:l(()=>[a(y,null,{default:l(()=>[a(C,{cols:"12"},{default:l(()=>[a(f,null,{default:l(()=>[a(p,{class:"d-flex align-center"},{default:l(()=>[e[9]||(e[9]=V("span",null,"分支",-1)),a(h),a(n,{color:"primary","prepend-icon":"mdi-source-branch-plus",onClick:e[0]||(e[0]=t=>r.showNewBranchDialog=!0)},{default:l(()=>[...e[8]||(e[8]=[s("新建分支 ",-1)])]),_:1})]),_:1}),a(c,null,{default:l(()=>[a(x,null,{default:l(()=>[(i(!0),j(k,null,v(r.branches,t=>(i(),m(b,{key:t.name,value:t.name},{prepend:l(()=>[a(F,{color:t.name===r.project.default_branch?"primary":""},{default:l(()=>[...e[10]||(e[10]=[s("mdi-source-branch ",-1)])]),_:1},8,["color"])]),append:l(()=>[a(n,{to:`/${o.$route.params.username}/${o.$route.params.projectname}/tree/${t.name}`,variant:"text"},{default:l(()=>[...e[11]||(e[11]=[s("查看 ",-1)])]),_:1},8,["to"]),t.name!==r.project.default_branch?(i(),m(n,{key:0,color:"error",variant:"text",onClick:M=>d.confirmDeleteBranch(t.name)},{default:l(()=>[...e[12]||(e[12]=[s("删除 ",-1)])]),_:1},8,["onClick"])):L("",!0)]),default:l(()=>[a(N,null,{default:l(()=>[s(w(t.name),1)]),_:2},1024),a(T,null,{default:l(()=>[V("span",G,"最新提交: "+w(t.latest_commit_hash.substring(0,7)),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(B,{modelValue:r.showNewBranchDialog,"onUpdate:modelValue":e[5]||(e[5]=t=>r.showNewBranchDialog=t),"max-width":"500px"},{default:l(()=>[a(f,null,{default:l(()=>[a(p,null,{default:l(()=>[...e[13]||(e[13]=[s("新建分支",-1)])]),_:1}),a(c,null,{default:l(()=>[a(U,{ref:"form",modelValue:r.valid,"onUpdate:modelValue":e[3]||(e[3]=t=>r.valid=t)},{default:l(()=>[a(I,{modelValue:r.newBranch.name,"onUpdate:modelValue":e[1]||(e[1]=t=>r.newBranch.name=t),rules:[t=>!!t||"分支名称不能为空"],label:"分支名称",required:""},null,8,["modelValue","rules"]),a(S,{modelValue:r.newBranch.source,"onUpdate:modelValue":e[2]||(e[2]=t=>r.newBranch.source=t),items:r.branches,rules:[t=>!!t||"请选择源分支"],"item-title":"name","item-value":"name",label:"源分支",required:""},null,8,["modelValue","items","rules"])]),_:1},8,["modelValue"])]),_:1}),a(g,null,{default:l(()=>[a(h),a(n,{color:"primary",text:"",onClick:e[4]||(e[4]=t=>r.showNewBranchDialog=!1)},{default:l(()=>[...e[14]||(e[14]=[s("取消 ",-1)])]),_:1}),a(n,{disabled:!r.valid,loading:r.loading,color:"primary",onClick:d.createBranch},{default:l(()=>[...e[15]||(e[15]=[s("创建 ",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(B,{modelValue:r.showDeleteDialog,"onUpdate:modelValue":e[7]||(e[7]=t=>r.showDeleteDialog=t),"max-width":"500px"},{default:l(()=>[a(f,null,{default:l(()=>[a(p,null,{default:l(()=>[...e[16]||(e[16]=[s("删除分支",-1)])]),_:1}),a(c,null,{default:l(()=>[s(' 确定要删除分支 "'+w(r.branchToDelete)+'" 吗？此操作不可撤销。 ',1)]),_:1}),a(g,null,{default:l(()=>[a(h),a(n,{color:"primary",text:"",onClick:e[6]||(e[6]=t=>r.showDeleteDialog=!1)},{default:l(()=>[...e[17]||(e[17]=[s("取消 ",-1)])]),_:1}),a(n,{loading:r.loading,color:"error",onClick:d.deleteBranch},{default:l(()=>[...e[18]||(e[18]=[s("删除 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const X=D(E,[["render",J]]);export{X as default};
