import{_ as H}from"./ExtensionEditDialog-dfIZLU0H.js";import{_ as W}from"./TimeAgo-nHUMlK0R.js";import{_ as G,c as X,o as r,Z as d,a0 as f,e as t,N as e,a9 as J,U as T,X as V,aY as N,ae as _,L as n,Y as m,a_ as F,R as A,S as C,T as D,a8 as O,ah as K,ai as c,aj as g,ak as y,a5 as b,i as k,P as U,F as Q,W as $,f as x,aI as ee,O as te,aE as se,aX as le,a6 as I,M as Y,b9 as ne,af as Z}from"./index-BhZBrlGg.js";import{a as oe,V as P}from"./VTimeline-B2dcmHvT.js";import"./ProjectSelector-BTYnMByG.js";import"./VSelect-CWcWmsqs.js";import"./VCheckboxBtn-jKGzOvSv.js";import"./VSelectionControl-Cdx4dl39.js";import"./VRadioGroup-ZofjN44p.js";import"./VSwitch-wS9HwrLL.js";import"https://static.geetest.com/v4/gt4.js";const ie={name:"ExtensionDetail",components:{TimeAgo:W,ExtensionEditDialog:H},setup(){Y({title:"扩展详情 - ZeroCat"})},data(){return{loading:!0,extension:null,s3BucketUrl:"",localuser:Z,showEditDialog:!1,showDeleteDialog:!1,deleteLoading:!1,submitLoading:!1,updateLoading:!1,snackbar:{show:!1,message:"",color:"success"}}},computed:{isOwner(){var o,s,v;return!this.extension||!Z.isLogin.value?!1:((o=Z.user.value)==null?void 0:o.id)===((v=(s=this.extension)==null?void 0:s.author)==null?void 0:v.id)}},async created(){this.s3BucketUrl=ne("s3.staticurl"),await this.fetchExtensionDetail()},methods:{async fetchExtensionDetail(){var o,s,v,B;this.loading=!0;try{const l=this.$route.params.id;let u;try{u=await I.get(`/extensions/detail/${l}?scope=my`)}catch(h){if(((o=h.response)==null?void 0:o.status)===401||((s=h.response)==null?void 0:s.status)===403)u=await I.get(`/extensions/detail/${l}?scope=public`);else throw h}((v=u.data)==null?void 0:v.status)==="success"?(this.extension=u.data.data,Y({title:`${((B=this.extension.project)==null?void 0:B.title)||"扩展"} - ZeroCat`})):this.extension=null}catch(l){console.error("Failed to fetch extension detail:",l),this.extension=null}finally{this.loading=!1}},async deleteExtension(){if(!(!this.extension||!this.isOwner)){this.deleteLoading=!0;try{const o=await I.delete(`/extensions/manager/${this.extension.id}`);o.data.status==="success"?(this.showMessage("删除扩展成功","success"),this.$router.push("/app/extensions")):this.showMessage(o.data.message||"删除扩展失败","error")}catch(o){console.error("Failed to delete extension:",o),this.showMessage("删除扩展失败","error")}finally{this.deleteLoading=!1,this.showDeleteDialog=!1}}},async submitExtension(){if(!(!this.extension||!this.isOwner)){this.submitLoading=!0;try{const o=await I.post(`/extensions/manager/submit/${this.extension.id}`);o.data.status==="success"?(this.showMessage("提交审核成功","success"),await this.fetchExtensionDetail()):this.showMessage(o.data.message||"提交失败","error")}catch(o){console.error("Failed to submit extension:",o),this.showMessage("提交失败","error")}finally{this.submitLoading=!1}}},async updateToLatestCommit(){if(!(!this.extension||!this.isOwner)){this.updateLoading=!0;try{const o=await I.post(`/extensions/manager/update/${this.extension.id}`);o.data.status==="success"?(this.showMessage("更新到最新提交成功","success"),await this.fetchExtensionDetail()):this.showMessage(o.data.message||"更新失败","error")}catch(o){console.error("Failed to update commit:",o),this.showMessage("更新失败","error")}finally{this.updateLoading=!1}}},getStatusColor(o){return{developing:"primary",pending:"warning",verified:"success",rejected:"error"}[o]||"grey"},getStatusText(o){return{developing:"开发中",pending:"待审核",verified:"上架",rejected:"已拒绝"}[o]||"未知"},showMessage(o,s="success"){this.snackbar={show:!0,message:o,color:s}}}},ae={class:"text-caption text-medium-emphasis"},re={class:"text-caption text-medium-emphasis"},ue={class:"mb-1"};function de(o,s,v,B,l,u){const h=W,q=H;return r(),X("div",null,[l.loading?(r(),d(T,{key:0,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:e(()=>[t(J,{indeterminate:"",size:"64",color:"primary"})]),_:1})):l.extension?(r(),d(T,{key:1},{default:e(()=>[t(V,{variant:"elevated",border:""},{default:e(()=>[t(N,null,{default:e(()=>[t(_,null,{default:e(()=>{var i,p;return[n(m(((p=(i=l.extension)==null?void 0:i.project)==null?void 0:p.title)||"扩展"),1)]}),_:1}),t(F,null,{default:e(()=>{var i;return[n(m(((i=l.extension)==null?void 0:i.description)||"暂无描述"),1)]}),_:1}),t(A,null,{default:e(()=>[t(C,{cols:"auto"},{default:e(()=>{var i;return[u.isOwner?(r(),d(D,{key:0,color:u.getStatusColor(l.extension.status),variant:"tonal",size:"default",class:"mr-2"},{default:e(()=>[n(m(u.getStatusText(l.extension.status)),1)]),_:1},8,["color"])):f("",!0),t(D,{color:(i=l.extension)!=null&&i.scratchCompatible?"orange":"grey",variant:"tonal","prepend-icon":"mdi-puzzle"},{default:e(()=>{var p;return[n(m((p=l.extension)!=null&&p.scratchCompatible?"兼容Scratch":"独立扩展"),1)]}),_:1},8,["color"])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0),t(T,null,{default:e(()=>[t(A,null,{default:e(()=>[t(C,{cols:"12",lg:"8"},{default:e(()=>[l.extension?(r(),d(V,{key:0,border:"",class:"mb-6"},{default:e(()=>[t(_,null,{default:e(()=>s[6]||(s[6]=[n(" 扩展详细信息 ",-1)])),_:1,__:[6]}),t(O,{class:"pa-0"},{default:e(()=>[t(K,null,{default:e(()=>{var i,p,j,L,z,E,M,S;return[t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[7]||(s[7]=[n("扩展ID",-1)])),_:1,__:[7]}),t(y,{class:"text-body-2 font-weight-medium"},{default:e(()=>{var a;return[n(m(((a=l.extension)==null?void 0:a.id)||"N/A"),1)]}),_:1})]),_:1}),t(b),t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[8]||(s[8]=[n("项目ID",-1)])),_:1,__:[8]}),t(y,{class:"text-body-2 font-weight-medium"},{default:e(()=>{var a,w;return[n(m(((w=(a=l.extension)==null?void 0:a.project)==null?void 0:w.id)||"N/A"),1)]}),_:1})]),_:1}),t(b),t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[9]||(s[9]=[n("分支信息",-1)])),_:1,__:[9]}),t(y,null,{default:e(()=>[t(D,{color:"primary",variant:"tonal",size:"small","prepend-icon":"mdi-source-branch"},{default:e(()=>{var a;return[n(m(((a=l.extension)==null?void 0:a.branch)||"main"),1)]}),_:1})]),_:1})]),_:1}),t(b),t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[10]||(s[10]=[n("提交信息",-1)])),_:1,__:[10]}),t(y,{class:"d-flex align-center"},{default:e(()=>{var a;return[t(D,{color:"success",variant:"tonal",size:"small","prepend-icon":"mdi-source-commit"},{default:e(()=>{var w,R;return[n(m(((R=(w=l.extension)==null?void 0:w.commit)==null?void 0:R.substring(0,8))||"latest"),1)]}),_:1}),u.isOwner&&((a=l.extension)!=null&&a.commit)&&l.extension.commit!=="latest"?(r(),d(k,{key:0,size:"small",variant:"text","prepend-icon":"mdi-refresh",loading:l.updateLoading,onClick:u.updateToLatestCommit,class:"ml-2"},{default:e(()=>s[11]||(s[11]=[n(" 更新到最新 ",-1)])),_:1,__:[11]},8,["loading","onClick"])):f("",!0)]}),_:1})]),_:1}),t(b),t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[12]||(s[12]=[n("创建时间",-1)])),_:1,__:[12]}),t(y,{class:"d-flex align-center"},{default:e(()=>{var a;return[t(U,{class:"mr-2",size:"small",color:"primary"},{default:e(()=>s[13]||(s[13]=[n("mdi-clock-outline",-1)])),_:1,__:[13]}),t(h,{date:(a=l.extension)==null?void 0:a.created_at},null,8,["date"])]}),_:1})]),_:1}),t(b),t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[14]||(s[14]=[n("更新时间",-1)])),_:1,__:[14]}),t(y,{class:"d-flex align-center"},{default:e(()=>{var a;return[t(U,{class:"mr-2",size:"small",color:"primary"},{default:e(()=>s[15]||(s[15]=[n("mdi-clock-outline",-1)])),_:1,__:[15]}),t(h,{date:(a=l.extension)==null?void 0:a.updated_at},null,8,["date"])]}),_:1})]),_:1}),(i=l.extension)!=null&&i.has_docs&&((p=l.extension)!=null&&p.docs_url)?(r(),d(b,{key:0})):f("",!0),(j=l.extension)!=null&&j.has_docs&&((L=l.extension)!=null&&L.docs_url)?(r(),d(c,{key:1},{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[16]||(s[16]=[n("扩展文档",-1)])),_:1,__:[16]}),t(y,null,{default:e(()=>[t(k,{variant:"tonal",size:"small","prepend-icon":"mdi-book-open-variant",href:l.extension.docs_url,target:"_blank"},{default:e(()=>s[17]||(s[17]=[n(" 查看文档 ",-1)])),_:1,__:[17]},8,["href"])]),_:1})]),_:1})):f("",!0),t(b),t(c,null,{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[18]||(s[18]=[n("兼容性信息",-1)])),_:1,__:[18]}),t(y,null,{default:e(()=>{var a;return[t(D,{color:(a=l.extension)!=null&&a.scratchCompatible?"orange":"grey",variant:"tonal",size:"small","prepend-icon":"mdi-puzzle",class:"mb-2"},{default:e(()=>{var w;return[n(m((w=l.extension)!=null&&w.scratchCompatible?"兼容原版Scratch":"不兼容原版Scratch"),1)]}),_:1},8,["color"])]}),_:1})]),_:1}),(E=(z=l.extension)==null?void 0:z.project)!=null&&E.tags&&l.extension.project.tags.length>0?(r(),d(b,{key:2})):f("",!0),(S=(M=l.extension)==null?void 0:M.project)!=null&&S.tags&&l.extension.project.tags.length>0?(r(),d(c,{key:3},{default:e(()=>[t(g,{class:"text-caption text-medium-emphasis"},{default:e(()=>s[19]||(s[19]=[n("项目标签",-1)])),_:1,__:[19]}),t(y,null,{default:e(()=>[(r(!0),X(Q,null,$(l.extension.project.tags,a=>(r(),d(D,{key:a,size:"small",variant:"outlined",class:"mr-1 mb-1"},{default:e(()=>[n(m(a),1)]),_:2},1024))),128))]),_:1})]),_:1})):f("",!0)]}),_:1})]),_:1})]),_:1})):f("",!0)]),_:1}),t(C,{cols:"12",lg:"4"},{default:e(()=>{var i,p,j,L,z,E,M,S;return[(i=l.extension)!=null&&i.project?(r(),d(V,{key:0,border:"",class:"mb-6",href:l.extension.project.url},{default:e(()=>[t(_,null,{default:e(()=>s[20]||(s[20]=[n(" 关联项目 ",-1)])),_:1,__:[20]}),t(N,null,{default:e(()=>[t(_,null,{default:e(()=>[n(m(l.extension.project.title),1)]),_:1}),t(F,null,{default:e(()=>[n(m(l.extension.project.description||"ZeroCat 上的项目"),1)]),_:1})]),_:1})]),_:1},8,["href"])):f("",!0),(p=l.extension)!=null&&p.has_samples&&((j=l.extension)!=null&&j.sample_project)?(r(),d(V,{key:1,border:"",class:"mb-6",to:`/${(E=(z=(L=l.extension)==null?void 0:L.sample_project)==null?void 0:z.author)==null?void 0:E.username}/${(S=(M=l.extension)==null?void 0:M.sample_project)==null?void 0:S.name}`},{default:e(()=>[t(_,null,{default:e(()=>s[21]||(s[21]=[n(" 示例项目 ",-1)])),_:1,__:[21]}),t(N,null,{default:e(()=>[t(_,null,{default:e(()=>[n(m(l.extension.sample_project.title),1)]),_:1}),t(F,null,{default:e(()=>[n("by "+m(l.extension.sample_project.description||"ZeroCat 上的项目"),1)]),_:1})]),_:1})]),_:1},8,["to"])):f("",!0)]}),_:1})]),_:1})]),_:1}),u.isOwner&&l.extension?(r(),d(T,{key:2},{default:e(()=>[t(V,{border:""},{default:e(()=>[t(_,null,{default:e(()=>s[22]||(s[22]=[n(" 扩展管理 ",-1)])),_:1,__:[22]}),t(O,null,{default:e(()=>[t(A,{class:"mb-6"},{default:e(()=>[t(C,{cols:"12",md:"auto"},{default:e(()=>[t(k,{color:"primary","prepend-icon":"mdi-pencil",variant:"elevated",onClick:s[0]||(s[0]=i=>l.showEditDialog=!0)},{default:e(()=>s[23]||(s[23]=[n(" 编辑扩展 ",-1)])),_:1,__:[23]})]),_:1}),t(C,{cols:"12",md:"auto"},{default:e(()=>[l.extension.status==="developing"?(r(),d(k,{key:0,color:"success","prepend-icon":"mdi-upload",variant:"elevated",loading:l.submitLoading,onClick:u.submitExtension},{default:e(()=>s[24]||(s[24]=[n(" 提交审核 ",-1)])),_:1,__:[24]},8,["loading","onClick"])):f("",!0)]),_:1}),t(C,{cols:"12",md:"auto",class:"ml-auto"},{default:e(()=>[t(k,{color:"error","prepend-icon":"mdi-delete",variant:"outlined",onClick:s[1]||(s[1]=i=>l.showDeleteDialog=!0)},{default:e(()=>s[25]||(s[25]=[n(" 删除扩展 ",-1)])),_:1,__:[25]})]),_:1})]),_:1}),t(V,{variant:"tonal"},{default:e(()=>[t(_,{class:"d-flex align-center"},{default:e(()=>[t(U,{class:"mr-2"},{default:e(()=>s[26]||(s[26]=[n("mdi-history",-1)])),_:1,__:[26]}),s[27]||(s[27]=n(" 开发历史 ",-1))]),_:1,__:[27]}),t(O,null,{default:e(()=>[t(oe,{density:"compact",side:"end"},{default:e(()=>[t(P,{"dot-color":"primary",size:"small"},{default:e(()=>[s[28]||(s[28]=x("div",{class:"mb-1"},[x("strong",null,"扩展创建")],-1)),x("div",ae,[t(h,{date:l.extension.created_at},null,8,["date"])])]),_:1,__:[28]}),l.extension.updated_at!==l.extension.created_at?(r(),d(P,{key:0,"dot-color":"warning",size:"small"},{default:e(()=>[s[29]||(s[29]=x("div",{class:"mb-1"},[x("strong",null,"最后更新")],-1)),x("div",re,[t(h,{date:l.extension.updated_at},null,8,["date"])])]),_:1,__:[29]})):f("",!0),t(P,{"dot-color":u.getStatusColor(l.extension.status),size:"small"},{default:e(()=>[x("div",ue,[x("strong",null,m(u.getStatusText(l.extension.status)),1)]),s[30]||(s[30]=x("div",{class:"text-caption text-medium-emphasis"},"当前状态",-1))]),_:1,__:[30]},8,["dot-color"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):l.extension?f("",!0):(r(),d(T,{key:3,class:"text-center py-8"},{default:e(()=>[t(U,{size:"64",color:"grey-lighten-1"},{default:e(()=>s[31]||(s[31]=[n("mdi-puzzle-remove",-1)])),_:1,__:[31]}),s[33]||(s[33]=x("p",{class:"text-h6 mt-4 text-grey-darken-1"},"扩展不存在",-1)),s[34]||(s[34]=x("p",{class:"text-body-2 text-grey"},"找不到指定的扩展信息",-1)),t(k,{class:"mt-4",to:"/app/extensions",color:"primary"},{default:e(()=>s[32]||(s[32]=[n("返回扩展列表",-1)])),_:1,__:[32]})]),_:1,__:[33,34]})),u.isOwner?(r(),d(q,{key:4,modelValue:l.showEditDialog,"onUpdate:modelValue":s[2]||(s[2]=i=>l.showEditDialog=i),extension:l.extension,onUpdated:u.fetchExtensionDetail},null,8,["modelValue","extension","onUpdated"])):f("",!0),u.isOwner?(r(),d(se,{key:5,modelValue:l.showDeleteDialog,"onUpdate:modelValue":s[4]||(s[4]=i=>l.showDeleteDialog=i),"max-width":"400"},{default:e(()=>[t(V,null,{default:e(()=>[t(_,null,{default:e(()=>s[35]||(s[35]=[n("删除扩展",-1)])),_:1,__:[35]}),t(O,null,{default:e(()=>{var i;return[n(' 确定要删除扩展"'+m((i=l.extension)==null?void 0:i.name)+'"吗？此操作不可撤销。 ',1)]}),_:1}),t(ee,null,{default:e(()=>[t(te),t(k,{onClick:s[3]||(s[3]=i=>l.showDeleteDialog=!1)},{default:e(()=>s[36]||(s[36]=[n("取消",-1)])),_:1,__:[36]}),t(k,{color:"error",loading:l.deleteLoading,onClick:u.deleteExtension},{default:e(()=>s[37]||(s[37]=[n(" 删除 ",-1)])),_:1,__:[37]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):f("",!0),t(le,{modelValue:l.snackbar.show,"onUpdate:modelValue":s[5]||(s[5]=i=>l.snackbar.show=i),color:l.snackbar.color},{default:e(()=>[n(m(l.snackbar.message),1)]),_:1},8,["modelValue","color"])])}const ke=G(ie,[["render",de]]);export{ke as default};
