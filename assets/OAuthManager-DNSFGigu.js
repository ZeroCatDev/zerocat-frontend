import{_ as de,r as p,x as ie,b as me,ac as fe,c as O,o as v,e as t,N as l,a9 as U,f as d,O as y,L as o,a3 as A,Y as x,$ as D,Q as Z,F as R,U as j,R as q,W as I,Z as G,X as n,S as P,a5 as Q,ad as _e,ae as b,ag as k,af as C,aE as H,i as L,aA as J,C as ve,a1 as $,ab as K}from"./index-BXZs0YfJ.js";import{_ as ce}from"./verifyEmail-C0O2gCEg.js";import{V as h}from"./VSpacer-CZRDZGDx.js";const pe={class:"oauth-binding"},ge={class:"d-flex align-center mb-2"},ye={class:"text-h6"},be={class:"text-caption"},ke={class:"mt-2 text-caption"},Ce={__name:"OAuthManager",setup(xe){const S=p([]),m=p(""),_=p("info"),N=p(!1),V=p(!1),T=p(""),u=p(null),B=p([]),ee="https://zerocat-api.houlangs.com",F=p(!1),W={google:{backgroundColor:"#4285F4",color:"#FFFFFF"},microsoft:{backgroundColor:"#F25022",color:"#FFFFFF"},github:{backgroundColor:"#333333",color:"#FFFFFF"},"40code":{backgroundColor:"#000000",color:"#FFFFFF"},linuxdo:{backgroundColor:"#FFD700",color:"#000000"},default:{backgroundColor:"#CCCCCC",color:"#000000"}},X={google:"mdi-google",microsoft:"mdi-microsoft",github:"mdi-github","40code":"mdi-code-braces",linuxdo:"mdi-linux",default:"mdi-link"},z=r=>{const e=r.replace("oauth_","").toLowerCase();return X[e]||X.default},E=r=>{const e=r.replace("oauth_","").toLowerCase(),s=B.value.find(a=>a.id.toLowerCase()===e);return s?s.name:e.charAt(0).toUpperCase()+e.slice(1)},M=r=>{const e=new Date(r);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)},Y=async()=>{var r,e;try{const s=await $.post("/account/oauth/bound",{userid:K.user.value.id});s.data.status==="success"?S.value=s.data.data:(m.value=s.data.message,_.value="error")}catch(s){m.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||"获取绑定的 OAuth 账号失败",_.value="error"}},le=async()=>{var r,e;try{const s=await $.get("/account/emails");if(s.data.status==="success"){const i=s.data.data.find(c=>c.is_primary);i&&(T.value=i.contact_value)}else m.value=s.data.message,_.value="error"}catch(s){m.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||"获取邮箱列表失败",_.value="error"}},te=async()=>{var r,e;try{const s=await $.get("/account/oauth/providers");s.data.status==="success"?B.value=s.data.data:(m.value=s.data.message,_.value="error")}catch(s){m.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||"获取可绑定的 OAuth 提供商失败",_.value="error"}},ae=r=>{u.value=r,F.value=!0},oe=()=>{F.value=!1,V.value=!0},se=()=>{V.value=!1,N.value=!0},ue=async r=>{var e,s;try{const a=await $.post("/account/confirm-unlink-oauth",{email:T.value,code:r,provider:u.value.contact_type});a.data.status==="success"?(m.value="成功解绑 OAuth 账号",_.value="success",Y()):(m.value=a.data.message||"解绑失败",_.value="error")}catch(a){m.value=((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"解绑 OAuth 账号失败",_.value="error"}finally{u.value=null}},re=r=>{window.location.href=`${ee}/account/oauth/bind/${r}?token=${K.getToken()}`},w=r=>W[r]||W.default,ne=ie(()=>{const r=S.value.map(e=>e.contact_type.toLowerCase().replace("oauth_",""));return B.value.filter(e=>!r.includes(e.id.toLowerCase()))});return me(()=>{Y(),le(),te()}),(r,e)=>{const s=fe("v-list-item-content");return v(),O("div",pe,[t(I,null,{default:l(()=>[t(U,{class:"d-flex align-center"},{default:l(()=>[t(y,{class:"mr-2"},{default:l(()=>e[5]||(e[5]=[o("mdi-link-variant")])),_:1,__:[5]}),e[6]||(e[6]=d("h2",null,"已绑定的 OAuth 账号",-1))]),_:1,__:[6]}),t(A,null,{default:l(()=>[t(Z,null,{default:l(()=>[(v(!0),O(R,null,j(S.value,(a,i)=>(v(),x(q,{key:i,cols:"12",sm:"6",md:"4"},{default:l(()=>[t(I,{elevation:"2",class:"oauth-account-card",onClick:c=>ae(a)},{default:l(()=>[t(A,null,{default:l(()=>[d("div",ge,[t(G,{color:w(a.contact_type.replace("oauth_","")).backgroundColor,size:"40",class:"mr-3"},{default:l(()=>[t(y,{color:w(a.contact_type.replace("oauth_","")).color},{default:l(()=>[o(n(z(a.contact_type)),1)]),_:2},1032,["color"])]),_:2},1032,["color"]),d("div",null,[d("div",ye,n(E(a.contact_type)),1),d("div",be,"ID: "+n(a.contact_id),1)])]),t(P,{small:"",color:a.verified?"success":"warning",class:"mr-2"},{default:l(()=>[o(n(a.verified?"已验证":"未验证"),1)]),_:2},1032,["color"]),t(P,{small:"",color:a.is_primary?"primary":"grey",class:"mr-2"},{default:l(()=>[o(n(a.is_primary?"主账号":"关联账号"),1)]),_:2},1032,["color"]),d("div",ke," 绑定时间: "+n(M(a.created_at)),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),m.value?(v(),x(Q,{key:0,type:_.value,class:"mt-4"},{default:l(()=>[o(n(m.value),1)]),_:1},8,["type"])):D("",!0)]),_:1})]),_:1}),t(J,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=a=>F.value=a),"max-width":"500"},{default:l(()=>[t(I,null,{default:l(()=>[t(U,{class:"headline d-flex align-center"},{default:l(()=>{var a,i;return[t(G,{color:w(((i=(a=u.value)==null?void 0:a.contact_type)==null?void 0:i.replace("oauth_",""))||"").backgroundColor,size:"40",class:"mr-3"},{default:l(()=>{var c,f;return[t(y,{color:w(((f=(c=u.value)==null?void 0:c.contact_type)==null?void 0:f.replace("oauth_",""))||"").color},{default:l(()=>{var g;return[o(n(z(((g=u.value)==null?void 0:g.contact_type)||"")),1)]}),_:1},8,["color"])]}),_:1},8,["color"]),o(" "+n(u.value?E(u.value.contact_type):"")+" 账号详情 ",1)]}),_:1}),t(A,null,{default:l(()=>[t(_e,{dense:""},{default:l(()=>{var a,i,c;return[t(b,null,{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[7]||(e[7]=[o("绑定 ID")])),_:1,__:[7]}),t(C,null,{default:l(()=>{var f;return[o(n(((f=u.value)==null?void 0:f.contact_id)||"-"),1)]}),_:1})]),_:1})]),_:1}),(a=u.value)!=null&&a.metadata?(v(),x(b,{key:0},{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[8]||(e[8]=[o("平台用户 ID")])),_:1,__:[8]}),t(C,null,{default:l(()=>[o(n(u.value.metadata.id||"-"),1)]),_:1})]),_:1})]),_:1})):D("",!0),(i=u.value)!=null&&i.metadata?(v(),x(b,{key:1},{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[9]||(e[9]=[o("用户名")])),_:1,__:[9]}),t(C,null,{default:l(()=>[o(n(u.value.metadata.name||"-"),1)]),_:1})]),_:1})]),_:1})):D("",!0),(c=u.value)!=null&&c.metadata?(v(),x(b,{key:2},{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[10]||(e[10]=[o("邮箱")])),_:1,__:[10]}),t(C,null,{default:l(()=>[o(n(u.value.metadata.email||"-"),1)]),_:1})]),_:1})]),_:1})):D("",!0),t(b,null,{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[11]||(e[11]=[o("验证状态")])),_:1,__:[11]}),t(C,null,{default:l(()=>{var f;return[t(P,{small:"",color:(f=u.value)!=null&&f.verified?"success":"warning"},{default:l(()=>{var g;return[o(n((g=u.value)!=null&&g.verified?"已验证":"未验证"),1)]}),_:1},8,["color"])]}),_:1})]),_:1})]),_:1}),t(b,null,{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[12]||(e[12]=[o("账号类型")])),_:1,__:[12]}),t(C,null,{default:l(()=>{var f;return[t(P,{small:"",color:(f=u.value)!=null&&f.is_primary?"primary":"grey"},{default:l(()=>{var g;return[o(n((g=u.value)!=null&&g.is_primary?"主账号":"关联账号"),1)]}),_:1},8,["color"])]}),_:1})]),_:1})]),_:1}),t(b,null,{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[13]||(e[13]=[o("绑定时间")])),_:1,__:[13]}),t(C,null,{default:l(()=>[o(n(u.value?M(u.value.created_at):"-"),1)]),_:1})]),_:1})]),_:1}),t(b,null,{default:l(()=>[t(s,null,{default:l(()=>[t(k,{class:"text--primary mb-1"},{default:l(()=>e[14]||(e[14]=[o("最后更新")])),_:1,__:[14]}),t(C,null,{default:l(()=>[o(n(u.value?M(u.value.updated_at):"-"),1)]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),t(H,null,{default:l(()=>[t(h),t(L,{text:"",onClick:e[0]||(e[0]=a=>F.value=!1)},{default:l(()=>e[15]||(e[15]=[o("关闭")])),_:1,__:[15]}),t(L,{color:"error",text:"",onClick:oe,disabled:!u.value},{default:l(()=>[t(y,{left:""},{default:l(()=>e[16]||(e[16]=[o("mdi-link-variant-off")])),_:1,__:[16]}),e[17]||(e[17]=o(" 解除绑定 "))]),_:1,__:[17]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),"max-width":"500"},{default:l(()=>[t(I,null,{default:l(()=>[t(U,{class:"headline"},{default:l(()=>[t(y,{left:"",color:"warning"},{default:l(()=>e[18]||(e[18]=[o("mdi-alert")])),_:1,__:[18]}),e[19]||(e[19]=o(" 确认解除绑定 "))]),_:1,__:[19]}),t(A,null,{default:l(()=>[e[27]||(e[27]=d("p",{class:"mb-2"},"您确定要解除以下 OAuth 账号的绑定吗？",-1)),t(Q,{type:"warning",text:"",dense:""},{default:l(()=>{var a,i;return[e[23]||(e[23]=d("strong",null,"提供商：",-1)),o(n(u.value?E(u.value.contact_type):""),1),e[24]||(e[24]=d("br",null,null,-1)),e[25]||(e[25]=d("strong",null,"绑定 ID：",-1)),o(n(((a=u.value)==null?void 0:a.contact_id)||"-"),1),e[26]||(e[26]=d("br",null,null,-1)),(i=u.value)!=null&&i.metadata?(v(),O(R,{key:0},[e[20]||(e[20]=d("strong",null,"用户名：",-1)),o(n(u.value.metadata.name||"-"),1),e[21]||(e[21]=d("br",null,null,-1)),e[22]||(e[22]=d("strong",null,"平台邮箱：",-1)),o(n(u.value.metadata.email||"-"),1)],64)):D("",!0)]}),_:1,__:[23,24,25,26]}),e[28]||(e[28]=d("p",{class:"mt-2 text-caption"},"解除绑定后，您需要重新进行身份验证才能重新绑定此账号。",-1))]),_:1,__:[27,28]}),t(H,null,{default:l(()=>[t(h),t(L,{text:"",onClick:e[2]||(e[2]=a=>V.value=!1)},{default:l(()=>e[29]||(e[29]=[o("取消")])),_:1,__:[29]}),t(L,{color:"error",onClick:se},{default:l(()=>[t(y,{left:""},{default:l(()=>e[30]||(e[30]=[o("mdi-link-variant-off")])),_:1,__:[30]}),e[31]||(e[31]=o(" 确认解除绑定 "))]),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ce,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=a=>N.value=a),email:T.value,onVerified:ue},null,8,["modelValue","email"]),t(I,{class:"mt-4"},{default:l(()=>[t(U,{class:"d-flex align-center"},{default:l(()=>[t(y,{class:"mr-2"},{default:l(()=>e[32]||(e[32]=[o("mdi-link-plus")])),_:1,__:[32]}),e[33]||(e[33]=d("h2",null,"可绑定的 OAuth 提供商",-1))]),_:1,__:[33]}),t(A,null,{default:l(()=>[t(Q,{type:"info",text:""},{default:l(()=>e[34]||(e[34]=[o(" 不论怎样，你都需要确保对绑定账户内邮箱完全的控制。 ")])),_:1,__:[34]}),t(Z,{class:"mt-2"},{default:l(()=>[(v(!0),O(R,null,j(ne.value,(a,i)=>(v(),x(q,{key:i,cols:"12",sm:"6",md:"4"},{default:l(()=>[t(L,{block:"",height:"50",style:ve(w(a.id)),onClick:c=>re(a.id),class:"text-none"},{default:l(()=>[t(y,{left:""},{default:l(()=>[o(n(z(a.id)),1)]),_:2},1024),o(" 绑定 "+n(a.name),1)]),_:2},1032,["style","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})])}}},Ae=de(Ce,[["__scopeId","data-v-abed661c"]]);export{Ae as _};
