import{_ as se,a as le,b as ae}from"./Comment-n1SJorBx.js";import{_ as oe}from"./Projects-ubVhLmDY.js";import{f as B,p as E,U as _e,n as X,t as v,y as pe,s as fe,i as M,a as t,W as C,X as he,E as ne,Y as re,B as de,k as N,Z as ce,u as ye,$ as ve,R as ge,a0 as xe,a1 as D,A as me,j as be,l as Ce,a2 as ke,a3 as je,a4 as Te,a5 as Y,z as we,a6 as Ve,a7 as Pe,_ as De,r as ze,c as b,o as c,w as l,a8 as Se,a9 as z,G as a,J as Ie,H as m,O as n,P as $,aa as Be,K as k,ab as V,e as x,M as P,N as S,ac as I,I as Ee,Q as ee,T as Me}from"./index-B-pwE892.js";import{g as Ne}from"./user-D60UDejH.js";/* empty css                        */import{V as te,a as ie}from"./VRow-BmqfSRgz.js";import{V as y}from"./VChip-BWy79_OB.js";import{V as Re}from"./VContainer-9UII5G1r.js";import"./VForm-CMfS_Xif.js";import"./VTextarea-Cop013mw.js";import"./VDialog-BvdYUyNA.js";import"./showProjects-GgrwWCex.js";import"./projectService-Bp75SO6o.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-3WsGkzbV.js";/* empty css              */const Ue=E({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:ce,iconColor:String,lineColor:String,...N(),...de(),...re(),...ne()},"VTimelineDivider"),Le=B()({name:"VTimelineDivider",props:Ue(),setup(e,s){let{slots:u}=s;const{sizeClasses:j,sizeStyles:o}=_e(e,"v-timeline-divider__dot"),{backgroundColorStyles:p,backgroundColorClasses:h}=X(v(e,"dotColor")),{roundedClasses:f}=pe(e,"v-timeline-divider__dot"),{elevationClasses:g}=fe(e),{backgroundColorClasses:T,backgroundColorStyles:w}=X(v(e,"lineColor"));return M(()=>t("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[t("div",{class:["v-timeline-divider__before",T.value],style:w.value},null),!e.hideDot&&t("div",{key:"dot",class:["v-timeline-divider__dot",g.value,f.value,j.value],style:o.value},[t("div",{class:["v-timeline-divider__inner-dot",h.value,f.value],style:p.value},[u.default?t(he,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},u.default):t(C,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),t("div",{class:["v-timeline-divider__after",T.value],style:w.value},null)])),{}}}),ue=E({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:ce,iconColor:String,lineInset:[Number,String],...N(),...be(),...ne(),...de(),...re(),...me()},"VTimelineItem"),Ae=B()({name:"VTimelineItem",props:ue(),setup(e,s){let{slots:u}=s;const{dimensionStyles:j}=ye(e),o=ve(0),p=ge();return xe(p,h=>{var f;h&&(o.value=((f=h.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:f.getBoundingClientRect().width)??0)},{flush:"post"}),M(()=>{var h,f;return t("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":D(o.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${D(e.lineInset)})`:D(0)},e.style]},[t("div",{class:"v-timeline-item__body",style:j.value},[(h=u.default)==null?void 0:h.call(u)]),t(Le,{ref:p,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:u.icon}),e.density!=="compact"&&t("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((f=u.opposite)==null?void 0:f.call(u))])])}),{}}}),Fe=E({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...Pe(ue({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...N(),...Ve(),...me(),...we()},"VTimeline"),Oe=B()({name:"VTimeline",props:Fe(),setup(e,s){let{slots:u}=s;const{themeClasses:j}=Ce(e),{densityClasses:o}=ke(e),{rtlClasses:p}=je();Te({VTimelineDivider:{lineColor:v(e,"lineColor")},VTimelineItem:{density:v(e,"density"),dotColor:v(e,"dotColor"),fillDot:v(e,"fillDot"),hideOpposite:v(e,"hideOpposite"),iconColor:v(e,"iconColor"),lineColor:v(e,"lineColor"),lineInset:v(e,"lineInset"),size:v(e,"size")}});const h=Y(()=>{const g=e.side?e.side:e.density!=="default"?"end":null;return g&&`v-timeline--side-${g}`}),f=Y(()=>{const g=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return g;case"start":return g[0];case"end":return g[1];default:return null}});return M(()=>t(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,f.value,{"v-timeline--inset-line":!!e.lineInset},j.value,o.value,h.value,p.value,e.class],style:[{"--v-timeline-line-thickness":D(e.lineThickness)},e.style]},u)),{}}}),qe={components:{Projects:oe,Comment:ae,Markdown:le,TimeAgo:se},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},currentPage:1,isLoadingMore:!1,pageSize:20,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"},VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await Ne(this.username),Me({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){this.lists=(await ee({url:`/projectlist/userid/${this.user.id}/public`,method:"get"})).data.data},async fetchTimeline(e=1){try{const s=await ee.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});s.data.status==="success"&&(e===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(e){return e!=null&&e.length?e.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}},getTargetContent(e,s){if(!e)return"";switch(e.type){case"project":return e.title||`项目 #${e.id}`;case"user":return e.display_name||`用户 #${e.id}`;case"projectlist":return`项目列表 #${e.id}`;default:return`${e.type} #${e.id}`}},getFieldDisplayName(e){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[e]||e}}},Ke={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},We={class:"mt-2 text-body-1 text-medium-emphasis",style:{"word-break":"break-word","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ze={class:"mt-2 text-medium-emphasis"},He={class:"timeline-item-content"},Ge={class:"event-header"},Je={class:"text-h6"},Qe={class:"project-info"},Xe={class:"font-weight-medium"},Ye={class:"mt-2 text-caption text-medium-emphasis"},$e={class:"d-flex align-center mb-2"},et={class:"font-weight-medium"},tt={class:"rename-details text-body-2"},it={class:"d-flex align-center"},st={class:"d-flex align-center mt-1"},lt={class:"project-meta text-caption text-medium-emphasis mt-2"},at={class:"d-flex align-center mb-2"},ot={class:"font-weight-medium"},nt={class:"commit-message text-body-2"},rt={class:"commit-hash text-caption text-medium-emphasis mt-1"},dt={class:"d-flex align-center mb-2"},ct={class:"font-weight-medium"},mt={class:"info-updates text-body-2"},ut={class:"d-flex align-center"},_t={class:"d-flex flex-column mt-1 field-changes"},pt={class:"old-value"},ft={class:"ml-2"},ht={class:"new-value"},yt={class:"ml-2 text-info"},vt={class:"project-meta text-caption text-medium-emphasis mt-2"},gt={key:3,class:"event-content pa-2"},xt={key:0,class:"text-body-2"},bt={key:1,class:"text-body-2"},Ct={key:2,class:"text-body-2 text-medium-emphasis"},kt={class:"d-flex justify-center mt-4 mb-4"},jt={key:1,class:"text-medium-emphasis"};function Tt(e,s,u,j,o,p){const h=se,f=le,g=oe,T=ae,w=ze("router-link");return c(),b(Re,null,{default:l(()=>[t(Se,{modelValue:o.tab,"onUpdate:modelValue":s[0]||(s[0]=i=>o.tab=i)},{default:l(()=>[t(z,{value:"home"},{default:l(()=>[t(Ie,{class:"mt-8"},{default:l(()=>[t(te,{class:"d-flex align-center"},{default:l(()=>[t(ie,null,{default:l(()=>[s[2]||(s[2]=a("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),a("p",Ke,[m(n(o.user.display_name)+" ",1),t($,{size:"52",class:"ma-2"},{default:l(()=>[t(Be,{src:o.VITE_APP_S3_BUCKET+"/user/"+o.user.images},null,8,["src"])]),_:1})]),a("p",We,n(o.user.motto),1),a("p",Ze,[t(y,null,{default:l(()=>[t(C,{icon:"mdi-account-circle",start:""}),m(" #"+n(o.user.id),1)]),_:1}),t(y,null,{default:l(()=>[t(C,{icon:"mdi-clock",start:""}),t(h,{date:o.user.regTime},null,8,["date"]),s[1]||(s[1]=m(" 注册 "))]),_:1}),t(y,null,{default:l(()=>[t(C,{icon:"mdi-tag",start:""}),m(" "+n(o.user.id===1?"社区管理员":"用户"),1)]),_:1})])]),_:1})]),_:1})]),_:1}),s[4]||(s[4]=a("br",null,null,-1)),t(k,{title:"关于我",subtitle:"README.md"},{default:l(()=>[t(V,{class:"markdown-body"},{default:l(()=>[s[3]||(s[3]=a("br",null,null,-1)),t(f,null,{default:l(()=>[m(n(o.user.motto),1)]),_:1})]),_:1})]),_:1}),t(g,{url:o.url},null,8,["url"]),t(te,null,{default:l(()=>[(c(!0),x(P,null,S(o.lists,i=>(c(),b(ie,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:i.id},{default:l(()=>[t(k,{rounded:"lg"},{default:l(()=>[t(k,{to:"/app/projectlist/"+i.id,rounded:"lg",title:i.title,subtitle:i.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[5]||(s[5]=a("br",null,null,-1)),t(T,{url:"user-"+o.user.id,name:"用户"},null,8,["url"])]),_:1}),t(z,{value:"comment"},{default:l(()=>[t(T,{url:"user-"+o.user.id,name:"用户"},null,8,["url"])]),_:1}),t(z,{value:"timeline"},{default:l(()=>[t(Oe,{side:"end",align:"start",class:"mt-4"},{default:l(()=>[(c(!0),x(P,null,S(o.timeline.events,i=>(c(),b(Ae,{key:i.id,size:"small","dot-color":"primary"},{opposite:l(()=>[m(n(new Date(i.created_at).toLocaleString()),1)]),icon:l(()=>[t($,{image:o.VITE_APP_S3_BUCKET+"/user/"+o.user.images},null,8,["image"])]),default:l(()=>{var R,U,L,A,F,O,q,K,W,Z,H,G;return[a("div",He,[a("div",Ge,[a("h3",Je,n(i.actor.display_name)+" "+n(((R=o.eventTypes[i.type])==null?void 0:R.text)||"进行了操作"),1),t(y,{size:"x-small",color:((U=o.eventTypes[i.type])==null?void 0:U.color)||"primary",class:"ml-2"},{default:l(()=>{var r;return[m(n(((r=o.eventTypes[i.type])==null?void 0:r.label)||i.type),1)]}),_:2},1032,["color"])]),s[10]||(s[10]=m()),(L=o.eventTypes[i.type])!=null&&L.isProject?(c(),b(w,{key:0,to:`/app/link/project?id=${(A=i.target)==null?void 0:A.id}`,class:"text-decoration-none"},{default:l(()=>{var r;return[m(n((r=i.event_data)==null?void 0:r.project_title),1)]}),_:2},1032,["to"])):I("",!0),s[11]||(s[11]=a("div",{class:"mb-2"},null,-1)),(F=o.eventTypes[i.type])!=null&&F.isProject&&!["project_rename","project_commit"].includes(i.type)?(c(),b(k,{key:1,class:"mb-3 project-event",to:`/app/link/project?id=${(O=i.target)==null?void 0:O.id}`},{default:l(()=>[t(V,null,{default:l(()=>{var r,d;return[a("div",Qe,[t(C,{icon:"mdi-source-repository",color:"primary",class:"mr-2"}),a("span",Xe,n(((r=i.event_data)==null?void 0:r.project_name)||"未命名项目"),1),a("div",Ye,n((d=i.event_data)==null?void 0:d.project_description),1)])]}),_:2},1024)]),_:2},1032,["to"])):["project_rename","project_commit","project_info_update"].includes(i.type)?(c(),x(P,{key:2},[i.type==="project_rename"?(c(),b(k,{key:0,class:"rename-card mb-3",to:`/app/link/project?id=${(q=i.target)==null?void 0:q.id}`},{default:l(()=>[t(V,null,{default:l(()=>{var r;return[a("div",$e,[t(C,{icon:"mdi-rename-box",color:"warning",class:"mr-2"}),a("span",et,n((r=i.event_data)==null?void 0:r.project_title),1)]),a("div",tt,[a("div",it,[s[6]||(s[6]=a("span",{class:"text-medium-emphasis"},"从",-1)),t(y,{size:"small",class:"mx-2",color:"surface-variant"},{default:l(()=>{var d;return[m(n((d=i.event_data)==null?void 0:d.old_name),1)]}),_:2},1024)]),a("div",st,[s[7]||(s[7]=a("span",{class:"text-medium-emphasis"},"到",-1)),t(y,{size:"small",class:"mx-2",color:"warning"},{default:l(()=>{var d;return[m(n((d=i.event_data)==null?void 0:d.new_name),1)]}),_:2},1024)])]),a("div",lt,[t(y,{size:"x-small",class:"mr-1"},{default:l(()=>{var d;return[m(n((d=i.event_data)==null?void 0:d.project_type),1)]}),_:2},1024),t(y,{size:"x-small"},{default:l(()=>{var d;return[m(n((d=i.event_data)==null?void 0:d.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):i.type==="project_commit"?(c(),b(k,{key:1,class:"commit-card mb-3",to:`/app/link/project?id=${(K=i.target)==null?void 0:K.id}`},{default:l(()=>[t(V,null,{default:l(()=>{var r,d,_;return[a("div",at,[t(C,{icon:"mdi-source-commit",color:"info",class:"mr-2"}),a("span",ot,"分支: "+n((r=i.event_data)==null?void 0:r.branch),1)]),a("div",nt,n((d=i.event_data)==null?void 0:d.commit_message),1),a("div",rt," 提交ID: "+n((_=i.event_data)==null?void 0:_.commit_id.substring(0,7)),1)]}),_:2},1024)]),_:2},1032,["to"])):i.type==="project_info_update"?(c(),b(k,{key:2,class:"info-update-card mb-3",to:`/app/link/project?id=${(W=i.target)==null?void 0:W.id}`},{default:l(()=>[t(V,null,{default:l(()=>{var r,d;return[a("div",dt,[t(C,{icon:"mdi-file-document-edit",color:"info",class:"mr-2"}),a("span",ct,n((r=i.event_data)==null?void 0:r.project_title),1)]),a("div",mt,[(c(!0),x(P,null,S((d=i.event_data)==null?void 0:d.updated_fields,_=>{var J,Q;return c(),x("div",{key:_,class:"update-item mb-2"},[a("div",ut,[t(y,{size:"x-small",color:"info",class:"mr-2"},{default:l(()=>[m(n(p.getFieldDisplayName(_)),1)]),_:2},1024)]),a("div",_t,[a("div",pt,[s[8]||(s[8]=a("span",{class:"text-medium-emphasis"},"从：",-1)),a("span",ft,n((J=i.event_data)==null?void 0:J.old_values[_]),1)]),a("div",ht,[s[9]||(s[9]=a("span",{class:"text-medium-emphasis"},"到：",-1)),a("span",yt,n((Q=i.event_data)==null?void 0:Q.new_values[_]),1)])])])}),128))]),a("div",vt,[t(y,{size:"x-small",class:"mr-1"},{default:l(()=>{var _;return[m(n((_=i.event_data)==null?void 0:_.project_type),1)]}),_:2},1024),t(y,{size:"x-small"},{default:l(()=>{var _;return[m(n((_=i.event_data)==null?void 0:_.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):I("",!0)],64)):(c(),x("div",gt,[i.type==="user_profile_update"?(c(),x("div",xt," 更新了："+n(p.getUpdatedFields((Z=i.event_data)==null?void 0:Z.updated_fields)),1)):((H=i.target)==null?void 0:H.type)==="project"?(c(),x("div",bt,[a("span",null,n(((G=o.eventTypes[i.type])==null?void 0:G.text)||"操作了"),1),t(w,{to:`/app/link/project?id=${i.target.id}`,class:"text-decoration-none ml-1"},{default:l(()=>{var r;return[m(n(((r=i.event_data)==null?void 0:r.project_name)||i.target.title||`项目 #${i.target.id}`),1)]}),_:2},1032,["to"])])):(c(),x("div",Ct,n(p.getTargetContent(i.target,i.type)),1))]))])]}),_:2},1024))),128))]),_:1}),a("div",kt,[p.hasMoreEvents?(c(),b(Ee,{key:0,loading:o.isLoadingMore,variant:"tonal",onClick:p.loadMoreEvents},{default:l(()=>s[12]||(s[12]=[m(" 加载更多 ")])),_:1},8,["loading","onClick"])):o.timeline.events.length>0?(c(),x("div",jt," 没有更多内容了 ")):I("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ot=De(qe,[["render",Tt],["__scopeId","data-v-f093ac04"]]);export{Ot as default};
