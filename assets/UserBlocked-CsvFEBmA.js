import{_ as B,X as p,ag as x,ac as U,a as u,o as r,T as c,h as l,N as s,Z as w,M as m,F as g,Q as C,W as b,as as v,at as I,K as n,S as d,au as S,j as k,U as T,q as M,Y as N,R as A}from"./index-BZTz8w1z.js";import{a as y,V}from"./VRow-BBentoK4.js";import{V as E}from"./VSnackbar-3A9pU9fK.js";const P={name:"UserBlocked",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1}},data(){return{blockedUsers:[],loading:!0,loadingMore:!1,unblockingId:null,totalBlockedUsers:0,localuser:x,VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com",snackbar:{show:!1,text:"",color:"success"}}},computed:{hasMoreBlockedUsers(){return this.blockedUsers.length<this.totalBlockedUsers&&this.showAll}},watch:{userId:{immediate:!0,handler(o,e){o&&o!==e&&this.fetchBlockedUsers()}}},methods:{async fetchBlockedUsers(o=!1){if(this.userId)try{o?this.loadingMore=!0:this.loading=!0;const e=o?this.blockedUsers.length:0,i=this.showAll?this.limit:Math.min(this.limit,5),f=await p.get("/follows/blocked",{params:{limit:i,offset:e}});if(f.data.success){const t=f.data.data;o?this.blockedUsers=[...this.blockedUsers,...t.blocked]:this.blockedUsers=t.blocked,this.totalBlockedUsers=t.total}}catch(e){console.error("获取拉黑用户失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async unblockUser(o,e){try{this.unblockingId=o,await p.delete(`/follows/block/${o}`),this.blockedUsers=this.blockedUsers.filter(i=>i.user.id!==o),this.totalBlockedUsers--,this.showSnackbar(`已取消拉黑 ${e}`,"success")}catch(i){console.error("取消拉黑失败:",i),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.unblockingId=null}},async loadMoreBlockedUsers(){await this.fetchBlockedUsers(!0)},showSnackbar(o,e="success"){this.snackbar={show:!0,text:o,color:e}}}},z={class:"user-blocked"},K={class:"text-caption text-medium-emphasis"},j={class:"d-flex justify-center mt-4 mb-4"},q={key:1,class:"text-medium-emphasis"};function F(o,e,i,f,t,h){const _=U("router-link");return r(),u("div",z,[t.loading?(r(),c(V,{key:0},{default:s(()=>[l(y,{cols:"12",class:"text-center"},{default:s(()=>[l(w,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):t.blockedUsers.length===0?(r(),c(V,{key:1},{default:s(()=>[l(y,{cols:"12",class:"text-center"},{default:s(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无拉黑用户",-1)])),_:1})]),_:1})):(r(),u(g,{key:2},[(r(!0),u(g,null,C(t.blockedUsers,a=>(r(),c(A,{key:a.id,class:"mb-3",hover:""},{default:s(()=>[l(v,null,{prepend:s(()=>[l(_,{to:`/${a.user.username}`},{default:s(()=>[l(T,{size:"50"},{default:s(()=>[l(M,{src:t.VITE_APP_S3_BUCKET+"/user/"+a.user.images,alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:s(()=>[l(k,{variant:"outlined",color:"error",size:"small",loading:t.unblockingId===a.user.id,onClick:R=>h.unblockUser(a.user.id,a.user.display_name)},{default:s(()=>e[3]||(e[3]=[n(" 取消拉黑 ")])),_:2},1032,["loading","onClick"])]),default:s(()=>[l(I,null,{default:s(()=>[l(_,{to:`/${a.user.username}`,class:"text-decoration-none"},{default:s(()=>[n(d(a.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),l(S,{class:"text-truncate"},{default:s(()=>[n(d(a.metadata.reason)+" - "+d(a.created_at),1)]),_:2},1024)]),_:2},1024),a.reason?(r(),c(N,{key:0,class:"pt-0"},{default:s(()=>[m("p",K,[e[4]||(e[4]=m("strong",null,"拉黑原因:",-1)),n(" "+d(a.reason),1)])]),_:2},1024)):b("",!0)]),_:2},1024))),128)),m("div",j,[h.hasMoreBlockedUsers?(r(),c(k,{key:0,loading:t.loadingMore,variant:"tonal",onClick:h.loadMoreBlockedUsers},{default:s(()=>e[5]||(e[5]=[n(" 加载更多 ")])),_:1},8,["loading","onClick"])):t.blockedUsers.length>0?(r(),u("div",q," 没有更多内容了 ")):b("",!0)])],64)),l(E,{modelValue:t.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=a=>t.snackbar.show=a),color:t.snackbar.color,timeout:3e3},{actions:s(()=>[l(k,{variant:"text",onClick:e[0]||(e[0]=a=>t.snackbar.show=!1)},{default:s(()=>e[6]||(e[6]=[n(" 关闭 ")])),_:1})]),default:s(()=>[n(d(t.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const W=B(P,[["render",F],["__scopeId","data-v-0cea5f79"]]);export{W as _};
