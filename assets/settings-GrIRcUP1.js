import{_ as P,a as S}from"./LanguageSelector-tnkls29Z.js";import{_ as L,ah as q,o as c,Y as f,N as r,e as t,R as B,S as n,f as a,aG as V,i as u,a5 as M,T as E,m as R,U as m,C as s,aJ as b,O as y,n as O,a0 as g,Z as h,ai as Z,aj as k,a1 as A,a2 as X,a3 as z,a4 as G,aF as T,af as w,a9 as D,W as H,a6 as d,ag as j,ap as J,a7 as W,aZ as Y}from"./index-C30_-gqw.js";import{V as K}from"./VTextarea-DN100mDs.js";import{V as Q}from"./VCombobox-BXkfOC2w.js";import{V as _}from"./VFileInput-dl40yv0S.js";import"./licenses-DSftVfqA.js";import"./programming_languages-Aq2ViMcP.js";import"./special_languages-1P7AwNtB.js";import"https://static.geetest.com/v4/gt4.js";import"./filter-CsjMEVhL.js";const $={components:{LicenseSelector:S,LanguageSelector:P},data(){return{localuser:j,states:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],projectID:this.$route.params.id,project:{},newProjectName:"",tags:{items:["动画","故事","音乐","硬核","艺术","水"],chips:[]},changeVisibility:!1,changeVisibilityText:"",confirmDelete:!1,confirmDeleteText:"",thumbnail:null}},async created(){j.isLogin.value||this.$router.push("/app/account/login"),await this.fetchProject()},setup(){return W({title:"项目设置"}),{sudoManager:Y()}},methods:{removeTag(o){this.tags.chips.splice(this.tags.chips.indexOf(o),1)},async fetchProject(){try{const{username:o,projectname:e}=this.$route.params;this.project=await J(o,e),this.projectID=this.project.id,this.newProjectName=this.project.name,this.tags.chips=this.project.tags.map(v=>v.name)}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"无法获取项目数据",life:3e3})}},async deleteProject(){try{const o=await this.sudoManager.requireSudo({title:"删除项目",subtitle:`您正在尝试删除项目 ${this.project.name}。此操作不可逆，请输入密码以确认。`,persistent:!0});await d.delete(`/project/${this.projectID}`,{headers:{"X-Sudo-Token":o}}),this.$toast.add({severity:"info",summary:"成功",detail:"项目已删除",life:3e3}),this.$router.push("/app/explore")}catch(o){console.error(o),o.type!=="cancel"&&this.$toast.add({severity:"error",summary:"错误",detail:"删除项目失败",life:3e3})}},async saveProject(){this.project.tags=this.tags.chips.map(o=>o);try{const o=(await d.put(`/project/id/${this.projectID}`,{id:this.project.id,title:this.project.title,description:this.project.description,type:this.project.type,tags:this.project.tags,license:this.project.license})).data;this.$toast.add({severity:o.status,summary:o.message,detail:o.message,life:3e3})}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"保存项目失败",life:3e3})}},async renameProject(){try{const o=(await d.put(`/project/rename/${this.projectID}`,{newName:this.newProjectName})).data;this.$toast.add({severity:o.status,summary:o.message,detail:o.message,life:3e3})}catch(o){console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"修改项目名称失败",life:3e3})}},async changeProjectVisibility(){try{const o=await this.sudoManager.requireSudo({title:"更改项目可见性",subtitle:`您正在将项目"${this.project.name}"的可见性从${this.project.state==="public"?"公开":"私密"}更改为${this.project.state==="public"?"私密":"公开"}。此操作需要验证您的身份。`,persistent:!0}),e=(await d.put(`/project/changevisibility/${this.projectID}`,{newState:this.project.state==="public"?"private":"public"},{headers:{"X-Sudo-Token":o}})).data;this.$toast.add({severity:e.status,summary:e.message,detail:e.message,life:3e3}),this.$router.push(`/explore/${j.user.value.username}/${this.project.name}`)}catch(o){o.type!=="cancelled"&&(console.error(o),this.$toast.add({severity:"error",summary:"错误",detail:"修改项目状态失败",life:3e3}))}},cancel(){this.$router.push("/explore/my")},onFileChange(o){const e=o.target.files[0];e&&(this.thumbnail=URL.createObjectURL(e))},async uploadThumbnail(){const o=new FormData;o.append("file",this.$refs.fileInput.$el.querySelector("input").files[0]);try{await d.post(`/scratch/thumbnail/${this.projectID}`,o,{headers:{Authorization:`Bearer ${j.token}`,"Content-Type":"multipart/form-data"}}),this.$toast.add({severity:"success",summary:"成功",detail:"封面上传成功",life:3e3})}catch(e){console.error(e),this.$toast.add({severity:"error",summary:"错误",detail:"封面上传失败",life:3e3})}}}};function ee(o,e,v,te,l,p){const I=P,U=S,x=q("v-if");return c(),f(H,null,{default:r(()=>[t(B,null,{default:r(()=>[t(n,{cols:"12"},{default:r(()=>[...e[14]||(e[14]=[a("h1",null,"常规",-1)])]),_:1}),t(n,{cols:"7"},{default:r(()=>[t(V,{modelValue:l.newProjectName,"onUpdate:modelValue":e[0]||(e[0]=i=>l.newProjectName=i),hint:"修改项目名称",label:"项目名称",required:"",variant:"outlined"},{append:r(()=>[t(u,{color:"primary",text:"修改名称",variant:"tonal",onClick:p.renameProject},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1}),t(n,{cols:"12"},{default:r(()=>[t(M)]),_:1}),t(n,{cols:"7"},{default:r(()=>[t(V,{modelValue:l.project.title,"onUpdate:modelValue":e[1]||(e[1]=i=>l.project.title=i),hint:"可读性更好的标题",label:"项目标题",required:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12"},{default:r(()=>[t(K,{modelValue:l.project.description,"onUpdate:modelValue":e[2]||(e[2]=i=>l.project.description=i),hint:"介绍作品类型，玩法，并向对这个作品有帮助的人致谢！",label:"简介",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",sm:"6"},{default:r(()=>[t(I,{modelValue:l.project.type,"onUpdate:modelValue":e[3]||(e[3]=i=>l.project.type=i),hint:"不建议你改",label:"类型",required:""},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",sm:"6"},{default:r(()=>[t(U,{modelValue:l.project.license,"onUpdate:modelValue":e[4]||(e[4]=i=>l.project.license=i)},null,8,["modelValue"])]),_:1}),t(n,{cols:"12"},{default:r(()=>[t(Q,{modelValue:l.tags.chips,"onUpdate:modelValue":e[5]||(e[5]=i=>l.tags.chips=i),items:l.tags.items,chips:"",label:"标签",multiple:"","prepend-icon":"mdi-tag",variant:"outlined"},{selection:r(({attrs:i,item:C,select:N,selected:F})=>[t(E,R({"model-value":F,closable:""},i,{onClick:N,"onClick:close":le=>p.removeTag(C)}),{default:r(()=>[a("strong",null,m(C.name),1),e[15]||(e[15]=s("  ",-1)),e[16]||(e[16]=a("span",null,"(interest)",-1))]),_:2},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue","items"])]),_:1}),t(n,{cols:"12"},{default:r(()=>[t(b,null,{default:r(()=>[t(y),t(u,{text:"取消",variant:"plain",onClick:p.cancel},null,8,["onClick"]),t(u,{color:"primary",text:"保存",variant:"tonal",onClick:p.saveProject},null,8,["onClick"])]),_:1})]),_:1}),t(n,{cols:"12"},{default:r(()=>[...e[17]||(e[17]=[a("h1",null,"图片",-1)])]),_:1}),t(n,{cols:"12"},{default:r(()=>[t(_,{ref:"fileInput",accept:"image/*",label:"上传封面","prepend-icon":"mdi-image",variant:"outlined",onChange:p.onFileChange},null,8,["onChange"]),l.thumbnail?(c(),f(O,{key:0,src:l.thumbnail,"max-width":"200"},null,8,["src"])):g("",!0),t(u,{disabled:!l.thumbnail,color:"primary",text:"上传封面",variant:"tonal",onClick:p.uploadThumbnail},null,8,["disabled","onClick"])]),_:1}),t(n,{cols:"12"},{default:r(()=>[...e[18]||(e[18]=[a("h1",null,"危险",-1)])]),_:1}),t(n,{cols:"12"},{default:r(()=>[t(h,null,{default:r(()=>[t(Z,null,{default:r(()=>[t(k,{subtitle:"删除此项目后无法恢复。",title:"删除此项目"},{append:r(()=>[t(u,{color:"error",text:"删除此项目",variant:"tonal",onClick:e[6]||(e[6]=i=>l.confirmDelete=!0)})]),_:1}),t(k,{subtitle:"选择项目的可见性，公开或私密。",title:"更改项目可见性"},{append:r(()=>[t(u,{color:"error",text:"更改项目可见性",variant:"tonal",onClick:e[7]||(e[7]=i=>l.changeVisibility=!0)})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(A,null,{default:r(()=>[t(X,null,{default:r(()=>[t(z,null,{default:r(()=>[...e[19]||(e[19]=[s("详细数据",-1)])]),_:1}),t(G,null,{default:r(()=>[s(m(l.project),1)]),_:1})]),_:1})]),_:1}),t(T,{modelValue:l.confirmDelete,"onUpdate:modelValue":e[10]||(e[10]=i=>l.confirmDelete=i),"max-width":"500px"},{default:r(()=>[t(h,null,{default:r(()=>[t(w,{class:"headline"},{default:r(()=>[s("删除 "+m(l.project.title),1)]),_:1}),t(D,null,{default:r(()=>[e[20]||(e[20]=s("你确定要删除这个项目吗？此操作无法撤销。",-1)),e[21]||(e[21]=a("br",null,null,-1)),s("这将永久删除 "+m(l.project.title)+" 项目、推送、Star、评论、和其他所有数据，移除Fork对此项目的关联（但不会删除Fork）。",1),e[22]||(e[22]=a("br",null,null,-1)),e[23]||(e[23]=s("要确认，请在下面的框中输入提示的小字以确认您的操作。 ",-1)),e[24]||(e[24]=a("br",null,null,-1)),e[25]||(e[25]=a("br",null,null,-1)),t(V,{modelValue:l.confirmDeleteText,"onUpdate:modelValue":e[8]||(e[8]=i=>l.confirmDeleteText=i),label:`${l.localuser.user.username}/${l.project.name}`,variant:"outlined"},null,8,["modelValue","label"])]),_:1}),t(b,null,{default:r(()=>[t(y),t(u,{color:"primary",text:"",onClick:e[9]||(e[9]=i=>{l.confirmDelete=!1,l.confirmDeleteText=""})},{default:r(()=>[...e[26]||(e[26]=[s("取消 ",-1)])]),_:1}),t(u,{disabled:l.confirmDeleteText!==`${l.localuser.user.username}/${l.project.name}`,color:"error",text:"",onClick:p.deleteProject},{default:r(()=>[...e[27]||(e[27]=[s("删除 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:l.changeVisibility,"onUpdate:modelValue":e[13]||(e[13]=i=>l.changeVisibility=i),"max-width":"500px"},{default:r(()=>[t(h,null,{default:r(()=>[t(w,{class:"headline"},{default:r(()=>[s(m(l.project.state==="public"?"私密":"公开")+" "+m(l.project.title),1)]),_:1}),t(D,null,{default:r(()=>[l.project.state==="public"?(c(),f(x,{key:0},{default:r(()=>[...e[28]||(e[28]=[s(" 将此仓库设为私有将删除不再有权访问此仓库的用户的 star。如果您决定在将来公开此存储库，则无法恢复这些 star ，这将影响项目的排名。",-1),a("br",null,null,-1),s(" 此项目的Fork将保持公开，且不再与此项目有任何关联。 ",-1)])]),_:1})):g("",!0),l.project.state==="private"?(c(),f(x,{key:1},{default:r(()=>[...e[29]||(e[29]=[s(" 该项目将对可以访问ZeroCat的每个人都可见",-1),a("br",null,null,-1),s(" 任何人都可以复制或下载您的仓库。",-1),a("br",null,null,-1),s(" 您的操作历史记录和日志将对所有人可见。 ",-1)])]),_:1})):g("",!0),e[30]||(e[30]=a("br",null,null,-1)),e[31]||(e[31]=a("br",null,null,-1)),e[32]||(e[32]=s(" 要确认，请在下面的框中输入提示的小字以确认您的操作。 ",-1)),e[33]||(e[33]=a("br",null,null,-1)),e[34]||(e[34]=a("br",null,null,-1)),t(V,{modelValue:l.changeVisibilityText,"onUpdate:modelValue":e[11]||(e[11]=i=>l.changeVisibilityText=i),label:`${l.localuser.user.username}/${l.project.name}`,variant:"outlined"},null,8,["modelValue","label"])]),_:1}),t(b,null,{default:r(()=>[t(y),t(u,{color:"primary",text:"",onClick:e[12]||(e[12]=i=>l.changeVisibility=!1)},{default:r(()=>[...e[35]||(e[35]=[s("取消 ",-1)])]),_:1}),t(u,{disabled:l.changeVisibilityText!==`${l.localuser.user.username}/${l.project.name}`,color:"error",text:"",onClick:p.changeProjectVisibility},{default:r(()=>[s(m(l.project.state==="public"?"设置为私密":"设置为公开"),1)]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ce=L($,[["render",ee]]);export{ce as default};
