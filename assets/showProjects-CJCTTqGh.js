import{l as b,b as _}from"./project-DFeCVYie.js";import{l as y,b as S}from"./user-RyxYguxU.js";import{_ as g}from"./43-lazyload-CBkwrR6M.js";import{_ as v,o,c as n,w as e,e as c,T as d,U as p,a,R as f,Q,ah as V,af as C,O as h,W as l,ag as w,a3 as I,N as k,a1 as x}from"./index-D4SP7Gxj.js";import{a as A,V as F}from"./VRow-B0DghjNL.js";const j={props:{projectIds:{type:Array,required:!0},actions:{type:Array}},data(){return{projects:[],authorids:[],authors:{},liveQuerySubscription:null,authorQuerySubscription:null}},watch:{projectIds:{handler(){this.startLiveFetch(),this.refreshData()},immediate:!0,deep:!0}},methods:{startLiveFetch(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.liveQuerySubscription=b(this.projectIds,r=>{const s=new Map(r.map(t=>[t.id,t]));this.projects=this.projectIds.map(t=>s.get(t)).filter(Boolean),this.updateAuthorIds()})},updateAuthorIds(){const r=[...new Set(this.projects.map(s=>s.authorid))];JSON.stringify(r)!==JSON.stringify(this.authorids)&&(this.authorids=r,this.startAuthorLiveFetch())},startAuthorLiveFetch(){this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe(),this.authorQuerySubscription=y(this.authorids,r=>{const s={};r.forEach(t=>{s[t.id]=t}),this.authors=s})},async refreshData(){await _(this.projectIds),await S(this.authorids)}},beforeDestroy(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe()}};function D(r,s,t,N,m,B){return o(),n(F,null,{default:e(()=>[(o(!0),c(d,null,p(m.projects,i=>(o(),n(A,{key:i.id,cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2"},{default:e(()=>[a(f,{rounded:"lg",border:""},{default:e(()=>[a(f,{to:"/projects/"+i.id,style:{"aspect-ratio":"4/3"},rounded:"lg"},{default:e(()=>[a(Q,{src:"https://s4-1.wuyuan.1r.ink/scratch_slt/"+i.id,class:"align-end","lazy-src":g,height:"100%",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",cover:""},{default:e(()=>[a(V,null,{default:e(()=>[a(C,null,{default:e(()=>[h(l(i.title||"未缓存"),1)]),_:2},1024),a(w,null,{default:e(()=>[h(l(i.description||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["to"]),t.actions?(o(),n(I,{key:0},{default:e(()=>[(o(!0),c(d,null,p(t.actions,u=>(o(),c("div",{key:u.name},[a(k,{onClick:L=>u.function(i.id,i)},{default:e(()=>[h(l(u.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)):x("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})}const M=v(j,[["render",D]]);export{M as _};
