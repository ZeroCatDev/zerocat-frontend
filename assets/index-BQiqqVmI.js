import{_ as A,af as L,Z as x,o as a,N as t,e as s,a0 as f,X as b,n as T,bU as N,aY as S,T as w,L as o,ae as k,Y as u,a_ as z,aI as j,i as _,a8 as E,R as h,S as g,aF as Q,P as y,f as n,c as p,F as D,W as P,bA as M,aE as B,$ as H,O,a9 as q,U as R,a6 as Y,b9 as Z,M as W}from"./index-BhZBrlGg.js";import{V as U}from"./VSelect-CWcWmsqs.js";import{V as X}from"./VSkeletonLoader-DokIKOlU.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-jKGzOvSv.js";import"./VSelectionControl-Cdx4dl39.js";const G={name:"ExtensionCard",props:{extension:{type:Object,required:!0},s3BucketUrl:{type:String,required:!0}},data(){return{localuser:L}},computed:{extensionTags(){var r;return(r=this.extension.project)!=null&&r.tags?Array.isArray(this.extension.project.tags)?this.extension.project.tags:[]:[]}},emits:["view-extension","open-docs"]};function J(r,e,c,V,l,d){return a(),x(b,{class:"box-shadow",rounded:"lg"},{default:t(()=>[s(b,{to:"/app/extensions/"+c.extension.id,rounded:"lg",style:{"aspect-ratio":"4/3"}},{default:t(()=>[s(T,{src:c.extension.image?c.s3BucketUrl+"/material/asset/"+c.extension.image+".png":"",class:"align-end",cover:"",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",height:"100%","lazy-src":N},{default:t(()=>[s(S,null,{default:t(()=>[s(w,{size:"small",color:"primary",variant:"tonal"},{default:t(()=>e[0]||(e[0]=[o(" 扩展 ",-1)])),_:1,__:[0]}),s(k,null,{default:t(()=>{var v;return[o(u(((v=c.extension)==null?void 0:v.name)||"加载中..."),1)]}),_:1}),s(z,null,{default:t(()=>{var v;return[o(u(((v=c.extension)==null?void 0:v.description)||""),1)]}),_:1})]),_:1})]),_:1},8,["src"])]),_:1},8,["to"]),c.extension.author?(a(),x(S,{key:0,"append-avatar":c.extension.author.avatar?l.localuser.getUserAvatar(c.extension.author.avatar):""},{default:t(()=>[s(k,null,{default:t(()=>[o(u(c.extension.author.display_name||c.extension.author.username||"未知用户"),1)]),_:1}),s(z,null,{default:t(()=>[o(u(c.extension.author.username||""),1)]),_:1})]),_:1},8,["append-avatar"])):f("",!0)]),_:1})}const I=A(G,[["render",J],["__scopeId","data-v-43ebc843"]]),K={name:"ExtensionsMarket",components:{ExtensionCard:I},setup(){W({title:"扩展市场 - ZeroCat"})},data(){return{loading:!1,extensions:[],currentPage:1,totalPages:1,totalCount:0,limit:20,searchQuery:"",sortBy:"created_at",sortOrder:"desc",activeFilters:{search:"",sort:"created_at",order:"desc",scratchCompatible:null},s3BucketUrl:"",showDetailDialog:!1,selectedExtension:null,showDocsDialog:!1,docsLoading:!1,docsContent:"",sortOptions:[{title:"最新发布",value:"created_at"},{title:"最近更新",value:"updated_at"},{title:"星标数",value:"stars"},{title:"查看数",value:"views"},{title:"点赞数",value:"likes"},{title:"综合排序",value:"popularity"},{title:"名称排序",value:"name"},{title:"作者排序",value:"author"}],orderOptions:[{title:"降序",value:"desc"},{title:"升序",value:"asc"}],searchTimeout:null,scratchCompatibleFilter:null,scratchCompatibleOptions:[{title:"所有",value:null},{title:"兼容原版Scratch",value:!0},{title:"不兼容原版Scratch",value:!1}]}},computed:{hasActiveFilters(){return Object.values(this.activeFilters).some(r=>r!==""&&r!==null&&r!==void 0)},selectedExtensionTags(){var r,e;return(e=(r=this.selectedExtension)==null?void 0:r.project)!=null&&e.tags?Array.isArray(this.selectedExtension.project.tags)?this.selectedExtension.project.tags:[]:[]}},async created(){this.s3BucketUrl=Z("s3.staticurl"),await this.fetchExtensions()},methods:{async fetchExtensions(){var r,e,c,V;this.loading=!0;try{const l={page:this.currentPage,limit:this.limit,...this.activeFilters},d=await Y.get("/extensions/marketplace",{params:l});(r=d.data)!=null&&r.data&&(this.extensions=d.data.data.extensions||[],this.totalCount=((e=d.data.data.pagination)==null?void 0:e.total)||0,this.totalPages=((c=d.data.data.pagination)==null?void 0:c.total_pages)||1,this.currentPage=((V=d.data.data.pagination)==null?void 0:V.page)||1)}catch(l){console.error("Failed to fetch extensions:",l),this.extensions=[],this.totalCount=0,this.totalPages=1}finally{this.loading=!1}},handleSearch(){this.activeFilters.search=this.searchQuery,this.currentPage=1,this.fetchExtensions()},handleFilterChange(){this.activeFilters.scratchCompatible=this.scratchCompatibleFilter,this.currentPage=1,this.fetchExtensions()},handleSortChange(){this.activeFilters.sort=this.sortBy,this.activeFilters.order=this.sortOrder,this.currentPage=1,this.fetchExtensions()},resetFilters(){this.searchQuery="",this.scratchCompatibleFilter=null,this.sortBy="created_at",this.sortOrder="desc",this.activeFilters={search:"",sort:"created_at",order:"desc",scratchCompatible:null},this.currentPage=1,this.fetchExtensions()},handlePageChange(r){this.currentPage=r,this.fetchExtensions()},resetAllFilters(){this.activeFilters={search:"",sort:"created_at",order:"desc",scratchCompatible:null},this.currentPage=1,this.fetchExtensions()},viewExtension(r){this.selectedExtension=r,this.showDetailDialog=!0},async openDocs(r){this.showDocsDialog=!0,this.docsLoading=!0,this.docsContent="";try{await new Promise(e=>setTimeout(e,1e3)),this.docsContent=`
          <div class="docs-content">
            <h2>${r.name} 扩展文档</h2>
            <p>这里是 <strong>${r.name}</strong> 扩展的使用文档。</p>
            <p><strong>文档路径:</strong> ${r.docs_url||"暂无"}</p>
            <p>要查看完整文档，请访问扩展的项目页面。</p>

            <h3>使用说明</h3>
            <p>1. 下载扩展文件</p>
            <p>2. 将扩展文件放入项目的扩展目录</p>
            <p>3. 在项目中使用扩展功能</p>

            <h3>示例代码</h3>
            <pre><code>// 示例代码将在这里显示
// 请访问项目页面查看完整示例</code></pre>
          </div>
        `}catch(e){console.error("Failed to load docs:",e),this.docsContent=""}finally{this.docsLoading=!1}}}},$={class:"d-flex align-center"},ee={class:"text-body-2"},te={key:0,class:"ml-2"},se={class:"text-body-1 text-grey mt-2"},le={class:"mt-2 text-caption text-grey-darken-1"},ne={key:0},oe={class:"flex-grow-1"},ie={class:"text-h5 font-weight-bold"},ae={class:"text-subtitle-1 text-grey-darken-1"},re={class:"text-body-1 mb-4"},de={class:"text-center"},ue={class:"text-h6 font-weight-bold text-amber"},ce={class:"text-center"},me={class:"text-h6 font-weight-bold text-green"},xe={class:"text-center"},ge={class:"text-h6 font-weight-bold text-red"},pe={key:0,class:"mb-4"},fe={class:"mb-4"},he={class:"text-caption text-grey mt-1"},_e={key:1,class:"mb-4"},ye={class:"d-flex justify-center gap-4"},ve={key:0,class:"text-center py-8"},be=["innerHTML"],Ce={key:2,class:"text-center py-8 text-grey"};function ke(r,e,c,V,l,d){const v=I;return a(),x(R,null,{default:t(()=>[s(b,{class:"mb-4",border:""},{default:t(()=>[s(S,{"prepend-icon":"mdi-puzzle"},{default:t(()=>[s(k,null,{default:t(()=>e[11]||(e[11]=[o(" 扩展市场 ",-1)])),_:1,__:[11]}),s(z,null,{default:t(()=>e[12]||(e[12]=[o(" 发现和使用社区开发的扩展来增强您的项目功能 ",-1)])),_:1,__:[12]})]),_:1}),s(j,null,{default:t(()=>[s(_,{to:"/app/extensions/my"},{default:t(()=>e[13]||(e[13]=[o(" 我的扩展 ",-1)])),_:1,__:[13]})]),_:1})]),_:1}),s(b,{variant:"flat",class:"mb-4",border:""},{default:t(()=>[s(E,null,{default:t(()=>[s(h,null,{default:t(()=>[s(g,{cols:"12",md:"4"},{default:t(()=>[s(Q,{modelValue:l.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=i=>l.searchQuery=i),label:"搜索扩展","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"",density:"compact",onInput:d.handleSearch,onClear:d.handleSearch},null,8,["modelValue","onInput","onClear"])]),_:1}),s(g,{cols:"12",md:"2"},{default:t(()=>[s(U,{modelValue:l.scratchCompatibleFilter,"onUpdate:modelValue":[e[1]||(e[1]=i=>l.scratchCompatibleFilter=i),d.handleFilterChange],items:l.scratchCompatibleOptions,label:"Scratch兼容性",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:t(()=>[s(U,{modelValue:l.sortBy,"onUpdate:modelValue":[e[2]||(e[2]=i=>l.sortBy=i),d.handleSortChange],items:l.sortOptions,label:"排序方式",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:t(()=>[s(U,{modelValue:l.sortOrder,"onUpdate:modelValue":[e[3]||(e[3]=i=>l.sortOrder=i),d.handleSortChange],items:l.orderOptions,label:"排序方向",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1}),s(h,null,{default:t(()=>[s(g,{cols:"12",class:"text-center"},{default:t(()=>[s(_,{variant:"outlined",color:"grey",size:"small",onClick:d.resetFilters,class:"mr-2"},{default:t(()=>[s(y,{start:""},{default:t(()=>e[14]||(e[14]=[o("mdi-refresh",-1)])),_:1,__:[14]}),e[15]||(e[15]=o(" 重置筛选 ",-1))]),_:1,__:[15]},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),!l.loading&&l.extensions.length>0?(a(),x(h,{key:0},{default:t(()=>[s(g,{cols:"12"},{default:t(()=>[s(b,{variant:"flat",class:"mb-4",border:""},{default:t(()=>[s(E,{class:"d-flex align-center justify-space-between"},{default:t(()=>[n("div",$,[s(y,{class:"mr-2",color:"primary"},{default:t(()=>e[16]||(e[16]=[o("mdi-information",-1)])),_:1,__:[16]}),n("span",ee,[e[17]||(e[17]=o(" 共找到 ",-1)),n("strong",null,u(l.totalCount),1),e[18]||(e[18]=o(" 个扩展 ",-1)),l.activeFilters.search?(a(),p("span",te,' (搜索: "'+u(l.activeFilters.search)+'") ',1)):f("",!0)])])]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0),s(h,null,{default:t(()=>[s(g,{cols:"12"},{default:t(()=>[l.loading?(a(),x(h,{key:0},{default:t(()=>[(a(),p(D,null,P(12,i=>s(g,{key:i,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[s(X,{type:"card",class:"extension-skeleton"})]),_:2},1024)),64))]),_:1})):l.extensions.length===0?(a(),x(h,{key:1},{default:t(()=>[s(g,{cols:"12",class:"text-center py-16"},{default:t(()=>[s(y,{size:"80",color:"grey-lighten-1"},{default:t(()=>e[19]||(e[19]=[o("mdi-puzzle-outline",-1)])),_:1,__:[19]}),e[21]||(e[21]=n("h2",{class:"text-h5 mt-4 text-grey-darken-1"},"暂无扩展",-1)),n("p",se,u(d.hasActiveFilters?"没有找到匹配的扩展":"扩展市场暂时为空"),1),d.hasActiveFilters?(a(),x(_,{key:0,variant:"outlined",color:"primary",class:"mt-4",onClick:d.resetAllFilters},{default:t(()=>e[20]||(e[20]=[o(" 清除所有筛选条件 ",-1)])),_:1,__:[20]},8,["onClick"])):f("",!0)]),_:1,__:[21]})]),_:1})):(a(),x(h,{key:2},{default:t(()=>[(a(!0),p(D,null,P(l.extensions,i=>(a(),x(g,{key:i.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[s(v,{extension:i,"s3-bucket-url":l.s3BucketUrl,onViewExtension:d.viewExtension,onOpenDocs:d.openDocs},null,8,["extension","s3-bucket-url","onViewExtension","onOpenDocs"])]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),!l.loading&&l.extensions.length>0?(a(),x(h,{key:1},{default:t(()=>[s(g,{cols:"12",class:"text-center"},{default:t(()=>[s(M,{modelValue:l.currentPage,"onUpdate:modelValue":[e[4]||(e[4]=i=>l.currentPage=i),d.handlePageChange],length:l.totalPages,"total-visible":7},null,8,["modelValue","length","onUpdate:modelValue"]),n("div",le,[o(" 第 "+u(l.currentPage)+" 页，共 "+u(l.totalPages)+" 页 ",1),l.totalCount>0?(a(),p("span",ne," (每页 "+u(l.limit)+" 条，共 "+u(l.totalCount)+" 条) ",1)):f("",!0)])]),_:1})]),_:1})):f("",!0),s(B,{modelValue:l.showDetailDialog,"onUpdate:modelValue":e[7]||(e[7]=i=>l.showDetailDialog=i),"max-width":"900",persistent:""},{default:t(()=>[l.selectedExtension?(a(),x(b,{key:0},{default:t(()=>[s(k,{class:"d-flex align-center"},{default:t(()=>{var i,C;return[s(H,{class:"mr-3",size:"56"},{default:t(()=>[l.selectedExtension.image?(a(),x(T,{key:0,src:l.s3BucketUrl+"/extension/"+l.selectedExtension.image},null,8,["src"])):(a(),x(y,{key:1,size:"28",color:"primary"},{default:t(()=>e[22]||(e[22]=[o("mdi-puzzle",-1)])),_:1,__:[22]}))]),_:1}),n("div",oe,[n("div",ie,u(l.selectedExtension.name),1),n("div",ae," by "+u(((i=l.selectedExtension.author)==null?void 0:i.display_name)||((C=l.selectedExtension.author)==null?void 0:C.username)||"未知开发者"),1)]),s(_,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=F=>l.showDetailDialog=!1)})]}),_:1}),s(E,null,{default:t(()=>{var i,C,F;return[n("p",re,u(l.selectedExtension.description),1),s(h,{class:"mb-4"},{default:t(()=>[s(g,{cols:"12",sm:"4"},{default:t(()=>{var m;return[n("div",de,[n("div",ue,u(((m=l.selectedExtension.project)==null?void 0:m.star_count)||0),1),e[23]||(e[23]=n("div",{class:"text-caption text-grey-darken-1"},"星标",-1))])]}),_:1}),s(g,{cols:"12",sm:"4"},{default:t(()=>{var m;return[n("div",ce,[n("div",me,u(((m=l.selectedExtension.project)==null?void 0:m.view_count)||0),1),e[24]||(e[24]=n("div",{class:"text-caption text-grey-darken-1"},"查看",-1))])]}),_:1}),s(g,{cols:"12",sm:"4"},{default:t(()=>{var m;return[n("div",xe,[n("div",ge,u(((m=l.selectedExtension.project)==null?void 0:m.like_count)||0),1),e[25]||(e[25]=n("div",{class:"text-caption text-grey-darken-1"},"点赞",-1))])]}),_:1})]),_:1}),d.selectedExtensionTags.length>0?(a(),p("div",pe,[e[26]||(e[26]=n("h3",{class:"text-subtitle-1 mb-2"},"标签",-1)),(a(!0),p(D,null,P(d.selectedExtensionTags,m=>(a(),x(w,{key:m,class:"mr-2 mb-2",variant:"outlined",color:"primary"},{default:t(()=>[o(u(m),1)]),_:2},1024))),128))])):f("",!0),n("div",fe,[e[27]||(e[27]=n("h3",{class:"text-subtitle-1 mb-2"},"兼容性",-1)),s(w,{color:(i=l.selectedExtension)!=null&&i.scratchCompatible?"orange":"grey",variant:"outlined","prepend-icon":"mdi-puzzle"},{default:t(()=>{var m;return[o(u((m=l.selectedExtension)!=null&&m.scratchCompatible?"兼容原版Scratch":"不兼容原版Scratch"),1)]}),_:1},8,["color"]),n("p",he,u((C=l.selectedExtension)!=null&&C.scratchCompatible?"此扩展可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)]),l.selectedExtension.sample_project?(a(),p("div",_e,[e[28]||(e[28]=n("h3",{class:"text-subtitle-1 mb-2"},"示例项目",-1)),s(w,{class:"mr-2 mb-2",variant:"outlined",color:"blue"},{default:t(()=>[o(u(l.selectedExtension.sample_project),1)]),_:1})])):f("",!0),n("div",ye,[s(_,{color:"primary",size:"large",href:(F=l.selectedExtension.project)==null?void 0:F.url,target:"_blank"},{default:t(()=>[s(y,{start:""},{default:t(()=>e[29]||(e[29]=[o("mdi-open-in-new",-1)])),_:1,__:[29]}),e[30]||(e[30]=o(" 查看扩展项目 ",-1))]),_:1,__:[30]},8,["href"]),l.selectedExtension.has_docs?(a(),x(_,{key:0,color:"orange",size:"large",variant:"outlined",onClick:e[6]||(e[6]=m=>d.openDocs(l.selectedExtension))},{default:t(()=>[s(y,{start:""},{default:t(()=>e[31]||(e[31]=[o("mdi-book-open-variant",-1)])),_:1,__:[31]}),e[32]||(e[32]=o(" 查看文档 ",-1))]),_:1,__:[32]})):f("",!0)])]}),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"]),s(B,{modelValue:l.showDocsDialog,"onUpdate:modelValue":e[10]||(e[10]=i=>l.showDocsDialog=i),"max-width":"1000",persistent:""},{default:t(()=>[s(b,null,{default:t(()=>[s(k,{class:"d-flex align-center"},{default:t(()=>[s(y,{class:"mr-2",color:"orange"},{default:t(()=>e[33]||(e[33]=[o("mdi-book-open-variant",-1)])),_:1,__:[33]}),e[34]||(e[34]=o(" 扩展文档 ",-1)),s(O),s(_,{icon:"mdi-close",variant:"text",onClick:e[8]||(e[8]=i=>l.showDocsDialog=!1)})]),_:1,__:[34]}),s(E,{style:{"max-height":"600px","overflow-y":"auto"}},{default:t(()=>[l.docsLoading?(a(),p("div",ve,[s(q,{indeterminate:"",color:"primary"}),e[35]||(e[35]=n("p",{class:"mt-4 text-grey-darken-1"},"加载文档中...",-1))])):l.docsContent?(a(),p("div",{key:1,innerHTML:l.docsContent},null,8,be)):(a(),p("div",Ce,[s(y,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[36]||(e[36]=[o("mdi-file-document-outline",-1)])),_:1,__:[36]}),e[37]||(e[37]=n("p",{class:"text-h6 mt-4 text-grey-darken-1"},"无法加载文档内容",-1)),e[38]||(e[38]=n("p",{class:"text-body-2 text-grey"},"请访问扩展项目页面查看完整文档",-1))]))]),_:1}),s(j,null,{default:t(()=>[s(O),s(_,{onClick:e[9]||(e[9]=i=>l.showDocsDialog=!1)},{default:t(()=>e[39]||(e[39]=[o("关闭",-1)])),_:1,__:[39]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ue=A(K,[["render",ke],["__scopeId","data-v-d9f92823"]]);export{Ue as default};
