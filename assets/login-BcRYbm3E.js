import{_ as x}from"./LoadingDialog-Ba4bJUqr.js";import{_ as C}from"./Recaptcha-BzAFt-l1.js";import{_ as B,r as k,e as g,o as h,G as p,a as o,w as n,ao as b,I as i,H as d,c as R,a4 as m,M as w,O as T,K as E,S as u,Q as y,T as L,R as W}from"./index-DYuxtcPw.js";import{l as A}from"./accountService-BCyEkzzs.js";import{V as v,a as l}from"./VRow-D_ISJLm8.js";import{V as I}from"./VForm-3Vgw237-.js";import"./VDialog-BpzW4Nwg.js";import"https://static.geetest.com/v4/gt4.js";/* empty css              */const N={components:{LoadingDialog:x,Recaptcha:C},data(){return{BASE_API:"https://zerocat-api.houlangs.com",username:"",password:"",verificationCode:"",loginType:"password",countdown:0,tryinguser:{},loading:!1,localuser:u,show1:W(!1),rules:{required:t=>!!t||"æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹",length:t=>(t==null?void 0:t.length)===6||"éªŒè¯ç å¿…é¡»æ˜¯6ä½æ•°å­—"},emailRules:[t=>t?!0:"å¿…é¡»å¡«å†™é‚®ç®±",t=>/.+@.+\..+/.test(t)?!0:"ä¸ç¬¦åˆæ ¼å¼"],usernameRules:[t=>t?!0:"å¿…é¡»å¡«å†™å¯†ç "]}},created(){u.isLogin.value===!0&&this.$router.push("/")},setup(){L({title:"ç™»å½•"})},methods:{async handleLogin(){this.loginType==="password"?await this.loginWithPassword():await this.loginWithCode()},async loginWithPassword(){this.loading=!0;try{const t=await A({captcha:this.$refs.recaptcha.getResponse(),un:this.username,pw:this.password});this.handleLoginResponse(t)}catch(t){this.handleError(t)}finally{this.loading=!1}},async loginWithCode(){if(!this.verificationCode||this.verificationCode.length!==6){this.$toast.add({severity:"error",summary:"é”™è¯¯",detail:"è¯·è¾“å…¥6ä½éªŒè¯ç ",life:3e3});return}this.loading=!0;try{const t=await y.post("/account/login-with-code",{email:this.username,code:this.verificationCode});this.handleLoginResponse(t)}catch(t){this.handleError(t)}finally{this.loading=!1}},async sendVerificationCode(){if(!(this.countdown>0)){if(!this.username||!/.+@.+\..+/.test(this.username)){this.$toast.add({severity:"error",summary:"é”™è¯¯",detail:"è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€",life:3e3});return}this.$refs.recaptcha.showBindCaptcha()}},async handleBindVerified(t){this.loading=!0;try{const e=await y.post("/account/send-login-code",{email:this.username,captcha:t});e.data.status==="success"?(this.$toast.add({severity:"success",summary:"æˆåŠŸ",detail:"éªŒè¯ç å·²å‘é€",life:3e3}),this.startCountdown()):this.$toast.add({severity:"error",summary:"é”™è¯¯",detail:e.data.message,life:3e3})}catch(e){this.handleError(e)}finally{this.loading=!1}},handleBindError(){this.$toast.add({severity:"error",summary:"é”™è¯¯",detail:"éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•",life:3e3})},handleBindClose(){},startCountdown(){this.countdown=60;const t=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(t)},1e3)},async handleLoginResponse(t){this.tryinguser=t.data,this.tryinguser.status==="success"?(await u.setUser(this.tryinguser.token),this.$router.push("/")):this.$toast.add({severity:"info",summary:"info",detail:this.tryinguser.message,life:3e3})},handleError(t){var e,c;this.$toast.add({severity:"error",summary:"é”™è¯¯",detail:((c=(e=t.response)==null?void 0:e.data)==null?void 0:c.message)||t.message,life:3e3})},loginWithOAuth(t){const e=u.getToken();window.location.href=`https://zerocat-api.houlangs.com/account/oauth/${t}?token=${e}`}}},U={class:"auth-wrapper d-flex align-center justify-center pa-4"};function z(t,e,c,O,s,a){const f=k("v-cardtext"),V=C,_=x;return h(),g(w,null,[p("div",U,[o(E,{class:"auth-card pa-4 pt-7","max-width":"448",border:"",rounded:"lg"},{default:n(()=>[o(v,null,{default:n(()=>[o(l,{cols:"12"},{default:n(()=>[o(f,null,{default:n(()=>e[8]||(e[8]=[p("h5",{class:"text-h5 font-weight-semibold mb-1"}," æ¬¢è¿Žæ¥åˆ°ZeroCatNextï¼ ðŸ‘‹ðŸ» ",-1),p("p",{class:"mb-0"},"ç™»å½•ä½ çš„è´¦æˆ·",-1)])),_:1})]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(I,null,{default:n(()=>[o(v,null,{default:n(()=>[o(l,{cols:"12"},{default:n(()=>[o(b,{modelValue:s.loginType,"onUpdate:modelValue":e[0]||(e[0]=r=>s.loginType=r),mandatory:"",color:"primary",rounded:"lg",class:"mb-4"},{default:n(()=>[o(i,{value:"password",variant:"text"},{default:n(()=>e[9]||(e[9]=[d("å¯†ç ç™»å½•")])),_:1}),o(i,{value:"code",variant:"text"},{default:n(()=>e[10]||(e[10]=[d("éªŒè¯ç ç™»å½•")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(l,{cols:"12"},{default:n(()=>[o(m,{label:"é‚®ç®±",type:"text",modelValue:s.username,"onUpdate:modelValue":e[1]||(e[1]=r=>s.username=r),variant:"outlined",rules:s.emailRules},null,8,["modelValue","rules"]),s.loginType==="password"?(h(),R(m,{key:0,label:"å¯†ç ",modelValue:s.password,"onUpdate:modelValue":e[2]||(e[2]=r=>s.password=r),variant:"outlined",rules:s.usernameRules,"append-icon":s.show1?"mdi-eye":"mdi-eye-off",type:s.show1?"text":"password","onClick:append":e[3]||(e[3]=r=>s.show1=!s.show1)},null,8,["modelValue","rules","append-icon","type"])):(h(),g(w,{key:1},[o(m,{modelValue:s.verificationCode,"onUpdate:modelValue":e[4]||(e[4]=r=>s.verificationCode=r),label:"éªŒè¯ç ",variant:"outlined",maxlength:"6",rules:[s.rules.required,s.rules.length]},null,8,["modelValue","rules"]),o(i,{class:"mb-4",variant:"text",onClick:a.sendVerificationCode,disabled:s.countdown>0},{default:n(()=>[d(T(s.countdown>0?`${s.countdown}ç§’åŽé‡æ–°å‘é€`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["onClick","disabled"])],64))]),_:1}),o(l,{cols:"9"},{default:n(()=>[o(V,{ref:"recaptcha",recaptchaId:"recaptcha-div",showNormal:s.loginType==="password",onBindVerified:a.handleBindVerified,onBindError:a.handleBindError,onBindClose:a.handleBindClose},null,8,["showNormal","onBindVerified","onBindError","onBindClose"])]),_:1}),o(l,{cols:"12"},{default:n(()=>[o(i,{class:"text-none",color:"primary",rounded:"xl",text:"ç™»å½•",variant:"flat",size:"large",onClick:a.handleLogin,"append-icon":"mdi-arrow-right"},null,8,["onClick"])]),_:1}),o(l,{cols:"12"},{default:n(()=>[o(i,{class:"text-none",color:"white",rounded:"xl",text:"æ³¨å†Œ",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),o(i,{class:"text-none",color:"white",rounded:"xl",text:"æ‰¾å›žå¯†ç ",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"})]),_:1}),o(l,{cols:"12"},{default:n(()=>[o(i,{onClick:e[5]||(e[5]=r=>a.loginWithOAuth("google")),color:"red"},{default:n(()=>e[11]||(e[11]=[d("ä½¿ç”¨ Google ç™»å½•")])),_:1}),o(i,{onClick:e[6]||(e[6]=r=>a.loginWithOAuth("microsoft")),color:"blue"},{default:n(()=>e[12]||(e[12]=[d("ä½¿ç”¨ Microsoft ç™»å½•")])),_:1}),o(i,{onClick:e[7]||(e[7]=r=>a.loginWithOAuth("github")),color:"black"},{default:n(()=>e[13]||(e[13]=[d("ä½¿ç”¨ GitHub ç™»å½•")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o(_,{show:s.loading,text:"ç™»å½•ä¸­"},null,8,["show"])],64)}const K=B(N,[["render",z]]);export{K as default};
