import{_ as U,aa as w,a1 as p,ab as x,ac as V,c as u,o,Y as c,e as l,N as s,R as g,a4 as C,Q as b,f as k,F as y,U as v,$ as B,aQ as I,a9 as M,L as i,X as d,aS as S,i as h,Z as N,n as A,a3 as T,W as z,bz as q}from"./index-Dz-hN2N-.js";const F={name:"UserBlocked",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1},username:{type:String,required:!0}},data(){return{blockedUsers:[],loading:!1,loadingMore:!1,unblockingId:null,totalBlockedUsers:0,localuser:x,page:1,hasMore:!0,snackbar:{show:!1,text:"",color:"success"},s3BucketUrl:""}},computed:{hasMoreBlockedUsers(){return this.blockedUsers.length<this.totalBlockedUsers&&this.showAll}},watch:{userId:{immediate:!0,handler(r,e){r&&r!==e&&this.fetchBlockedUsers()}}},methods:{async fetchBlockedUsers(r=!1){if(this.userId)try{r?this.loadingMore=!0:this.loading=!0;const e=r?this.blockedUsers.length:0,n=this.showAll?this.limit:Math.min(this.limit,5),m=await p.get("/follows/blocked",{params:{limit:n,offset:e}});if(m.data.success){const t=m.data.data;r?this.blockedUsers=[...this.blockedUsers,...t.blocked]:this.blockedUsers=t.blocked,this.totalBlockedUsers=t.total}}catch(e){console.error("获取拉黑用户失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async unblockUser(r,e){try{this.unblockingId=r,await p.delete(`/follows/block/${r}`),this.blockedUsers=this.blockedUsers.filter(n=>n.user.id!==r),this.totalBlockedUsers--,this.showSnackbar(`已取消拉黑 ${e}`,"success")}catch(n){console.error("取消拉黑失败:",n),this.showSnackbar(n.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.unblockingId=null}},async loadMoreBlockedUsers(){await this.fetchBlockedUsers(!0)},showSnackbar(r,e="success"){this.snackbar={show:!0,text:r,color:e}}},async mounted(){this.s3BucketUrl=await w("s3.staticurl")}},L={class:"user-blocked"},Q={class:"text-caption text-medium-emphasis"},R={class:"d-flex justify-center mt-4 mb-4"},j={key:1,class:"text-medium-emphasis"};function D(r,e,n,m,t,f){const _=V("router-link");return o(),u("div",L,[t.loading?(o(),c(b,{key:0},{default:s(()=>[l(g,{class:"text-center",cols:"12"},{default:s(()=>[l(C,{color:"primary",indeterminate:""})]),_:1})]),_:1})):t.blockedUsers.length===0?(o(),c(b,{key:1},{default:s(()=>[l(g,{class:"text-center",cols:"12"},{default:s(()=>e[2]||(e[2]=[k("p",{class:"text-medium-emphasis"},"暂无拉黑用户",-1)])),_:1,__:[2]})]),_:1})):(o(),u(y,{key:2},[(o(!0),u(y,null,v(t.blockedUsers,a=>(o(),c(z,{key:a.id,class:"mb-3",hover:""},{default:s(()=>[l(I,null,{prepend:s(()=>[l(_,{to:`/${a.user.username}`},{default:s(()=>[l(N,{size:"50"},{default:s(()=>[l(A,{src:t.s3BucketUrl+"/user/"+a.user.avatar,alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:s(()=>[l(h,{loading:t.unblockingId===a.user.id,color:"error",size:"small",variant:"outlined",onClick:E=>f.unblockUser(a.user.id,a.user.display_name)},{default:s(()=>e[3]||(e[3]=[i(" 取消拉黑 ",-1)])),_:2,__:[3]},1032,["loading","onClick"])]),default:s(()=>[l(M,null,{default:s(()=>[l(_,{to:`/${a.user.username}`,class:"text-decoration-none"},{default:s(()=>[i(d(a.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),l(S,{class:"text-truncate"},{default:s(()=>[i(d(a.metadata.reason)+" - "+d(a.created_at),1)]),_:2},1024)]),_:2},1024),a.reason?(o(),c(T,{key:0,class:"pt-0"},{default:s(()=>[k("p",Q,[e[4]||(e[4]=k("strong",null,"拉黑原因:",-1)),i(" "+d(a.reason),1)])]),_:2},1024)):B("",!0)]),_:2},1024))),128)),k("div",R,[f.hasMoreBlockedUsers?(o(),c(h,{key:0,loading:t.loadingMore,variant:"tonal",onClick:f.loadMoreBlockedUsers},{default:s(()=>e[5]||(e[5]=[i(" 加载更多 ",-1)])),_:1,__:[5]},8,["loading","onClick"])):t.blockedUsers.length>0?(o(),u("div",j," 没有更多内容了 ")):B("",!0)])],64)),l(q,{modelValue:t.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=a=>t.snackbar.show=a),color:t.snackbar.color,timeout:3e3},{actions:s(()=>[l(h,{variant:"text",onClick:e[0]||(e[0]=a=>t.snackbar.show=!1)},{default:s(()=>e[6]||(e[6]=[i(" 关闭 ",-1)])),_:1,__:[6]})]),default:s(()=>[i(d(t.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const W=U(F,[["render",D],["__scopeId","data-v-8870aab0"]]);export{W as _};
