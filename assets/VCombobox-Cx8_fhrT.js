import{g as Ae,p as Pe,a as Re,r as B,A as I,cj as Ee,ck as Te,u as X,cl as Me,cm as Le,x as p,cn as D,az as A,co as _e,cp as Ne,w as P,cq as Be,cr as Y,cs as Oe,d as Ke,aG as ee,e as d,f as F,O as le,ct as ze,F as $,aE as Ue,m as S,ah as $e,ai as ae,cu as je,a4 as qe,aT as He,ch as Ge,Z as We,cv as Ze,C as Je,D as Qe,S as Xe,h as Ye,L as el,bx as ll,cw as al,by as tl,cx as ul,cy as nl,cz as te,cA as ol}from"./index-DqTFJ56J.js";import{u as il,h as sl,m as rl}from"./filter-DxbJNipU.js";const cl=Pe({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...rl({filterKeys:["title"]}),...ul({hideNoData:!0,returnObject:!0}),...tl(nl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...al({transition:!1})},"VCombobox"),fl=Ae()({name:"VCombobox",props:cl(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,ue){var G;let{emit:ne,slots:n}=ue;const{t:oe}=Re(),b=B(),x=I(!1),C=I(!0),O=I(!1),j=B(),R=B(),s=I(-1);let E=!1;const{items:q,transformIn:ie,transformOut:se}=Ee(l),{textColorClasses:re,textColorStyles:ce}=Te(()=>{var e;return(e=b.value)==null?void 0:e.color}),o=X(l,"modelValue",[],e=>ie(Me(e)),e=>{const a=se(e);return l.multiple?a:a[0]??null}),T=Le(l),M=p(()=>!!(l.chips||n.chip)),V=p(()=>M.value||!!n.selection),k=I(!l.multiple&&!V.value?((G=o.value[0])==null?void 0:G.title)??"":""),v=p({get:()=>k.value,set:async e=>{var a;if(k.value=e??"",!l.multiple&&!V.value&&(o.value=[D(l,e)],A(()=>{var r;return(r=R.value)==null?void 0:r.scrollToIndex(0)})),e&&l.multiple&&((a=l.delimiters)!=null&&a.length)){const r=l.delimiters.map(_e).join("|"),u=e.split(new RegExp(`(?:${r})+`));if(u.length>1){for(let i of u)i=i.trim(),i&&(g(D(l,i)),await A());k.value=""}}e||(s.value=-1),C.value=!e}}),ve=p(()=>typeof l.counterValue=="function"?l.counterValue(o.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?o.value.length:v.value.length),{filteredItems:L,getMatches:de}=il(l,q,()=>l.alwaysFilter||!C.value?v.value:""),w=p(()=>l.hideSelected?L.value.filter(e=>!o.value.some(a=>a.value===e.value)):L.value),_=p(()=>l.hideNoData&&!w.value.length||T.isReadonly.value||T.isDisabled.value),K=X(l,"menu"),c=p({get:()=>K.value,set:e=>{var a;K.value&&!e&&((a=j.value)!=null&&a.Î¨openChildren.size)||e&&_.value||(K.value=e)}}),{menuId:fe,ariaExpanded:me,ariaControls:he,ariaLabel:H}=Ne(l,c);P(k,e=>{E?A(()=>E=!1):x.value&&!c.value&&(c.value=!0),ne("update:search",e)}),P(o,e=>{var a;!l.multiple&&!V.value&&(k.value=((a=e[0])==null?void 0:a.title)??"")});const be=p(()=>o.value.map(e=>e.value)),z=p(()=>{var a;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&v.value===((a=w.value[0])==null?void 0:a.title))&&w.value.length>0&&!C.value&&!O.value}),U=B(),ge=Be(U,b);function ye(e){E=!0,A(()=>E=!1),l.openOnClear&&(c.value=!0)}function xe(){_.value||(c.value=!0)}function Ve(e){_.value||(x.value&&(e.preventDefault(),e.stopPropagation()),c.value=!c.value)}function pe(e){var a;(te(e)||e.key==="Backspace")&&((a=b.value)==null||a.focus())}function Ce(e){var u,i,f,y;if(ol(e)||T.isReadonly.value)return;const a=(u=b.value)==null?void 0:u.selectionStart,r=o.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(c.value=!0),["Escape"].includes(e.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(z.value&&["Enter","Tab"].includes(e.key)&&!o.value.some(t=>{let{value:h}=t;return h===w.value[0].value})&&g(L.value[0]),C.value=!0),e.key==="ArrowDown"&&z.value&&((i=U.value)==null||i.focus("next")),e.key==="Enter"&&v.value&&(g(D(l,v.value)),V.value&&(k.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&V.value&&o.value.length>0&&!v.value)return g(o.value[0],!1);if(~s.value){e.preventDefault();const t=s.value;g(o.value[s.value],!1),s.value=t>=r-1?r-2:t}else e.key==="Backspace"&&!v.value&&(s.value=r-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(s.value<0&&a&&a>0)return;const t=s.value>-1?s.value-1:r-1;o.value[t]?s.value=t:(s.value=-1,(f=b.value)==null||f.setSelectionRange(v.value.length,v.value.length))}else if(e.key==="ArrowRight"){if(s.value<0)return;const t=s.value+1;o.value[t]?s.value=t:(s.value=-1,(y=b.value)==null||y.setSelectionRange(0,0))}else~s.value&&te(e)&&(s.value=-1)}function ke(){var e;l.eager&&((e=R.value)==null||e.calculateVisibleItems())}function we(){var e;x.value&&(C.value=!0,(e=b.value)==null||e.focus())}function g(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const r=o.value.findIndex(i=>(l.valueComparator||Y)(i.value,e.value)),u=a??!~r;if(~r){const i=u?[...o.value,e]:[...o.value];i.splice(r,1),o.value=i}else u&&(o.value=[...o.value,e]);l.clearOnSelect&&(v.value="")}else{const r=a!==!1;o.value=r?[e]:[],k.value=r&&!V.value?e.title:"",A(()=>{c.value=!1,C.value=!0})}}function Se(e){x.value=!0,setTimeout(()=>{O.value=!0})}function Fe(e){O.value=!1}function Ie(e){(e==null||e===""&&!l.multiple&&!V.value)&&(o.value=[])}return P(x,(e,a)=>{if(!(e||e===a)&&(s.value=-1,c.value=!1,v.value)){if(l.multiple){g(D(l,v.value));return}if(!V.value)return;o.value.some(r=>{let{title:u}=r;return u===v.value})?k.value="":g(D(l,v.value))}}),P(c,()=>{if(!l.hideSelected&&c.value&&o.value.length){const e=w.value.findIndex(a=>o.value.some(r=>(l.valueComparator||Y)(r.value,a.value)));Oe&&window.requestAnimationFrame(()=>{var a;e>=0&&((a=R.value)==null||a.scrollToIndex(e))})}}),P(q,(e,a)=>{c.value||x.value&&!a.length&&e.length&&(c.value=!0)}),Ke(()=>{const e=!!(!l.hideNoData||w.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),a=o.value.length>0,r=ee.filterProps(l);return d(ee,S({ref:b},r,{modelValue:v.value,"onUpdate:modelValue":[u=>v.value=u,Ie],focused:x.value,"onUpdate:focused":u=>x.value=u,validationValue:o.externalValue,counterValue:ve.value,dirty:a,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!V.value,"v-combobox--selecting-index":s.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:T.isReadonly.value,placeholder:a?void 0:l.placeholder,"onClick:clear":ye,"onMousedown:control":xe,onKeydown:Ce,"aria-expanded":me.value,"aria-controls":he.value}),{...n,default:()=>F($,null,[d(Ue,S({id:fe.value,ref:j,modelValue:c.value,"onUpdate:modelValue":u=>c.value=u,activator:"parent",contentClass:"v-combobox__content",disabled:_.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:ke,onAfterLeave:we},l.menuProps),{default:()=>[e&&d($e,S({ref:U,filterable:!0,selected:be.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),selectable:!0,onKeydown:pe,onFocusin:Se,onFocusout:Fe,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},ge,l.listProps),{default:()=>{var u,i,f;return[(u=n["prepend-item"])==null?void 0:u.call(n),!w.value.length&&!l.hideNoData&&(((i=n["no-data"])==null?void 0:i.call(n))??d(ae,{key:"no-data",title:oe(l.noDataText)},null)),d(je,{ref:R,renderless:!0,items:w.value,itemKey:"value"},{default:y=>{var Z,J,Q;let{item:t,index:h,itemRef:m}=y;const W=S(t.props,{ref:m,key:t.value,active:z.value&&h===0?!0:void 0,onClick:()=>g(t,null)});return t.type==="divider"?((Z=n.divider)==null?void 0:Z.call(n,{props:t.raw,index:h}))??d(qe,S(t.props,{key:`divider-${h}`}),null):t.type==="subheader"?((J=n.subheader)==null?void 0:J.call(n,{props:t.raw,index:h}))??d(He,S(t.props,{key:`subheader-${h}`}),null):((Q=n.item)==null?void 0:Q.call(n,{item:t,index:h,props:W}))??d(ae,S(W,{role:"option"}),{prepend:N=>{let{isSelected:De}=N;return F($,null,[l.multiple&&!l.hideSelected?d(Ge,{key:t.value,modelValue:De,ripple:!1,tabindex:"-1"},null):void 0,t.props.prependAvatar&&d(We,{image:t.props.prependAvatar},null),t.props.prependIcon&&d(le,{icon:t.props.prependIcon},null)])},title:()=>{var N;return C.value?t.title:sl("v-combobox",t.title,(N=de(t))==null?void 0:N.title)}})}}),(f=n["append-item"])==null?void 0:f.call(n)]}})]}),o.value.map((u,i)=>{function f(m){m.stopPropagation(),m.preventDefault(),g(u,!1)}const y={"onClick:close":f,onKeydown(m){m.key!=="Enter"&&m.key!==" "||(m.preventDefault(),m.stopPropagation(),f(m))},onMousedown(m){m.preventDefault(),m.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},t=M.value?!!n.chip:!!n.selection,h=t?Ze(M.value?n.chip({item:u,index:i,props:y}):n.selection({item:u,index:i})):void 0;if(!(t&&!h))return F("div",{key:u.value,class:Qe(["v-combobox__selection",i===s.value&&["v-combobox__selection--selected",re.value]]),style:Je(i===s.value?ce.value:{})},[M.value?n.chip?d(Ye,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:u.title}}},{default:()=>[h]}):d(Xe,S({key:"chip",closable:l.closableChips,size:"small",text:u.title,disabled:u.props.disabled},y),null):h??F("span",{class:"v-combobox__selection-text"},[u.title,l.multiple&&i<o.value.length-1&&F("span",{class:"v-combobox__selection-comma"},[el(",")])])])})]),"append-inner":function(){var y,t;for(var u=arguments.length,i=new Array(u),f=0;f<u;f++)i[f]=arguments[f];return F($,null,[(y=n["append-inner"])==null?void 0:y.call(n,...i),(!l.hideNoData||l.items.length)&&l.menuIcon?d(le,{class:"v-combobox__menu-icon",color:(t=b.value)==null?void 0:t.fieldIconColor,icon:l.menuIcon,onMousedown:Ve,onClick:ze,"aria-label":H.value,title:H.value,tabindex:"-1"},null):void 0])}})}),ll({isFocused:x,isPristine:C,menu:c,search:v,selectionIndex:s,filteredItems:L,select:g},b)}});export{fl as V};
