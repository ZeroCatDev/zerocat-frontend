import{_ as A}from"./Timeline-Dz43zBrP.js";import{_ as I,a as F}from"./UserFollowers-BEj5_Z2j.js";import{_ as N,a as S}from"./Comment-ryDRitJN.js";import{g as K}from"./projectListService-AqW2iRS1.js";import{_ as V,c as b,o as i,X as n,M as r,e,a8 as v,a9 as $,Y as c,F as L,aa as ee,L as u,W as D,R as w,Q as j,a5 as h,i as U,f as o,T as a,ab as te,ac as y,ad as se,Z as re,n as le,$ as x,S as f,O as d,U as k,ae as oe,a6 as ie,af as P}from"./index-DqTFJ56J.js";import{_ as ae}from"./Projects-Cceopu5e.js";import{_ as R}from"./UserRelationControls-CuVKFI1P.js";import{_ as q}from"./TimeAgo-C1fvw-LU.js";import{_ as B}from"./PageAnalytics-C0iviIK2.js";/* empty css                        */import"./VTimeline-B-QrANI3.js";import"./_commonjsHelpers-BosuxZz1.js";import"./VTextarea-DCEsvZBe.js";import"https://static.geetest.com/v4/gt4.js";import"./ProjectCard-CoW0AwOM.js";const ne={name:"UserProjectLists",props:{userId:{type:[Number,String],required:!0},projectLists:{type:Array,default:()=>[]}},data(){return{loading:!1,localLists:[]}},computed:{lists(){return this.projectLists.length>0?this.projectLists:this.localLists}},watch:{userId:{immediate:!0,handler(t){t&&this.projectLists.length===0&&this.fetchUserLists()}}},methods:{async fetchUserLists(){this.loading=!0;try{const t=await K(this.userId);t.status==="success"?this.localLists=t.data||[]:console.error("获取用户列表失败:",t.message)}catch(t){console.error("获取用户列表失败:",t)}finally{this.loading=!1}}}};function ue(t,s,m,C,l,g){return i(),b("div",null,[l.loading?(i(),n(c,{key:0,class:"mb-4"},{default:r(()=>[e(v,{class:"text-center"},{default:r(()=>[e($,{color:"primary",indeterminate:""})]),_:1})]),_:1})):(i(),b(L,{key:1},[g.lists.length===0?(i(),n(c,{key:0,class:"mb-4"},{default:r(()=>[e(v,{class:"text-center"},{default:r(()=>[e(ee,{type:"info",variant:"tonal"},{default:r(()=>[...s[0]||(s[0]=[u(" 该用户暂无公开项目列表 ",-1)])]),_:1})]),_:1})]),_:1})):(i(),n(j,{key:1},{default:r(()=>[(i(!0),b(L,null,D(g.lists,p=>(i(),n(w,{key:p.id,cols:"12",lg:"3",md:"4",sm:"6",xl:"2",xs:"12",xxl:"2"},{default:r(()=>[e(c,{rounded:"lg"},{default:r(()=>[e(c,{subtitle:p.description,title:p.title,to:"/app/projectlist/"+p.id,rounded:"lg",variant:"tonal"},null,8,["subtitle","title","to"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))],64))])}const E=V(ne,[["render",ue]]),ce={name:"FollowStats",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},data(){return{followersCount:0,followingCount:0,loading:!1}},mounted(){this.fetchFollowStats()},watch:{userId:{handler(){this.fetchFollowStats()}}},methods:{async fetchFollowStats(){try{this.loading=!0;const t=await h.get(`/follows/followers/${this.userId}`,{params:{limit:1,offset:0}});t.data.success&&(this.followersCount=t.data.data.total);const s=await h.get(`/follows/following/${this.userId}`,{params:{limit:1,offset:0}});s.data.success&&(this.followingCount=s.data.data.total)}catch(t){console.error("获取关注统计失败:",t)}finally{this.loading=!1}}}},de={class:"font-weight-bold"},me={class:"font-weight-bold"};function pe(t,s,m,C,l,g){return i(),n(j,{class:"follow-stats"},{default:r(()=>[e(w,null,{default:r(()=>[e(U,{to:`/${m.username}?tab=followers`,class:"stats-btn",variant:"text"},{default:r(()=>[o("span",de,a(l.followersCount),1),s[0]||(s[0]=o("span",{class:"text-body-2 text-medium-emphasis"},"关注者",-1))]),_:1},8,["to"])]),_:1}),e(w,null,{default:r(()=>[e(U,{to:`/${m.username}?tab=following`,class:"stats-btn",variant:"text"},{default:r(()=>[o("span",me,a(l.followingCount),1),s[1]||(s[1]=o("span",{class:"text-body-2 text-medium-emphasis"},"正在关注",-1))]),_:1},8,["to"])]),_:1})]),_:1})}const Z=V(ce,[["render",pe],["__scopeId","data-v-8db03ed6"]]),M=t=>({id:t,display_name:"未知用户",bio:"用户信息未缓存",avatar:"",regTime:"2000-01-01T00:00:00.000Z",sex:"未知",username:"未知"});async function _e(t){if(Array.isArray(t))try{const{data:s}=await h.post("/user/batch/name",{users:t});return s.data}catch{return t.map(m=>M(m))}else try{const{data:s}=await h.get(`/user/username/${t}`);return s.data}catch{return M(t)}}const fe={components:{Comment:S,Markdown:N,TimeAgo:q,UserProjectLists:E,UserRelationControls:R,FollowStats:Z,UserFollowers:F,UserFollowing:I,Timeline:A,PageAnalytics:B},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},isLoadingMore:!1,localuser:P,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",bio:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"},localuser:P}},watch:{"$route.query.tab"(t){this.tab=t||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await _e(this.username),ie({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_orderby=view_up&search_state=public`},async getProjectList(){try{const t=await h({url:`/projectlist/userid/${this.user.id}/public`,method:"get"});t.data&&t.data.data&&(this.lists=t.data.data)}catch(t){console.error("获取用户项目列表失败:",t),this.lists=[]}},async fetchTimeline(t=1){try{const s=await h.get(`/timeline/user/${this.user.id}`,{params:{page:t,limit:this.timeline.pagination.size}});s.data.status==="success"&&(t===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(t){return t!=null&&t.length?t.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!this.isLoadingMore)try{this.isLoadingMore=!0,await this.fetchTimeline(this.timeline.pagination.current+1)}finally{this.isLoadingMore=!1}},getTargetContent(t,s){if(!t)return"";switch(t.type){case"project":return t.title||`项目 #${t.id}`;case"user":return t.display_name||`用户 #${t.id}`;case"projectlist":return`项目列表 #${t.id}`;default:return`${t.type} #${t.id}`}},getFieldDisplayName(t){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[t]||t}}},he={class:"font-weight-medium text-primary"},ge={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},ye={class:"mt-2 text-body-1 text-medium-emphasis user-motto"},be={class:"mt-2 text-medium-emphasis"},we=["href"];function xe(t,s,m,C,l,g){const p=B,z=q,W=R,H=Z,O=N,Q=ae,X=E,T=S,Y=F,G=I,J=A;return i(),b("div",null,[e(p,{"target-id":l.user.id,"target-type":"user"},null,8,["target-id"]),e(k,null,{default:r(()=>[e(te,{modelValue:l.tab,"onUpdate:modelValue":s[0]||(s[0]=_=>l.tab=_)},{default:r(()=>[e(y,{value:"home"},{default:r(()=>[e(se,{class:"mt-8"},{default:r(()=>[e(j,{class:"d-flex align-center"},{default:r(()=>[e(w,null,{default:r(()=>[o("p",he,a(l.user.type==="administrator"?"ZeroCat 管理员":"开发者"),1),o("p",ge,[u(a(l.user.display_name)+" ",1),e(re,{class:"ma-2",size:"52"},{default:r(()=>[e(le,{src:l.localuser.getUserAvatar(l.user.avatar)},null,8,["src"])]),_:1})]),o("p",ye,a(l.user.motto),1),o("p",be,[e(f,{class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-account-circle",start:""}),u(" #"+a(l.user.id),1)]),_:1}),e(f,{class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-clock",start:""}),e(z,{date:l.user.regTime},null,8,["date"]),s[1]||(s[1]=u(" 注册 ",-1))]),_:1}),l.user.location?(i(),n(f,{key:0,class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-map-marker",start:""}),u(" "+a(l.user.location),1)]),_:1})):x("",!0),l.user.birthday?(i(),n(f,{key:1,class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-cake-variant",start:""}),u(" "+a(new Date(l.user.birthday).toLocaleDateString()),1)]),_:1})):x("",!0),l.user.url?(i(),n(f,{key:2,"append-icon":"mdi-open-in-new",class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-web",start:""}),o("a",{href:l.user.url,class:"text-decoration-none",target:"_blank"},a(l.user.url),9,we)]),_:1})):x("",!0),l.user.isActive?x("",!0):(i(),n(f,{key:3,color:"error"},{default:r(()=>[e(d,{icon:"mdi-alert-circle",start:""}),s[2]||(s[2]=u(" 异常 ",-1))]),_:1}))]),e(W,{"display-name":l.user.display_name,"user-id":l.user.id,username:l.username},null,8,["display-name","user-id","username"]),e(H,{"user-id":l.user.id,username:l.username,class:"mt-3"},null,8,["user-id","username"])]),_:1})]),_:1})]),_:1}),s[4]||(s[4]=o("br",null,null,-1)),e(c,{subtitle:"README.md",title:"关于我"},{default:r(()=>[e(v,{class:"markdown-body"},{default:r(()=>[s[3]||(s[3]=o("br",null,null,-1)),e(O,null,{default:r(()=>[u(a(l.user.bio),1)]),_:1})]),_:1})]),_:1}),e(Q,{url:l.url,showAuthor:!1},null,8,["url"]),e(j,null,{default:r(()=>[(i(!0),b(L,null,D(l.lists,_=>(i(),n(w,{key:_.id,cols:"12",lg:"3",md:"4",sm:"6",xl:"2",xs:"12",xxl:"2"},{default:r(()=>[e(c,{rounded:"lg"},{default:r(()=>[e(c,{subtitle:_.description,title:_.title,to:"/app/projectlist/"+_.id,color:"primary",rounded:"lg",variant:"tonal"},null,8,["subtitle","title","to"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[5]||(s[5]=o("br",null,null,-1)),e(X,{"project-lists":l.lists,"user-id":l.user.id},null,8,["project-lists","user-id"]),s[6]||(s[6]=o("br",null,null,-1)),e(T,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1}),e(y,{value:"comment"},{default:r(()=>[e(T,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1}),e(y,{value:"followers"},{default:r(()=>[e(k,null,{default:r(()=>[s[7]||(s[7]=o("h2",{class:"text-h5 mb-4"},"关注者",-1)),e(Y,{"show-all":!1,"user-id":l.user.id},null,8,["user-id"])]),_:1})]),_:1}),e(y,{value:"following"},{default:r(()=>[e(k,null,{default:r(()=>[s[8]||(s[8]=o("h2",{class:"text-h5 mb-4"},"正在关注",-1)),e(G,{"show-all":!1,"user-id":l.user.id},null,8,["user-id"])]),_:1})]),_:1}),e(y,{value:"timeline"},{default:r(()=>[e(c,{class:"mt-4",variant:"flat"},{default:r(()=>[e(oe,{class:"d-flex align-center"},{default:r(()=>[e(d,{class:"mr-2",color:"primary",icon:"mdi-timeline-clock"}),u(" "+a(l.user.display_name)+" 的动态 ",1)]),_:1}),e(v,null,{default:r(()=>[e(J,{"is-loading-more":l.isLoadingMore,timeline:l.timeline,onLoadMore:g.loadMoreEvents},null,8,["is-loading-more","timeline","onLoadMore"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const De=V(fe,[["render",xe],["__scopeId","data-v-93d0b99f"]]);export{De as default};
