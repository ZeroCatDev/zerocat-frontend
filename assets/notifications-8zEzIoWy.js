import{_ as E,a as r,o as t,h as l,N as s,R as S,T as d,at as U,M as p,K as c,O as k,j as A,ah as P,Y as F,Z as q,F as M,W as y,aj as H,Q as K,ak as O,am as Q,S as f,an as j,U as D,q as W,ao as Y,r as _,y as R,e as Z,c8 as G,c9 as J,ca as X,cb as $}from"./index-BZTz8w1z.js";import{V as ee,a as te}from"./VRow-BBentoK4.js";import{V as ae}from"./VChip-DFg2OVrE.js";import{V as se}from"./VPagination-8259P6R1.js";import{V as oe}from"./VContainer-CSAjgE8G.js";/* empty css              */const re={setup(){const u=_([]),a=_(!0),m=_(null),o=_(1),h=_(20),g=_(0),e=R(()=>Math.ceil(g.value/h.value)),C=R(()=>u.value.some(i=>!i.read)),x=async(i=1)=>{a.value=!0,m.value=null,o.value=i;try{const n=await J();u.value=n.notifications||[],g.value=n.total_rows_notifications||0}catch(n){m.value=n.message||"Failed to load notifications",console.error("Error loading notifications:",n)}finally{a.value=!1}},T=async i=>{try{await $(i);const n=u.value.find(N=>N.id===i);n&&(n.read=!0)}catch(n){console.error("Error marking notification as read:",n)}},L=async()=>{try{await X(),u.value.forEach(i=>{i.read=!0})}catch(i){console.error("Error marking all notifications as read:",i)}},z=i=>{const n=new Date(i),B=new Date-n,b=Math.floor(B/1e3),V=Math.floor(b/60),v=Math.floor(V/60),w=Math.floor(v/24);return b<60?"刚刚":V<60?`${V}分钟前`:v<24?`${v}小时前`:w<30?`${w}天前`:n.toLocaleDateString()};return Z(()=>{x()}),{notifications:u,loading:a,error:m,currentPage:o,totalPages:e,hasUnread:C,fetchNotifications:x,markAsRead:T,markAllAsRead:L,formatDate:z,debugNotificationTest:G}}},le={class:"d-flex justify-center pa-4"},ne={key:0},ie={key:1},de={key:0},ce={key:1},ue={key:2},fe={key:3},_e={key:4},me={key:5},ye={key:6},pe={key:7},ke={key:8},ge={key:9},Ve={key:1,class:"py-8 text-center"};function ve(u,a,m,o,h,g){return t(),r("div",null,[l(oe,null,{default:s(()=>[l(ee,null,{default:s(()=>[l(te,{cols:"12"},{default:s(()=>[l(S,null,{default:s(()=>[l(U,{class:"d-flex align-center justify-space-between"},{default:s(()=>[p("div",null,[l(k,{start:""},{default:s(()=>a[1]||(a[1]=[c("mdi-bell")])),_:1}),a[2]||(a[2]=c(" 通知中心 "))]),p("div",null,[l(A,{variant:"outlined","prepend-icon":"mdi-check-all",onClick:o.debugNotificationTest},{default:s(()=>a[3]||(a[3]=[c(" 测试 ")])),_:1},8,["onClick"]),l(A,{variant:"outlined","prepend-icon":"mdi-check-all",onClick:o.markAllAsRead,disabled:!o.hasUnread},{default:s(()=>a[4]||(a[4]=[c(" 标记全部已读 ")])),_:1},8,["onClick","disabled"])])]),_:1}),l(P),o.loading?(t(),d(F,{key:0},{default:s(()=>[p("div",le,[l(q,{indeterminate:""})])]),_:1})):(t(),r(M,{key:1},[o.notifications.length>0?(t(),d(H,{key:0},{default:s(()=>[(t(!0),r(M,null,K(o.notifications,e=>(t(),d(O,{key:e.id,to:e.redirect_url,lines:"three",color:"primary",active:!e.read,onClick:C=>o.markAsRead(e.id)},{prepend:s(()=>[e.acting_user_avatar_template?(t(),d(D,{key:0,size:"40"},{default:s(()=>[l(W,{src:e.acting_user_avatar_template},null,8,["src"])]),_:2},1024)):(t(),d(D,{key:1,color:"primary",size:"40"},{default:s(()=>[l(k,null,{default:s(()=>a[5]||(a[5]=[c("mdi-bell")])),_:1})]),_:1}))]),append:s(()=>[e.high_priority?(t(),d(ae,{key:0,color:"error",size:"small",class:"mr-2"},{default:s(()=>a[6]||(a[6]=[c(" 重要 ")])),_:1})):y("",!0),e.read?y("",!0):(t(),d(k,{key:1,color:"primary",size:"small"},{default:s(()=>a[7]||(a[7]=[c("mdi-circle-small")])),_:1}))]),default:s(()=>[l(Q,null,{default:s(()=>[e.acting_user_name?(t(),r("span",ne,f(e.acting_user_name),1)):(t(),r("span",ie,"系统消息"))]),_:2},1024),l(j,null,{default:s(()=>[e.notification_type===1?(t(),r("span",de,"在项目 "+f(e.data.project_title)+" 中评论了",1)):e.notification_type===2?(t(),r("span",ce,"点赞了项目 "+f(e.data.project_title),1)):e.notification_type===3?(t(),r("span",ue,"Fork了项目 "+f(e.data.project_title),1)):e.notification_type===20?(t(),r("span",fe,"关注了你")):e.notification_type===101?(t(),r("span",_e,"点赞了你的评论")):e.notification_type===50?(t(),r("span",me,"系统公告")):e.notification_type===802?(t(),r("span",ye,"在话题中提到了你")):e.notification_type===21?(t(),r("span",pe,"在项目中提到了你")):e.notification_type===800?(t(),r("span",ke,f(e.data.title),1)):(t(),r("span",ge,"新的通知"))]),_:2},1024),l(j,{class:"text-caption text-grey"},{default:s(()=>[c(f(o.formatDate(e.created_at)),1)]),_:2},1024)]),_:2},1032,["to","active","onClick"]))),128))]),_:1})):(t(),r("div",Ve,[l(k,{size:"large",color:"grey"},{default:s(()=>a[8]||(a[8]=[c("mdi-bell-off")])),_:1}),a[9]||(a[9]=p("div",{class:"text-body-1 text-grey mt-2"},"暂无通知",-1))])),o.notifications.length>0?(t(),d(P,{key:2})):y("",!0),o.notifications.length>0?(t(),d(Y,{key:3,class:"d-flex justify-center pa-4"},{default:s(()=>[o.totalPages>1?(t(),d(se,{key:0,modelValue:o.currentPage,"onUpdate:modelValue":[a[0]||(a[0]=e=>o.currentPage=e),o.fetchNotifications],length:o.totalPages},null,8,["modelValue","length","onUpdate:modelValue"])):y("",!0)]),_:1})):y("",!0)],64))]),_:1})]),_:1})]),_:1})]),_:1})])}const he=E(re,[["render",ve],["__scopeId","data-v-0c209e31"]]),I={},Ce={__name:"notifications",setup(u){return(a,m)=>(t(),d(he))}};typeof I=="function"&&I(Ce);export{Ce as default};
