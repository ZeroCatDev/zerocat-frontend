import{_ as V,a1 as p,aa as w,ab as B,c as u,o as l,Y as c,e as r,N as s,R as g,a4 as U,Q as b,f as m,F as y,U as C,$ as x,aT as v,a9 as I,L as i,X as d,aV as M,i as h,Z as S,n as N,a3 as A,W as T,aS as q}from"./index-NKeTyzEk.js";const z={name:"UserBlocked",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1},username:{type:String,required:!0}},data(){return{blockedUsers:[],loading:!1,loadingMore:!1,unblockingId:null,totalBlockedUsers:0,page:1,hasMore:!0,snackbar:{show:!1,text:"",color:"success"},localuser:w}},computed:{hasMoreBlockedUsers(){return this.blockedUsers.length<this.totalBlockedUsers&&this.showAll}},watch:{userId:{immediate:!0,handler(o,e){o&&o!==e&&this.fetchBlockedUsers()}}},methods:{async fetchBlockedUsers(o=!1){if(this.userId)try{o?this.loadingMore=!0:this.loading=!0;const e=o?this.blockedUsers.length:0,n=this.showAll?this.limit:Math.min(this.limit,5),f=await p.get("/follows/blocked",{params:{limit:n,offset:e}});if(f.data.success){const t=f.data.data;o?this.blockedUsers=[...this.blockedUsers,...t.blocked]:this.blockedUsers=t.blocked,this.totalBlockedUsers=t.total}}catch(e){console.error("获取拉黑用户失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async unblockUser(o,e){try{this.unblockingId=o,await p.delete(`/follows/block/${o}`),this.blockedUsers=this.blockedUsers.filter(n=>n.user.id!==o),this.totalBlockedUsers--,this.showSnackbar(`已取消拉黑 ${e}`,"success")}catch(n){console.error("取消拉黑失败:",n),this.showSnackbar(n.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.unblockingId=null}},async loadMoreBlockedUsers(){await this.fetchBlockedUsers(!0)},showSnackbar(o,e="success"){this.snackbar={show:!0,text:o,color:e}}}},F={class:"user-blocked"},L={class:"text-caption text-medium-emphasis"},R={class:"d-flex justify-center mt-4 mb-4"},j={key:1,class:"text-medium-emphasis"};function D(o,e,n,f,t,k){const _=B("router-link");return l(),u("div",F,[t.loading?(l(),c(b,{key:0},{default:s(()=>[r(g,{class:"text-center",cols:"12"},{default:s(()=>[r(U,{color:"primary",indeterminate:""})]),_:1})]),_:1})):t.blockedUsers.length===0?(l(),c(b,{key:1},{default:s(()=>[r(g,{class:"text-center",cols:"12"},{default:s(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无拉黑用户",-1)])),_:1,__:[2]})]),_:1})):(l(),u(y,{key:2},[(l(!0),u(y,null,C(t.blockedUsers,a=>(l(),c(T,{key:a.id,class:"mb-3",hover:""},{default:s(()=>[r(v,null,{prepend:s(()=>[r(_,{to:`/${a.user.username}`},{default:s(()=>[r(S,{size:"50"},{default:s(()=>[r(N,{src:t.localuser.getUserAvatar(a.user.avatar),alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:s(()=>[r(h,{loading:t.unblockingId===a.user.id,color:"error",size:"small",variant:"outlined",onClick:E=>k.unblockUser(a.user.id,a.user.display_name)},{default:s(()=>e[3]||(e[3]=[i(" 取消拉黑 ",-1)])),_:2,__:[3]},1032,["loading","onClick"])]),default:s(()=>[r(I,null,{default:s(()=>[r(_,{to:`/${a.user.username}`,class:"text-decoration-none"},{default:s(()=>[i(d(a.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),r(M,{class:"text-truncate"},{default:s(()=>[i(d(a.metadata.reason)+" - "+d(a.created_at),1)]),_:2},1024)]),_:2},1024),a.reason?(l(),c(A,{key:0,class:"pt-0"},{default:s(()=>[m("p",L,[e[4]||(e[4]=m("strong",null,"拉黑原因:",-1)),i(" "+d(a.reason),1)])]),_:2},1024)):x("",!0)]),_:2},1024))),128)),m("div",R,[k.hasMoreBlockedUsers?(l(),c(h,{key:0,loading:t.loadingMore,variant:"tonal",onClick:k.loadMoreBlockedUsers},{default:s(()=>e[5]||(e[5]=[i(" 加载更多 ",-1)])),_:1,__:[5]},8,["loading","onClick"])):t.blockedUsers.length>0?(l(),u("div",j," 没有更多内容了 ")):x("",!0)])],64)),r(q,{modelValue:t.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=a=>t.snackbar.show=a),color:t.snackbar.color,timeout:3e3},{actions:s(()=>[r(h,{variant:"text",onClick:e[0]||(e[0]=a=>t.snackbar.show=!1)},{default:s(()=>e[6]||(e[6]=[i(" 关闭 ",-1)])),_:1,__:[6]})]),default:s(()=>[i(d(t.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const Q=V(z,[["render",D],["__scopeId","data-v-166d4deb"]]);export{Q as _};
