import{aZ as U,b7 as H,r as T,b as J,a6 as E,c as j,o as _,e,N as l,f as B,Y as x,a0 as I,Z as c,af as p,L as t,a9 as g,i as f,T as N,aB as r,P as O,U as m,j as W,W as F,_ as X,x as z,eX as G,R as q,S as y,b0 as D,ai as K,aj as P,ak as L,al as R,aA as Q,ab as h,aY as ee,F as le}from"./index-sIbGf8Dn.js";import{V as se}from"./VTextarea-DocgrHtD.js";import"https://static.geetest.com/v4/gt4.js";const ae={class:"sudo-example"},te={__name:"SudoExample",setup(Y){const o=U(),d=H({basic:!1,optional:!1,api:!1,auto:!1}),n=T(null),C=async()=>{d.basic=!0,n.value=null;try{const u=await o.requireSudo({title:"删除重要数据",subtitle:"此操作不可逆，请验证您的身份",persistent:!0});n.value={success:!0,message:"获取到sudo token",token:u.substring(0,20)+"...",action:"模拟执行了需要sudo权限的操作"},console.log("执行需要sudo权限的操作，token:",u)}catch(u){n.value={success:!1,message:u.message,type:u.type}}finally{d.basic=!1}},w=()=>{n.value={isValid:o.isSudoValid(),token:o.getSudoToken(),expiresIn:o.tokenExpiresIn,expiresAt:o.expiresAt,formattedTime:o.formatTime(o.tokenExpiresIn)}},S=()=>{o.clearSudo(),n.value={success:!0,message:"Sudo token已清除"}},b=async()=>{d.api=!0,n.value=null;try{const u=await o.requireSudo({title:"API操作认证",subtitle:"此API调用需要管理员权限"}),s=o.addSudoToRequest({method:"delete",url:"/admin/users/123",data:{reason:"违规操作"}});console.log("发送带有sudo token的请求:",s),n.value={success:!0,message:"模拟API请求成功",requestConfig:s}}catch(u){n.value={success:!1,message:u.message}}finally{d.api=!1}},v=async()=>{var u;d.auto=!0,n.value=null;try{const s=await E({method:"post",url:"/admin/settings",data:{setting:"important_config",value:"new_value"},requireSudo:!0});n.value={success:!0,message:"自动处理sudo的API请求成功",data:s.data}}catch(s){n.value={success:!1,message:s.message,details:(u=s.response)==null?void 0:u.data}}finally{d.auto=!1}};return J(()=>{o.createSudoInterceptor(E)}),(u,s)=>(_(),j("div",ae,[e(F,null,{default:l(()=>[s[9]||(s[9]=B("h2",null,"Sudo管理系统使用示例",-1)),e(c,{class:"mb-4"},{default:l(()=>[e(p,null,{default:l(()=>[...s[0]||(s[0]=[t("基本用法",-1)])]),_:1}),e(g,null,{default:l(()=>[e(f,{onClick:C,color:"primary",loading:d.basic,class:"mr-2"},{default:l(()=>[...s[1]||(s[1]=[t(" 需要Sudo认证的操作 ",-1)])]),_:1},8,["loading"]),e(f,{onClick:w,color:"info",class:"mr-2"},{default:l(()=>[...s[2]||(s[2]=[t(" 检查Sudo状态 ",-1)])]),_:1}),e(f,{onClick:S,color:"warning"},{default:l(()=>[...s[3]||(s[3]=[t(" 清除Sudo Token ",-1)])]),_:1})]),_:1})]),_:1}),e(c,{class:"mb-4"},{default:l(()=>[e(p,null,{default:l(()=>[...s[4]||(s[4]=[t("HTTP请求集成",-1)])]),_:1}),e(g,null,{default:l(()=>[e(f,{onClick:b,color:"primary",loading:d.api,class:"mr-2"},{default:l(()=>[...s[5]||(s[5]=[t(" 发送需要Sudo的API请求 ",-1)])]),_:1},8,["loading"]),e(f,{onClick:v,color:"secondary",loading:d.auto},{default:l(()=>[...s[6]||(s[6]=[t(" 自动处理Sudo的API请求 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),e(c,{class:"mb-4"},{default:l(()=>[e(p,null,{default:l(()=>[...s[7]||(s[7]=[t("当前Sudo状态",-1)])]),_:1}),e(g,null,{default:l(()=>[e(N,{color:r(o).isTokenValid?"success":"error",variant:"tonal",class:"mr-2"},{default:l(()=>[e(O,{icon:r(o).isTokenValid?"mdi-shield-check":"mdi-shield-off",class:"mr-1"},null,8,["icon"]),t(" "+m(r(o).isTokenValid?"已认证":"未认证"),1)]),_:1},8,["color"]),r(o).isTokenValid?(_(),x(N,{key:0,color:"info",variant:"tonal"},{default:l(()=>[t(" 剩余: "+m(r(o).tokenExpiresIn),1)]),_:1})):I("",!0),r(o).isLoading==!0?(_(),x(W,{key:1,indeterminate:"",color:"primary",class:"mt-2"})):I("",!0)]),_:1})]),_:1}),n.value?(_(),x(c,{key:0},{default:l(()=>[e(p,null,{default:l(()=>[...s[8]||(s[8]=[t("操作结果",-1)])]),_:1}),e(g,null,{default:l(()=>[B("pre",null,m(n.value),1)]),_:1})]),_:1})):I("",!0)]),_:1})]))}},oe={class:"sudo-debug"},ue={__name:"SudoDebug",setup(Y){const{requireSudo:o,isSudoValid:d,clearSudo:n,isLoading:C,tokenExpiresIn:w,sudoToken:S,expiresAt:b}=U(),v=z(()=>d()),u=T(!1),s=T(null),V=T({show:!1,text:"",color:"success"}),M=(i,a=!0)=>{V.value={show:!0,text:i,color:a?"success":"error"}},Z=async()=>{try{const i=await o({title:"测试强制认证",subtitle:"这是一个测试用的强制认证对话框",persistent:!0});M("强制认证成功！")}catch(i){M(i.message||"认证失败",!1)}},$=async()=>{var i,a;u.value=!0,s.value=null;try{const k=await E({method:"get",url:"/api/admin/test",requireSudo:!0});s.value={success:!0,message:"请求成功！响应数据："+JSON.stringify(k.data)}}catch(k){s.value={success:!1,message:"请求失败："+(((a=(i=k.response)==null?void 0:i.data)==null?void 0:a.message)||k.message)}}finally{u.value=!1}};return(i,a)=>{const k=G;return _(),j(le,null,[e(te),B("div",oe,[e(k),e(F,null,{default:l(()=>[e(c,{class:"mb-4"},{default:l(()=>[e(p,null,{default:l(()=>[...a[2]||(a[2]=[t("Sudo Token 调试页面",-1)])]),_:1}),e(g,null,{default:l(()=>[e(q,null,{default:l(()=>[e(y,{cols:"12",md:"6"},{default:l(()=>[e(D,null,{default:l(()=>[...a[3]||(a[3]=[t("当前Token状态",-1)])]),_:1}),e(K,null,{default:l(()=>[e(P,null,{default:l(()=>[e(L,null,{default:l(()=>[...a[4]||(a[4]=[t("Token 有效性:",-1)])]),_:1}),e(R,null,{default:l(()=>[e(N,{color:v.value?"success":"error"},{default:l(()=>[t(m(v.value?"有效":"无效"),1)]),_:1},8,["color"])]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(L,null,{default:l(()=>[...a[5]||(a[5]=[t("剩余时间:",-1)])]),_:1}),e(R,null,{default:l(()=>[t(m(r(w))+"秒",1)]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(L,null,{default:l(()=>[...a[6]||(a[6]=[t("过期时间:",-1)])]),_:1}),e(R,null,{default:l(()=>[t(m(r(b)?new Date(r(b)).toLocaleString():"无"),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(y,{cols:"12",md:"6"},{default:l(()=>[e(D,null,{default:l(()=>[...a[7]||(a[7]=[t("当前Token",-1)])]),_:1}),e(se,{modelValue:r(S),"onUpdate:modelValue":a[0]||(a[0]=A=>Q(S)?S.value=A:null),readonly:"",label:"Sudo Token",rows:"3",class:"token-display"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{class:"mb-4"},{default:l(()=>[e(p,null,{default:l(()=>[...a[8]||(a[8]=[t("认证测试",-1)])]),_:1}),e(g,null,{default:l(()=>[e(q,null,{default:l(()=>[e(y,{cols:"12",md:"6"},{default:l(()=>[e(f,{color:"primary",class:"mb-2 me-2",onClick:Z,loading:r(C)},{default:l(()=>[...a[9]||(a[9]=[t(" 测试认证 ",-1)])]),_:1},8,["loading"]),e(f,{color:"error",class:"mb-2",onClick:r(n),disabled:!v.value},{default:l(()=>[...a[10]||(a[10]=[t(" 清除Token ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(p,null,{default:l(()=>[...a[11]||(a[11]=[t("API 测试",-1)])]),_:1}),e(g,null,{default:l(()=>[e(q,null,{default:l(()=>[e(y,{cols:"12",md:"6"},{default:l(()=>[e(f,{color:"info",class:"mb-2 me-2",onClick:$,loading:u.value},{default:l(()=>[...a[12]||(a[12]=[t(" 测试需要Sudo的API请求 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),s.value?(_(),x(h,{key:0,type:s.value.success?"success":"error",class:"mt-4"},{default:l(()=>[t(m(s.value.message),1)]),_:1},8,["type"])):I("",!0)]),_:1})]),_:1})]),_:1}),e(ee,{modelValue:V.value.show,"onUpdate:modelValue":a[1]||(a[1]=A=>V.value.show=A),color:V.value.color,timeout:3e3},{default:l(()=>[t(m(V.value.text),1)]),_:1},8,["modelValue","color"])])],64)}}},ie=X(ue,[["__scopeId","data-v-b832bc29"]]);export{ie as default};
