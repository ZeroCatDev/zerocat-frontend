import{_ as Z,ac as $,Y as q,o as F,N as l,e,Q as h,R as ee,W as k,a9 as y,L as o,i as u,O as v,X as d,S as A,aA as I,$ as B,a3 as m,ah as le,ai as b,a6 as ae,a7 as S,ad as te,ae as c,af as g,ag as D,f as L,aF as oe,aB as ie,aE as p,T as ne,r as s,b as de,a1 as N}from"./index-DYtKgzMm.js";import{V}from"./VSpacer-DFUSiSeK.js";import{V as ue}from"./VDataTable-C_YE0IhX.js";import{V as se}from"./VSelect-C_A-ITaa.js";import{V as re}from"./VTextarea-_V97dJzz.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-BtsUDiUh.js";import"./VSelectionControl-ByDSqZcw.js";import"./VTable-skr2I1jC.js";import"./filter-BSf6S-ZG.js";const fe={name:"CodeRunAdmin",setup(){const O=s([]),a=s(!1),f=s(null),t=s(!1),T=s(!1),w=s(!1),r=s(!1),i=s(0),_=s(!1),J=s(!1),U=s(!1),x=s({request_url:"",status:"",device_config:""}),R=[{title:"设备名称",value:"device_name"},{title:"设备ID",value:"id"},{title:"请求地址",value:"request_url"},{title:"状态",value:"status"},{title:"最后报告",value:"last_report"},{title:"操作",value:"actions",sortable:!1}],W=["active","inactive","error"],C=async()=>{a.value=!0;try{const n=await N.get("/admin/coderun/devices");n.data.success&&(O.value=n.data.devices)}catch(n){console.error("Failed to fetch devices:",n)}finally{a.value=!1}},E=n=>{f.value=n,t.value=!0},M=n=>{f.value=n,x.value={request_url:n.request_url||"",status:n.status||"active",device_config:JSON.stringify(n.device_config||{},null,2)},T.value=!0},Q=n=>{f.value=n,w.value=!0},X=()=>{r.value=!0},Y=async()=>{_.value=!0;try{const n={...x.value,device_config:JSON.parse(x.value.device_config)};(await N.put(`/admin/coderun/devices/${f.value.id}`,n)).data.success&&(await C(),T.value=!1)}catch(n){console.error("Failed to save device config:",n)}finally{_.value=!1}},j=async()=>{J.value=!0;try{(await N.delete(`/admin/coderun/devices/${f.value.id}`)).data.success&&(await C(),w.value=!1)}catch(n){console.error("Failed to delete device:",n)}finally{J.value=!1}},z=async()=>{U.value=!0;try{(await N.delete("/admin/coderun/devices/inactive/all")).data.success&&(await C(),r.value=!1)}catch(n){console.error("Failed to delete all inactive devices:",n)}finally{U.value=!1}},G=n=>{switch(n){case"active":return"success";case"error":return"error";default:return"warning"}},H=n=>n?new Date(n).toLocaleString():"未知",K=n=>{try{return n&&JSON.parse(n),!0}catch{return"请输入有效的 JSON 格式"}};return de(()=>{C()}),{devices:O,loading:a,headers:R,selectedDevice:f,detailsDialog:t,configDialog:T,deleteDialog:w,deleteInactiveDialog:r,activeTab:i,editConfig:x,statusOptions:W,saving:_,deleting:J,deletingInactive:U,refreshDevices:C,openDeviceDetails:E,openDeviceConfig:M,confirmDelete:Q,confirmDeleteInactive:X,saveDeviceConfig:Y,deleteDevice:j,deleteAllInactive:z,getStatusColor:G,formatDateTime:H,validateJson:K}}};function ve(O,a,f,t,T,w){const r=$("v-list-item-content");return F(),q(ne,{fluid:""},{default:l(()=>[e(h,null,{default:l(()=>[e(ee,{cols:"12"},{default:l(()=>[e(k,null,{default:l(()=>[e(y,{class:"d-flex align-center"},{default:l(()=>[a[17]||(a[17]=o(" CodeRun 设备管理 ")),e(V),e(u,{color:"primary",onClick:t.refreshDevices,loading:t.loading},{default:l(()=>[e(v,{left:""},{default:l(()=>a[13]||(a[13]=[o("mdi-refresh")])),_:1,__:[13]}),a[14]||(a[14]=o(" 刷新 "))]),_:1,__:[14]},8,["onClick","loading"]),e(u,{color:"error",class:"ml-2",onClick:t.confirmDeleteInactive,loading:t.loading},{default:l(()=>[e(v,{left:""},{default:l(()=>a[15]||(a[15]=[o("mdi-delete-sweep")])),_:1,__:[15]}),a[16]||(a[16]=o(" 删除所有不活跃设备 "))]),_:1,__:[16]},8,["onClick","loading"])]),_:1,__:[17]}),e(ue,{headers:t.headers,items:t.devices,loading:t.loading,"items-per-page":10,class:"elevation-1"},{"item.status":l(({item:i})=>[e(A,{color:t.getStatusColor(i.status),small:""},{default:l(()=>[o(d(i.status),1)]),_:2},1032,["color"])]),"item.last_report":l(({item:i})=>[o(d(t.formatDateTime(i.last_report)),1)]),"item.actions":l(({item:i})=>[e(u,{icon:"",small:"",onClick:_=>t.openDeviceDetails(i)},{default:l(()=>[e(v,null,{default:l(()=>a[18]||(a[18]=[o("mdi-eye")])),_:1,__:[18]})]),_:2},1032,["onClick"]),e(u,{icon:"",small:"",onClick:_=>t.openDeviceConfig(i)},{default:l(()=>[e(v,null,{default:l(()=>a[19]||(a[19]=[o("mdi-cog")])),_:1,__:[19]})]),_:2},1032,["onClick"]),e(u,{icon:"",small:"",color:"error",onClick:_=>t.confirmDelete(i)},{default:l(()=>[e(v,null,{default:l(()=>a[20]||(a[20]=[o("mdi-delete")])),_:1,__:[20]})]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1}),e(I,{modelValue:t.detailsDialog,"onUpdate:modelValue":a[3]||(a[3]=i=>t.detailsDialog=i),"max-width":"800px"},{default:l(()=>[t.selectedDevice?(F(),q(k,{key:0},{default:l(()=>[e(y,null,{default:l(()=>[o(" 设备详情: "+d(t.selectedDevice.device_name)+" ",1),e(V),e(u,{icon:"",onClick:a[0]||(a[0]=i=>t.detailsDialog=!1)},{default:l(()=>[e(v,null,{default:l(()=>a[21]||(a[21]=[o("mdi-close")])),_:1,__:[21]})]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(le,{modelValue:t.activeTab,"onUpdate:modelValue":a[1]||(a[1]=i=>t.activeTab=i)},{default:l(()=>[e(b,{value:"basic-info"},{default:l(()=>a[22]||(a[22]=[o("基本信息")])),_:1,__:[22]}),e(b,{value:"docker-info"},{default:l(()=>a[23]||(a[23]=[o("Docker 信息")])),_:1,__:[23]}),e(b,{value:"system-info"},{default:l(()=>a[24]||(a[24]=[o("系统信息")])),_:1,__:[24]}),e(b,{value:"runtime-info"},{default:l(()=>a[25]||(a[25]=[o("运行时信息")])),_:1,__:[25]})]),_:1},8,["modelValue"]),e(ae,{modelValue:t.activeTab,"onUpdate:modelValue":a[2]||(a[2]=i=>t.activeTab=i)},{default:l(()=>[e(S,{value:"basic-info"},{default:l(()=>[e(te,null,{default:l(()=>[e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[26]||(a[26]=[o("设备 ID")])),_:1,__:[26]}),e(D,null,{default:l(()=>[o(d(t.selectedDevice.id),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[27]||(a[27]=[o("设备名称")])),_:1,__:[27]}),e(D,null,{default:l(()=>[o(d(t.selectedDevice.device_name),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[28]||(a[28]=[o("状态")])),_:1,__:[28]}),e(D,null,{default:l(()=>[e(A,{color:t.getStatusColor(t.selectedDevice.status),small:""},{default:l(()=>[o(d(t.selectedDevice.status),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[29]||(a[29]=[o("创建时间")])),_:1,__:[29]}),e(D,null,{default:l(()=>[o(d(t.formatDateTime(t.selectedDevice.created_at)),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[30]||(a[30]=[o("最后更新")])),_:1,__:[30]}),e(D,null,{default:l(()=>[o(d(t.formatDateTime(t.selectedDevice.updated_at)),1)]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(r,null,{default:l(()=>[e(g,null,{default:l(()=>a[31]||(a[31]=[o("最后报告")])),_:1,__:[31]}),e(D,null,{default:l(()=>[o(d(t.formatDateTime(t.selectedDevice.last_report)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{value:"docker-info"},{default:l(()=>[e(m,null,{default:l(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.docker_info,null,2)),1)]),_:1})]),_:1}),e(S,{value:"system-info"},{default:l(()=>[e(m,null,{default:l(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.system_info,null,2)),1)]),_:1})]),_:1}),e(S,{value:"runtime-info"},{default:l(()=>[e(m,null,{default:l(()=>[L("pre",null,d(JSON.stringify(t.selectedDevice.coderun_info,null,2)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"]),e(I,{modelValue:t.configDialog,"onUpdate:modelValue":a[8]||(a[8]=i=>t.configDialog=i),"max-width":"600px"},{default:l(()=>[t.selectedDevice?(F(),q(k,{key:0},{default:l(()=>[e(y,null,{default:l(()=>[o(" 设备配置: "+d(t.selectedDevice.device_name)+" ",1),e(V),e(u,{icon:"",onClick:a[4]||(a[4]=i=>t.configDialog=!1)},{default:l(()=>[e(v,null,{default:l(()=>a[32]||(a[32]=[o("mdi-close")])),_:1,__:[32]})]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(oe,{ref:"configForm"},{default:l(()=>[e(ie,{modelValue:t.editConfig.request_url,"onUpdate:modelValue":a[5]||(a[5]=i=>t.editConfig.request_url=i),label:"请求 URL",required:""},null,8,["modelValue"]),e(se,{modelValue:t.editConfig.status,"onUpdate:modelValue":a[6]||(a[6]=i=>t.editConfig.status=i),items:t.statusOptions,label:"状态",required:""},null,8,["modelValue","items"]),e(re,{modelValue:t.editConfig.device_config,"onUpdate:modelValue":a[7]||(a[7]=i=>t.editConfig.device_config=i),label:"设备配置 (JSON)",rows:"10",rules:[t.validateJson]},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(p,null,{default:l(()=>[e(V),e(u,{color:"primary",onClick:t.saveDeviceConfig,loading:t.saving},{default:l(()=>a[33]||(a[33]=[o(" 保存 ")])),_:1,__:[33]},8,["onClick","loading"])]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"]),e(I,{modelValue:t.deleteDialog,"onUpdate:modelValue":a[10]||(a[10]=i=>t.deleteDialog=i),"max-width":"400px"},{default:l(()=>[e(k,null,{default:l(()=>[e(y,null,{default:l(()=>a[34]||(a[34]=[o("确认删除")])),_:1,__:[34]}),e(m,null,{default:l(()=>{var i;return[o(' 确定要删除设备 "'+d((i=t.selectedDevice)==null?void 0:i.device_name)+'" 吗？此操作无法撤销。 ',1)]}),_:1}),e(p,null,{default:l(()=>[e(V),e(u,{text:"",onClick:a[9]||(a[9]=i=>t.deleteDialog=!1)},{default:l(()=>a[35]||(a[35]=[o(" 取消 ")])),_:1,__:[35]}),e(u,{color:"error",onClick:t.deleteDevice,loading:t.deleting},{default:l(()=>a[36]||(a[36]=[o(" 删除 ")])),_:1,__:[36]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:t.deleteInactiveDialog,"onUpdate:modelValue":a[12]||(a[12]=i=>t.deleteInactiveDialog=i),"max-width":"400px"},{default:l(()=>[e(k,null,{default:l(()=>[e(y,null,{default:l(()=>a[37]||(a[37]=[o("确认批量删除")])),_:1,__:[37]}),e(m,null,{default:l(()=>a[38]||(a[38]=[o(" 确定要删除所有不活跃的设备吗？此操作无法撤销。 ")])),_:1,__:[38]}),e(p,null,{default:l(()=>[e(V),e(u,{text:"",onClick:a[11]||(a[11]=i=>t.deleteInactiveDialog=!1)},{default:l(()=>a[39]||(a[39]=[o(" 取消 ")])),_:1,__:[39]}),e(u,{color:"error",onClick:t.deleteAllInactive,loading:t.deletingInactive},{default:l(()=>a[40]||(a[40]=[o(" 删除 ")])),_:1,__:[40]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const we=Z(fe,[["render",ve],["__scopeId","data-v-2517ded4"]]);export{we as default};
