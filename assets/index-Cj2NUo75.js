import{f as H,p as K,i as Q,a as s,A as j,k as q,_ as J,R as i,al as W,r as I,e as V,o as m,w as t,ac as L,G as w,a3 as x,c as k,a8 as X,a0 as B,M as O,N as T,L as P,a1 as b,H as c,O as f,a2 as Y,I as $,K as N,Q as _,S as U}from"./index-BTO7MRDj.js";import{_ as Z}from"./verifyEmail-BMj-54n-.js";import{V as ee}from"./VAlert-F-qzeG5Z.js";import"./VSpacer-Rxooc2g0.js";/* empty css              */import"./VDialog-BTS7m_Kv.js";const ae=K({start:Boolean,end:Boolean,...q(),...j()},"VListItemAction"),E=H()({name:"VListItemAction",props:ae(),setup(d,p){let{slots:o}=p;return Q(()=>s(d.tag,{class:["v-list-item-action",{"v-list-item-action--start":d.start,"v-list-item-action--end":d.end},d.class],style:d.style},o)),{}}}),te={class:"oauth-binding"},se={__name:"index",setup(d){const p=i([]),o=i(""),r=i("info"),y=i(!1),g=i(""),h=i(""),A=i([]),S="https://zerocat-api.houlangs.com",C=async()=>{var l,e;try{const a=await _.post("/account/oauth/bound",{userid:U.user.value.id});a.data.status==="success"?p.value=a.data.data:(o.value=a.data.message,r.value="error")}catch(a){o.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"获取绑定的 OAuth 账号失败",r.value="error"}},D=async()=>{var l,e;try{const a=await _.get("/account/emails");if(a.data.status==="success"){const n=a.data.data.find(v=>v.is_primary);n&&(g.value=n.contact_value)}else o.value=a.data.message,r.value="error"}catch(a){o.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"获取邮箱列表失败",r.value="error"}},F=async()=>{var l,e;try{const a=await _.get("/account/oauth/providers");a.data.status==="success"?A.value=a.data.data:(o.value=a.data.message,r.value="error")}catch(a){o.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"获取可绑定的 OAuth 提供商失败",r.value="error"}},M=(l,e)=>{h.value=e,y.value=!0},R=async l=>{var e,a;try{const u=await _.post("/account/confirm-unlink-oauth",{email:g.value,code:l,provider:h.value});u.data.status==="success"?(o.value="成功解绑 OAuth 账号",r.value="success",C()):(o.value=u.data.message||"解绑失败",r.value="error")}catch(u){o.value=((a=(e=u.response)==null?void 0:e.data)==null?void 0:a.message)||"解绑 OAuth 账号失败",r.value="error"}},z=l=>{window.location.href=`${S}/account/oauth/${l}?token=${U.getToken()}`};return W(()=>{C(),D(),F()}),(l,e)=>{const a=I("v-list-item-content"),u=I("v-list-item-group");return m(),V("div",te,[s(N,null,{default:t(()=>[s(L,null,{default:t(()=>e[1]||(e[1]=[w("h2",null,"已绑定的 OAuth 账号",-1)])),_:1}),s(x,null,{default:t(()=>[s(B,null,{default:t(()=>[s(u,null,{default:t(()=>[(m(!0),V(O,null,T(p.value,(n,v)=>(m(),k(P,{key:v},{default:t(()=>[s(a,null,{default:t(()=>[s(b,null,{default:t(()=>[c(f(n.contact_value),1)]),_:2},1024),s(Y,null,{default:t(()=>[c(f(n.contact_type),1)]),_:2},1024)]),_:2},1024),s(E,null,{default:t(()=>[s($,{onClick:G=>M(n.contact_value,n.contact_type),color:"red"},{default:t(()=>e[2]||(e[2]=[c("解绑")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o.value?(m(),k(ee,{key:0,type:r.value},{default:t(()=>[c(f(o.value),1)]),_:1},8,["type"])):X("",!0)]),_:1})]),_:1}),s(Z,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),email:g.value,onVerified:R},null,8,["modelValue","email"]),s(N,{class:"mt-4"},{default:t(()=>[s(L,null,{default:t(()=>e[3]||(e[3]=[w("h2",null,"可绑定的 OAuth 提供商",-1)])),_:1}),s(x,null,{default:t(()=>[e[5]||(e[5]=c(" 绑定提供商是按照邮箱验证的，也就是说你需要先将你的邮箱绑定到账户才会将这个登录提供商的oauth绑定到账户。 ")),s(B,null,{default:t(()=>[(m(!0),V(O,null,T(A.value,(n,v)=>(m(),k(P,{key:v},{default:t(()=>[s(a,null,{default:t(()=>[s(b,null,{default:t(()=>[c(f(n.name),1)]),_:2},1024)]),_:2},1024),s(E,null,{default:t(()=>[s($,{onClick:G=>z(n.id),color:"primary"},{default:t(()=>e[4]||(e[4]=[c("绑定")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})])}}},ce=J(se,[["__scopeId","data-v-fd88a7a1"]]);export{ce as default};
