import{_ as W}from"./ProjectSelector-DziYG9V5.js";import{_ as Y,a1 as V,aa as S,Y as p,o as m,N as t,e as s,W as _,a9 as g,L as i,O as x,a3 as b,aE as K,Q as I,R as j,ad as R,aY as $,aZ as ee,$ as v,ae as O,X as d,af as Z,c as w,aA as M,aW as te,i as f,ac as se,F as le,U as oe,D as ie,f as r,Z as z,n as L,aT as D,aV as P,a5 as ne,aD as H,az as Q,a4 as ae,T as E,S as C,a0 as re,aS as de,M as me,a$ as ue}from"./index-NKeTyzEk.js";import{V as ce}from"./VSelect-CLBac9jt.js";import{V as pe,a as G}from"./VRadioGroup-BNW7nWIB.js";import{V as fe}from"./VSwitch-DAnNvCOL.js";import{V as T}from"./VSpacer-pgfRTz1s.js";import{_ as X}from"./TimeAgo-CXIdpKXu.js";import{a as ge,V as U}from"./VTimeline-exnX1iov.js";import"https://static.geetest.com/v4/gt4.js";import"./VCheckboxBtn-CPEXDlsO.js";import"./VSelectionControl-BgzZZir8.js";const xe={name:"ExtensionEditDialog",components:{ProjectSelector:W},props:{modelValue:{type:Boolean,default:!1},extension:{type:Object,default:null}},emits:["update:modelValue","updated"],data(){return{formValid:!1,loading:!1,loadingCommits:!1,localuser:S,form:{branch:"",commit:"",image:"",samples:null,docs:"",scratchCompatible:!1},useLatestCommit:!0,imageMode:"project",commits:[],branches:[],myProjects:[],selectedSampleProject:null,selectedSampleProjectId:null}},computed:{dialog:{get(){return this.modelValue},set(o){this.$emit("update:modelValue",o)}},previewImage(){return this.imageMode==="project"?null:this.form.image?S.getUserAvatar(this.form.image):null}},watch:{async modelValue(o){o&&this.extension&&await this.initializeForm()},useLatestCommit(o){o?this.form.commit="":this.fetchCommits()},selectedSampleProjectId:{handler(o){o&&this.loadSampleProject(o)},immediate:!0}},async created(){await this.fetchMyProjects()},methods:{async initializeForm(){this.extension&&(this.form={branch:this.extension.branch||"",commit:this.extension.commit||"",image:this.extension.image||"",samples:this.extension.samples||null,docs:this.extension.docs||"",scratchCompatible:this.extension.scratchCompatible||!1},this.useLatestCommit=!this.extension.commit||this.extension.commit==="latest",this.imageMode=this.extension.image?"custom":"project",this.extension.sample_project&&(this.selectedSampleProject=this.extension.sample_project),await this.fetchBranches())},async fetchMyProjects(){try{const o=await V.get("/searchapi",{params:{search_userid:S.user.value.id,search_state:"public",limit:100}});o.data&&o.data.projects&&(this.myProjects=o.data.projects)}catch(o){console.error("Failed to fetch my projects:",o)}},async fetchBranches(){var o,e;if((e=(o=this.extension)==null?void 0:o.project)!=null&&e.id)try{const u=await V.get(`/project/branches?projectid=${this.extension.project.id}`);u.data.status==="success"?this.branches=u.data.data||[]:(console.error("加载分支列表失败:",u.data.message),this.branches=[])}catch(u){console.error("Failed to fetch branches:",u),this.branches=[]}},async fetchCommits(){var o,e;if((e=(o=this.extension)==null?void 0:o.project)!=null&&e.id){this.loadingCommits=!0;try{const u=await V.get(`/project/commits?projectid=${this.extension.project.id}&branch=${this.form.branch||"main"}`);u.data.status==="success"?(this.commits=u.data.data||[],this.commits=this.commits.map(y=>({...y,id:y.hash||y.id||"unknown",commit_message:y.message||y.commit_message||"无提交信息",date:y.date||new Date().toISOString(),author:y.author||{username:"未知用户"}}))):(console.error("加载提交历史失败:",u.data.message),this.commits=[])}catch(u){console.error("Failed to fetch commits:",u),this.commits=[]}finally{this.loadingCommits=!1}}},selectCommit(o){this.form.commit=o.id},async onBranchChange(){this.useLatestCommit||await this.fetchCommits()},async loadSampleProject(o){try{const u=(await V.post("/project/batch",{projectIds:[o]})).data.data||[];u.length>0&&(this.selectedSampleProject=u[0],this.form.samples=o)}catch(e){console.error("Failed to load sample project:",e)}},selectSampleProject(o){this.selectedSampleProject=o,this.form.samples=o.id,this.showProjectSelector=!1},clearSampleProject(){this.selectedSampleProject=null,this.selectedSampleProjectId=null,this.form.samples=null},async saveExtension(){if(this.extension){this.loading=!0;try{const o={...this.form.branch&&{branch:this.form.branch},...this.form.docs&&{docs:this.form.docs},...this.form.scratchCompatible!==void 0&&{scratchCompatible:this.form.scratchCompatible}};this.useLatestCommit?o.commit="latest":this.form.commit&&(o.commit=this.form.commit),this.imageMode==="project"||this.form.image&&(o.image=this.form.image),this.form.samples&&(o.samples=this.form.samples);const e=await V.put(`/extensions/manager/edit/${this.extension.id}`,o);e.data.status==="success"?(this.$emit("updated"),this.closeDialog(),this.showMessage("扩展更新成功","success")):this.showMessage(e.data.message||"更新失败","error")}catch(o){console.error("Failed to update extension:",o),this.showMessage("更新扩展失败","error")}finally{this.loading=!1}}},closeDialog(){this.dialog=!1},showMessage(o,e){console.log(o)}}},_e={key:0,class:"mt-3"},he={class:"d-flex align-center mt-4"},ve={class:"text-caption text-grey"},be={class:"d-flex align-center mb-3"},ye={key:0,class:"selected-project"},Ve={key:1,class:"text-center py-4 text-grey"},Ce={class:"text-caption text-grey"};function je(o,e,u,y,l,c){const k=W;return m(),p(Q,{modelValue:c.dialog,"onUpdate:modelValue":e[11]||(e[11]=a=>c.dialog=a),"max-width":"800",persistent:""},{default:t(()=>[s(_,null,{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[12]||(e[12]=[i("mdi-pencil",-1)])),_:1,__:[12]}),e[13]||(e[13]=i(" 编辑扩展 ",-1))]),_:1,__:[13]}),s(b,null,{default:t(()=>[s(K,{ref:"form",modelValue:l.formValid,"onUpdate:modelValue":e[10]||(e[10]=a=>l.formValid=a)},{default:t(()=>[s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>e[14]||(e[14]=[i("基本信息",-1)])),_:1,__:[14]}),s(b,null,{default:t(()=>[s(I,null,{default:t(()=>[s(j,{cols:"12",md:"6"},{default:t(()=>[s(ce,{modelValue:l.form.branch,"onUpdate:modelValue":[e[0]||(e[0]=a=>l.form.branch=a),c.onBranchChange],label:"分支名称",placeholder:"选择分支","prepend-inner-icon":"mdi-source-branch",variant:"outlined",density:"compact",items:l.branches,"item-title":"name","item-value":"name"},{item:t(({props:a,item:n})=>[s(R,$(ee(a)),{prepend:t(()=>[s(x,{size:"small"},{default:t(()=>e[15]||(e[15]=[i("mdi-source-branch",-1)])),_:1,__:[15]})]),default:t(()=>[s(O,null,{default:t(()=>[i(d(n.raw.name),1)]),_:2},1024),n.raw.description?(m(),p(Z,{key:0},{default:t(()=>[i(d(n.raw.description),1)]),_:2},1024)):v("",!0)]),_:2},1040)]),_:1},8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(j,{cols:"12",md:"6"},{default:t(()=>[s(M,{modelValue:l.form.commit,"onUpdate:modelValue":e[1]||(e[1]=a=>l.form.commit=a),label:"提交ID",placeholder:"留空或latest使用最新提交","prepend-inner-icon":"mdi-source-commit",variant:"outlined",density:"compact",readonly:l.useLatestCommit},null,8,["modelValue","readonly"]),s(te,{modelValue:l.useLatestCommit,"onUpdate:modelValue":e[4]||(e[4]=a=>l.useLatestCommit=a),class:"mt-2",variant:"outlined",density:"compact",divided:""},{default:t(()=>[s(f,{variant:l.useLatestCommit?"flat":"outlined",color:l.useLatestCommit?"primary":void 0,size:"small",onClick:e[2]||(e[2]=a=>l.useLatestCommit=!0)},{default:t(()=>e[16]||(e[16]=[i(" 最新 ",-1)])),_:1,__:[16]},8,["variant","color"]),s(f,{variant:l.useLatestCommit?"outlined":"flat",color:l.useLatestCommit?void 0:"primary",size:"small",onClick:e[3]||(e[3]=a=>l.useLatestCommit=!1)},{default:t(()=>e[17]||(e[17]=[i(" 指定 ",-1)])),_:1,__:[17]},8,["variant","color"])]),_:1},8,["modelValue"]),!l.useLatestCommit&&l.commits.length>0?(m(),w("div",_e,[s(se,{density:"compact","max-height":"200",class:"overflow-y-auto",variant:"outlined"},{default:t(()=>[(m(!0),w(le,null,oe(l.commits,a=>(m(),p(R,{key:a.id,onClick:n=>c.selectCommit(a),active:l.form.commit===a.id,class:ie({"v-list-item--active":l.form.commit===a.id})},{prepend:t(()=>[s(x,{size:"small"},{default:t(()=>e[18]||(e[18]=[i("mdi-source-commit",-1)])),_:1,__:[18]})]),default:t(()=>[s(O,{class:"text-caption"},{default:t(()=>[i(d(a.id.substring(0,8)),1)]),_:2},1024),s(Z,{class:"text-caption"},{default:t(()=>[i(d(a.commit_message||"无提交信息"),1)]),_:2},1024)]),_:2},1032,["onClick","active","class"]))),128))]),_:1})])):v("",!0),l.useLatestCommit?v("",!0):(m(),p(f,{key:1,variant:"outlined",size:"small",class:"mt-2","prepend-icon":"mdi-refresh",onClick:c.fetchCommits,loading:l.loadingCommits},{default:t(()=>e[19]||(e[19]=[i(" 刷新提交列表 ",-1)])),_:1,__:[19]},8,["onClick","loading"]))]),_:1}),s(j,{cols:"12"},{default:t(()=>[s(M,{modelValue:l.form.docs,"onUpdate:modelValue":e[5]||(e[5]=a=>l.form.docs=a),label:"文档路径",placeholder:"/docs/extension","prepend-inner-icon":"mdi-book-open-variant",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>e[20]||(e[20]=[i("扩展图标",-1)])),_:1,__:[20]}),s(b,null,{default:t(()=>[s(pe,{modelValue:l.imageMode,"onUpdate:modelValue":e[6]||(e[6]=a=>l.imageMode=a),inline:""},{default:t(()=>[s(G,{label:"跟随项目",value:"project"}),s(G,{label:"自定义图标",value:"custom"})]),_:1},8,["modelValue"]),l.imageMode==="custom"?(m(),p(M,{key:0,modelValue:l.form.image,"onUpdate:modelValue":e[7]||(e[7]=a=>l.form.image=a),label:"图标文件名",placeholder:"icon.png","prepend-inner-icon":"mdi-image",variant:"outlined",density:"compact",class:"mt-2"},null,8,["modelValue"])):v("",!0),r("div",he,[s(z,{size:"48",class:"mr-3"},{default:t(()=>[c.previewImage?(m(),p(L,{key:0,src:c.previewImage},null,8,["src"])):(m(),p(x,{key:1,size:"24"},{default:t(()=>e[21]||(e[21]=[i("mdi-puzzle",-1)])),_:1,__:[21]}))]),_:1}),r("div",null,[e[22]||(e[22]=r("div",{class:"text-body-2"},"预览",-1)),r("div",ve,d(l.imageMode==="project"?"使用项目默认图标":l.form.image||"默认图标"),1)])])]),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>e[23]||(e[23]=[i("示例项目",-1)])),_:1,__:[23]}),s(b,null,{default:t(()=>[r("div",be,[s(k,{modelValue:l.selectedSampleProjectId,"onUpdate:modelValue":e[8]||(e[8]=a=>l.selectedSampleProjectId=a),multiple:!1,author:"me"},{default:t(()=>[s(f,{class:"ml-2",variant:"outlined"},{default:t(()=>e[24]||(e[24]=[i(" 选择 ",-1)])),_:1,__:[24]})]),_:1},8,["modelValue"])]),l.selectedSampleProject?(m(),w("div",ye,[s(_,{variant:"outlined",class:"mb-2"},{default:t(()=>[s(D,null,{prepend:t(()=>[s(z,null,{default:t(()=>{var a;return[s(L,{src:l.localuser.getUserAvatar((a=l.selectedSampleProject.author)==null?void 0:a.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(g,{class:"text-subtitle-2"},{default:t(()=>[i(d(l.selectedSampleProject.title),1)]),_:1}),s(P,null,{default:t(()=>{var a,n;return[i("by "+d(((a=l.selectedSampleProject.author)==null?void 0:a.display_name)||((n=l.selectedSampleProject.author)==null?void 0:n.username)),1)]}),_:1})]),_:1})]),_:1}),s(f,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-close",onClick:c.clearSampleProject},{default:t(()=>e[25]||(e[25]=[i(" 移除示例项目 ",-1)])),_:1,__:[25]},8,["onClick"])])):(m(),w("div",Ve,[s(x,{size:"48"},{default:t(()=>e[26]||(e[26]=[i("mdi-file-document-outline",-1)])),_:1,__:[26]}),e[27]||(e[27]=r("p",{class:"mt-2"},"未选择示例项目",-1))]))]),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:"",class:"mb-4"},{default:t(()=>[s(g,{class:"text-subtitle-1"},{default:t(()=>[s(x,{class:"mr-2",color:"orange"},{default:t(()=>e[28]||(e[28]=[i("mdi-puzzle",-1)])),_:1,__:[28]}),e[29]||(e[29]=i(" Scratch兼容性 ",-1))]),_:1,__:[29]}),s(b,null,{default:t(()=>[s(ne,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:t(()=>e[30]||(e[30]=[i(" 选择此扩展是否兼容原版Scratch平台。兼容原版Scratch的扩展可以在Scratch项目中使用。 ",-1)])),_:1,__:[30]}),s(fe,{modelValue:l.form.scratchCompatible,"onUpdate:modelValue":e[9]||(e[9]=a=>l.form.scratchCompatible=a),label:"兼容原版Scratch",color:"orange","hide-details":"",class:"mb-2"},null,8,["modelValue"]),r("div",Ce,d(l.form.scratchCompatible?"此扩展将可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(H,null,{default:t(()=>[s(T),s(f,{onClick:c.closeDialog},{default:t(()=>e[31]||(e[31]=[i("取消",-1)])),_:1,__:[31]},8,["onClick"]),s(f,{color:"primary",loading:l.loading,onClick:c.saveExtension},{default:t(()=>e[32]||(e[32]=[i(" 保存 ",-1)])),_:1,__:[32]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const q=Y(xe,[["render",je],["__scopeId","data-v-578f35f1"]]),ke={name:"ExtensionDetail",components:{TimeAgo:X,ExtensionEditDialog:q},data(){return{loading:!0,extension:null,s3BucketUrl:"",showEditDialog:!1,showDeleteDialog:!1,deleteLoading:!1,snackbar:{show:!1,message:"",color:"success"},submitLoading:!1,updateLoading:!1,localuser:S}},async created(){if(S.isLogin.value===!1){this.$router.push("/app/account/login");return}this.s3BucketUrl=ue("s3.staticurl"),await this.fetchExtension()},methods:{async fetchExtension(){var o;this.loading=!0;try{const e=this.$route.params.id,u=await V.get(`/extensions/manager/${e}`);u.data.status==="success"?(this.extension=u.data.data,me({title:`${((o=this.extension.project)==null?void 0:o.title)||"扩展"} - ZeroCat`})):this.extension=null}catch(e){console.error("Failed to fetch extension:",e),this.extension=null}finally{this.loading=!1}},async deleteExtension(){if(this.extension){this.deleteLoading=!0;try{const o=await V.delete(`/extensions/manager/${this.extension.id}`);o.data.status==="success"?(this.showMessage("删除扩展成功","success"),this.$router.push("/app/extensions")):this.showMessage(o.data.message||"删除扩展失败","error")}catch(o){console.error("Failed to delete extension:",o),this.showMessage("删除扩展失败","error")}finally{this.deleteLoading=!1,this.showDeleteDialog=!1}}},async submitExtension(){if(this.extension){this.submitLoading=!0;try{const o=await V.post(`/extensions/manager/submit/${this.extension.id}`);o.data.status==="success"?(this.showMessage("推送成功","success"),await this.fetchExtension()):this.showMessage(o.data.message||"推送失败","error")}catch(o){console.error("Failed to submit extension:",o),this.showMessage("推送失败","error")}finally{this.submitLoading=!1}}},async updateToLatestCommit(){if(this.extension){this.updateLoading=!0;try{const o=await V.post(`/extensions/manager/update/${this.extension.id}`);o.data.status==="success"?(this.showMessage("更新成功","success"),await this.fetchExtension()):this.showMessage(o.data.message||"更新失败","error")}catch(o){console.error("Failed to update commit:",o),this.showMessage("更新失败","error")}finally{this.updateLoading=!1}}},getStatusColor(o){return{developing:"primary",pending:"warning",verified:"success",rejected:"error"}[o]||"grey"},getStatusText(o){return{developing:"开发中",pending:"待审核",verified:"已审核",rejected:"已拒绝"}[o]||"未知"},showMessage(o,e="success"){this.snackbar={show:!0,message:o,color:e}}}},we={class:"d-flex flex-wrap ga-2"},Se={class:"mb-4"},ze={class:"mb-4"},Le={class:"d-flex align-center"},De={class:"mb-4"},Pe={class:"d-flex align-center"},Me={class:"mb-4"},Ee={class:"d-flex align-center"},Ue={key:0,class:"mb-4"},Ie={class:"mb-4"},Te={class:"text-caption text-grey mt-1"},Fe={class:"mb-3"},Be={class:"d-flex flex-wrap ga-2"},Ae={class:"text-caption text-grey"},Ne={class:"text-caption text-grey"},Re={class:"mb-1"};function Oe(o,e,u,y,l,c){const k=X,a=q;return m(),w("div",null,[l.loading?(m(),p(E,{key:0,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:t(()=>[s(ae,{indeterminate:"",size:"64"})]),_:1})):l.extension?(m(),p(E,{key:1},{default:t(()=>[s(I,null,{default:t(()=>[s(j,{cols:"12",lg:"8",md:"8",sm:"12"},{default:t(()=>[s(_,{class:"mb-4",variant:"flat"},{default:t(()=>[s(D,null,{prepend:t(()=>[s(z,{size:"64"},{default:t(()=>[l.extension.image?(m(),p(L,{key:0,src:l.s3BucketUrl+"/extension/"+l.extension.image},null,8,["src"])):(m(),p(x,{key:1,size:"32"},{default:t(()=>e[6]||(e[6]=[i("mdi-puzzle",-1)])),_:1,__:[6]}))]),_:1})]),append:t(()=>[s(C,{color:c.getStatusColor(l.extension.status),size:"large",variant:"flat"},{default:t(()=>[i(d(c.getStatusText(l.extension.status)),1)]),_:1},8,["color"])]),default:t(()=>[s(g,{class:"text-h4"},{default:t(()=>{var n;return[i(d(((n=l.extension.project)==null?void 0:n.title)||"扩展"),1)]}),_:1}),s(P,{class:"text-h6 mt-2"},{default:t(()=>{var n;return[i(d(((n=l.extension.project)==null?void 0:n.description)||"扩展"),1)]}),_:1})]),_:1})]),_:1}),s(_,{class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(b,null,{default:t(()=>{var n,h,F,B,A,N;return[r("div",we,[s(f,{color:"primary","prepend-icon":"mdi-pencil",variant:"elevated",onClick:e[0]||(e[0]=J=>l.showEditDialog=!0)},{default:t(()=>e[7]||(e[7]=[i(" 编辑 ",-1)])),_:1,__:[7]}),l.extension.status==="developing"?(m(),p(f,{key:0,color:"success","prepend-icon":"mdi-upload",variant:"elevated",loading:l.submitLoading,onClick:c.submitExtension},{default:t(()=>e[8]||(e[8]=[i(" 推送 ",-1)])),_:1,__:[8]},8,["loading","onClick"])):v("",!0),s(f,{"prepend-icon":"mdi-open-in-new",variant:"outlined",to:`/${(h=(n=l.extension.project)==null?void 0:n.author)==null?void 0:h.username}/${(F=l.extension.project)==null?void 0:F.name}`},{default:t(()=>e[9]||(e[9]=[i(" 查看项目 ",-1)])),_:1,__:[9]},8,["to"]),l.extension.sample_project?(m(),p(f,{key:1,"prepend-icon":"mdi-file-document",variant:"outlined",to:`/${(A=(B=l.extension.sample_project)==null?void 0:B.author)==null?void 0:A.username}/${(N=l.extension.sample_project)==null?void 0:N.name}`},{default:t(()=>e[10]||(e[10]=[i(" 查看示例项目 ",-1)])),_:1,__:[10]},8,["to"])):v("",!0),s(T),s(f,{color:"error","prepend-icon":"mdi-delete",variant:"outlined",onClick:e[1]||(e[1]=J=>l.showDeleteDialog=!0)},{default:t(()=>e[11]||(e[11]=[i(" 删除 ",-1)])),_:1,__:[11]})])]}),_:1})]),_:1}),s(_,{variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[12]||(e[12]=[i("mdi-information",-1)])),_:1,__:[12]}),e[13]||(e[13]=i(" 扩展信息 ",-1))]),_:1,__:[13]}),s(b,null,{default:t(()=>[s(I,null,{default:t(()=>[s(j,{cols:"12",md:"6"},{default:t(()=>[r("div",Se,[e[14]||(e[14]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"分支",-1)),s(C,{"prepend-icon":"mdi-source-branch",variant:"tonal"},{default:t(()=>[i(d(l.extension.branch||"main"),1)]),_:1})]),r("div",ze,[e[16]||(e[16]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"提交ID",-1)),r("div",Le,[s(C,{"prepend-icon":"mdi-source-commit",variant:"tonal"},{default:t(()=>{var n;return[i(d(((n=l.extension.commit)==null?void 0:n.substring(0,8))||"latest"),1)]}),_:1}),l.extension.commit&&l.extension.commit!=="latest"?(m(),p(f,{key:0,size:"small",variant:"text","prepend-icon":"mdi-refresh",loading:l.updateLoading,onClick:c.updateToLatestCommit,class:"ml-2"},{default:t(()=>e[15]||(e[15]=[i(" 更新到最新 ",-1)])),_:1,__:[15]},8,["loading","onClick"])):v("",!0)])])]),_:1}),s(j,{cols:"12",md:"6"},{default:t(()=>[r("div",De,[e[18]||(e[18]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"创建时间",-1)),r("div",Pe,[s(x,{class:"mr-1",size:"small"},{default:t(()=>e[17]||(e[17]=[i("mdi-clock",-1)])),_:1,__:[17]}),s(k,{date:l.extension.created_at},null,8,["date"])])]),r("div",Me,[e[20]||(e[20]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"更新时间",-1)),r("div",Ee,[s(x,{class:"mr-1",size:"small"},{default:t(()=>e[19]||(e[19]=[i("mdi-clock",-1)])),_:1,__:[19]}),s(k,{date:l.extension.updated_at},null,8,["date"])])])]),_:1})]),_:1}),s(re,{class:"my-4"}),l.extension.docs?(m(),w("div",Ue,[e[21]||(e[21]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-2"},"文档",-1)),s(C,{"prepend-icon":"mdi-book-open-variant",variant:"tonal"},{default:t(()=>[i(d(l.extension.docs),1)]),_:1})])):v("",!0),r("div",Ie,[e[22]||(e[22]=r("div",{class:"text-subtitle-2 text-grey-darken-1 mb-2"},"Scratch兼容性",-1)),s(C,{color:l.extension.scratchCompatible?"orange":"grey","prepend-icon":"mdi-puzzle",variant:"tonal"},{default:t(()=>[i(d(l.extension.scratchCompatible?"兼容原版Scratch":"不兼容原版Scratch"),1)]),_:1},8,["color"]),r("p",Te,d(l.extension.scratchCompatible?"此扩展可以在Scratch项目中使用":"此扩展仅适用于其他平台"),1)])]),_:1})]),_:1})]),_:1}),s(j,{cols:"12",lg:"4",md:"4",sm:"12"},{default:t(()=>[l.extension.project?(m(),p(_,{key:0,class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[23]||(e[23]=[i("mdi-folder",-1)])),_:1,__:[23]}),e[24]||(e[24]=i(" 项目 ",-1))]),_:1,__:[24]}),s(D,null,{prepend:t(()=>[s(z,null,{default:t(()=>{var n;return[s(L,{src:l.localuser.getUserAvatar((n=l.extension.project.author)==null?void 0:n.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(g,null,{default:t(()=>[i(d(l.extension.project.title),1)]),_:1}),s(P,null,{default:t(()=>{var n,h;return[i("by "+d(((n=l.extension.project.author)==null?void 0:n.display_name)||((h=l.extension.project.author)==null?void 0:h.username)),1)]}),_:1})]),_:1}),s(b,null,{default:t(()=>[r("p",Fe,d(l.extension.project.description),1),r("div",Be,[s(C,{size:"small",variant:"tonal"},{default:t(()=>[i(d(l.extension.project.type),1)]),_:1}),s(C,{size:"small",variant:"tonal","prepend-icon":"mdi-eye"},{default:t(()=>[i(d(l.extension.project.view_count||0),1)]),_:1}),s(C,{size:"small",variant:"tonal","prepend-icon":"mdi-star"},{default:t(()=>[i(d(l.extension.project.star_count||0),1)]),_:1})])]),_:1})]),_:1})):v("",!0),l.extension.sample_project?(m(),p(_,{key:1,class:"mb-4",variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[25]||(e[25]=[i("mdi-file-document",-1)])),_:1,__:[25]}),e[26]||(e[26]=i(" 示例项目 ",-1))]),_:1,__:[26]}),s(D,null,{prepend:t(()=>[s(z,null,{default:t(()=>{var n;return[s(L,{src:l.localuser.getUserAvatar((n=l.extension.sample_project.author)==null?void 0:n.avatar)||""},null,8,["src"])]}),_:1})]),default:t(()=>[s(g,null,{default:t(()=>[i(d(l.extension.sample_project.title),1)]),_:1}),s(P,null,{default:t(()=>{var n,h;return[i("by "+d(((n=l.extension.sample_project.author)==null?void 0:n.display_name)||((h=l.extension.sample_project.author)==null?void 0:h.username)),1)]}),_:1})]),_:1})]),_:1})):v("",!0),s(_,{variant:"tonal",border:"",hover:""},{default:t(()=>[s(g,{class:"d-flex align-center"},{default:t(()=>[s(x,{class:"mr-2"},{default:t(()=>e[27]||(e[27]=[i("mdi-history",-1)])),_:1,__:[27]}),e[28]||(e[28]=i(" 历史 ",-1))]),_:1,__:[28]}),s(b,null,{default:t(()=>[s(ge,{density:"compact",side:"end"},{default:t(()=>[s(U,{"dot-color":"primary",size:"small"},{default:t(()=>[e[29]||(e[29]=r("div",{class:"mb-1"},[r("strong",null,"创建时间")],-1)),r("div",Ae,[s(k,{date:l.extension.created_at},null,8,["date"])])]),_:1,__:[29]}),l.extension.updated_at!==l.extension.created_at?(m(),p(U,{key:0,"dot-color":"warning",size:"small"},{default:t(()=>[e[30]||(e[30]=r("div",{class:"mb-1"},[r("strong",null,"更新时间")],-1)),r("div",Ne,[s(k,{date:l.extension.updated_at},null,8,["date"])])]),_:1,__:[30]})):v("",!0),s(U,{"dot-color":c.getStatusColor(l.extension.status),size:"small"},{default:t(()=>[r("div",Re,[r("strong",null,d(c.getStatusText(l.extension.status)),1)]),e[31]||(e[31]=r("div",{class:"text-caption text-grey"}," 状态 ",-1))]),_:1,__:[31]},8,["dot-color"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(m(),p(E,{key:2,class:"text-center py-8"},{default:t(()=>[s(x,{size:"64",color:"grey-lighten-1"},{default:t(()=>e[32]||(e[32]=[i("mdi-puzzle-remove",-1)])),_:1,__:[32]}),e[34]||(e[34]=r("p",{class:"text-h6 mt-4 text-grey-darken-1"},"扩展详情",-1)),e[35]||(e[35]=r("p",{class:"text-body-2 text-grey"},"扩展详情",-1)),s(f,{class:"mt-4",to:"/app/extensions"},{default:t(()=>e[33]||(e[33]=[i("返回扩展管理",-1)])),_:1,__:[33]})]),_:1,__:[34,35]})),s(a,{modelValue:l.showEditDialog,"onUpdate:modelValue":e[2]||(e[2]=n=>l.showEditDialog=n),extension:l.extension,onUpdated:c.fetchExtension},null,8,["modelValue","extension","onUpdated"]),s(Q,{modelValue:l.showDeleteDialog,"onUpdate:modelValue":e[4]||(e[4]=n=>l.showDeleteDialog=n),"max-width":"400"},{default:t(()=>[s(_,null,{default:t(()=>[s(g,null,{default:t(()=>e[36]||(e[36]=[i("删除扩展",-1)])),_:1,__:[36]}),s(b,null,{default:t(()=>{var n,h;return[i(' 确定删除扩展"'+d((h=(n=l.extension)==null?void 0:n.project)==null?void 0:h.title)+'" ',1)]}),_:1}),s(H,null,{default:t(()=>[s(T),s(f,{onClick:e[3]||(e[3]=n=>l.showDeleteDialog=!1)},{default:t(()=>e[37]||(e[37]=[i("取消",-1)])),_:1,__:[37]}),s(f,{color:"error",loading:l.deleteLoading,onClick:c.deleteExtension},{default:t(()=>e[38]||(e[38]=[i(" 删除 ",-1)])),_:1,__:[38]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(de,{modelValue:l.snackbar.show,"onUpdate:modelValue":e[5]||(e[5]=n=>l.snackbar.show=n),color:l.snackbar.color},{default:t(()=>[i(d(l.snackbar.message),1)]),_:1},8,["modelValue","color"])])}const et=Y(ke,[["render",Oe],["__scopeId","data-v-8d5ec46c"]]);export{et as default};
