import{_ as F,Y as x,o as _,N as a,e as s,Q as V,R as u,W as C,a9 as w,f as l,a3 as b,X as i,D as L,aD as N,i as K,L as M,aA as U,c as G,a5 as H,T as O,r as o,x as g,w as j,a$ as h,b as J,dG as X,ex as Y}from"./index-BIid3482.js";import{V as z}from"./index-DmvNbO5A.js";import{V as Q}from"./VSpacer-CWkpgYIS.js";import"https://static.geetest.com/v4/gt4.js";const p=5*60*1e3,R={LAST_FETCH:"config_last_fetch_time"},W={name:"ConfigDebug",setup(){const v=o({}),t=o(!1),r=o(0),e=o(null),c=o(""),d=o(void 0),f=g(()=>Date.now()-r.value>p),y=g(()=>r.value+p),E=g(()=>{const n=y.value-Date.now();return n>0?n:0}),T=async()=>{v.value=await h(),r.value=parseInt(localStorage.getItem(R.LAST_FETCH)||"0",10),c.value&&(d.value=await h(c.value))},S=async()=>{t.value=!0;try{await Y(),await T()}catch(n){console.error("刷新配置失败:",n)}finally{t.value=!1}},A=n=>{if(!n)return"未更新";const m=new Date(n);return`${m.toLocaleDateString()} ${m.toLocaleTimeString()}`},D=n=>{if(n<=0)return"已过期";const m=Math.floor(n/6e4),I=Math.floor(n%6e4/1e3);return`${m}分${I}秒`},k=()=>t.value?"刷新中...":f.value?"立即刷新":"强制刷新";j(c,async n=>{if(!n){d.value=void 0;return}d.value=await h(n)});const B=()=>{e.value=setInterval(()=>{r.value=parseInt(localStorage.getItem(R.LAST_FETCH)||"0",10)},1e3)};return J(async()=>{await T(),B()}),X(()=>{e.value&&clearInterval(e.value)}),{config:v,lastFetchTime:r,isRefreshing:t,isExpired:f,nextAutoRefresh:y,timeUntilExpiry:E,searchKey:c,searchResult:d,handleRefresh:S,formatTime:A,formatDuration:D,getRefreshButtonText:k}}},q={class:"status-item"},P={class:"status-item"},Z={class:"status-item"},$={class:"status-item"},ee={key:0};function te(v,t,r,e,c,d){return _(),x(O,{class:"pa-4 config-debug",fluid:""},{default:a(()=>[s(V,null,{default:a(()=>[s(u,{cols:"12"},{default:a(()=>[s(C,{class:"mb-4"},{default:a(()=>[s(w,{class:"d-flex justify-space-between align-center"},{default:a(()=>t[1]||(t[1]=[l("span",{class:"text-h6"},"配置状态",-1)])),_:1,__:[1]}),s(b,null,{default:a(()=>[s(V,null,{default:a(()=>[s(u,{cols:"12",sm:"6"},{default:a(()=>[l("div",q,[t[2]||(t[2]=l("div",{class:"text-subtitle-2"},"最后更新时间",-1)),l("div",null,i(e.formatTime(e.lastFetchTime)),1)])]),_:1}),s(u,{cols:"12",sm:"6"},{default:a(()=>[l("div",P,[t[3]||(t[3]=l("div",{class:"text-subtitle-2"},"配置状态",-1)),l("div",{class:L({"text-error":e.isExpired,"text-success":!e.isExpired})},i(e.isExpired?"已过期":"有效"),3)])]),_:1}),s(u,{cols:"12",sm:"6"},{default:a(()=>[l("div",Z,[t[4]||(t[4]=l("div",{class:"text-subtitle-2"},"下次自动更新",-1)),l("div",null,i(e.formatTime(e.nextAutoRefresh)),1)])]),_:1}),s(u,{cols:"12",sm:"6"},{default:a(()=>[l("div",$,[t[5]||(t[5]=l("div",{class:"text-subtitle-2"},"剩余有效时间",-1)),l("div",null,i(e.formatDuration(e.timeUntilExpiry)),1)])]),_:1})]),_:1})]),_:1}),s(N,null,{default:a(()=>[s(Q),s(K,{disabled:!e.isExpired&&e.isRefreshing,loading:e.isRefreshing,color:"primary",variant:"tonal",onClick:e.handleRefresh},{default:a(()=>[M(i(e.getRefreshButtonText()),1)]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1}),s(C,null,{default:a(()=>[s(w,{class:"d-flex justify-space-between align-center"},{default:a(()=>[t[6]||(t[6]=l("span",{class:"text-h6"},"配置内容",-1)),s(U,{modelValue:e.searchKey,"onUpdate:modelValue":t[0]||(t[0]=f=>e.searchKey=f),class:"max-width-200",clearable:"",density:"compact","hide-details":"",label:"查找配置项"},null,8,["modelValue"])]),_:1,__:[6]}),s(b,null,{default:a(()=>[e.searchKey?e.searchResult===void 0?(_(),x(H,{key:1,class:"mt-2",text:"未找到对应的配置项",type:"warning"})):(_(),x(z,{key:2,class:"mt-2"},{default:a(()=>[l("pre",null,i(JSON.stringify({[e.searchKey]:e.searchResult},null,2)),1)]),_:1})):(_(),G("pre",ee," "+i(JSON.stringify(e.config,null,2)),1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const ie=F(W,[["render",te],["__scopeId","data-v-fec376fb"]]);export{ie as default};
