import{l as w,b as P}from"./project-mn2o6brF.js";import{l as Q,b as x}from"./user-Ca5O2_G4.js";import{_ as T}from"./43-lazyload-CBkwrR6M.js";import{_ as V,o as s,c as n,w as e,e as p,S as f,T as y,a as r,Q as A,O as l,U as h,N as j,$ as m,J as F,X as L,L as _,Y as g}from"./index-Bs7RMKPc.js";import{a as I,V as S}from"./VRow-DRAMlhhK.js";import{V as b,e as N,c as D,d as B,b as U}from"./VCard-BlF6-DPm.js";import{V as C}from"./VChip-CiKHvfBt.js";import{V as J}from"./VPagination-B7vSBHvk.js";import{V as M}from"./VContainer-BL-qopN5.js";const O={props:{projectIds:{type:Array,required:!0},actions:{type:Array}},data(){return{projects:[],authorids:[],authors:{},liveQuerySubscription:null,authorQuerySubscription:null}},watch:{projectIds:{handler(){this.startLiveFetch(),this.refreshData()},immediate:!0,deep:!0}},methods:{startLiveFetch(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.liveQuerySubscription=w(this.projectIds,o=>{this.projects=o,this.updateAuthorIds()})},updateAuthorIds(){const o=[...new Set(this.projects.map(t=>t.authorid))];JSON.stringify(o)!==JSON.stringify(this.authorids)&&(this.authorids=o,this.startAuthorLiveFetch())},startAuthorLiveFetch(){this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe(),this.authorQuerySubscription=Q(this.authorids,o=>{const t={};o.forEach(u=>{t[u.id]=u}),this.authors=t})},async refreshData(){await P(this.projectIds),await x(this.authorids)}},beforeDestroy(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe()}};function q(o,t,u,v,i,d){return s(),n(S,null,{default:e(()=>[(s(!0),p(f,null,y(i.projects,a=>(s(),n(I,{key:a.id,cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2"},{default:e(()=>[r(b,{rounded:"lg",border:""},{default:e(()=>[r(b,{to:"/projects/"+a.id,style:{"aspect-ratio":"4/3"},rounded:"lg"},{default:e(()=>[r(A,{src:"https://s4-1.wuyuan.1r.ink/scratch_slt/"+a.id,class:"align-end","lazy-src":T,height:"100%",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",cover:""},{default:e(()=>[r(N,null,{default:e(()=>[r(D,null,{default:e(()=>[l(h(a.title||"未缓存"),1)]),_:2},1024),r(B,null,{default:e(()=>[l(h(a.description||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["to"]),u.actions?(s(),n(U,{key:0},{default:e(()=>[(s(!0),p(f,null,y(u.actions,c=>(s(),p("div",{key:c.name},[r(j,{onClick:X=>c.function(a.id,a)},{default:e(()=>[l(h(c.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)):m("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})}const k=V(O,[["render",q]]),E={components:{showProjects:k},props:{url:{type:String,required:!0},actions:{type:Array}},data(){return{projectIds:[],page:1,limit:16,totalPage:1,totalCount:0,loading:!1,loadTime:0}},computed:{hasTotalCount(){return this.totalCount>0}},methods:{async fetchProjects(){this.loading=!0;const o=performance.now();try{const t=await F.get(`${this.url}&curr=${this.page}&limit=${this.limit}`);this.projectIds=this.hasTotalCount?t.projects:[...this.projectIds,...t.projects],this.totalCount=t.totalCount||0,this.totalPage=this.totalCount?Math.ceil(this.totalCount/this.limit):1}catch(t){console.error("Failed to fetch projects:",t)}finally{this.loading=!1,this.loadTime=performance.now()-o}},loadMore(){this.page++,this.fetchProjects()}},watch:{url:{handler(){this.page=1,this.fetchProjects()},immediate:!0},page:{handler(){this.fetchProjects()}}}},z={class:"mt-2 text-medium-emphasis"};function R(o,t,u,v,i,d){const a=k;return s(),n(M,null,{default:e(()=>[i.loading?(s(),n(L,{key:0,indeterminate:"",color:"primary"})):m("",!0),r(S,null,{default:e(()=>[r(I,{cols:"12"},{default:e(()=>[_("p",z,[r(C,null,{default:e(()=>[r(g,{icon:"mdi-timer",start:""}),l(" 加载耗时: "+h(i.loadTime)+" ms ",1)]),_:1}),i.totalCount?(s(),n(C,{key:0},{default:e(()=>[r(g,{icon:"mdi-counter",start:""}),l(" 总作品数量: "+h(i.totalCount),1)]),_:1})):m("",!0)])]),_:1})]),_:1}),r(a,{projectIds:i.projectIds,actions:u.actions},null,8,["projectIds","actions"]),t[2]||(t[2]=_("br",null,null,-1)),d.hasTotalCount?(s(),n(J,{key:1,modelValue:i.page,"onUpdate:modelValue":t[0]||(t[0]=c=>i.page=c),length:i.totalPage,onInput:d.fetchProjects,rounded:"circle"},null,8,["modelValue","length","onInput"])):(s(),n(j,{key:2,onClick:d.loadMore,color:"primary"},{default:e(()=>t[1]||(t[1]=[l("继续加载")])),_:1},8,["onClick"]))]),_:1})}const rt=V(E,[["render",R]]);export{rt as _,k as s};
