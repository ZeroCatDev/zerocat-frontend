import{_ as N,Z as L,o as k,N as a,e,ae as E,L as n,P as r,a5 as H,a8 as c,f as s,c as J,a0 as M,ai as _,aZ as W,aj as g,ak as p,Y as C,i as u,R as T,S as b,X as v,ah as U,aI as X,O as Y,bh as q,r as z,b as F,b7 as o,U as G}from"./index-BhZBrlGg.js";import"https://static.geetest.com/v4/gt4.js";const K={name:"PWASettings",setup(){const{isInstallable:w,isInstalled:l,isOnline:f,updateAvailable:t,installing:y,install:A,updateApp:x,clearCache:V,getSWInfo:B}=q(),S=z(null),m=z({api:!1,images:!1,static:!1,all:!1}),O=async()=>{try{await A()?o("应用安装成功！","success"):o("安装已取消","info")}catch(i){console.error("安装失败:",i),o("安装失败，请重试","error")}},D=async i=>{m.value[i]=!0;try{await V(i)?o(`${Z(i)}清除成功`,"success"):o("清除缓存失败","error")}catch(d){console.error("清除缓存失败:",d),o("清除缓存失败","error")}finally{m.value[i]=!1}},R=async()=>{if(confirm("确定要清除所有缓存吗？这可能会影响应用性能。")){m.value.all=!0;try{const d=["api","images","static"];(await Promise.all(d.map(I=>V(I)))).every(I=>I)?(o("所有缓存清除成功","success"),setTimeout(()=>{window.location.reload()},1e3)):o("部分缓存清除失败","warning")}catch(d){console.error("清除缓存失败:",d),o("清除缓存失败","error")}finally{m.value.all=!1}}},Z=i=>({api:"API缓存",images:"图片缓存",static:"静态资源缓存"})[i]||"缓存",j=i=>i?new Date(i).toLocaleString("zh-CN"):"未知",P=async()=>{try{const i=await B();S.value=i}catch(i){console.error("获取SW信息失败:",i)}};return F(()=>{P()}),{isInstallable:w,isInstalled:l,isOnline:f,updateAvailable:t,installing:y,swInfo:S,clearingCache:m,handleInstall:O,updateApp:x,handleClearCache:D,handleClearAllCache:R,formatTime:j,refreshSWInfo:P}}},Q={class:"mb-6"},h={class:"mb-6"},$={class:"d-flex align-center mb-2"},ll={class:"d-flex align-center mb-2"},al={class:"d-flex align-center mb-2"},el={class:"d-flex align-center mb-2"},tl={key:0};function nl(w,l,f,t,y,A){return k(),L(v,null,{default:a(()=>[e(E,{class:"d-flex align-center"},{default:a(()=>[e(r,{start:"",color:"primary"},{default:a(()=>l[3]||(l[3]=[n("mdi-application-cog",-1)])),_:1,__:[3]}),l[4]||(l[4]=n(" PWA设置 ",-1))]),_:1,__:[4]}),e(H),e(c,null,{default:a(()=>[s("div",Q,[l[10]||(l[10]=s("h3",{class:"text-h6 mb-3"},"应用状态",-1)),e(_,{class:"px-0"},W({prepend:a(()=>[e(r,{color:t.isInstalled?"success":"grey",icon:t.isInstalled?"mdi-check-circle":"mdi-circle-outline"},null,8,["color","icon"])]),default:a(()=>[e(g,null,{default:a(()=>l[5]||(l[5]=[n("应用安装状态",-1)])),_:1,__:[5]}),e(p,null,{default:a(()=>[n(C(t.isInstalled?"已安装为PWA应用":"在浏览器中运行"),1)]),_:1})]),_:2},[t.isInstallable&&!t.isInstalled?{name:"append",fn:a(()=>[e(u,{loading:t.installing,color:"primary",variant:"tonal",size:"small",onClick:t.handleInstall},{default:a(()=>l[6]||(l[6]=[n(" 安装应用 ",-1)])),_:1,__:[6]},8,["loading","onClick"])]),key:"0"}:void 0]),1024),e(_,{class:"px-0"},{prepend:a(()=>[e(r,{color:t.isOnline?"success":"error",icon:t.isOnline?"mdi-wifi":"mdi-wifi-off"},null,8,["color","icon"])]),default:a(()=>[e(g,null,{default:a(()=>l[7]||(l[7]=[n("网络连接",-1)])),_:1,__:[7]}),e(p,null,{default:a(()=>[n(C(t.isOnline?"已连接到网络":"离线模式"),1)]),_:1})]),_:1}),e(_,{class:"px-0"},W({prepend:a(()=>[e(r,{color:t.updateAvailable?"warning":"success",icon:t.updateAvailable?"mdi-update":"mdi-check-circle"},null,8,["color","icon"])]),default:a(()=>[e(g,null,{default:a(()=>l[8]||(l[8]=[n("应用版本",-1)])),_:1,__:[8]}),e(p,null,{default:a(()=>[n(C(t.updateAvailable?"有更新可用":"已是最新版本"),1)]),_:1})]),_:2},[t.updateAvailable?{name:"append",fn:a(()=>[e(u,{color:"warning",variant:"tonal",size:"small",onClick:t.updateApp},{default:a(()=>l[9]||(l[9]=[n(" 立即更新 ",-1)])),_:1,__:[9]},8,["onClick"])]),key:"0"}:void 0]),1024)]),s("div",h,[l[27]||(l[27]=s("h3",{class:"text-h6 mb-3"},"缓存管理",-1)),e(T,null,{default:a(()=>[e(b,{cols:"12",sm:"6"},{default:a(()=>[e(v,{variant:"outlined"},{default:a(()=>[e(c,null,{default:a(()=>[s("div",$,[e(r,{color:"blue",class:"mr-2"},{default:a(()=>l[11]||(l[11]=[n("mdi-database",-1)])),_:1,__:[11]}),l[12]||(l[12]=s("span",{class:"font-weight-medium"},"API缓存",-1))]),l[14]||(l[14]=s("p",{class:"text-caption text-grey mb-3"}," API请求的缓存数据 ",-1)),e(u,{loading:t.clearingCache.api,variant:"outlined",size:"small",block:"",onClick:l[0]||(l[0]=x=>t.handleClearCache("api"))},{default:a(()=>l[13]||(l[13]=[n(" 清除API缓存 ",-1)])),_:1,__:[13]},8,["loading"])]),_:1,__:[14]})]),_:1})]),_:1}),e(b,{cols:"12",sm:"6"},{default:a(()=>[e(v,{variant:"outlined"},{default:a(()=>[e(c,null,{default:a(()=>[s("div",ll,[e(r,{color:"green",class:"mr-2"},{default:a(()=>l[15]||(l[15]=[n("mdi-image",-1)])),_:1,__:[15]}),l[16]||(l[16]=s("span",{class:"font-weight-medium"},"图片缓存",-1))]),l[18]||(l[18]=s("p",{class:"text-caption text-grey mb-3"}," 图片和媒体文件缓存 ",-1)),e(u,{loading:t.clearingCache.images,variant:"outlined",size:"small",block:"",onClick:l[1]||(l[1]=x=>t.handleClearCache("images"))},{default:a(()=>l[17]||(l[17]=[n(" 清除图片缓存 ",-1)])),_:1,__:[17]},8,["loading"])]),_:1,__:[18]})]),_:1})]),_:1}),e(b,{cols:"12",sm:"6"},{default:a(()=>[e(v,{variant:"outlined"},{default:a(()=>[e(c,null,{default:a(()=>[s("div",al,[e(r,{color:"purple",class:"mr-2"},{default:a(()=>l[19]||(l[19]=[n("mdi-file-code",-1)])),_:1,__:[19]}),l[20]||(l[20]=s("span",{class:"font-weight-medium"},"静态资源",-1))]),l[22]||(l[22]=s("p",{class:"text-caption text-grey mb-3"}," JS、CSS等静态文件缓存 ",-1)),e(u,{loading:t.clearingCache.static,variant:"outlined",size:"small",block:"",onClick:l[2]||(l[2]=x=>t.handleClearCache("static"))},{default:a(()=>l[21]||(l[21]=[n(" 清除静态缓存 ",-1)])),_:1,__:[21]},8,["loading"])]),_:1,__:[22]})]),_:1})]),_:1}),e(b,{cols:"12",sm:"6"},{default:a(()=>[e(v,{variant:"outlined"},{default:a(()=>[e(c,null,{default:a(()=>[s("div",el,[e(r,{color:"red",class:"mr-2"},{default:a(()=>l[23]||(l[23]=[n("mdi-delete-sweep",-1)])),_:1,__:[23]}),l[24]||(l[24]=s("span",{class:"font-weight-medium"},"全部缓存",-1))]),l[26]||(l[26]=s("p",{class:"text-caption text-grey mb-3"}," 清除所有缓存数据 ",-1)),e(u,{loading:t.clearingCache.all,color:"error",variant:"outlined",size:"small",block:"",onClick:t.handleClearAllCache},{default:a(()=>l[25]||(l[25]=[n(" 清除全部缓存 ",-1)])),_:1,__:[25]},8,["loading","onClick"])]),_:1,__:[26]})]),_:1})]),_:1})]),_:1})]),t.swInfo?(k(),J("div",tl,[l[30]||(l[30]=s("h3",{class:"text-h6 mb-3"},"应用信息",-1)),e(U,{density:"compact"},{default:a(()=>[e(_,null,{default:a(()=>[e(g,null,{default:a(()=>l[28]||(l[28]=[n("Service Worker版本",-1)])),_:1,__:[28]}),e(p,null,{default:a(()=>[n(C(t.swInfo.version),1)]),_:1})]),_:1}),e(_,null,{default:a(()=>[e(g,null,{default:a(()=>l[29]||(l[29]=[n("更新时间",-1)])),_:1,__:[29]}),e(p,null,{default:a(()=>[n(C(t.formatTime(t.swInfo.timestamp)),1)]),_:1})]),_:1})]),_:1})])):M("",!0)]),_:1}),e(X,null,{default:a(()=>[e(Y),e(u,{variant:"text","prepend-icon":"mdi-refresh",onClick:t.refreshSWInfo},{default:a(()=>l[31]||(l[31]=[n(" 刷新信息 ",-1)])),_:1,__:[31]},8,["onClick"])]),_:1})]),_:1})}const sl=N(K,[["render",nl],["__scopeId","data-v-34c24d32"]]),il={class:"pwa-settings-page"},ol={class:"page-header mb-6"},rl={__name:"pwa",setup(w){return useHead({title:"PWA设置"}),(l,f)=>(k(),L(G,null,{default:a(()=>[s("div",il,[s("div",ol,[e(T,{align:"center"},{default:a(()=>[e(b,null,{default:a(()=>f[0]||(f[0]=[s("h1",{class:"text-h4 font-weight-bold"},"PWA设置",-1),s("p",{class:"text-subtitle-1 text-grey mt-2"}," 管理渐进式Web应用设置和缓存 ",-1)])),_:1,__:[0]})]),_:1})]),e(sl)])]),_:1}))}},ml=N(rl,[["__scopeId","data-v-07ac1396"]]);export{ml as default};
