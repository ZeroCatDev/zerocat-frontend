import{_ as N,bq as _,c as q,o as h,e as s,N as i,aK as D,aI as I,R as E,Y as V,a0 as P,S as f,aG as w,i as p,L as F,U as G,bo as H,r as n,x as K,ag as M,a7 as W,br as b}from"./index-sIbGf8Dn.js";import{_ as k}from"./AuthCard-BK-s5tHj.js";import"https://static.geetest.com/v4/gt4.js";const Y={components:{LoadingDialog:_,AuthCard:k},setup(){const v=H(),a=n(""),m=n(""),e=n(""),g=n(""),x=n(1),d=n(!1),u=n(0),t=n(!1),R=n(!1),C=n("处理中..."),T={required:o=>!!o||"此字段为必填项",length:o=>(o==null?void 0:o.length)===6||"验证码必须是6位数字"},S=[o=>!!o||"必须填写邮箱",o=>/.+@.+\..+/.test(o)||"不符合格式"],U=[o=>!!o||"必须填写密码",o=>o.length>=8||"密码至少需要8个字符",o=>/[A-Za-z]/.test(o)&&/[0-9]/.test(o)||"密码必须包含字母和数字"],z=K(()=>[o=>!!o||"必须确认密码",o=>o===e.value||"两次输入的密码不一致"]);M.isLogin.value===!0&&v.push("/app/dashboard"),W({title:"重设密码"});const A=async()=>{var o,l;if(!(u.value>0)){if(!a.value||!/.+@.+\..+/.test(a.value)){c("请输入正确的邮箱地址");return}d.value=!0,C.value="正在发送验证码...";try{const r=await b.sendPasswordResetCode(a.value);r.status==="success"?(y("验证码已发送到您的邮箱"),x.value=2,L()):c(r.message||"发送验证码失败")}catch(r){c(((l=(o=r.response)==null?void 0:o.data)==null?void 0:l.message)||"发送验证码失败")}finally{d.value=!1}}},B=async()=>{var o,l;if(!m.value||m.value.length!==6){c("请输入6位验证码");return}if(!e.value||e.value!==g.value){c("请确保输入了密码且两次输入一致");return}d.value=!0,C.value="正在重设密码...";try{const r=await b.resetPasswordWithCode(a.value,m.value,e.value);r.status==="success"?(y("密码重置成功，请使用新密码登录"),setTimeout(()=>{v.push("/app/account/login")},2e3)):c(r.message||"重置密码失败")}catch(r){c(((l=(o=r.response)==null?void 0:o.data)==null?void 0:l.message)||"重置密码失败")}finally{d.value=!1}},L=()=>{u.value=60;const o=setInterval(()=>{u.value--,u.value<=0&&clearInterval(o)},1e3)},y=o=>{var l;(l=this==null?void 0:this.$toast)==null||l.add({severity:"success",summary:"成功",detail:o,life:3e3})},c=o=>{var l;(l=this==null?void 0:this.$toast)==null||l.add({severity:"error",summary:"错误",detail:o,life:3e3})};return{email:a,verificationCode:m,password:e,confirmPassword:g,step:x,loading:d,countdown:u,showPassword:t,showConfirmPassword:R,loadingText:C,rules:T,emailRules:S,passwordRules:U,confirmPasswordRules:z,sendVerificationCode:A,resetPassword:B}}};function Z(v,a,m,e,g,x){const d=k,u=_;return h(),q("div",null,[s(d,{subtitle:"重设密码"},{default:i(()=>[s(D,{onSubmit:a[7]||(a[7]=I(()=>{},["prevent"]))},{default:i(()=>[s(E,null,{default:i(()=>[s(f,{cols:"12"},{default:i(()=>[s(w,{modelValue:e.email,"onUpdate:modelValue":a[0]||(a[0]=t=>e.email=t),disabled:e.step>1,rules:e.emailRules,label:"邮箱",type:"text",variant:"outlined"},null,8,["modelValue","disabled","rules"])]),_:1}),e.step>=2?(h(),V(f,{key:0,cols:"12"},{default:i(()=>[s(w,{modelValue:e.verificationCode,"onUpdate:modelValue":a[1]||(a[1]=t=>e.verificationCode=t),rules:[e.rules.required,e.rules.length],label:"验证码",maxlength:"6",variant:"outlined"},null,8,["modelValue","rules"]),s(p,{disabled:e.countdown>0,class:"mb-4",variant:"text",onClick:e.sendVerificationCode},{default:i(()=>[F(G(e.countdown>0?`${e.countdown}秒后重新发送`:"重新发送验证码"),1)]),_:1},8,["disabled","onClick"])]),_:1})):P("",!0),e.step>=2?(h(),V(f,{key:1,cols:"12"},{default:i(()=>[s(w,{modelValue:e.password,"onUpdate:modelValue":a[2]||(a[2]=t=>e.password=t),"append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",rules:e.passwordRules,type:e.showPassword?"text":"password",label:"新密码",variant:"outlined","onClick:append":a[3]||(a[3]=t=>e.showPassword=!e.showPassword)},null,8,["modelValue","append-icon","rules","type"]),s(w,{modelValue:e.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=t=>e.confirmPassword=t),"append-icon":e.showConfirmPassword?"mdi-eye":"mdi-eye-off",rules:e.confirmPasswordRules,type:e.showConfirmPassword?"text":"password",label:"确认密码",variant:"outlined","onClick:append":a[5]||(a[5]=t=>e.showConfirmPassword=!e.showConfirmPassword)},null,8,["modelValue","append-icon","rules","type"])]),_:1})):P("",!0),s(f,{cols:"12"},{default:i(()=>[s(p,{loading:e.loading,text:e.step===1?"获取验证码":"重设密码","append-icon":"mdi-arrow-right",class:"text-none",color:"primary",rounded:"xl",size:"large",variant:"flat",onClick:a[6]||(a[6]=t=>e.step===1?e.sendVerificationCode():e.resetPassword())},null,8,["loading","text"])]),_:1}),s(f,{cols:"12"},{default:i(()=>[s(p,{"append-icon":"mdi-arrow-right",class:"text-none",color:"white",rounded:"xl",size:"large",text:"登录",to:"/app/account/login",variant:"text"}),s(p,{"append-icon":"mdi-arrow-right",class:"text-none",color:"white",rounded:"xl",size:"large",text:"注册",to:"/app/account/register",variant:"text"})]),_:1})]),_:1})]),_:1})]),_:1}),s(u,{show:e.loading,text:e.loadingText},null,8,["show","text"])])}const Q=N(Y,[["render",Z]]);export{Q as default};
