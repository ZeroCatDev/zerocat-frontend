import{_ as le,a as ae,b as oe}from"./Comment-C0AYOREu.js";import{g as fe}from"./projectListService-BibWetke.js";import{_ as ne,a as h,o as r,T as y,N as l,h as t,Y as T,Z as he,R as x,F as V,K as u,Q as D,b as E,p as U,$ as ye,a0 as ee,a1 as b,a2 as ve,a3 as ge,f as M,O as k,i as be,a4 as re,G as de,a5 as ce,J as N,I as ue,a6 as xe,B as je,r as ke,w as Ce,l as S,E as me,a7 as Te,x as Ve,a8 as we,a9 as Pe,aa as De,y as te,D as Se,H as ze,ab as Ie,ac as Le,ad as Be,ae as z,M as a,af as Ee,S as n,U as se,q as Ue,W as I,j as Me,X as ie,L as Ne}from"./index-BVHv7Kt3.js";import{V as Re}from"./VAlert-B6fgM-_0.js";import{a as L,V as B}from"./VRow-DOaJ8fnm.js";import{_ as Ae}from"./Projects-Dv_lJpzU.js";import{g as Fe}from"./user-BlG3Z1un.js";/* empty css                        */import{V as g}from"./VChip-mBmXDnix.js";import{V as qe}from"./VContainer-COdZDY2D.js";import"./VForm-BWGcY56c.js";import"./VInput-CfGeQOzG.js";import"./VTextarea-C_3qB9EC.js";/* empty css                   */import"./VDialog-CHpQTOKs.js";/* empty css              */import"./ProjectCard-BGyvydnB.js";import"./projectService-CE7nFhN8.js";import"./43-lazyload-CBkwrR6M.js";import"./VPagination-V3CpOQGd.js";const Oe={name:"UserProjectLists",props:{userId:{type:[Number,String],required:!0},projectLists:{type:Array,default:()=>[]}},data(){return{loading:!1,localLists:[]}},computed:{lists(){return this.projectLists.length>0?this.projectLists:this.localLists}},watch:{userId:{immediate:!0,handler(e){e&&this.projectLists.length===0&&this.fetchUserLists()}}},methods:{async fetchUserLists(){this.loading=!0;try{const e=await fe(this.userId);e.status==="success"?this.localLists=e.data||[]:console.error("获取用户列表失败:",e.message)}catch(e){console.error("获取用户列表失败:",e)}finally{this.loading=!1}}}};function Ke(e,i,p,C,o,_){return r(),h("div",null,[o.loading?(r(),y(x,{key:0,class:"mb-4"},{default:l(()=>[t(T,{class:"text-center"},{default:l(()=>[t(he,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(r(),h(V,{key:1},[_.lists.length===0?(r(),y(x,{key:0,class:"mb-4"},{default:l(()=>[t(T,{class:"text-center"},{default:l(()=>[t(Re,{type:"info",variant:"tonal"},{default:l(()=>i[0]||(i[0]=[u(" 该用户暂无公开项目列表 ")])),_:1})]),_:1})]),_:1})):(r(),y(B,{key:1},{default:l(()=>[(r(!0),h(V,null,D(_.lists,m=>(r(),y(L,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:m.id},{default:l(()=>[t(x,{rounded:"lg"},{default:l(()=>[t(x,{to:"/app/projectlist/"+m.id,rounded:"lg",title:m.title,subtitle:m.description,variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))],64))])}const _e=ne(Oe,[["render",Ke]]),We=U({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:ue,iconColor:String,lineColor:String,...N(),...ce(),...de(),...re()},"VTimelineDivider"),Ze=E()({name:"VTimelineDivider",props:We(),setup(e,i){let{slots:p}=i;const{sizeClasses:C,sizeStyles:o}=ye(e,"v-timeline-divider__dot"),{backgroundColorStyles:_,backgroundColorClasses:m}=ee(b(e,"dotColor")),{roundedClasses:v}=ve(e,"v-timeline-divider__dot"),{elevationClasses:j}=ge(e),{backgroundColorClasses:P,backgroundColorStyles:w}=ee(b(e,"lineColor"));return M(()=>t("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[t("div",{class:["v-timeline-divider__before",P.value],style:w.value},null),!e.hideDot&&t("div",{key:"dot",class:["v-timeline-divider__dot",j.value,v.value,C.value],style:o.value},[t("div",{class:["v-timeline-divider__inner-dot",m.value,v.value],style:_.value},[p.default?t(be,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},p.default):t(k,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),t("div",{class:["v-timeline-divider__after",P.value],style:w.value},null)])),{}}}),pe=U({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:ue,iconColor:String,lineInset:[Number,String],side:{type:String,validator:e=>e==null||["start","end"].includes(e)},...N(),...Te(),...re(),...ce(),...de(),...me()},"VTimelineItem"),$e=E()({name:"VTimelineItem",props:pe(),setup(e,i){let{slots:p}=i;const{dimensionStyles:C}=xe(e),o=je(0),_=ke();return Ce(_,m=>{var v;m&&(o.value=((v=m.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:v.getBoundingClientRect().width)??0)},{flush:"post"}),M(()=>{var m,v;return t("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot,"v-timeline-item--side-start":e.side==="start","v-timeline-item--side-end":e.side==="end"},e.class],style:[{"--v-timeline-dot-size":S(o.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${S(e.lineInset)})`:S(0)},e.style]},[t("div",{class:"v-timeline-item__body",style:C.value},[(m=p.default)==null?void 0:m.call(p)]),t(Ze,{ref:_,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:p.icon}),e.density!=="compact"&&t("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((v=p.opposite)==null?void 0:v.call(p))])])}),{}}}),He=U({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...Ie(pe({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...N(),...ze(),...me(),...Se()},"VTimeline"),Ge=E()({name:"VTimeline",props:He(),setup(e,i){let{slots:p}=i;const{themeClasses:C}=Ve(e),{densityClasses:o}=we(e),{rtlClasses:_}=Pe();De({VTimelineDivider:{lineColor:b(e,"lineColor")},VTimelineItem:{density:b(e,"density"),dotColor:b(e,"dotColor"),fillDot:b(e,"fillDot"),hideOpposite:b(e,"hideOpposite"),iconColor:b(e,"iconColor"),lineColor:b(e,"lineColor"),lineInset:b(e,"lineInset"),size:b(e,"size")}});const m=te(()=>{const j=e.side?e.side:e.density!=="default"?"end":null;return j&&`v-timeline--side-${j}`}),v=te(()=>{const j=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return j;case"start":return j[0];case"end":return j[1];default:return null}});return M(()=>t(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,v.value,{"v-timeline--inset-line":!!e.lineInset},C.value,o.value,m.value,_.value,e.class],style:[{"--v-timeline-line-thickness":S(e.lineThickness)},e.style]},p)),{}}}),Je={components:{Comment:oe,Markdown:ae,TimeAgo:le,UserProjectLists:_e},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},currentPage:1,isLoadingMore:!1,pageSize:20,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",motto:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"},VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com"}},watch:{"$route.query.tab"(e){this.tab=e||"home"}},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await Fe(this.username),Ne({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){try{const e=await ie({url:`/projectlist/userid/${this.user.id}/public`,method:"get"});e.data&&e.data.data&&(this.lists=e.data.data)}catch(e){console.error("获取用户项目列表失败:",e),this.lists=[]}},async fetchTimeline(e=1){try{const i=await ie.get(`/timeline/user/${this.user.id}`,{params:{page:e,limit:this.pageSize}});i.data.status==="success"&&(e===1?this.timeline=i.data.data:(this.timeline.events=[...this.timeline.events,...i.data.data.events],this.timeline.pagination=i.data.data.pagination))}catch(i){console.error("Failed to fetch timeline:",i)}},getUpdatedFields(e){return e!=null&&e.length?e.map(i=>this.fieldDisplayNames[i]||i).join("、"):""},async loadMoreEvents(){if(!(this.isLoadingMore||!this.hasMoreEvents))try{this.isLoadingMore=!0,this.currentPage+=1,await this.fetchTimeline(this.currentPage)}catch(e){console.error("Failed to load more events:",e)}finally{this.isLoadingMore=!1}},getTargetContent(e,i){if(!e)return"";switch(e.type){case"project":return e.title||`项目 #${e.id}`;case"user":return e.display_name||`用户 #${e.id}`;case"projectlist":return`项目列表 #${e.id}`;default:return`${e.type} #${e.id}`}},getFieldDisplayName(e){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[e]||e}}},Qe={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},Xe={class:"mt-2 text-body-1 text-medium-emphasis",style:{"word-break":"break-word","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ye={class:"mt-2 text-medium-emphasis"},et={class:"timeline-item-content"},tt={class:"event-header"},st={class:"text-h6"},it={class:"project-info"},lt={class:"font-weight-medium"},at={class:"mt-2 text-caption text-medium-emphasis"},ot={class:"d-flex align-center mb-2"},nt={class:"font-weight-medium"},rt={class:"rename-details text-body-2"},dt={class:"d-flex align-center"},ct={class:"d-flex align-center mt-1"},ut={class:"project-meta text-caption text-medium-emphasis mt-2"},mt={class:"d-flex align-center mb-2"},_t={class:"font-weight-medium"},pt={class:"commit-message text-body-2"},ft={class:"commit-hash text-caption text-medium-emphasis mt-1"},ht={class:"d-flex align-center mb-2"},yt={class:"font-weight-medium"},vt={class:"info-updates text-body-2"},gt={class:"d-flex align-center"},bt={class:"d-flex flex-column mt-1 field-changes"},xt={class:"old-value"},jt={class:"ml-2"},kt={class:"new-value"},Ct={class:"ml-2 text-info"},Tt={class:"project-meta text-caption text-medium-emphasis mt-2"},Vt={key:3,class:"event-content pa-2"},wt={key:0,class:"text-body-2"},Pt={key:1,class:"text-body-2"},Dt={key:2,class:"text-body-2 text-medium-emphasis"},St={class:"d-flex justify-center mt-4 mb-4"},zt={key:1,class:"text-medium-emphasis"};function It(e,i,p,C,o,_){const m=le,v=ae,j=Ae,P=_e,w=oe,R=Le("router-link");return r(),y(qe,null,{default:l(()=>[t(Be,{modelValue:o.tab,"onUpdate:modelValue":i[0]||(i[0]=s=>o.tab=s)},{default:l(()=>[t(z,{value:"home"},{default:l(()=>[t(Ee,{class:"mt-8"},{default:l(()=>[t(B,{class:"d-flex align-center"},{default:l(()=>[t(L,null,{default:l(()=>[i[2]||(i[2]=a("p",{class:"font-weight-medium text-primary"},"ZeroCat 用户",-1)),a("p",Qe,[u(n(o.user.display_name)+" ",1),t(se,{size:"52",class:"ma-2"},{default:l(()=>[t(Ue,{src:o.VITE_APP_S3_BUCKET+"/user/"+o.user.images},null,8,["src"])]),_:1})]),a("p",Xe,n(o.user.motto),1),a("p",Ye,[t(g,null,{default:l(()=>[t(k,{icon:"mdi-account-circle",start:""}),u(" #"+n(o.user.id),1)]),_:1}),t(g,null,{default:l(()=>[t(k,{icon:"mdi-clock",start:""}),t(m,{date:o.user.regTime},null,8,["date"]),i[1]||(i[1]=u(" 注册 "))]),_:1}),t(g,null,{default:l(()=>[t(k,{icon:"mdi-tag",start:""}),u(" "+n(o.user.id===1?"社区管理员":"用户"),1)]),_:1})])]),_:1})]),_:1})]),_:1}),i[4]||(i[4]=a("br",null,null,-1)),t(x,{title:"关于我",subtitle:"README.md"},{default:l(()=>[t(T,{class:"markdown-body"},{default:l(()=>[i[3]||(i[3]=a("br",null,null,-1)),t(v,null,{default:l(()=>[u(n(o.user.motto),1)]),_:1})]),_:1})]),_:1}),i[5]||(i[5]=u()),t(j,{url:o.url},null,8,["url"]),t(B,null,{default:l(()=>[(r(!0),h(V,null,D(o.lists,s=>(r(),y(L,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:s.id},{default:l(()=>[t(x,{rounded:"lg"},{default:l(()=>[t(x,{to:"/app/projectlist/"+s.id,rounded:"lg",title:s.title,subtitle:s.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),i[6]||(i[6]=a("br",null,null,-1)),t(P,{"user-id":o.user.id,"project-lists":o.lists},null,8,["user-id","project-lists"]),i[7]||(i[7]=a("br",null,null,-1)),t(w,{url:"user-"+o.user.id,name:"用户"},null,8,["url"])]),_:1}),t(z,{value:"comment"},{default:l(()=>[t(w,{url:"user-"+o.user.id,name:"用户"},null,8,["url"])]),_:1}),t(z,{value:"timeline"},{default:l(()=>[t(Ge,{side:"end",align:"start",class:"mt-4"},{default:l(()=>[(r(!0),h(V,null,D(o.timeline.events,s=>(r(),y($e,{key:s.id,size:"small","dot-color":"primary"},{opposite:l(()=>[u(n(new Date(s.created_at).toLocaleString()),1)]),icon:l(()=>[t(se,{image:o.VITE_APP_S3_BUCKET+"/user/"+o.user.images},null,8,["image"])]),default:l(()=>{var A,F,q,O,K,W,Z,$,H,G,J,Q;return[a("div",et,[a("div",tt,[a("h3",st,n(s.actor.display_name)+" "+n(((A=o.eventTypes[s.type])==null?void 0:A.text)||"进行了操作"),1),t(g,{size:"x-small",color:((F=o.eventTypes[s.type])==null?void 0:F.color)||"primary",class:"ml-2"},{default:l(()=>{var d;return[u(n(((d=o.eventTypes[s.type])==null?void 0:d.label)||s.type),1)]}),_:2},1032,["color"])]),i[12]||(i[12]=u()),(q=o.eventTypes[s.type])!=null&&q.isProject?(r(),y(R,{key:0,to:`/app/link/project?id=${(O=s.target)==null?void 0:O.id}`,class:"text-decoration-none"},{default:l(()=>{var d;return[u(n((d=s.event_data)==null?void 0:d.project_title),1)]}),_:2},1032,["to"])):I("",!0),i[13]||(i[13]=a("div",{class:"mb-2"},null,-1)),(K=o.eventTypes[s.type])!=null&&K.isProject&&!["project_rename","project_commit"].includes(s.type)?(r(),y(x,{key:1,class:"mb-3 project-event",to:`/app/link/project?id=${(W=s.target)==null?void 0:W.id}`},{default:l(()=>[t(T,null,{default:l(()=>{var d,c;return[a("div",it,[t(k,{icon:"mdi-source-repository",color:"primary",class:"mr-2"}),a("span",lt,n(((d=s.event_data)==null?void 0:d.project_name)||"未命名项目"),1),a("div",at,n((c=s.event_data)==null?void 0:c.project_description),1)])]}),_:2},1024)]),_:2},1032,["to"])):["project_rename","project_commit","project_info_update"].includes(s.type)?(r(),h(V,{key:2},[s.type==="project_rename"?(r(),y(x,{key:0,class:"rename-card mb-3",to:`/app/link/project?id=${(Z=s.target)==null?void 0:Z.id}`},{default:l(()=>[t(T,null,{default:l(()=>{var d;return[a("div",ot,[t(k,{icon:"mdi-rename-box",color:"warning",class:"mr-2"}),a("span",nt,n((d=s.event_data)==null?void 0:d.project_title),1)]),a("div",rt,[a("div",dt,[i[8]||(i[8]=a("span",{class:"text-medium-emphasis"},"从",-1)),t(g,{size:"small",class:"mx-2",color:"surface-variant"},{default:l(()=>{var c;return[u(n((c=s.event_data)==null?void 0:c.old_name),1)]}),_:2},1024)]),a("div",ct,[i[9]||(i[9]=a("span",{class:"text-medium-emphasis"},"到",-1)),t(g,{size:"small",class:"mx-2",color:"warning"},{default:l(()=>{var c;return[u(n((c=s.event_data)==null?void 0:c.new_name),1)]}),_:2},1024)])]),a("div",ut,[t(g,{size:"x-small",class:"mr-1"},{default:l(()=>{var c;return[u(n((c=s.event_data)==null?void 0:c.project_type),1)]}),_:2},1024),t(g,{size:"x-small"},{default:l(()=>{var c;return[u(n((c=s.event_data)==null?void 0:c.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):s.type==="project_commit"?(r(),y(x,{key:1,class:"commit-card mb-3",to:`/app/link/project?id=${($=s.target)==null?void 0:$.id}`},{default:l(()=>[t(T,null,{default:l(()=>{var d,c,f;return[a("div",mt,[t(k,{icon:"mdi-source-commit",color:"info",class:"mr-2"}),a("span",_t,"分支: "+n((d=s.event_data)==null?void 0:d.branch),1)]),a("div",pt,n((c=s.event_data)==null?void 0:c.commit_message),1),a("div",ft," 提交ID: "+n((f=s.event_data)==null?void 0:f.commit_id.substring(0,7)),1)]}),_:2},1024)]),_:2},1032,["to"])):s.type==="project_info_update"?(r(),y(x,{key:2,class:"info-update-card mb-3",to:`/app/link/project?id=${(H=s.target)==null?void 0:H.id}`},{default:l(()=>[t(T,null,{default:l(()=>{var d,c;return[a("div",ht,[t(k,{icon:"mdi-file-document-edit",color:"info",class:"mr-2"}),a("span",yt,n((d=s.event_data)==null?void 0:d.project_title),1)]),a("div",vt,[(r(!0),h(V,null,D((c=s.event_data)==null?void 0:c.updated_fields,f=>{var X,Y;return r(),h("div",{key:f,class:"update-item mb-2"},[a("div",gt,[t(g,{size:"x-small",color:"info",class:"mr-2"},{default:l(()=>[u(n(_.getFieldDisplayName(f)),1)]),_:2},1024)]),a("div",bt,[a("div",xt,[i[10]||(i[10]=a("span",{class:"text-medium-emphasis"},"从：",-1)),a("span",jt,n((X=s.event_data)==null?void 0:X.old_values[f]),1)]),a("div",kt,[i[11]||(i[11]=a("span",{class:"text-medium-emphasis"},"到：",-1)),a("span",Ct,n((Y=s.event_data)==null?void 0:Y.new_values[f]),1)])])])}),128))]),a("div",Tt,[t(g,{size:"x-small",class:"mr-1"},{default:l(()=>{var f;return[u(n((f=s.event_data)==null?void 0:f.project_type),1)]}),_:2},1024),t(g,{size:"x-small"},{default:l(()=>{var f;return[u(n((f=s.event_data)==null?void 0:f.project_state),1)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["to"])):I("",!0)],64)):(r(),h("div",Vt,[s.type==="user_profile_update"?(r(),h("div",wt," 更新了："+n(_.getUpdatedFields((G=s.event_data)==null?void 0:G.updated_fields)),1)):((J=s.target)==null?void 0:J.type)==="project"?(r(),h("div",Pt,[a("span",null,n(((Q=o.eventTypes[s.type])==null?void 0:Q.text)||"操作了"),1),t(R,{to:`/app/link/project?id=${s.target.id}`,class:"text-decoration-none ml-1"},{default:l(()=>{var d;return[u(n(((d=s.event_data)==null?void 0:d.project_name)||s.target.title||`项目 #${s.target.id}`),1)]}),_:2},1032,["to"])])):(r(),h("div",Dt,n(_.getTargetContent(s.target,s.type)),1))]))])]}),_:2},1024))),128))]),_:1}),a("div",St,[_.hasMoreEvents?(r(),y(Me,{key:0,loading:o.isLoadingMore,variant:"tonal",onClick:_.loadMoreEvents},{default:l(()=>i[14]||(i[14]=[u(" 加载更多 ")])),_:1},8,["loading","onClick"])):o.timeline.events.length>0?(r(),h("div",zt," 没有更多内容了 ")):I("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Yt=ne(Je,[["render",It],["__scopeId","data-v-b89e0844"]]);export{Yt as default};
