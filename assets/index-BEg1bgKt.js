import{a as F,_ as R,b as z}from"./Comment-kBdeGAtQ.js";import{_ as K}from"./NewProjectList-CNEkThK_.js";import{_ as B,H as P,J as j,o as a,c as u,w as e,a as r,M as m,Y as L,L as i,T as c,$ as Q,a0 as C,a1 as S,a2 as I,e as h,R as g,S as x,Q as V,a3 as X,a4 as Y,a5 as Z,K as d,P as b,a6 as _,G as $,a7 as tt,a8 as et,a9 as N,aa as rt,Z as ot,X as D,ab as E,ac as H,ad as A,U as M,O as U}from"./index-BjbaqXGR.js";import{V as st}from"./VDialog-DOHLM7Ps.js";import{_ as G}from"./License--gu3Oe5X.js";import{o as lt}from"./openEdit-AJJkPSPH.js";import{i as it,g as at,a as nt,b as ct}from"./projectService-Bt6FpWZz.js";import{a as dt}from"./user-C9FMS1D-.js";import{a as k,V as ut}from"./VRow-C0WmWv5s.js";import{V as f}from"./VChip-Wz8iYLqb.js";import{V as pt}from"./VContainer-6jjBDW6J.js";import"./VForm-a5WXGmRq.js";import"./VTextarea-Dnl_HOAp.js";import"./VSpacer-BoQCDcek.js";/* empty css              */const mt={components:{NewProjectList:K},name:"ProjectStar",props:{projectId:{type:Number,required:!0}},data(){return{localuser:P,userinfo:P.user,newProjectListDialog:!1,star:!1,starinfo:{},projectLists:[]}},watch:{projectId:{immediate:!0,handler(s){this.getStarStatus(s),this.getProjectList(s)}}},methods:{getStarStatus(s){s&&j({url:`/projectlist/checkstar?projectid=${s}`,method:"get"}).then(o=>{this.star=o.data.star,this.starinfo=o.data})},ToggleStarProject(){this.star==0?j({url:"/projectlist/star",method:"post",data:{projectid:this.projectId}}).then(s=>{this.star=s.data.star,this.starinfo.count=Number(this.starinfo.count)+1}):j({url:"/projectlist/unstar",method:"post",data:{projectid:this.projectId}}).then(s=>{this.star=s.data.star,this.starinfo.count=Number(this.starinfo.count)-1})},async getProjectList(s){s&&(this.projectLists=(await j({url:"/projectlist/check?projectid="+s,method:"get"})).data.data)},async addProjectToList(s){await j({url:"/projectlist/add",data:{userid:this.userinfo.id,projectid:this.projectId,listid:s},method:"post"}).then(o=>{this.$toast.add({severity:"info",summary:"info",detail:o.data.message,life:3e3}),this.getProjectList(this.projectId)})},async removeProjectFromList(s){await j({url:"/projectlist/remove",data:{projectid:this.projectId,listid:s},method:"post"}).then(o=>{this.$toast.add({severity:"info",summary:"info",detail:o.data.message,life:3e3}),this.getProjectList(this.projectId)})}}};function ht(s,o,y,v,t,p){const w=K;return a(),u(Z,{border:"",density:"compact",rounded:"lg",size:"x-small"},{default:e(()=>[r(m,{onClick:o[0]||(o[0]=n=>p.ToggleStarProject()),variant:"tonal",class:"text-none",text:"Star"},{prepend:e(()=>[r(L,{icon:t.star?"mdi-star":"mdi-star-outline",color:t.star?"yellow":""},null,8,["icon","color"])]),default:e(()=>[i(c(t.star?"Starred":"Star")+" "+c(t.starinfo.count),1)]),_:1}),o[4]||(o[4]=i()),r(Q,{color:"surface-light",vertical:""}),r(C,{"close-on-content-click":!1},{activator:e(({props:n})=>[r(m,S({class:"px-5",icon:"mdi-menu-down"},n),null,16)]),default:e(()=>[r(I,null,{default:e(()=>[(a(!0),h(g,null,x(t.projectLists,n=>(a(),h("div",{key:n.id},[r(V,{"append-icon":n.include==!0?"mdi-minus-circle":"mdi-plus-circle",active:n.include==!0,color:"primary",onClick:T=>n.include==!0?p.removeProjectFromList(n.id):p.addProjectToList(n.id)},{default:e(()=>[r(X,null,{default:e(()=>[i(c(n.title),1)]),_:2},1024),r(Y,null,{default:e(()=>[i(c(n.description),1)]),_:2},1024)]),_:2},1032,["append-icon","active","onClick"])]))),128)),r(V,{onClick:o[1]||(o[1]=n=>t.newProjectListDialog=!0)},{default:e(()=>o[3]||(o[3]=[i("新建列表")])),_:1})]),_:1}),r(st,{modelValue:t.newProjectListDialog,"onUpdate:modelValue":o[2]||(o[2]=n=>t.newProjectListDialog=n)},{default:e(()=>[r(w,{listid:s.editlistid,close:()=>t.newProjectListDialog=!1,callback:p.getProjectList},null,8,["listid","close","callback"])]),_:1},8,["modelValue"])]),_:1})]),_:1})}const W=B(mt,[["render",ht]]),ft={data(){return{embedurl:"/",watchedtype:"",watchedid:"",pythonplayer:"",code:""}},props:{type:{type:String,default:"text"},id:{type:String,default:"1"}},watch:{type:async function(s,o){this.watchedtype=s,this.watchedid=s,this.type==="scratch"&&(this.embedurl=`/scratch/embed.html?id=${this.id}&branch=main&ref=latest&embed=true`),this.type==="python"&&(this.pythonplayer="/python/nextplay.html?id="+this.id)}}},_t=["src"],yt={key:1},jt={style:{width:"100%",height:"100%","aspect-ratio":"4 / 3"}},bt=["src"];function gt(s,o,y,v,t,p){return a(),h(g,null,[y.type==="scratch"?(a(),u(b,{key:0,hover:"",border:"",style:{"aspect-ratio":"4 / 3"}},{default:e(()=>[d("iframe",{src:t.embedurl,scrolling:"no",frameborder:"0",style:{width:"100%",height:"100%"}},null,8,_t)]),_:1})):_("",!0),y.type==="python"?(a(),h("div",yt,[d("div",jt,[d("iframe",{src:t.pythonplayer,scrolling:"no",frameborder:"0",style:{width:"100%",height:"100%"}},null,8,bt)])])):_("",!0)],64)}const vt=B(ft,[["render",gt]]),xt={components:{ProjectRunner:vt,TimeAgo:F,Comment:R,ProjectStar:W,Markdown:z,License:G},data(){return{project:{},author:{},openEditor:lt,localuser:P,tab:"readme",embedurl:"",projectbranchs:[],projectbranchhistory:[],showplayer:!0,player:{branch:"main",commit:{id:"latest"},latest_commit_hash:"latest"},initProject:it}},async mounted(){this.initlizeProject()},methods:{async initlizeProject(){const s=this.$route.params.username,o=this.$route.params.projectname;this.$route.params.username=="proxy"&&this.$router.replace(`/app${this.$route.path}`);const y=await at(s,o);this.project=y,this.project.id=this.project.id,this.player.branch=this.project.default_branch;var v=await nt(this.project.id);this.projectbranchs=v.data;const t=this.projectbranchs.find(p=>p.name===this.player.branch);console.log(t),console.log(t),console.log(t),t&&(this.player.commit.id=t.latest_commit_hash,this.player.latest_commit_hash=t.latest_commit_hash),this.loadProjectPlayer(),this.loadBranchHistory(),$({title:this.project.title}),this.author=await dt(this.project.authorid)},loadProjectPlayer(){this.embedurl=`/scratch/embed.html?id=${this.project.id}&branch=${this.player.branch}&ref=${this.player.commit.id}&embed=true`},loadBranchHistory(){ct(this.project.id,this.player.latest_commit_hash).then(s=>{this.projectbranchhistory=s})}},watch:{player:{handler:function(s,o){this.loadProjectPlayer(),this.loadBranchHistory()},deep:!0}}},Vt={style:{display:"flex","justify-content":"space-between"},class:"mb-2"},wt=["src"],kt={class:"px-4 d-flex ga-2 mb-2"},Pt={class:"px-4 d-flex ga-2 mb-2"},Lt={class:"px-4 d-flex ga-2 mb-2"},Ct={class:"px-4 d-flex ga-2 mb-2"},St={class:"px-4 d-flex ga-2 mb-2"},It={class:"px-4"};function Bt(s,o,y,v,t,p){const w=z,n=G,T=F,q=W,J=R;return a(),u(pt,null,{default:e(()=>[r(ut,null,{default:e(()=>[r(k,{xs:"12",sm:"12",md:"8",lg:"8",xl:"8",xxl:"8",cols:"12"},{default:e(()=>[d("div",Vt,[d("div",null,[r(C,{"close-on-content-click":!1},{activator:e(({props:l})=>[r(m,S({rounded:"lg",variant:"tonal",class:"text-none","prepend-icon":"mdi-git","append-icon":"mdi-menu-down"},l),{prepend:e(()=>[r(L)]),default:e(()=>[i(c(t.player.branch),1)]),_:2},1040)]),default:e(()=>[r(I,{dense:""},{default:e(()=>[(a(!0),h(g,null,x(t.projectbranchs,l=>(a(),u(V,{key:l,title:l.name,subtitle:l.description,value:l.name,active:l.name===t.player.branch,onClick:O=>{t.player.branch=l.name,t.player.commit.id=l.latest_commit_hash,t.player.latest_commit_hash=l.latest_commit_hash}},null,8,["title","subtitle","value","active","onClick"]))),128))]),_:1})]),_:1}),r(m,{class:"ml-2",variant:"text",to:`/${s.$route.params.username}/${s.$route.params.projectname}/branches`},{default:e(()=>[i(c(t.projectbranchs.length)+"个分支",1)]),_:1},8,["to"])]),r(C,{"close-on-content-click":!1},{activator:e(({props:l})=>[r(m,S({variant:"tonal",class:"text-none","prepend-icon":"mdi-history",rounded:"lg","append-icon":"mdi-menu-down"},l),{prepend:e(()=>[r(L)]),default:e(()=>[i(c(t.projectbranchhistory.length)+" 次提交",1)]),_:2},1040)]),default:e(()=>[r(I,{dense:""},{default:e(()=>[(a(!0),h(g,null,x(t.projectbranchhistory,l=>(a(),u(V,{key:l,title:l.commit_message,subtitle:`${l.commit_date} - #${l.author_id}`,active:l.id===t.player.commit.id,onClick:O=>t.player.commit.id=l.id},null,8,["title","subtitle","active","onClick"]))),128))]),_:1})]),_:1})]),t.showplayer==!0?(a(),u(b,{key:0,hover:"",border:"",style:{"aspect-ratio":"4 / 3"}},{default:e(()=>[d("iframe",{src:t.embedurl,scrolling:"no",frameborder:"0",style:{width:"100%",height:"100%"}},null,8,wt)]),_:1})):_("",!0),t.showplayer?_("",!0):(a(),u(b,{key:1,hover:"",border:"",title:t.player.commit.error_code},{default:e(()=>[r(tt,null,{default:e(()=>[r(m,{onClick:o[0]||(o[0]=l=>t.initProject(t.project.id))},{default:e(()=>o[4]||(o[4]=[i("以Scratch模板初始化项目")])),_:1})]),_:1})]),_:1},8,["title"])),o[7]||(o[7]=d("br",null,null,-1)),r(b,null,{default:e(()=>[r(et,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=l=>t.tab=l),"bg-color":"primary"},{default:e(()=>[r(N,{value:"readme"},{default:e(()=>o[5]||(o[5]=[i("README")])),_:1}),r(N,{value:"license"},{default:e(()=>o[6]||(o[6]=[i("LICENSE")])),_:1})]),_:1},8,["modelValue"]),r(rt,null,{default:e(()=>[r(ot,{modelValue:t.tab,"onUpdate:modelValue":o[2]||(o[2]=l=>t.tab=l)},{default:e(()=>[r(D,{value:"readme"},{default:e(()=>[r(w,null,{default:e(()=>[i(c(t.project.description),1)]),_:1})]),_:1}),r(D,{value:"license"},{default:e(()=>[r(n,{licenseKey:t.project.license||"none"},null,8,["licenseKey"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(k,{xs:"12",sm:"12",md:"4",lg:"4",xl:"4",xxl:"8",cols:"12"},{default:e(()=>[r(b,{hover:"",border:""},{default:e(()=>[r(E,null,{default:e(()=>[r(H,null,{default:e(()=>[i(c(t.project.title),1)]),_:1}),r(A,null,{default:e(()=>[i(c(t.project.description),1)]),_:1})]),_:1}),d("div",kt,[r(f,{pill:""},{default:e(()=>[r(M,{start:""},{default:e(()=>[r(U,{src:"https://s4-1.wuyuan.1r.ink/user/"+t.author.images},null,8,["src"])]),_:1}),i(c(t.author.display_name),1)]),_:1})]),d("div",Pt,[r(f,{pill:"","prepend-icon":"mdi-eye"},{default:e(()=>[i(c(t.project.view_count)+"浏览",1)]),_:1}),r(f,{pill:"","prepend-icon":"mdi-clock"},{default:e(()=>[r(T,{date:t.project.time},null,8,["date"])]),_:1})]),d("div",Lt,[t.project.state=="public"?(a(),u(f,{key:0,pill:"","prepend-icon":"mdi-xml"},{default:e(()=>o[8]||(o[8]=[i("开源作品")])),_:1})):_("",!0),t.project.state=="private"?(a(),u(f,{key:1,pill:"","prepend-icon":"mdi-xml"},{default:e(()=>o[9]||(o[9]=[i("私密作品")])),_:1})):_("",!0),r(f,{pill:"","prepend-icon":"mdi-application"},{default:e(()=>[i(c(t.project.type),1)]),_:1})]),d("div",Ct,[(a(!0),h(g,null,x(t.project.tags,l=>(a(),h("div",null,[r(f,null,{default:e(()=>[i(c(l.name),1)]),_:2},1024)]))),256))]),d("div",St,[r(q,{projectId:t.project.id},null,8,["projectId"]),r(m,{onClick:o[3]||(o[3]=l=>t.openEditor(t.project.id,t.project.type)),variant:"text"},{default:e(()=>o[10]||(o[10]=[i("打开创造页")])),_:1}),t.project.authorid!=t.localuser.user.id?(a(),u(m,{key:0,to:`${t.project.authorid}/${t.project.id}/fork`,variant:"text"},{default:e(()=>o[11]||(o[11]=[i("改编")])),_:1},8,["to"])):_("",!0)]),d("div",It,[r(b,{hover:"",to:"/"+t.author.username,border:""},{default:e(()=>[r(E,null,{prepend:e(()=>[r(M,null,{default:e(()=>[r(U,{alt:t.author.display_name,src:"https://s4-1.wuyuan.1r.ink/user/"+t.author.images},null,8,["alt","src"])]),_:1})]),default:e(()=>[r(H,{class:"text-white"},{default:e(()=>[i(c(t.author.display_name),1)]),_:1}),r(A,{class:"text-white"},{default:e(()=>[i(c(t.author.motto),1)]),_:1})]),_:1})]),_:1},8,["to"])]),o[12]||(o[12]=d("br",null,null,-1))]),_:1})]),_:1}),r(k,{xxl:"8",xl:"8",lg:"8",md:"8",sm:"12",xs:"12",cols:"12"},{default:e(()=>[r(J,{url:"project-"+t.project.id,name:"项目"},null,8,["url"])]),_:1})]),_:1})]),_:1})}const Jt=B(xt,[["render",Bt]]);export{Jt as default};
