import{_ as N,c as A,o as i,e as r,N as t,Y as m,a0 as I,af as L,L as n,U as u,b0 as U,a9 as p,f as g,aa as M,ab as w,aJ as R,O as j,i as T,Z as q,bm as z,bo as D,r as o,x as C,a7 as E,b as H,ag as J,br as O,az as P}from"./index-DHBb6a3D.js";import"https://static.geetest.com/v4/gt4.js";const Y={setup(){const x=z(),a=D(),s=o(!0),e=o(""),f=o(""),v=o(!1),c=o(0),b=o(null),d=o(null),S=C(()=>s.value?"正在验证登录":e.value?"验证失败":"验证成功"),B=C(()=>s.value?"请稍候，正在处理您的登录请求":e.value?"登录链接验证失败":"您已成功登录");return E({title:"魔术链接验证"}),H(async()=>{var _,V;if(J.isLogin.value===!0){a.push("/app/dashboard");return}const y=x.query.token;if(!y){s.value=!1,e.value="缺少验证令牌，无法完成验证";return}try{const l=await O.validateMagicLink(y);l.status==="success"?(s.value=!1,f.value=l.message||"登录成功！",v.value=!0,c.value=5,d.value=setInterval(()=>{c.value--,c.value<=0&&clearInterval(d.value)},1e3),b.value=setTimeout(()=>{var k;const h=((k=l.callback)==null?void 0:k.redirect)||"/app/dashboard";a.push(h)},5e3)):(s.value=!1,e.value=l.message||"验证失败")}catch(l){s.value=!1,l.value=((V=(_=l.response)==null?void 0:_.data)==null?void 0:V.message)||"验证过程中发生错误"}}),P(()=>{b.value&&clearTimeout(b.value),d.value&&clearInterval(d.value)}),{loading:s,error:e,success:f,loginSuccess:v,countdown:c,pageTitle:S,pageSubtitle:B}}},Z={class:"d-flex align-center justify-center pa-4"};function F(x,a,s,e,f,v){return i(),A("div",Z,[r(q,{border:"",class:"pa-4 pt-7","max-width":"448",rounded:"lg"},{default:t(()=>[r(L,{class:"text-h5 font-weight-semibold"},{default:t(()=>[n(u(e.pageTitle),1)]),_:1}),r(U,null,{default:t(()=>[n(u(e.pageSubtitle),1)]),_:1}),e.loading?(i(),m(p,{key:0},{default:t(()=>[r(M,{class:"mx-auto d-block mb-4",color:"primary",indeterminate:""}),a[0]||(a[0]=g("p",{class:"text-center"},"正在验证您的登录链接...",-1))]),_:1})):e.error?(i(),m(p,{key:1},{default:t(()=>[r(w,{border:"start",class:"mb-4",type:"error",variant:"tonal"},{default:t(()=>[n(u(e.error),1)]),_:1}),a[1]||(a[1]=g("p",{class:"text-body-2"}," 验证链接可能已失效或已被使用。请尝试重新获取登录链接，或使用其他方式登录。 ",-1))]),_:1})):e.success?(i(),m(p,{key:2},{default:t(()=>[r(w,{border:"start",class:"mb-4",type:"success",variant:"tonal"},{default:t(()=>[n(u(e.success),1)]),_:1}),a[2]||(a[2]=g("p",{class:"text-body-2"}," 您已成功登录，即将跳转到主页... ",-1))]),_:1})):I("",!0),r(R,null,{default:t(()=>[r(j),r(T,{disabled:e.loading||e.countdown>0,color:"primary",to:"/app/account/login",variant:"text"},{default:t(()=>[n(u(e.countdown>0?`${e.countdown}秒后跳转`:"返回登录"),1)]),_:1},8,["disabled"]),r(T,{disabled:e.loading||!e.loginSuccess||e.countdown>0,color:"primary",to:"/app/dashboard",variant:"flat"},{default:t(()=>[...a[3]||(a[3]=[n(" 去主页 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})])}const Q=N(Y,[["render",F]]);export{Q as default};
