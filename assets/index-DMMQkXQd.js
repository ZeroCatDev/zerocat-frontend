import{_ as v}from"./EditProjectListConfig-Cu6T2hEX.js";import{o as E}from"./openEdit-BX8FwpvB.js";import{_ as j,a5 as M,X as c,o as n,M as i,e,a8 as x,Q as f,R as d,aG as w,aC as B,a4 as F,aJ as C,N as y,i as p,Y as I,af as h,f as m,S,L as V,T as g,c as k,$ as L,Z as z,n as T,aI as q,a9 as O,aa as R,F as G,W as H,aF as b,U as J,a6 as Q}from"./index-3iUuPb_9.js";import{e as W,f as X}from"./projectListService-lCYwHtd8.js";import"https://static.geetest.com/v4/gt4.js";const Y={data(){return{projectInfo:{title:"",description:"",state:"private"},listStates:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],loading:!1,newId:0,openEdit:E}},props:{callback:{type:Function,required:!1},close:{type:Function,required:!1}},methods:{show(){this.projectInfo={title:"",description:"",state:"private"},this.loading=!1,this.newId=0},async newProjectList(){if(this.projectInfo.title){this.loading=!0;try{const s=await M.post("/projectlist/lists/create",this.projectInfo);this.$toast.add({severity:"info",summary:s.data.status==="success"?"成功":"错误",detail:s.data.message||"创建项目列表",life:3e3}),s.data.status==="success"&&(this.newId=s.data.data.id,this.callback&&this.callback(),this.close&&this.close())}catch(s){console.error("创建项目列表失败:",s),this.$toast.add({severity:"error",summary:"错误",detail:"创建项目列表失败",life:3e3})}finally{this.loading=!1}}}}};function Z(s,t,a,_,l,r){return n(),c(I,{border:"","prepend-icon":"mdi-format-list-bulleted",title:"新建列表"},{default:i(()=>[e(x,null,{default:i(()=>[e(f,{dense:""},{default:i(()=>[e(d,{cols:"12"},{default:i(()=>[e(w,{modelValue:l.projectInfo.title,"onUpdate:modelValue":t[0]||(t[0]=o=>l.projectInfo.title=o),rules:[o=>!!o||"标题不能为空"],hint:"将便于查找",label:"标题",required:""},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12"},{default:i(()=>[e(w,{modelValue:l.projectInfo.description,"onUpdate:modelValue":t[1]||(t[1]=o=>l.projectInfo.description=o),hint:"简要描述列表内容",label:"简介"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:i(()=>[e(B,{modelValue:l.projectInfo.state,"onUpdate:modelValue":t[2]||(t[2]=o=>l.projectInfo.state=o),items:l.listStates,"item-title":"state","item-value":"abbr",label:"列表状态"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(F),e(C,null,{default:i(()=>[e(y),e(p,{text:"关闭",variant:"plain",onClick:t[3]||(t[3]=o=>a.close())}),e(p,{disabled:!l.projectInfo.title,loading:l.loading,color:"primary",text:"创建",variant:"tonal",onClick:r.newProjectList},null,8,["disabled","loading","onClick"])]),_:1})]),_:1})}const D=j(Y,[["render",Z]]),K={props:{list:{type:Object,required:!0}},data(){return{projectCount:0,loading:!1,error:null}},computed:{isOwner(){const s=h.user.value;return s&&s.id===(this.list.authorid||this.list.userId)}},async created(){await this.fetchProjectCount()},setup(){return{localuser:h,getUserAvatar:t=>!t||!t.avatar?"":h.getUserAvatar(t.avatar)}},methods:{async fetchProjectCount(){var s;if(this.list.projects)this.projectCount=this.list.projects.length;else try{this.loading=!0;const t=await W(this.list.id);t.status==="success"&&t.data&&(this.projectCount=((s=t.data.projects)==null?void 0:s.length)||0)}catch(t){console.error(`获取列表 ${this.list.id} 项目数量失败:`,t)}finally{this.loading=!1}},formatDate(s){return s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未知"}}},$={class:"d-flex align-center"},tt={class:"text-caption"},et={class:"mt-2 d-flex align-center"},st={class:"text-caption"},it={key:0,class:"text-caption"};function lt(s,t,a,_,l,r){return n(),c(I,{subtitle:a.list.description||"无描述",title:a.list.title,to:`/app/projectlist/${a.list.id}`,class:"h-100"},{default:i(()=>[e(x,null,{default:i(()=>[m("div",$,[e(S,{color:a.list.state==="public"?"success":"warning",class:"mr-2",size:"small"},{default:i(()=>[V(g(a.list.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),m("span",tt,g(r.formatDate(a.list.updateTime||a.list.updatedAt)),1)]),m("div",et,[m("span",st,"项目数: "+g(l.projectCount),1),e(y),a.list.author?(n(),k("span",it,[e(z,{class:"mr-1",size:"16"},{default:i(()=>[e(T,{src:_.getUserAvatar(a.list.author),alt:"用户头像"},null,8,["src"])]),_:1}),V(" "+g(a.list.author.display_name||a.list.author.username||`用户${a.list.authorid}`),1)])):L("",!0)])]),_:1}),e(C,null,{default:i(()=>[r.isOwner?(n(),c(p,{key:0,color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:t[0]||(t[0]=q(o=>s.$emit("edit",a.list.id),["stop","prevent"]))})):L("",!0),e(y),e(p,{to:`/app/projectlist/${a.list.id}`,icon:"mdi-eye",size:"small",variant:"text"},null,8,["to"])]),_:1})]),_:1},8,["subtitle","title","to"])}const P=j(K,[["render",lt]]),at={components:{NewProjectList:D,EditProjectListConfig:v,ProjectListItem:P},data(){return{loading:!0,myLists:[],newListDialog:!1,editDialog:!1,selectedListId:null}},async created(){await this.fetchMyLists()},methods:{async fetchMyLists(){this.loading=!0;try{const s=await X();s.status==="success"?this.myLists=s.data||[]:this.$toast.add({severity:"error",summary:"错误",detail:s.message||"获取列表失败",life:3e3})}catch(s){console.error("获取我的列表失败:",s),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},openNewListDialog(){this.newListDialog=!0},openEditDialog(s){this.selectedListId=s,this.editDialog=!0}}};function ot(s,t,a,_,l,r){const o=P,N=D,A=v;return n(),c(J,null,{default:i(()=>[e(f,null,{default:i(()=>[e(d,{class:"d-flex align-center mb-4",cols:"12"},{default:i(()=>[t[3]||(t[3]=m("h2",{class:"text-h5"},"我的项目列表",-1)),e(y),e(p,{color:"primary","prepend-icon":"mdi-plus",onClick:r.openNewListDialog},{default:i(()=>t[2]||(t[2]=[V(" 新建列表 ",-1)])),_:1,__:[2]},8,["onClick"])]),_:1,__:[3]})]),_:1}),l.loading?(n(),c(f,{key:0},{default:i(()=>[e(d,{class:"text-center",cols:"12"},{default:i(()=>[e(O,{color:"primary",indeterminate:""})]),_:1})]),_:1})):l.myLists.length===0?(n(),c(f,{key:1},{default:i(()=>[e(d,{cols:"12"},{default:i(()=>[e(R,{type:"info",variant:"tonal"},{default:i(()=>t[4]||(t[4]=[V(' 您还没有创建任何项目列表，点击右上角的"新建列表"按钮创建一个吧！ ',-1)])),_:1,__:[4]})]),_:1})]),_:1})):(n(),c(f,{key:2},{default:i(()=>[(n(!0),k(G,null,H(l.myLists,u=>(n(),c(d,{key:u.id,cols:"12",lg:"3",md:"4",sm:"6"},{default:i(()=>[e(o,{list:u,onEdit:r.openEditDialog},null,8,["list","onEdit"])]),_:2},1024))),128))]),_:1})),e(b,{modelValue:l.newListDialog,"onUpdate:modelValue":t[0]||(t[0]=u=>l.newListDialog=u),"max-width":"600px"},{default:i(()=>[e(N,{callback:r.fetchMyLists,close:()=>l.newListDialog=!1},null,8,["callback","close"])]),_:1},8,["modelValue"]),e(b,{modelValue:l.editDialog,"onUpdate:modelValue":t[1]||(t[1]=u=>l.editDialog=u),"max-width":"600px"},{default:i(()=>[l.selectedListId?(n(),c(A,{key:0,callback:r.fetchMyLists,close:()=>l.editDialog=!1,listid:l.selectedListId},null,8,["callback","close","listid"])):L("",!0)]),_:1},8,["modelValue"])]),_:1})}const U=j(at,[["render",ot]]),nt={components:{ProjectListsView:U},data(){return{localuser:h}},name:"projectlist",setup(){Q({title:"我的项目列表"})}};function rt(s,t,a,_,l,r){const o=U;return n(),c(o)}const pt=j(nt,[["render",rt]]);export{pt as default};
