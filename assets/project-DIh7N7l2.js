import{_ as ge}from"./Projects-Dmlkrqs0.js";import{g as qe,a as He,ck as We,cl as Ge,cm as Je,u as $,cn as Ye,co as Ze,cp as Qe,w as W,L as ie,cs as Xe,d as $e,aG as _,e as a,f as j,P as ce,ct as el,F as ee,aE as ll,m as S,ai as tl,aj as de,cu as al,a5 as Ve,aT as nl,ci as ul,$ as ol,T as te,cv as sl,y as rl,z as il,h as cl,C as E,bw as dl,A as D,M as R,r as z,cw as vl,cx as ve,cr as ml,bx as pl,f0 as me,p as fl,by as hl,cz as gl,cA as Vl,_ as yl,o as bl,Y as Cl,N as r,R as pe,S as b,aC as O,i as U,aF as Pl,Z as xl,a9 as kl,U as fe,a1 as wl,a2 as Sl,a3 as jl,a4 as Il,aJ as Dl,O as Al,W as Fl,a6 as le,ag as he,a7 as _l}from"./index-C30_-gqw.js";import{u as Tl,h as Rl,m as Ul}from"./filter-CsjMEVhL.js";import{V as El}from"./VTextarea-DN100mDs.js";import{V as Ml}from"./VCombobox-BXkfOC2w.js";import"./ProjectCard-B1WnGwKa.js";import"https://static.geetest.com/v4/gt4.js";const Ll=fl({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Ul({filterKeys:["title"]}),...Vl(),...hl(gl({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),Bl=qe()({name:"VAutocomplete",props:Ll(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,n){let{slots:o}=n;const{t:ae}=He(),t=z(),h=R(!1),C=R(!0),u=R(!1),M=z(),L=z(),m=R(-1),A=R(null),{items:G,transformIn:ye,transformOut:be}=We(e),{textColorClasses:Ce,textColorStyles:Pe}=Ge(()=>{var l;return(l=t.value)==null?void 0:l.color}),{InputIcon:xe}=Je(e),p=$(e,"search",""),i=$(e,"modelValue",[],l=>ye(l===null?[null]:Ye(l)),l=>{const s=be(l);return e.multiple?s:s[0]??null}),ke=D(()=>typeof e.counterValue=="function"?e.counterValue(i.value):typeof e.counterValue=="number"?e.counterValue:i.value.length),T=Ze(e),{filteredItems:J,getMatches:we}=Tl(e,G,()=>A.value??(C.value?"":p.value)),I=D(()=>e.hideSelected&&A.value===null?J.value.filter(l=>!i.value.some(s=>s.value===l.value)):J.value),ne=pl(()=>e.closableChips&&!T.isReadonly.value&&!T.isDisabled.value),K=D(()=>!!(e.chips||o.chip)),B=D(()=>K.value||!!o.selection),Se=D(()=>i.value.map(l=>l.props.value)),N=D(()=>I.value.find(l=>l.type==="item"&&!l.props.disabled)),Y=D(()=>{var s;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&p.value===((s=N.value)==null?void 0:s.title))&&I.value.length>0&&!C.value&&!u.value}),q=D(()=>e.hideNoData&&!I.value.length||T.isReadonly.value||T.isDisabled.value),Z=$(e,"menu"),f=D({get:()=>Z.value,set:l=>{var s;Z.value&&!l&&((s=M.value)!=null&&s.ΨopenChildren.size)||l&&q.value||(Z.value=l)}}),{menuId:je,ariaExpanded:Ie,ariaControls:De}=Qe(e,f),Q=z(),Ae=vl(Q,t);function Fe(l){e.openOnClear&&(f.value=!0),p.value=""}function _e(){q.value||(f.value=!0)}function Te(l){q.value||(h.value&&(l.preventDefault(),l.stopPropagation()),f.value=!f.value)}function Re(l){var s;(ve(l)||l.key==="Backspace")&&((s=t.value)==null||s.focus())}function Ue(l){var g,P,d,y,k;if(T.isReadonly.value)return;const s=(g=t.value)==null?void 0:g.selectionStart,v=i.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(f.value=!0),["Escape"].includes(l.key)&&(f.value=!1),Y.value&&["Enter","Tab"].includes(l.key)&&N.value&&!i.value.some(V=>{let{value:c}=V;return c===N.value.value})&&F(N.value),l.key==="ArrowDown"&&Y.value&&((P=Q.value)==null||P.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&B.value&&i.value.length>0&&!p.value)return F(i.value[0],!1);if(~m.value){l.preventDefault();const V=m.value;F(i.value[m.value],!1),m.value=V>=v-1?v-2:V}else l.key==="Backspace"&&!p.value&&(m.value=v-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(m.value<0&&s&&s>0)return;const V=m.value>-1?m.value-1:v-1;if(i.value[V])m.value=V;else{const c=((d=p.value)==null?void 0:d.length)??null;m.value=-1,(y=t.value)==null||y.setSelectionRange(c,c)}}else if(l.key==="ArrowRight"){if(m.value<0)return;const V=m.value+1;i.value[V]?m.value=V:(m.value=-1,(k=t.value)==null||k.setSelectionRange(0,0))}else~m.value&&ve(l)&&(m.value=-1)}function Ee(l){if(me(t.value,":autofill")||me(t.value,":-webkit-autofill")){const s=G.value.find(v=>v.title===l.target.value);s&&F(s)}}function Me(){var l;e.eager&&((l=L.value)==null||l.calculateVisibleItems())}function Le(){var l;h.value&&(C.value=!0,(l=t.value)==null||l.focus()),A.value=null}function Be(l){h.value=!0,setTimeout(()=>{u.value=!0})}function Ne(l){u.value=!1}function Oe(l){(l==null||l===""&&!e.multiple&&!B.value)&&(i.value=[])}const X=R(!1);function F(l){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const v=i.value.findIndex(P=>(e.valueComparator||ml)(P.value,l.value)),g=s??!~v;if(~v){const P=g?[...i.value,l]:[...i.value];P.splice(v,1),i.value=P}else g&&(i.value=[...i.value,l]);e.clearOnSelect&&(p.value="")}else{const v=s!==!1;i.value=v?[l]:[],A.value=C.value?"":p.value??"",p.value=v&&!B.value?l.title:"",ie(()=>{f.value=!1,C.value=!0})}}return W(h,(l,s)=>{var v;l!==s&&(l?(X.value=!0,p.value=e.multiple||B.value?"":String(((v=i.value.at(-1))==null?void 0:v.props.title)??""),C.value=!0,ie(()=>X.value=!1)):(!e.multiple&&p.value==null&&(i.value=[]),f.value=!1,!C.value&&p.value&&(A.value=p.value),p.value="",m.value=-1))}),W(p,l=>{!h.value||X.value||(l&&(f.value=!0),C.value=!l)}),W(f,l=>{if(!e.hideSelected&&l&&i.value.length&&C.value){const s=I.value.findIndex(v=>i.value.some(g=>v.value===g.value));Xe&&window.requestAnimationFrame(()=>{var v;s>=0&&((v=L.value)==null||v.scrollToIndex(s))})}l&&(A.value=null)}),W(G,(l,s)=>{f.value||h.value&&!s.length&&l.length&&(f.value=!0)}),$e(()=>{const l=!!(!e.hideNoData||I.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),s=i.value.length>0,v=_.filterProps(e);return a(_,S({ref:t},v,{modelValue:p.value,"onUpdate:modelValue":[g=>p.value=g,Oe],focused:h.value,"onUpdate:focused":g=>h.value=g,validationValue:i.externalValue,counterValue:ke.value,dirty:s,onChange:Ee,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":f.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!B.value,"v-autocomplete--selecting-index":m.value>-1},e.class],style:e.style,readonly:T.isReadonly.value,placeholder:s?void 0:e.placeholder,"onClick:clear":Fe,"onMousedown:control":_e,onKeydown:Ue,"aria-expanded":Ie.value,"aria-controls":De.value}),{...o,default:g=>{let{id:P}=g;return j(ee,null,[a(ll,S({id:je.value,ref:M,modelValue:f.value,"onUpdate:modelValue":d=>f.value=d,activator:"parent",contentClass:"v-autocomplete__content",disabled:q.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Me,onAfterLeave:Le},e.menuProps),{default:()=>[l&&a(tl,S({ref:Q,filterable:!0,selected:Se.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:d=>d.preventDefault(),onKeydown:Re,onFocusin:Be,onFocusout:Ne,tabindex:"-1",selectable:!!I.value.length,"aria-live":"polite","aria-labelledby":`${P.value}-label`,"aria-multiselectable":e.multiple,color:e.itemColor??e.color},Ae,e.listProps),{default:()=>{var d,y,k;return[(d=o["prepend-item"])==null?void 0:d.call(o),!I.value.length&&!e.hideNoData&&(((y=o["no-data"])==null?void 0:y.call(o))??a(de,{key:"no-data",title:ae(e.noDataText)},null)),a(al,{ref:L,renderless:!0,items:I.value,itemKey:"value"},{default:V=>{var oe,se,re;let{item:c,index:w,itemRef:x}=V;const ue=S(c.props,{ref:x,key:c.value,active:Y.value&&c===N.value?!0:void 0,onClick:()=>F(c,null),"aria-posinset":w+1,"aria-setsize":I.value.length});return c.type==="divider"?((oe=o.divider)==null?void 0:oe.call(o,{props:c.raw,index:w}))??a(Ve,S(c.props,{key:`divider-${w}`}),null):c.type==="subheader"?((se=o.subheader)==null?void 0:se.call(o,{props:c.raw,index:w}))??a(nl,S(c.props,{key:`subheader-${w}`}),null):((re=o.item)==null?void 0:re.call(o,{item:c,index:w,props:ue}))??a(de,S(ue,{role:"option"}),{prepend:H=>{let{isSelected:ze}=H;return j(ee,null,[e.multiple&&!e.hideSelected?a(ul,{key:c.value,modelValue:ze,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Ke=>Ke.preventDefault()},null):void 0,c.props.prependAvatar&&a(ol,{image:c.props.prependAvatar},null),c.props.prependIcon&&a(ce,{icon:c.props.prependIcon},null)])},title:()=>{var H;return C.value?c.title:Rl("v-autocomplete",c.title,(H=we(c))==null?void 0:H.title)}})}}),(k=o["append-item"])==null?void 0:k.call(o)]}})]}),i.value.map((d,y)=>{function k(x){x.stopPropagation(),x.preventDefault(),F(d,!1)}const V=S(te.filterProps(d.props),{"onClick:close":k,onKeydown(x){x.key!=="Enter"&&x.key!==" "||(x.preventDefault(),x.stopPropagation(),k(x))},onMousedown(x){x.preventDefault(),x.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),c=K.value?!!o.chip:!!o.selection,w=c?sl(K.value?o.chip({item:d,index:y,props:V}):o.selection({item:d,index:y})):void 0;if(!(c&&!w))return j("div",{key:d.value,class:il(["v-autocomplete__selection",y===m.value&&["v-autocomplete__selection--selected",Ce.value]]),style:rl(y===m.value?Pe.value:{})},[K.value?o.chip?a(cl,{key:"chip-defaults",defaults:{VChip:{closable:ne.value,size:"small",text:d.title}}},{default:()=>[w]}):a(te,S({key:"chip",closable:ne.value,size:"small",text:d.title,disabled:d.props.disabled},V),null):w??j("span",{class:"v-autocomplete__selection-text"},[d.title,e.multiple&&y<i.value.length-1&&j("span",{class:"v-autocomplete__selection-comma"},[E(",")])])])})])},"append-inner":function(){var y,k;for(var g=arguments.length,P=new Array(g),d=0;d<g;d++)P[d]=arguments[d];return j(ee,null,[(y=o["append-inner"])==null?void 0:y.call(o,...P),e.menuIcon?a(ce,{class:"v-autocomplete__menu-icon",color:(k=t.value)==null?void 0:k.fieldIconColor,icon:e.menuIcon,onMousedown:Te,onClick:el,"aria-hidden":!0,tabindex:"-1"},null):void 0,e.appendInnerIcon&&a(xe,{key:"append-icon",name:"appendInner",color:P[0].iconColor.value},null)])}})}),dl({isFocused:h,isPristine:C,menu:f,search:p,filteredItems:J,select:F},t)}}),Nl={components:{Projects:ge},data(){return{localuser:he,projectstates:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],projecthistory:[{state:"关闭",abbr:"0"},{state:"开启",abbr:"1"}],searchstates:[{state:"所有",abbr:""},{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],typeitems:[{name:"所有",type:""},{name:"Scratch",type:"scratch"},{name:"Python",type:"python"}],orderitems:[{name:"观看量升序",type:"view_up"},{name:"观看量降序",type:"view_down"},{name:"时间升序",type:"time_up"},{name:"时间降序",type:"time_down"},{name:"序号升序",type:"id_up"},{name:"序号降序",type:"id_down"}],currentProjectID:0,dialog:!1,currentProject:{},previousProject:{},search:{title:"",type:"",description:"",source:"",order:"view_up",authorid:"",type:"",state:"",tag:""},aboutTags:{items:["动画","故事","音乐","硬核","艺术","水"],chips:z({}),selected:[]},url:""}},setup(){_l({title:"我的作品"})},async mounted(){await this.onPageChange()},methods:{removetag(e){chips.value.splice(chips.value.indexOf(e),1)},projecttypeProps(e){return{title:e.name,subtitle:e.department}},async onPageChange(e=1){this.url=`/searchapi?search_userid=${he.user.value.id}&search_type=${this.search.type}&search_title=${this.search.title}&search_source=${this.search.source}&search_description=${this.search.description}&search_orderby=${this.search.order}&search_state=${this.search.state}&search_tag=${this.search.tag}`},resetSearch(){this.search={title:"",type:"scratch",description:"",source:"",order:"view_up",authorid:"",state:"public",tag:"",limit:20},this.onPageChange()},openinfo(e,n){this.currentProjectID=e,this.currentProject=n,this.previousProject={...n},this.aboutTags.chips=this.currentProject.tags.map(o=>o.name),this.dialog=!0},async pushproject(e){try{const n=await le.post(`/project/${e}/push`);console.log(n.data),this.$toast.add({severity:"info",summary:"info",detail:n.data.message,life:3e3}),this.onPageChange()}catch(n){console.log(n),this.$toast.add({severity:"error",summary:"失败",detail:"失败",life:3e3})}},async deleteProject(){try{const e=await le.delete(`/project/edit/${this.currentProjectID}`);console.log(e.data),this.$toast.add({severity:"info",summary:"info",detail:e.data.message,life:3e3}),this.onPageChange(),this.dialog=!1}catch(e){console.log(e),this.$toast.add({severity:"error",summary:"error",detail:"删除失败",life:3e3})}},async SaveProjectsInfo(){this.currentProject.tags=this.aboutTags.chips.map(e=>e);try{const e=await le.put(`/project/id/${this.currentProjectID}`,this.currentProject);console.log(e.data),this.$toast.add({severity:"info",summary:"info",detail:e.data.message,life:3e3}),this.dialog=!1,this.onPageChange()}catch(e){console.log(e),this.$toast.add({severity:"error",summary:"error",detail:"修改失败",life:3e3})}}}};function Ol(e,n,o,ae,t,h){const C=ge;return bl(),Cl(Fl,null,{default:r(()=>[a(pe,null,{default:r(()=>[a(b,{cols:"6"},{default:r(()=>[a(_,{modelValue:t.search.title,"onUpdate:modelValue":n[0]||(n[0]=u=>t.search.title=u),label:"作品名 包含："+t.search.title},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"6"},{default:r(()=>[a(_,{modelValue:t.search.description,"onUpdate:modelValue":n[1]||(n[1]=u=>t.search.description=u),label:"作品描述 包含："+t.search.description},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"6"},{default:r(()=>[a(_,{modelValue:t.search.source,"onUpdate:modelValue":n[2]||(n[2]=u=>t.search.source=u),label:"作品内容 包含："+t.search.source},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"6"},{default:r(()=>[a(_,{modelValue:t.localuser.user.id,"onUpdate:modelValue":n[3]||(n[3]=u=>t.localuser.user.id=u),label:"用户ID 为："+t.search.authorid,"control-variant":"用户ID",disabled:""},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(O,{modelValue:t.search.order,"onUpdate:modelValue":n[4]||(n[4]=u=>t.search.order=u),items:t.orderitems,"item-title":"name","item-value":"type",label:"排序"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(O,{modelValue:t.search.type,"onUpdate:modelValue":n[5]||(n[5]=u=>t.search.type=u),items:t.typeitems,"item-title":"name","item-value":"type",label:"项目类型"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(O,{modelValue:t.search.state,"onUpdate:modelValue":n[6]||(n[6]=u=>t.search.state=u),items:t.searchstates,"item-title":"state","item-value":"abbr",label:"项目状态"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"3"},{default:r(()=>[a(Bl,{modelValue:t.search.tag,"onUpdate:modelValue":n[7]||(n[7]=u=>t.search.tag=u),items:["","动画","故事","音乐","硬核","艺术","水"],label:"标签 为："+t.search.tag},null,8,["modelValue","label"])]),_:1}),a(b,{cols:"12"},{default:r(()=>[a(U,{"append-icon":"mdi-magnify",color:"primary",rounded:"xl",variant:"flat",onClick:n[8]||(n[8]=u=>h.onPageChange())},{default:r(()=>[...n[18]||(n[18]=[E("搜索 ",-1)])]),_:1}),a(U,{color:"",rounded:"xl",variant:"flat",onClick:n[9]||(n[9]=u=>{t.search.order="view_up",t.search.type="",t.search.authorid="",t.search.source="",t.search.description="",t.search.title="",t.search.state="public",h.onPageChange()})},{default:r(()=>[...n[19]||(n[19]=[E("重置 ",-1)])]),_:1})]),_:1})]),_:1}),n[23]||(n[23]=j("br",null,null,-1)),n[24]||(n[24]=j("br",null,null,-1)),a(C,{url:t.url},null,8,["url"]),a(Pl,{modelValue:t.dialog,"onUpdate:modelValue":n[17]||(n[17]=u=>t.dialog=u),"max-width":"70vw",origin:"center center",persistent:""},{default:r(()=>[a(xl,{"prepend-icon":"mdi-xml",title:"作品信息"},{default:r(()=>[a(kl,null,{default:r(()=>[a(pe,{dense:""},{default:r(()=>[a(b,{cols:"12",md:"12",sm:"12"},{default:r(()=>[a(_,{modelValue:t.currentProject.title,"onUpdate:modelValue":n[10]||(n[10]=u=>t.currentProject.title=u),hint:"将会在首页展示",label:"标题",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"12",sm:"12"},{default:r(()=>[a(El,{modelValue:t.currentProject.description,"onUpdate:modelValue":n[11]||(n[11]=u=>t.currentProject.description=u),hint:"介绍作品类型，玩法，并向对这个作品有帮助的人致谢！",label:"简介"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",sm:"6"},{default:r(()=>[a(O,{modelValue:t.currentProject.type,"onUpdate:modelValue":n[12]||(n[12]=u=>t.currentProject.type=u),items:["scratch","python","text"],hint:"不建议你改",label:"类型",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",sm:"6"},{default:r(()=>[a(O,{modelValue:t.currentProject.state,"onUpdate:modelValue":n[13]||(n[13]=u=>t.currentProject.state=u),items:t.projectstates,hint:"我们鼓励开源","item-title":"state","item-value":"abbr",label:"项目状态"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"12"},{default:r(()=>[a(Ml,{modelValue:t.aboutTags.chips,"onUpdate:modelValue":n[14]||(n[14]=u=>t.aboutTags.chips=u),items:t.aboutTags.items,chips:"",label:"标签",multiple:"","prepend-icon":"mdi-tag",variant:"solo"},{selection:r(({attrs:u,item:M,select:L,selected:m})=>[a(te,S({"model-value":m,closable:""},u,{onClick:L,"onClick:close":A=>h.removetag(M)}),{default:r(()=>[j("strong",null,fe(M.name),1),n[20]||(n[20]=E("  ",-1)),n[21]||(n[21]=j("span",null,"(interest)",-1))]),_:2},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue","items"])]),_:1}),a(wl,null,{default:r(()=>[a(Sl,null,{default:r(()=>[a(jl,null,{default:r(()=>[...n[22]||(n[22]=[E("详细数据",-1)])]),_:1}),a(Il,null,{default:r(()=>[E(fe(t.currentProject),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Ve),a(Dl,null,{default:r(()=>[a(U,{color:"error",text:"删除",variant:"tonal",onClick:h.deleteProject},null,8,["onClick"]),a(U,{color:"text",text:"一键推送",variant:"tonal",onClick:n[15]||(n[15]=u=>h.pushproject(t.currentProject.id))}),a(Al),a(U,{text:"取消",variant:"plain",onClick:n[16]||(n[16]=u=>t.dialog=!1)}),a(U,{color:"primary",text:"保存",variant:"tonal",onClick:h.SaveProjectsInfo},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Yl=yl(Nl,[["render",Ol]]);export{Yl as default};
