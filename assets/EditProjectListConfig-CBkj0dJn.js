import{_ as y,a5 as d,aZ as h,X as I,o as b,M as a,e as s,a8 as u,aG as f,aC as V,aJ as c,i as r,N as g,aF as v,Y as m,ae as L,L as o,T as w}from"./index-CmO9_o1Q.js";const S={data(){return{listStates:[{state:"私密",abbr:"private"},{state:"公开",abbr:"public"}],loading:!0,saving:!1,deleting:!1,deleteDialog:!1,listInfo:{},newListInfo:{},sudoManager:h()}},props:{listid:{type:String,required:!0},callback:{type:Function,required:!1},close:{type:Function,required:!1}},computed:{hasChanges(){return JSON.stringify(this.listInfo)!==JSON.stringify(this.newListInfo)}},methods:{async getProjectList(i){this.loading=!0;try{const e=await d.get(`/projectlist/lists/listid/${i}`);e.data.status==="success"?(this.listInfo=JSON.parse(JSON.stringify(e.data.data)),this.newListInfo=JSON.parse(JSON.stringify(e.data.data))):this.$toast.add({severity:"error",summary:"错误",detail:e.data.message||"获取列表信息失败",life:3e3})}catch(e){console.error("获取列表信息失败:",e),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表信息失败",life:3e3})}finally{this.loading=!1}},async updateProjectList(){if(this.newListInfo.title){this.saving=!0;try{const i=await d.post(`/projectlist/lists/update/${this.listid}`,this.newListInfo);this.$toast.add({severity:i.data.status==="success"?"success":"error",summary:i.data.status==="success"?"成功":"错误",detail:i.data.message||"更新列表信息",life:3e3}),i.data.status==="success"&&(this.listInfo=JSON.parse(JSON.stringify(this.newListInfo)),this.callback&&this.callback())}catch(i){console.error("更新列表信息失败:",i),this.$toast.add({severity:"error",summary:"错误",detail:"更新列表信息失败",life:3e3})}finally{this.saving=!1}}},confirmDelete(){this.deleteDialog=!0},async deleteProjectList(){this.deleting=!0;try{const i=await this.sudoManager.requireSudo({title:"删除作品列表",subtitle:`您正在删除作品列表"${this.listInfo.title}"。此操作不可逆，请验证您的身份。`,persistent:!0}),e=await d.post("/projectlist/lists/delete",{id:this.listid},{headers:{"X-Sudo-Token":i}});this.$toast.add({severity:e.data.status==="success"?"info":"error",summary:e.data.status==="success"?"成功":"错误",detail:e.data.message||"删除列表",life:3e3}),e.data.status==="success"&&(this.deleteDialog=!1,this.callback&&this.callback(),this.close&&this.close())}catch(i){i.type!=="cancelled"&&(console.error("删除列表失败:",i),this.$toast.add({severity:"error",summary:"错误",detail:"删除列表失败",life:3e3}))}finally{this.deleting=!1}}},mounted(){this.getProjectList(this.listid)}};function k(i,e,p,C,t,n){return b(),I(m,{loading:t.loading,subtitle:`ID: ${t.listInfo.id||""}`,title:`${t.listInfo.title||"加载中..."}`,border:""},{default:a(()=>[s(u,null,{default:a(()=>[s(f,{modelValue:t.newListInfo.title,"onUpdate:modelValue":e[0]||(e[0]=l=>t.newListInfo.title=l),rules:[l=>!!l||"名称不能为空"],label:"名称",required:""},null,8,["modelValue","rules"]),s(f,{modelValue:t.newListInfo.description,"onUpdate:modelValue":e[1]||(e[1]=l=>t.newListInfo.description=l),label:"简介"},null,8,["modelValue"]),s(V,{modelValue:t.newListInfo.state,"onUpdate:modelValue":e[2]||(e[2]=l=>t.newListInfo.state=l),items:t.listStates,"item-title":"state","item-value":"abbr",label:"项目状态"},null,8,["modelValue","items"])]),_:1}),s(c,null,{default:a(()=>[s(r,{color:"error","prepend-icon":"mdi-delete",text:"删除",variant:"plain",onClick:n.confirmDelete},null,8,["onClick"]),s(g),s(r,{disabled:!n.hasChanges,"prepend-icon":"mdi-refresh",text:"重置",variant:"plain",onClick:e[3]||(e[3]=l=>t.newListInfo=JSON.parse(JSON.stringify(t.listInfo)))},null,8,["disabled"]),s(r,{text:"关闭",variant:"plain",onClick:e[4]||(e[4]=l=>p.close())}),s(r,{disabled:!n.hasChanges||!t.newListInfo.title,loading:t.saving,color:"primary","prepend-icon":"mdi-content-save",text:"保存",variant:"tonal",onClick:n.updateProjectList},null,8,["disabled","loading","onClick"])]),_:1}),s(v,{modelValue:t.deleteDialog,"onUpdate:modelValue":e[6]||(e[6]=l=>t.deleteDialog=l),"max-width":"500px"},{default:a(()=>[s(m,null,{default:a(()=>[s(L,{class:"text-h5"},{default:a(()=>e[7]||(e[7]=[o("确认删除",-1)])),_:1,__:[7]}),s(u,null,{default:a(()=>[o(' 您确定要删除列表 "'+w(t.listInfo.title)+'" 吗？此操作不可撤销。 ',1)]),_:1}),s(c,null,{default:a(()=>[s(g),s(r,{color:"primary",variant:"text",onClick:e[5]||(e[5]=l=>t.deleteDialog=!1)},{default:a(()=>e[8]||(e[8]=[o("取消",-1)])),_:1,__:[8]}),s(r,{loading:t.deleting,color:"error",variant:"text",onClick:n.deleteProjectList},{default:a(()=>e[9]||(e[9]=[o("删除",-1)])),_:1,__:[9]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["loading","subtitle","title"])}const N=y(S,[["render",k]]);export{N as _};
