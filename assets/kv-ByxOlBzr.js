import{a1 as S,_ as Z,r as s,b as ee,Y as ae,o as le,N as l,e as a,Q as P,R,f as C,i as v,L as u,aB as z,W as B,X as g,m as te,aA as A,a9 as K,a3 as M,aF as oe,aD as se,aE as Q,bz as ne,T as re}from"./index-Dz-hN2N-.js";import{V as ue}from"./VDataTableServer-Bf6JF0oP.js";import{V as ie}from"./VTooltip-DixLIMmb.js";import{V as de}from"./VTextarea-DaSo0WVx.js";import{V as j}from"./VSpacer-CmE8AOMV.js";import"https://static.geetest.com/v4/gt4.js";import"./VDataTable-CuXOZFDB.js";import"./VSelect-0_P7mExN.js";import"./VCheckboxBtn-BYIbfSha.js";import"./VSelectionControl-D2CrIs_u.js";import"./VTable-BaHIftig.js";import"./filter-D9jBFKMx.js";async function q(i){var r;try{return(await S.get(`/cachekv/${encodeURIComponent(i)}`)).data}catch(n){if(((r=n.response)==null?void 0:r.status)===404)return;throw n}}async function ce(i,r){return(await S.post(`/cachekv/${encodeURIComponent(i)}`,r)).data.data}async function ve(i){var r;try{return await S.delete(`/cachekv/${encodeURIComponent(i)}`),!0}catch(n){if(((r=n.response)==null?void 0:r.status)===404)return!1;throw n}}async function me({page:i=1,limit:r=20,showValue:n=!1,total:V=!1}={}){const f=await S.get("/cachekv",{params:{page:i,limit:r,showValue:n,total:V}});return{items:f.data.data,pagination:f.data.pagination}}const fe={class:"font-weight-medium"},pe={class:"value-preview"},ye={class:"value-full"},ge={__name:"kv",setup(i){const r=[{title:"缓存键",key:"key",sortable:!0},{title:"缓存值",key:"value",sortable:!1},{title:"操作",key:"actions",sortable:!1,align:"end"}],n=s([]),V=s(!1),f=s(!1),U=s(!1),k=s(""),w=s(!1),_=s(!1),p=s(null),D=s(null),F=s(null),x=s(1),h=s(10),I=s(0),N=s([]),m=s({show:!1,text:"",color:"success"}),d=s({key:"",value:""});async function L(t){x.value=t.page,h.value=t.itemsPerPage,N.value=t.sortBy,await b()}async function b(){var t,e,o,y;V.value=!0;try{if(k.value.trim()){const c=await q(k.value.trim());n.value=[{columns:{key:k.value.trim(),value:c}}],I.value=1}else{const c=await me({page:x.value,limit:h.value,showValue:!0,sortField:(e=(t=N.value)==null?void 0:t[0])==null?void 0:e.key,sortOrder:(y=(o=N.value)==null?void 0:o[0])==null?void 0:y.order,total:!0});n.value=c.items.map(H=>({columns:H})),I.value=c.pagination.total,x.value=c.pagination.page,h.value=c.pagination.limit}}catch(c){$("Failed to load items"),console.error("Error loading items:",c),n.value=[],I.value=0}finally{V.value=!1}}function T(t){try{if(typeof t=="string"){const e=JSON.parse(t);return JSON.stringify(e,null,2)}return JSON.stringify(t,null,2)}catch{return t}}async function O(){if(F.value.validate()){f.value=!0;try{const t=d.value.value;let e;try{e=JSON.parse(t)}catch{e=t}await ce(d.value.key,e),J(p.value?"Item updated successfully":"Item created successfully"),E(),b()}catch(t){$("Failed to save item"),console.error("Error saving item:",t)}finally{f.value=!1}}}function W(t){p.value=t,d.value={key:t.key,value:T(t.value)},w.value=!0}function X(t){D.value=t,_.value=!0}async function Y(){if(D.value){U.value=!0;try{await ve(D.value),J("Item deleted successfully"),_.value=!1,b()}catch(t){$("Failed to delete item"),console.error("Error deleting item:",t)}finally{U.value=!1}}}function E(){w.value=!1,p.value=null,d.value={key:"",value:""}}function J(t){m.value={show:!0,text:t,color:"success"}}function $(t){m.value={show:!0,text:t,color:"error"}}function G(){x.value=1,b()}return ee(async()=>{b(),console.log(await q("ces1_d9978c65"))}),(t,e)=>(le(),ae(re,null,{default:l(()=>[a(P,{class:"mb-4"},{default:l(()=>[a(R,{class:"d-flex justify-space-between align-center",cols:"12"},{default:l(()=>[e[10]||(e[10]=C("h1",{class:"text-h4"},"缓存管理",-1)),a(v,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>w.value=!0)},{default:l(()=>e[9]||(e[9]=[u(" 创建缓存 ",-1)])),_:1,__:[9]})]),_:1,__:[10]})]),_:1}),a(P,{class:"mb-4"},{default:l(()=>[a(R,{cols:"12",sm:"6"},{default:l(()=>[a(z,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),clearable:"",density:"comfortable","hide-details":"",label:"缓存键",placeholder:"输入缓存键以读取特定缓存","prepend-inner-icon":"mdi-key",variant:"outlined",onInput:G},null,8,["modelValue"])]),_:1})]),_:1}),a(B,null,{default:l(()=>[a(ue,{headers:r,items:n.value,"items-length":I.value,"items-per-page":h.value,"items-per-page-options":[10,25,50,100],loading:V.value,page:x.value,class:"elevation-1","onUpdate:options":L},{"item.key":l(({item:o})=>[C("div",fe,g(o.columns.key),1)]),"item.value":l(({item:o})=>[a(ie,{location:"bottom"},{activator:l(({props:y})=>[C("div",te({class:"text-truncate",style:{"max-width":"300px"}},y),[C("pre",pe,g(T(o.columns.value)),1)],16)]),default:l(()=>[C("pre",ye,g(T(o.columns.value)),1)]),_:2},1024)]),"item.actions":l(({item:o})=>[a(v,{color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:y=>W(o.columns)},null,8,["onClick"]),a(v,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:y=>X(o.columns.key)},null,8,["onClick"])]),_:1},8,["items","items-length","items-per-page","loading","page"])]),_:1}),a(A,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=o=>w.value=o),"max-width":"600px"},{default:l(()=>[a(B,null,{default:l(()=>[a(K,{class:"text-h5 pa-4"},{default:l(()=>[u(g(p.value?"编辑缓存":"创建缓存"),1)]),_:1}),a(M,{class:"pa-4"},{default:l(()=>[a(oe,{ref_key:"form",ref:F,onSubmit:se(O,["prevent"])},{default:l(()=>[a(z,{modelValue:d.value.key,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.key=o),readonly:!!p.value,rules:[o=>!!o||"Key is required"],class:"mb-4",label:"缓存键",variant:"outlined"},null,8,["modelValue","readonly","rules"]),a(de,{modelValue:d.value.value,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.value=o),hint:"支持 JSON 格式",rules:[o=>!!o||"缓存值是必填的"],class:"font-monospace",label:"缓存值","persistent-hint":"",rows:"8",variant:"outlined"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),a(Q,{class:"pa-4"},{default:l(()=>[a(j),a(v,{variant:"text",onClick:E},{default:l(()=>e[11]||(e[11]=[u(" 取消 ",-1)])),_:1,__:[11]}),a(v,{loading:f.value,color:"primary",onClick:O},{default:l(()=>[u(g(p.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=o=>_.value=o),"max-width":"400px"},{default:l(()=>[a(B,null,{default:l(()=>[a(K,{class:"text-h5 pa-4"},{default:l(()=>e[12]||(e[12]=[u(" 确认删除 ",-1)])),_:1,__:[12]}),a(M,{class:"pa-4"},{default:l(()=>e[13]||(e[13]=[u(" 确定要删除这个缓存吗？此操作无法撤销。 ",-1)])),_:1,__:[13]}),a(Q,{class:"pa-4"},{default:l(()=>[a(j),a(v,{variant:"text",onClick:e[5]||(e[5]=o=>_.value=!1)},{default:l(()=>e[14]||(e[14]=[u(" 取消 ",-1)])),_:1,__:[14]}),a(v,{loading:U.value,color:"error",onClick:Y},{default:l(()=>e[15]||(e[15]=[u(" 删除 ",-1)])),_:1,__:[15]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ne,{modelValue:m.value.show,"onUpdate:modelValue":e[8]||(e[8]=o=>m.value.show=o),color:m.value.color,timeout:3e3},{actions:l(()=>[a(v,{variant:"text",onClick:e[7]||(e[7]=o=>m.value.show=!1)},{default:l(()=>e[16]||(e[16]=[u(" 关闭 ",-1)])),_:1,__:[16]})]),default:l(()=>[u(g(m.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},Ne=Z(ge,[["__scopeId","data-v-34ba04c1"]]);export{Ne as default};
