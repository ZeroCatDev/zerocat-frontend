import{_ as b}from"./LoadingDialog-BdXwkqGQ.js";import{_ as k}from"./AuthCard-CtasAUoZ.js";import{_ as S,c as U,o as h,e as s,N as i,aF as F,aD as q,Q as E,Y as V,$ as P,R as f,aB as w,i as p,L as I,X as M,bc as H,r as n,x as Q,ab as W,M as X}from"./index-CqDYMkg5.js";import{A as _}from"./authService-w9KrMMhD.js";const Y={components:{LoadingDialog:b,AuthCard:k},setup(){const v=H(),a=n(""),m=n(""),e=n(""),g=n(""),x=n(1),d=n(!1),u=n(0),t=n(!1),R=n(!1),C=n("处理中..."),T={required:o=>!!o||"此字段为必填项",length:o=>(o==null?void 0:o.length)===6||"验证码必须是6位数字"},A=[o=>!!o||"必须填写邮箱",o=>/.+@.+\..+/.test(o)||"不符合格式"],B=[o=>!!o||"必须填写密码",o=>o.length>=8||"密码至少需要8个字符",o=>/[A-Za-z]/.test(o)&&/[0-9]/.test(o)||"密码必须包含字母和数字"],z=Q(()=>[o=>!!o||"必须确认密码",o=>o===e.value||"两次输入的密码不一致"]);W.isLogin.value===!0&&v.push("/app/dashboard"),X({title:"重设密码"});const D=async()=>{var o,l;if(!(u.value>0)){if(!a.value||!/.+@.+\..+/.test(a.value)){c("请输入正确的邮箱地址");return}d.value=!0,C.value="正在发送验证码...";try{const r=await _.sendPasswordResetCode(a.value);r.status==="success"?(y("验证码已发送到您的邮箱"),x.value=2,N()):c(r.message||"发送验证码失败")}catch(r){c(((l=(o=r.response)==null?void 0:o.data)==null?void 0:l.message)||"发送验证码失败")}finally{d.value=!1}}},L=async()=>{var o,l;if(!m.value||m.value.length!==6){c("请输入6位验证码");return}if(!e.value||e.value!==g.value){c("请确保输入了密码且两次输入一致");return}d.value=!0,C.value="正在重设密码...";try{const r=await _.resetPasswordWithCode(a.value,m.value,e.value);r.status==="success"?(y("密码重置成功，请使用新密码登录"),setTimeout(()=>{v.push("/app/account/login")},2e3)):c(r.message||"重置密码失败")}catch(r){c(((l=(o=r.response)==null?void 0:o.data)==null?void 0:l.message)||"重置密码失败")}finally{d.value=!1}},N=()=>{u.value=60;const o=setInterval(()=>{u.value--,u.value<=0&&clearInterval(o)},1e3)},y=o=>{var l;(l=this==null?void 0:this.$toast)==null||l.add({severity:"success",summary:"成功",detail:o,life:3e3})},c=o=>{var l;(l=this==null?void 0:this.$toast)==null||l.add({severity:"error",summary:"错误",detail:o,life:3e3})};return{email:a,verificationCode:m,password:e,confirmPassword:g,step:x,loading:d,countdown:u,showPassword:t,showConfirmPassword:R,loadingText:C,rules:T,emailRules:A,passwordRules:B,confirmPasswordRules:z,sendVerificationCode:D,resetPassword:L}}};function Z(v,a,m,e,g,x){const d=k,u=b;return h(),U("div",null,[s(d,{subtitle:"重设密码"},{default:i(()=>[s(F,{onSubmit:a[7]||(a[7]=q(()=>{},["prevent"]))},{default:i(()=>[s(E,null,{default:i(()=>[s(f,{cols:"12"},{default:i(()=>[s(w,{label:"邮箱",type:"text",modelValue:e.email,"onUpdate:modelValue":a[0]||(a[0]=t=>e.email=t),variant:"outlined",rules:e.emailRules,disabled:e.step>1},null,8,["modelValue","rules","disabled"])]),_:1}),e.step>=2?(h(),V(f,{key:0,cols:"12"},{default:i(()=>[s(w,{modelValue:e.verificationCode,"onUpdate:modelValue":a[1]||(a[1]=t=>e.verificationCode=t),label:"验证码",variant:"outlined",maxlength:"6",rules:[e.rules.required,e.rules.length]},null,8,["modelValue","rules"]),s(p,{class:"mb-4",variant:"text",onClick:e.sendVerificationCode,disabled:e.countdown>0},{default:i(()=>[I(M(e.countdown>0?`${e.countdown}秒后重新发送`:"重新发送验证码"),1)]),_:1},8,["onClick","disabled"])]),_:1})):P("",!0),e.step>=2?(h(),V(f,{key:1,cols:"12"},{default:i(()=>[s(w,{label:"新密码",modelValue:e.password,"onUpdate:modelValue":a[2]||(a[2]=t=>e.password=t),variant:"outlined",rules:e.passwordRules,"append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",type:e.showPassword?"text":"password","onClick:append":a[3]||(a[3]=t=>e.showPassword=!e.showPassword)},null,8,["modelValue","rules","append-icon","type"]),s(w,{label:"确认密码",modelValue:e.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=t=>e.confirmPassword=t),variant:"outlined",rules:e.confirmPasswordRules,"append-icon":e.showConfirmPassword?"mdi-eye":"mdi-eye-off",type:e.showConfirmPassword?"text":"password","onClick:append":a[5]||(a[5]=t=>e.showConfirmPassword=!e.showConfirmPassword)},null,8,["modelValue","rules","append-icon","type"])]),_:1})):P("",!0),s(f,{cols:"12"},{default:i(()=>[s(p,{class:"text-none",color:"primary",rounded:"xl",text:e.step===1?"获取验证码":"重设密码",variant:"flat",size:"large",onClick:a[6]||(a[6]=t=>e.step===1?e.sendVerificationCode():e.resetPassword()),"append-icon":"mdi-arrow-right",loading:e.loading},null,8,["text","loading"])]),_:1}),s(f,{cols:"12"},{default:i(()=>[s(p,{class:"text-none",color:"white",rounded:"xl",text:"登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/login"}),s(p,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"})]),_:1})]),_:1})]),_:1})]),_:1}),s(u,{show:e.loading,text:e.loadingText},null,8,["show","text"])])}const O=S(Y,[["render",Z]]);export{O as default};
