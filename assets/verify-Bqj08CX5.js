import{_ as M,bk as h,c as p,o as E,e as i,M as l,a8 as b,L as y,$ as C,i as f,f as x,O as N,Y as R,aK as q,aI as A,aG as B,aJ as U,N as z,aF as G,bg as J,bi as K,r as s,b as O,bl as S}from"./index-BpIYSfoU.js";import{_ as T}from"./AuthCard-DcP5RRAm.js";import"https://static.geetest.com/v4/gt4.js";const Y={components:{AuthCard:T,LoadingDialog:h},setup(){const v=J();K();const a=s(null),c=s(""),e=s(""),_=s(!1),g=s(!1),d=s(!1),w=s(!1),r=s(""),k=s("waiting"),I=[o=>!!o||"请输入电子邮件地址",o=>/.+@.+\..+/.test(o)||"请输入有效的电子邮件地址"];O(()=>{e.value=v.query.token||localStorage.getItem("verificationToken"),c.value=v.query.email||localStorage.getItem("verificationEmail"),e.value&&localStorage.setItem("verificationToken",e.value),c.value&&localStorage.setItem("verificationEmail",c.value),v.query.verified==="true"&&(k.value="success")});const D=async()=>{var o,m;if(!e.value){u("无法重新发送验证邮件：缺少验证令牌");return}g.value=!0;try{const t=await S.resendVerificationEmail(e.value);t.status==="success"?(e.value=t.temporaryToken,localStorage.setItem("verificationToken",e.value),V("验证邮件已重新发送，请查收")):u(t.message||"发送验证邮件失败")}catch(t){console.error("Error resending verification email:",t);const n=((m=(o=t.response)==null?void 0:o.data)==null?void 0:m.message)||"发送验证邮件时出错，请稍后再试";u(n)}finally{g.value=!1}},L=async()=>{var m,t;if(!a.value)return;const{valid:o}=await a.value.validate();if(o){d.value=!0;try{const n=await S.changeRegisterEmail(e.value,r.value);n.status==="success"?(c.value=n.email,e.value=n.temporaryToken,localStorage.setItem("verificationEmail",c.value),localStorage.setItem("verificationToken",e.value),w.value=!1,V("邮箱已更改，请查收验证邮件")):u(n.message||"更改邮箱失败")}catch(n){console.error("Error changing email:",n);const F=((t=(m=n.response)==null?void 0:m.data)==null?void 0:t.message)||"更改邮箱时出错，请稍后再试";u(F)}finally{d.value=!1}}},V=o=>{window.$toast?window.$toast.add({severity:"success",summary:"成功",detail:o,life:3e3}):window.$notify?window.$notify({title:"成功",message:o,type:"success"}):(console.log("Success:",o),alert(o))},u=o=>{window.$toast?window.$toast.add({severity:"error",summary:"错误",detail:o,life:3e3}):window.$notify?window.$notify({title:"错误",message:o,type:"error"}):(console.error("Error:",o),alert(o))};return{email:c,token:e,loading:_,resendLoading:g,changeEmailLoading:d,showChangeEmailDialog:w,newEmail:r,verificationStep:k,emailRules:I,emailForm:a,resendVerificationEmail:D,changeEmail:L}}},j={key:0},H={key:1,class:"text-center my-4"};function P(v,a,c,e,_,g){const d=T,w=h;return E(),p("div",null,[i(d,{subtitle:`快完成了！我们向 ${e.email} 发送了一封激活邮件。请按照邮件中的说明操作来激活您的账户。`},{default:l(()=>[i(b,null,{default:l(()=>[a[9]||(a[9]=y(" 如果您没有收到邮件，请检查您的垃圾邮件文件夹。 ",-1)),e.verificationStep==="waiting"?(E(),p("div",j,[i(f,{loading:e.resendLoading,block:"",class:"mb-3",color:"primary","prepend-icon":"mdi-email-outline",variant:"flat",onClick:e.resendVerificationEmail},{default:l(()=>a[4]||(a[4]=[y(" 重新发送激活电子邮件 ",-1)])),_:1,__:[4]},8,["loading","onClick"]),i(f,{block:"",color:"secondary","prepend-icon":"mdi-pencil",variant:"flat",onClick:a[0]||(a[0]=r=>e.showChangeEmailDialog=!0)},{default:l(()=>a[5]||(a[5]=[y(" 更改电子邮件地址 ",-1)])),_:1,__:[5]})])):C("",!0),e.verificationStep==="success"?(E(),p("div",H,[i(N,{class:"mb-2",color:"success",icon:"mdi-check-circle-outline",size:"x-large"}),a[7]||(a[7]=x("div",{class:"text-h6 mb-1"},"邮箱验证成功！",-1)),a[8]||(a[8]=x("div",{class:"text-body-1 mb-4"},"您的账户已激活，现在可以使用所有功能。",-1)),i(f,{color:"primary",to:"/app/dashboard",variant:"flat"},{default:l(()=>a[6]||(a[6]=[y(" 开始使用 ",-1)])),_:1,__:[6]})])):C("",!0)]),_:1,__:[9]})]),_:1},8,["subtitle"]),i(G,{modelValue:e.showChangeEmailDialog,"onUpdate:modelValue":a[3]||(a[3]=r=>e.showChangeEmailDialog=r),"max-width":"500px"},{default:l(()=>[i(R,{title:"更改电子邮件地址"},{default:l(()=>[i(b,null,{default:l(()=>[i(q,{ref:"emailForm",onSubmit:A(e.changeEmail,["prevent"])},{default:l(()=>[i(B,{modelValue:e.newEmail,"onUpdate:modelValue":a[1]||(a[1]=r=>e.newEmail=r),rules:e.emailRules,label:"新的电子邮件地址",required:"",type:"email",variant:"outlined"},null,8,["modelValue","rules"])]),_:1},8,["onSubmit"])]),_:1}),i(U,null,{default:l(()=>[i(z),i(f,{text:"取消",onClick:a[2]||(a[2]=r=>e.showChangeEmailDialog=!1)}),i(f,{loading:e.changeEmailLoading,color:"primary",text:"确认",onClick:e.changeEmail},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(w,{show:e.loading,text:"请稍候"},null,8,["show"])])}const Z=M(Y,[["render",P]]);export{Z as default};
