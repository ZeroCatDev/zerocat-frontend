import{_ as W}from"./LoadingDialog-mLUpwCAn.js";import{_ as N}from"./AuthCard-B8eBVh_O.js";import{_ as U}from"./Recaptcha-vUumk-o_.js";import{_ as G,a as E,o as _,h as t,N as s,U as K,X as P,as as X,at as b,K as v,F as J,j as f,T as Q,M as Y,b3 as Z,r as u,ai as $,L as ee,w as ae}from"./index-DKqePUrh.js";import{A as g}from"./authService-CyJyiAfk.js";import{V as oe}from"./VForm-BVXfDvnz.js";import{V as te,a as w}from"./VRow-MTxZhg05.js";import{V as B}from"./VTextField-i-JnkifG.js";import"./VDialog-DDRRILQ3.js";import"https://static.geetest.com/v4/gt4.js";import"./VInput-yqi59OEB.js";/* empty css              *//* empty css                   */const ne={components:{LoadingDialog:W,Recaptcha:U,AuthCard:N},setup(){const y=Z(),o=u(""),h=u(""),a=u(""),c=u("password"),p=u(0),i=u(!1),V=u(!1),m=u(null),l=u(!1),z={required:e=>!!e||"此字段为必填项",length:e=>(e==null?void 0:e.length)===6||"验证码必须是6位数字"},F=[e=>!!e||"必须填写邮箱",e=>/.+@.+\..+/.test(e)||"不符合格式"],M=[e=>!!e||"必须填写密码"];$.isLogin.value===!0&&y.push("/app/explore"),ee({title:"登录"});const S=()=>c.value==="password"?"登录":c.value==="code"?a.value?"登录":"发送验证码":c.value==="magiclink"?l.value?"已发送，请检查邮箱":"发送登录链接":"登录",D=async()=>{switch(c.value){case"password":await T();break;case"code":a.value?await L():await C();break;case"magiclink":await R();break}},T=async()=>{var e;if(!o.value||!h.value){r("请输入邮箱和密码");return}i.value=!0;try{const n=((e=m.value)==null?void 0:e.getResponse())||null,d=await g.loginWithPassword(o.value,h.value,n);A(d)}catch(n){x(n)}finally{i.value=!1}},L=async()=>{if(!o.value||!a.value){r("请输入邮箱和验证码");return}i.value=!0;try{const e=await g.loginWithCode(o.value,a.value);A(e)}catch(e){x(e)}finally{i.value=!1}},C=async()=>{var e;if(!(p.value>0)){if(!o.value||!/.+@.+\..+/.test(o.value)){r("请输入正确的邮箱地址");return}i.value=!0;try{const n=((e=m.value)==null?void 0:e.getResponse())||null,d=await g.sendLoginCode(o.value,n);d.status==="success"?(k("验证码已发送"),O()):r(d.message)}catch(n){x(n)}finally{i.value=!1}}},R=async()=>{var e;if(!l.value){if(!o.value||!/.+@.+\..+/.test(o.value)){r("请输入正确的邮箱地址");return}i.value=!0;try{const n=((e=m.value)==null?void 0:e.getResponse())||null;if(!n){r("请完成人机验证"),i.value=!1;return}const d=await g.generateMagicLink(o.value,window.location.origin+"/app/account/magiclink/validate",n);d.status==="success"?(k("登录链接已发送到您的邮箱"),l.value=!0):r(d.message)}catch(n){x(n)}finally{i.value=!1}}},I=e=>{window.location.href=g.oauthRedirect(e)},A=e=>{e.status==="success"?(k("登录成功，欢迎回来，"+e.display_name),setTimeout(()=>{y.push("/app/explore")},1e3)):r(e.message)},x=e=>{var n,d;r(((d=(n=e.response)==null?void 0:n.data)==null?void 0:d.message)||e.message)},k=e=>{var n;(n=this==null?void 0:this.$toast)==null||n.add({severity:"success",summary:"成功",detail:e,life:3e3})},r=e=>{var n;(n=this==null?void 0:this.$toast)==null||n.add({severity:"error",summary:"错误",detail:e,life:3e3})},O=()=>{p.value=60;const e=setInterval(()=>{p.value--,p.value<=0&&clearInterval(e)},1e3)},j=e=>{c.value==="code"&&!a.value&&C()},q=()=>{r("验证失败，请重试")},H=()=>{};return ae(c,e=>{a.value="",l.value=!1,setTimeout(()=>{m.value&&m.value.resetCaptcha()},100)}),{email:o,password:h,verificationCode:a,loginType:c,countdown:p,loading:i,showPassword:V,rules:z,emailRules:F,passwordRules:M,recaptcha:m,magicLinkSent:l,getLoginButtonText:S,handleLoginAction:D,loginWithPassword:T,loginWithCode:L,sendVerificationCode:C,sendMagicLink:R,loginWithOAuth:I,handleBindVerified:j,handleBindError:q,handleBindClose:H}}},le={class:"d-flex flex-wrap gap-2 justify-start mt-4"};function se(y,o,h,a,c,p){const i=U,V=N,m=W;return _(),E("div",null,[t(V,{subtitle:"登录你的账户"},{default:s(()=>[t(oe,null,{default:s(()=>[t(te,null,{default:s(()=>[t(w,{cols:"12"},{default:s(()=>[t(X,{modelValue:a.loginType,"onUpdate:modelValue":o[0]||(o[0]=l=>a.loginType=l),class:"mb-4"},{default:s(()=>[t(b,{value:"password",variant:"text"},{default:s(()=>o[7]||(o[7]=[v("密码登录")])),_:1}),t(b,{value:"code",variant:"text"},{default:s(()=>o[8]||(o[8]=[v("验证码登录")])),_:1}),t(b,{value:"magiclink",variant:"text"},{default:s(()=>o[9]||(o[9]=[v("魔术链接登录")])),_:1})]),_:1},8,["modelValue"]),t(B,{label:"邮箱",type:"text",modelValue:a.email,"onUpdate:modelValue":o[1]||(o[1]=l=>a.email=l),variant:"outlined",rules:a.emailRules},null,8,["modelValue","rules"]),a.loginType==="password"?(_(),K(B,{key:0,label:"密码",modelValue:a.password,"onUpdate:modelValue":o[2]||(o[2]=l=>a.password=l),variant:"outlined",rules:a.passwordRules,"append-icon":a.showPassword?"mdi-eye":"mdi-eye-off",type:a.showPassword?"text":"password","onClick:append":o[3]||(o[3]=l=>a.showPassword=!a.showPassword)},null,8,["modelValue","rules","append-icon","type"])):P("",!0),a.loginType==="code"?(_(),E(J,{key:1},[t(B,{modelValue:a.verificationCode,"onUpdate:modelValue":o[4]||(o[4]=l=>a.verificationCode=l),label:"验证码",variant:"outlined",maxlength:"6",rules:[a.rules.required,a.rules.length]},null,8,["modelValue","rules"]),t(f,{class:"mb-4",variant:"text",onClick:a.sendVerificationCode,disabled:a.countdown>0},{default:s(()=>[v(Q(a.countdown>0?`${a.countdown}秒后重新发送`:"发送验证码"),1)]),_:1},8,["onClick","disabled"])],64)):P("",!0)]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(i,{ref:"recaptcha",recaptchaId:"recaptcha-div",showNormal:!0,onBindVerified:a.handleBindVerified,onBindError:a.handleBindError,onBindClose:a.handleBindClose},null,8,["onBindVerified","onBindError","onBindClose"])]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(f,{class:"text-none",color:"primary",rounded:"xl",text:a.getLoginButtonText(),variant:"flat",size:"large",onClick:a.handleLoginAction,"append-icon":"mdi-arrow-right",loading:a.loading},null,8,["text","onClick","loading"])]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(f,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),t(f,{class:"text-none",color:"white",rounded:"xl",text:"找回密码",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"}),t(f,{class:"text-none",color:"white",rounded:"xl",text:"魔术链接登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/magiclink"})]),_:1}),t(w,{cols:"12"},{default:s(()=>[Y("div",le,[t(f,{onClick:o[5]||(o[5]=l=>a.loginWithOAuth("microsoft")),color:"blue","prepend-icon":"mdi-microsoft",variant:"flat"},{default:s(()=>o[10]||(o[10]=[v("Microsoft")])),_:1}),t(f,{onClick:o[6]||(o[6]=l=>a.loginWithOAuth("github")),color:"black","prepend-icon":"mdi-github",variant:"flat"},{default:s(()=>o[11]||(o[11]=[v("GitHub")])),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),t(m,{show:a.loading,text:"登录中"},null,8,["show"])])}const ye=G(ne,[["render",se]]);export{ye as default};
