import{l as _,r as y}from"./project-CDeVvL7_.js";import{l as b,r as S}from"./user-D4cUgdi-.js";import{_ as g}from"./43-lazyload-CBkwrR6M.js";import{_ as v,o,c as n,w as e,e as c,R as d,S as p,a,P as f,O as V,$ as C,a0 as Q,L as h,T as l,a1 as w,a3 as I,M as k,a2 as x}from"./index-Bn04TRkP.js";import{a as A,V as F}from"./VRow-Dh8z3BjH.js";const D={props:{projectIds:{type:Array,required:!0},actions:{type:Array}},data(){return{projects:[],authorids:[],authors:{},liveQuerySubscription:null,authorQuerySubscription:null}},watch:{projectIds:{handler(){this.startLiveFetch(),this.refreshData()},immediate:!0,deep:!0}},methods:{startLiveFetch(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.liveQuerySubscription=_(this.projectIds,s=>{const i=new Map(s.map(t=>[t.id,t]));this.projects=this.projectIds.map(t=>i.get(t)).filter(Boolean),this.updateAuthorIds()})},updateAuthorIds(){const s=[...new Set(this.projects.map(i=>i.authorid))];JSON.stringify(s)!==JSON.stringify(this.authorids)&&(this.authorids=s,this.startAuthorLiveFetch())},startAuthorLiveFetch(){this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe(),this.authorQuerySubscription=b(this.authorids,s=>{const i={};s.forEach(t=>{i[t.id]=t}),this.authors=i})},async refreshData(){await y(this.projectIds),await S(this.authorids)}},beforeDestroy(){this.liveQuerySubscription&&this.liveQuerySubscription.unsubscribe(),this.authorQuerySubscription&&this.authorQuerySubscription.unsubscribe()}};function L(s,i,t,B,m,N){return o(),n(F,null,{default:e(()=>[(o(!0),c(d,null,p(m.projects,r=>(o(),n(A,{key:r.id,cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2"},{default:e(()=>[a(f,{rounded:"lg",border:""},{default:e(()=>[a(f,{to:`/${r.authorid}/${r.id}`,style:{"aspect-ratio":"4/3"},rounded:"lg"},{default:e(()=>[a(V,{src:"https://s4-1.wuyuan.1r.ink/scratch_slt/"+r.id,class:"align-end","lazy-src":g,height:"100%",gradient:"to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)",cover:""},{default:e(()=>[a(C,null,{default:e(()=>[a(Q,null,{default:e(()=>[h(l(r.title||"未缓存"),1)]),_:2},1024),a(w,null,{default:e(()=>[h(l(r.description||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["to"]),t.actions?(o(),n(I,{key:0},{default:e(()=>[(o(!0),c(d,null,p(t.actions,u=>(o(),c("div",{key:u.name},[a(k,{onClick:$=>u.function(r.id,r)},{default:e(()=>[h(l(u.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)):x("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})}const E=v(D,[["render",L]]);export{E as _};
