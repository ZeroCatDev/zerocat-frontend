import{_ as M}from"./Timeline-D4_ztfGV.js";import{_ as I,a as F}from"./UserFollowers-Br3zNI4v.js";import{_ as N,a as A}from"./Comment-ZL9H2NF-.js";import{g as J}from"./projectListService-Bie-8iMM.js";import{_ as V,c as b,o as i,Y as n,N as r,e,a3 as v,a4 as K,W as c,F as L,a5 as $,L as u,U as S,R as w,Q as j,a1 as h,i as U,f as o,X as a,a6 as ee,a7 as y,a8 as te,Z as se,n as re,$ as x,S as f,O as d,T as k,a9 as le,M as oe,aa as ie,ab as ae}from"./index-C3KDjNI3.js";import{_ as ne}from"./Projects-CHqs3Q8O.js";import{_ as B}from"./UserRelationControls-BD4DfKw3.js";import{_ as D}from"./TimeAgo-BzsjB98v.js";import{_ as R}from"./PageAnalytics-Diputcgg.js";/* empty css                        */import"./_commonjsHelpers-BosuxZz1.js";import"./VTextarea-T9YjWnft.js";import"./ProjectCard-CV0oZu2m.js";import"./VSpacer-BccQjSKK.js";const ue={name:"UserProjectLists",props:{userId:{type:[Number,String],required:!0},projectLists:{type:Array,default:()=>[]}},data(){return{loading:!1,localLists:[]}},computed:{lists(){return this.projectLists.length>0?this.projectLists:this.localLists}},watch:{userId:{immediate:!0,handler(t){t&&this.projectLists.length===0&&this.fetchUserLists()}}},methods:{async fetchUserLists(){this.loading=!0;try{const t=await J(this.userId);t.status==="success"?this.localLists=t.data||[]:console.error("获取用户列表失败:",t.message)}catch(t){console.error("获取用户列表失败:",t)}finally{this.loading=!1}}}};function ce(t,s,m,C,l,g){return i(),b("div",null,[l.loading?(i(),n(c,{key:0,class:"mb-4"},{default:r(()=>[e(v,{class:"text-center"},{default:r(()=>[e(K,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(i(),b(L,{key:1},[g.lists.length===0?(i(),n(c,{key:0,class:"mb-4"},{default:r(()=>[e(v,{class:"text-center"},{default:r(()=>[e($,{type:"info",variant:"tonal"},{default:r(()=>s[0]||(s[0]=[u(" 该用户暂无公开项目列表 ")])),_:1,__:[0]})]),_:1})]),_:1})):(i(),n(j,{key:1},{default:r(()=>[(i(!0),b(L,null,S(g.lists,_=>(i(),n(w,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:_.id},{default:r(()=>[e(c,{rounded:"lg"},{default:r(()=>[e(c,{to:"/app/projectlist/"+_.id,rounded:"lg",title:_.title,subtitle:_.description,variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))],64))])}const q=V(ue,[["render",ce]]),de={name:"FollowStats",props:{userId:{type:Number,required:!0},username:{type:String,required:!0}},data(){return{followersCount:0,followingCount:0,loading:!1}},mounted(){this.fetchFollowStats()},watch:{userId:{handler(){this.fetchFollowStats()}}},methods:{async fetchFollowStats(){try{this.loading=!0;const t=await h.get(`/follows/followers/${this.userId}`,{params:{limit:1,offset:0}});t.data.success&&(this.followersCount=t.data.data.total);const s=await h.get(`/follows/following/${this.userId}`,{params:{limit:1,offset:0}});s.data.success&&(this.followingCount=s.data.data.total)}catch(t){console.error("获取关注统计失败:",t)}finally{this.loading=!1}}}},me={class:"font-weight-bold"},_e={class:"font-weight-bold"};function pe(t,s,m,C,l,g){return i(),n(j,{class:"follow-stats"},{default:r(()=>[e(w,null,{default:r(()=>[e(U,{variant:"text",to:`/${m.username}?tab=followers`,class:"stats-btn"},{default:r(()=>[o("span",me,a(l.followersCount),1),s[0]||(s[0]=o("span",{class:"text-body-2 text-medium-emphasis"},"关注者",-1))]),_:1,__:[0]},8,["to"])]),_:1}),e(w,null,{default:r(()=>[e(U,{variant:"text",to:`/${m.username}?tab=following`,class:"stats-btn"},{default:r(()=>[o("span",_e,a(l.followingCount),1),s[1]||(s[1]=o("span",{class:"text-body-2 text-medium-emphasis"},"正在关注",-1))]),_:1,__:[1]},8,["to"])]),_:1})]),_:1})}const E=V(de,[["render",pe],["__scopeId","data-v-d6d9b628"]]),P=t=>({id:t,display_name:"未知用户",bio:"用户信息未缓存",avatar:"",regTime:"2000-01-01T00:00:00.000Z",sex:"未知",username:"未知"});async function fe(t){if(Array.isArray(t))try{const{data:s}=await h.post("/user/batch/name",{users:t});return s.data}catch{return t.map(m=>P(m))}else try{const{data:s}=await h.get(`/user/username/${t}`);return s.data}catch{return P(t)}}const he={components:{Comment:A,Markdown:N,TimeAgo:D,UserProjectLists:q,UserRelationControls:B,FollowStats:E,UserFollowers:F,UserFollowing:I,Timeline:M,PageAnalytics:R},data(){return{username:this.$route.params.username,user:{},lists:[],url:"",tab:this.$route.query.tab||"home",timeline:{events:[],pagination:{current:1,size:20,total:0}},isLoadingMore:!1,localuser:ae,eventTypes:{project_create:{text:"创建了新项目",label:"新建",color:"success",isProject:!0},project_publish:{text:"更新了项目",label:"更新",color:"info",isProject:!0},project_fork:{text:"复刻了项目",label:"复刻",color:"warning",isProject:!0},project_delete:{text:"删除了项目",label:"删除",color:"error",isProject:!0},user_profile_update:{text:"更新了个人资料",label:"更新",color:"info"},user_register:{text:"加入了 ZeroCat",label:"注册",color:"primary"},project_commit:{text:"提交了项目更新",label:"提交",color:"info",isProject:!0},project_rename:{text:"重命名了项目",label:"重命名",color:"warning",isProject:!0},project_info_update:{text:"更新了项目信息",label:"更新信息",color:"info",isProject:!0}},fieldDisplayNames:{display_name:"昵称",bio:"个性签名",sex:"性别",birthday:"生日",avatar:"头像",background:"背景图片",email:"邮箱",phone:"手机号",website:"个人网站",bio:"个人简介",social_links:"社交链接",preferences:"偏好设置",visibility:"可见性设置",language:"语言设置"},s3BucketUrl:""}},watch:{"$route.query.tab"(t){this.tab=t||"home"}},async mounted(){this.s3BucketUrl=await ie("s3.staticurl")},async created(){await this.fetchUser(),await this.getProjectList(),await this.fetchTimeline(),this.tab=this.$route.query.tab||"home"},computed:{hasMoreEvents(){return this.timeline.events.length<this.timeline.pagination.total}},methods:{async fetchUser(){this.user=await fe(this.username),oe({title:""+this.user.display_name}),this.url=`/searchapi?search_userid=${this.user.id}&search_type=&search_title=&search_source=&search_description=&search_orderby=view_up&search_state=public&search_tag=`},async getProjectList(){try{const t=await h({url:`/projectlist/userid/${this.user.id}/public`,method:"get"});t.data&&t.data.data&&(this.lists=t.data.data)}catch(t){console.error("获取用户项目列表失败:",t),this.lists=[]}},async fetchTimeline(t=1){try{const s=await h.get(`/timeline/user/${this.user.id}`,{params:{page:t,limit:this.timeline.pagination.size}});s.data.status==="success"&&(t===1?this.timeline=s.data.data:(this.timeline.events=[...this.timeline.events,...s.data.data.events],this.timeline.pagination=s.data.data.pagination))}catch(s){console.error("Failed to fetch timeline:",s)}},getUpdatedFields(t){return t!=null&&t.length?t.map(s=>this.fieldDisplayNames[s]||s).join("、"):""},async loadMoreEvents(){if(!this.isLoadingMore)try{this.isLoadingMore=!0,await this.fetchTimeline(this.timeline.pagination.current+1)}finally{this.isLoadingMore=!1}},getTargetContent(t,s){if(!t)return"";switch(t.type){case"project":return t.title||`项目 #${t.id}`;case"user":return t.display_name||`用户 #${t.id}`;case"projectlist":return`项目列表 #${t.id}`;default:return`${t.type} #${t.id}`}},getFieldDisplayName(t){return{title:"标题",description:"描述",type:"类型",state:"状态",visibility:"可见性",tags:"标签",category:"分类"}[t]||t}}},ge={class:"font-weight-medium text-primary"},ye={class:"font-weight-bold text-sm-h2 text-h4 mt-2 d-inline-flex align-center username"},be={class:"mt-2 text-body-1 text-medium-emphasis user-motto"},we={class:"mt-2 text-medium-emphasis"},xe=["href"];function ve(t,s,m,C,l,g){const _=R,Z=D,z=B,W=E,H=N,O=ne,Q=q,T=A,X=F,Y=I,G=M;return i(),b("div",null,[e(_,{"target-type":"user","target-id":l.user.id},null,8,["target-id"]),e(k,null,{default:r(()=>[e(ee,{modelValue:l.tab,"onUpdate:modelValue":s[0]||(s[0]=p=>l.tab=p)},{default:r(()=>[e(y,{value:"home"},{default:r(()=>[e(te,{class:"mt-8"},{default:r(()=>[e(j,{class:"d-flex align-center"},{default:r(()=>[e(w,null,{default:r(()=>[o("p",ge,a(l.user.type==="administrator"?"ZeroCat 管理员":"开发者"),1),o("p",ye,[u(a(l.user.display_name)+" ",1),e(se,{size:"52",class:"ma-2"},{default:r(()=>[e(re,{src:l.s3BucketUrl+"/user/"+l.user.avatar},null,8,["src"])]),_:1})]),o("p",be,a(l.user.motto),1),o("p",we,[e(f,{class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-account-circle",start:""}),u(" #"+a(l.user.id),1)]),_:1}),e(f,{class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-clock",start:""}),e(Z,{date:l.user.regTime},null,8,["date"]),s[1]||(s[1]=u(" 注册 "))]),_:1,__:[1]}),l.user.location?(i(),n(f,{key:0,class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-map-marker",start:""}),u(" "+a(l.user.location),1)]),_:1})):x("",!0),l.user.birthday?(i(),n(f,{key:1,class:"mr-2"},{default:r(()=>[e(d,{icon:"mdi-cake-variant",start:""}),u(" "+a(new Date(l.user.birthday).toLocaleDateString()),1)]),_:1})):x("",!0),l.user.url?(i(),n(f,{key:2,class:"mr-2","append-icon":"mdi-open-in-new"},{default:r(()=>[e(d,{icon:"mdi-web",start:""}),o("a",{href:l.user.url,target:"_blank",class:"text-decoration-none"},a(l.user.url),9,xe)]),_:1})):x("",!0),l.user.isActive?x("",!0):(i(),n(f,{key:3,color:"error"},{default:r(()=>[e(d,{icon:"mdi-alert-circle",start:""}),s[2]||(s[2]=u(" 异常 "))]),_:1,__:[2]}))]),e(z,{"user-id":l.user.id,username:l.username,"display-name":l.user.display_name},null,8,["user-id","username","display-name"]),e(W,{"user-id":l.user.id,username:l.username,class:"mt-3"},null,8,["user-id","username"])]),_:1})]),_:1})]),_:1}),s[4]||(s[4]=o("br",null,null,-1)),e(c,{title:"关于我",subtitle:"README.md"},{default:r(()=>[e(v,{class:"markdown-body"},{default:r(()=>[s[3]||(s[3]=o("br",null,null,-1)),e(H,null,{default:r(()=>[u(a(l.user.bio),1)]),_:1})]),_:1,__:[3]})]),_:1}),e(O,{url:l.url},null,8,["url"]),e(j,null,{default:r(()=>[(i(!0),b(L,null,S(l.lists,p=>(i(),n(w,{cols:"12",xs:"12",sm:"6",md:"4",lg:"3",xl:"2",xxl:"2",key:p.id},{default:r(()=>[e(c,{rounded:"lg"},{default:r(()=>[e(c,{to:"/app/projectlist/"+p.id,rounded:"lg",title:p.title,subtitle:p.description,color:"primary",variant:"tonal"},null,8,["to","title","subtitle"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s[5]||(s[5]=o("br",null,null,-1)),e(Q,{"user-id":l.user.id,"project-lists":l.lists},null,8,["user-id","project-lists"]),s[6]||(s[6]=o("br",null,null,-1)),e(T,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1,__:[4,5,6]}),e(y,{value:"comment"},{default:r(()=>[e(T,{url:"user-"+l.user.id,name:"用户"},null,8,["url"])]),_:1}),e(y,{value:"followers"},{default:r(()=>[e(k,null,{default:r(()=>[s[7]||(s[7]=o("h2",{class:"text-h5 mb-4"},"关注者",-1)),e(X,{"user-id":l.user.id,"show-all":!1},null,8,["user-id"])]),_:1,__:[7]})]),_:1}),e(y,{value:"following"},{default:r(()=>[e(k,null,{default:r(()=>[s[8]||(s[8]=o("h2",{class:"text-h5 mb-4"},"正在关注",-1)),e(Y,{"user-id":l.user.id,"show-all":!1},null,8,["user-id"])]),_:1,__:[8]})]),_:1}),e(y,{value:"timeline"},{default:r(()=>[e(c,{class:"mt-4",variant:"flat"},{default:r(()=>[e(le,{class:"d-flex align-center"},{default:r(()=>[e(d,{icon:"mdi-timeline-clock",color:"primary",class:"mr-2"}),u(" "+a(l.user.display_name)+" 的动态 ",1)]),_:1}),e(v,null,{default:r(()=>[e(G,{timeline:l.timeline,"is-loading-more":l.isLoadingMore,onLoadMore:g.loadMoreEvents},null,8,["timeline","is-loading-more","onLoadMore"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const Be=V(he,[["render",ve],["__scopeId","data-v-fc5e19ce"]]);export{Be as default};
