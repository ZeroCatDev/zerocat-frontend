import{_ as v}from"./LoadingDialog-Dibf9trS.js";import{_ as V}from"./Recaptcha-Dp_C7NWD.js";import{_ as B,r as R,e as g,o as u,G as c,a as s,w as r,ap as b,I as n,H as p,c as k,a4 as h,M as w,O as E,K as T,S as m,Q as y,T as L,R as I}from"./index-B5WfG9ST.js";import{l as N}from"./accountService-DvP162Bj.js";import{V as x,a as i}from"./VRow-BaXe7X2C.js";import{V as U}from"./VForm-B-oiDDWN.js";import"./VDialog-C_Bf8Eq6.js";import"https://static.geetest.com/v4/gt4.js";/* empty css              */const z={components:{LoadingDialog:v,Recaptcha:V},data(){return{BASE_API:"https://zerocat-api.houlangs.com",username:"",password:"",verificationCode:"",loginType:"password",countdown:0,tryinguser:{},loading:!1,localuser:m,show1:I(!1),rules:{required:e=>!!e||"此字段为必填项",length:e=>(e==null?void 0:e.length)===6||"验证码必须是6位数字"},emailRules:[e=>e?!0:"必须填写邮箱",e=>/.+@.+\..+/.test(e)?!0:"不符合格式"],usernameRules:[e=>e?!0:"必须填写密码"]}},created(){m.isLogin.value===!0&&this.$router.push("/")},setup(){L({title:"登录"})},methods:{async handleLogin(){this.loginType==="password"?await this.loginWithPassword():await this.loginWithCode()},async loginWithPassword(){this.loading=!0;try{const e=await N({captcha:this.$refs.recaptcha.getResponse(),un:this.username,pw:this.password});this.handleLoginResponse(e)}catch(e){this.handleError(e)}finally{this.loading=!1}},async loginWithCode(){if(!this.verificationCode||this.verificationCode.length!==6){this.$toast.add({severity:"error",summary:"错误",detail:"请输入6位验证码",life:3e3});return}this.loading=!0;try{const e=await y.post("/account/login-with-code",{email:this.username,code:this.verificationCode});this.handleLoginResponse(e)}catch(e){this.handleError(e)}finally{this.loading=!1}},async sendVerificationCode(){if(!(this.countdown>0)){if(!this.username||!/.+@.+\..+/.test(this.username)){this.$toast.add({severity:"error",summary:"错误",detail:"请输入正确的邮箱地址",life:3e3});return}this.$refs.recaptcha.showBindCaptcha()}},async handleBindVerified(e){this.loading=!0;try{const t=await y.post("/account/send-login-code",{email:this.username,captcha:e});t.data.status==="success"?(this.$toast.add({severity:"success",summary:"成功",detail:"验证码已发送",life:3e3}),this.startCountdown()):this.$toast.add({severity:"error",summary:"错误",detail:t.data.message,life:3e3})}catch(t){this.handleError(t)}finally{this.loading=!1}},handleBindError(){this.$toast.add({severity:"error",summary:"错误",detail:"验证失败，请重试",life:3e3})},handleBindClose(){},startCountdown(){this.countdown=60;const e=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(e)},1e3)},async handleLoginResponse(e){this.tryinguser=e.data,this.tryinguser.status==="success"?(await m.setUser(this.tryinguser.token),this.$router.push("/")):this.$toast.add({severity:"info",summary:"info",detail:this.tryinguser.message,life:3e3})},handleError(e){var t,d;this.$toast.add({severity:"error",summary:"错误",detail:((d=(t=e.response)==null?void 0:t.data)==null?void 0:d.message)||e.message,life:3e3})}}},W={class:"auth-wrapper d-flex align-center justify-center pa-4"};function D(e,t,d,F,o,l){const f=R("v-cardtext"),_=V,C=v;return u(),g(w,null,[c("div",W,[s(T,{class:"auth-card pa-4 pt-7","max-width":"448",border:"",rounded:"lg"},{default:r(()=>[s(x,null,{default:r(()=>[s(i,{cols:"12"},{default:r(()=>[s(f,null,{default:r(()=>t[5]||(t[5]=[c("h5",{class:"text-h5 font-weight-semibold mb-1"}," 欢迎来到ZeroCatNext！ 👋🏻 ",-1),c("p",{class:"mb-0"},"登录你的账户",-1)])),_:1})]),_:1})]),_:1}),s(f,null,{default:r(()=>[s(U,null,{default:r(()=>[s(x,null,{default:r(()=>[s(i,{cols:"12"},{default:r(()=>[s(b,{modelValue:o.loginType,"onUpdate:modelValue":t[0]||(t[0]=a=>o.loginType=a),mandatory:"",color:"primary",rounded:"lg",class:"mb-4"},{default:r(()=>[s(n,{value:"password",variant:"text"},{default:r(()=>t[6]||(t[6]=[p("密码登录")])),_:1}),s(n,{value:"code",variant:"text"},{default:r(()=>t[7]||(t[7]=[p("验证码登录")])),_:1})]),_:1},8,["modelValue"])]),_:1}),s(i,{cols:"12"},{default:r(()=>[s(h,{label:"邮箱",type:"text",modelValue:o.username,"onUpdate:modelValue":t[1]||(t[1]=a=>o.username=a),variant:"outlined",rules:o.emailRules},null,8,["modelValue","rules"]),o.loginType==="password"?(u(),k(h,{key:0,label:"密码",modelValue:o.password,"onUpdate:modelValue":t[2]||(t[2]=a=>o.password=a),variant:"outlined",rules:o.usernameRules,"append-icon":o.show1?"mdi-eye":"mdi-eye-off",type:o.show1?"text":"password","onClick:append":t[3]||(t[3]=a=>o.show1=!o.show1)},null,8,["modelValue","rules","append-icon","type"])):(u(),g(w,{key:1},[s(h,{modelValue:o.verificationCode,"onUpdate:modelValue":t[4]||(t[4]=a=>o.verificationCode=a),label:"验证码",variant:"outlined",maxlength:"6",rules:[o.rules.required,o.rules.length]},null,8,["modelValue","rules"]),s(n,{class:"mb-4",variant:"text",onClick:l.sendVerificationCode,disabled:o.countdown>0},{default:r(()=>[p(E(o.countdown>0?`${o.countdown}秒后重新发送`:"发送验证码"),1)]),_:1},8,["onClick","disabled"])],64))]),_:1}),s(i,{cols:"9"},{default:r(()=>[s(_,{ref:"recaptcha",recaptchaId:"recaptcha-div",showNormal:o.loginType==="password",onBindVerified:l.handleBindVerified,onBindError:l.handleBindError,onBindClose:l.handleBindClose},null,8,["showNormal","onBindVerified","onBindError","onBindClose"])]),_:1}),s(i,{cols:"12"},{default:r(()=>[s(n,{class:"text-none",color:"primary",rounded:"xl",text:"登录",variant:"flat",size:"large",onClick:l.handleLogin,"append-icon":"mdi-arrow-right"},null,8,["onClick"])]),_:1}),s(i,{cols:"12"},{default:r(()=>[s(n,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),s(n,{class:"text-none",color:"white",rounded:"xl",text:"找回密码",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),s(C,{show:o.loading,text:"登录中"},null,8,["show"])],64)}const O=B(z,[["render",D]]);export{O as default};
