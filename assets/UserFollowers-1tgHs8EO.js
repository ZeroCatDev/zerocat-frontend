import{_ as x,aa as F,a1 as p,ab as T,ac as v,c as d,o as r,Y as c,e as a,N as t,R as k,a4 as C,Q as y,f as m,F as b,U as V,aU as M,a9 as I,L as u,X as f,aW as B,$ as _,S as U,i as g,Z as S,n as N,W as A,aT as L}from"./index-BcH3PFWn.js";const q={name:"UserFollowing",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1},username:{type:String,required:!0}},data(){return{following:[],loading:!0,loadingMore:!1,unfollowingId:null,totalFollowing:0,localuser:T,page:1,hasMore:!0,snackbar:{show:!1,text:"",color:"success"},s3BucketUrl:""}},computed:{hasMoreFollowing(){return this.following.length<this.totalFollowing&&this.showAll}},watch:{userId:{immediate:!0,handler(l,e){l&&l!==e&&this.fetchFollowing()}}},methods:{async fetchFollowing(l=!1){if(this.userId)try{l?this.loadingMore=!0:this.loading=!0;const e=l?this.following.length:0,i=this.showAll?this.limit:Math.min(this.limit,5),n=await p.get(`/follows/following/${this.userId}`,{params:{limit:i,offset:e}});if(n.data.success){const s=n.data.data;l?this.following=[...this.following,...s.following]:this.following=s.following,this.totalFollowing=s.total}}catch(e){console.error("获取关注用户失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async unfollowUser(l,e){if(!this.localuser.user.id){this.$router.push("/app/account/login");return}try{if(this.unfollowingId=l,await p.delete(`/follows/${l}`),this.userId===this.localuser.user.id)this.following=this.following.filter(i=>i.user.id!==l),this.totalFollowing--;else{const i=this.following.findIndex(n=>n.user.id===l);i!==-1&&(this.following[i].isFollowing=!1)}this.showSnackbar(`已取消关注 ${e}`,"info")}catch(i){console.error("取消关注失败:",i),this.showSnackbar(i.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.unfollowingId=null}},async loadMoreFollowing(){await this.fetchFollowing(!0)},showSnackbar(l,e="success"){this.snackbar={show:!0,text:l,color:e}}},async mounted(){this.s3BucketUrl=await F("s3.staticurl")}},j={class:"user-following"},R={class:"d-flex align-center"},W={class:"d-flex justify-center mt-4 mb-4"},Y={key:1,class:"text-medium-emphasis"};function D(l,e,i,n,s,h){const w=v("router-link");return r(),d("div",j,[s.loading?(r(),c(y,{key:0},{default:t(()=>[a(k,{class:"text-center",cols:"12"},{default:t(()=>[a(C,{color:"primary",indeterminate:""})]),_:1})]),_:1})):s.following.length===0?(r(),c(y,{key:1},{default:t(()=>[a(k,{class:"text-center",cols:"12"},{default:t(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无关注的用户",-1)])),_:1,__:[2]})]),_:1})):(r(),d(b,{key:2},[(r(!0),d(b,null,V(s.following,o=>(r(),c(A,{key:o.id,class:"mb-3",hover:""},{default:t(()=>[a(M,null,{prepend:t(()=>[a(w,{to:`/${o.user.username}`},{default:t(()=>[a(S,{size:"50"},{default:t(()=>[a(N,{src:s.s3BucketUrl+"/user/"+(o.user.avatar||o.user.avatar),alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:t(()=>[m("div",R,[o.followsYou?(r(),c(U,{key:0,class:"mr-2",color:"secondary",size:"small"},{default:t(()=>e[3]||(e[3]=[u(" 关注了你 ",-1)])),_:1,__:[3]})):_("",!0),s.localuser.user.id&&s.localuser.user.id!==o.user.id?(r(),c(g,{key:1,loading:s.unfollowingId===o.user.id,color:"primary","prepend-icon":"mdi-account-minus",size:"small",variant:"outlined",onClick:z=>h.unfollowUser(o.user.id,o.user.display_name)},{default:t(()=>e[4]||(e[4]=[u(" 取消关注 ",-1)])),_:2,__:[4]},1032,["loading","onClick"])):_("",!0)])]),default:t(()=>[a(I,null,{default:t(()=>[a(w,{to:`/${o.user.username}`,class:"text-decoration-none"},{default:t(()=>[u(f(o.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),a(B,{class:"text-truncate"},{default:t(()=>[u(f(o.created_at||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),m("div",W,[h.hasMoreFollowing?(r(),c(g,{key:0,loading:s.loadingMore,variant:"tonal",onClick:h.loadMoreFollowing},{default:t(()=>e[5]||(e[5]=[u(" 加载更多 ",-1)])),_:1,__:[5]},8,["loading","onClick"])):s.following.length>0?(r(),d("div",Y," 没有更多内容了 ")):_("",!0)])],64)),a(L,{modelValue:s.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=o=>s.snackbar.show=o),color:s.snackbar.color,timeout:3e3},{actions:t(()=>[a(g,{variant:"text",onClick:e[0]||(e[0]=o=>s.snackbar.show=!1)},{default:t(()=>e[6]||(e[6]=[u(" 关闭 ",-1)])),_:1,__:[6]})]),default:t(()=>[u(f(s.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const H=x(q,[["render",D],["__scopeId","data-v-5a2192b7"]]),E={name:"UserFollowers",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1},username:{type:String,required:!0}},data(){return{followers:[],loading:!1,error:null,page:1,hasMore:!0,s3BucketUrl:"",loadingMore:!1,actionLoading:null,totalFollowers:0,snackbar:{show:!1,text:"",color:"success"}}},async mounted(){this.s3BucketUrl=await F("s3.staticurl")},computed:{hasMoreFollowers(){return this.followers.length<this.totalFollowers&&this.showAll}},watch:{userId:{immediate:!0,handler(l,e){l&&l!==e&&this.fetchFollowers()}}},methods:{async fetchFollowers(l=!1){if(this.userId)try{l?this.loadingMore=!0:this.loading=!0;const e=l?this.followers.length:0,i=this.showAll?this.limit:Math.min(this.limit,5),n=await p.get(`/follows/followers/${this.userId}`,{params:{limit:i,offset:e}});if(n.data.success){const s=n.data.data;l?this.followers=[...this.followers,...s.followers]:this.followers=s.followers,this.totalFollowers=s.total}}catch(e){console.error("获取关注者失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async toggleFollow(l,e,i){if(!this.localuser.user.id){this.$router.push("/app/account/login");return}try{this.actionLoading=l,i?(await p.delete(`/follows/${l}`),this.showSnackbar(`已取消关注 ${e}`,"info")):(await p.post(`/follows/${l}`),this.showSnackbar(`已成功关注 ${e}`,"success"));const n=this.followers.findIndex(s=>s.user.id===l);n!==-1&&(this.followers[n].youFollow=!i)}catch(n){console.error("关注操作失败:",n),this.showSnackbar(n.response.data.error.message||"操作失败，请稍后重试","error")}finally{this.actionLoading=null}},async loadMoreFollowers(){await this.fetchFollowers(!0)},showSnackbar(l,e="success"){this.snackbar={show:!0,text:l,color:e}}}},P={class:"user-followers"},Q={class:"d-flex align-center"},X={class:"d-flex justify-center mt-4 mb-4"},Z={key:1,class:"text-medium-emphasis"};function $(l,e,i,n,s,h){const w=v("router-link");return r(),d("div",P,[s.loading?(r(),c(y,{key:0},{default:t(()=>[a(k,{class:"text-center",cols:"12"},{default:t(()=>[a(C,{color:"primary",indeterminate:""})]),_:1})]),_:1})):s.followers.length===0?(r(),c(y,{key:1},{default:t(()=>[a(k,{class:"text-center",cols:"12"},{default:t(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无关注者",-1)])),_:1,__:[2]})]),_:1})):(r(),d(b,{key:2},[(r(!0),d(b,null,V(s.followers,o=>(r(),c(A,{key:o.id,class:"mb-3",hover:""},{default:t(()=>[a(M,null,{prepend:t(()=>[a(w,{to:`/${o.user.username}`},{default:t(()=>[a(S,{size:"50"},{default:t(()=>[a(N,{src:s.s3BucketUrl+"/user/"+(o.user.avatar||o.user.avatar),alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:t(()=>[m("div",Q,[l.localuser.user.id&&l.localuser.user.id!==o.user.id?(r(),c(g,{key:0,color:"primary",loading:s.actionLoading===o.user.id,"prepend-icon":o.youFollow?"mdi-account-minus":"mdi-account-plus",variant:o.youFollow?"outlined":"tonal",size:"small",onClick:z=>h.toggleFollow(o.user.id,o.user.display_name,o.youFollow)},{default:t(()=>[u(f(o.youFollow?"取消关注":"关注"),1)]),_:2},1032,["loading","prepend-icon","variant","onClick"])):_("",!0)])]),default:t(()=>[a(I,null,{default:t(()=>[a(w,{to:`/${o.user.username}`,class:"text-decoration-none"},{default:t(()=>[u(f(o.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),a(B,{class:"text-truncate"},{default:t(()=>[u(f(o.created_at||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),m("div",X,[s.hasMore?(r(),c(g,{key:0,loading:s.loadingMore,variant:"tonal",onClick:h.loadMoreFollowers},{default:t(()=>e[3]||(e[3]=[u(" 加载更多 ",-1)])),_:1,__:[3]},8,["loading","onClick"])):s.followers.length>0?(r(),d("div",Z," 没有更多内容了 ")):_("",!0)])],64)),a(L,{modelValue:s.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=o=>s.snackbar.show=o),color:s.snackbar.color,timeout:3e3},{actions:t(()=>[a(g,{variant:"text",onClick:e[0]||(e[0]=o=>s.snackbar.show=!1)},{default:t(()=>e[4]||(e[4]=[u(" 关闭 ",-1)])),_:1,__:[4]})]),default:t(()=>[u(f(s.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const J=x(E,[["render",$],["__scopeId","data-v-689cb4e0"]]);export{H as _,J as a};
