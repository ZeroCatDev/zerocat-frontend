import{_ as P}from"./EditProjectListConfig-BDFXbsEs.js";import{_ as b,Q as T,S as L,c as d,o as c,w as e,e as g,a as s,aI as j,M as I,K as y,ac as V,am as z,G as o,O as n,H as f,I as B,an as N,ab as x,P as w,aa as C,N as S,T as v}from"./index-KvBOkYOg.js";import{a as A}from"./user-0eg1TJXV.js";import{V as m,a as h}from"./VRow-BkGKqcrg.js";import{V as D}from"./VChip-BQEjepel.js";import{V as k}from"./VSpacer-B9hLRdF2.js";import{V as E}from"./VAlert-5gJikUM3.js";import{V as O}from"./VDialog-CsSIDhDi.js";import{V as H}from"./VContainer-BK5TGkno.js";import{d as q}from"./projectService-Bwb405Na.js";import"./VSelect-BNiuH5l3.js";import"./VCheckboxBtn-B__jPtm-.js";import"./VSelectionControl-BNRFZx8V.js";/* empty css              */const F={props:{listId:{type:String,required:!0}},components:{EditProjectListConfig:P},data(){return{loading:!0,listInfo:{},isOwner:!1,editDialog:!1,userCache:{},authorInfo:{}}},computed:{hasProjects(){return this.listInfo.projects&&this.listInfo.projects.length>0}},async created(){await this.fetchProjectList()},methods:{async fetchProjectList(){this.loading=!0;try{const t=await T.get(`/projectlist/lists/listid/${this.listId}`);if(t.data.status==="success"){this.listInfo=t.data.data;const i=L.user.value;if(this.isOwner=i&&i.id===this.listInfo.authorid,this.listInfo.authorid&&(this.authorInfo=await this.fetchUserInfo(this.listInfo.authorid)),this.listInfo.projects&&this.listInfo.projects.length>0){const _=[...new Set(this.listInfo.projects.map(u=>u.authorid))];await Promise.all(_.map(u=>this.fetchUserInfo(u)))}}else this.$toast.add({severity:"error",summary:"错误",detail:t.data.message||"获取列表失败",life:3e3})}catch(t){console.error("获取列表失败:",t),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},async fetchUserInfo(t){if(this.userCache[t])return this.userCache[t];try{const i=await A(t);return this.userCache[t]=i,i}catch(i){return console.error(`获取用户 ${t} 信息失败:`,i),{id:t,username:`用户${t}`}}},getUserInfo(t){return this.userCache[t]||{id:t,username:`用户${t}`}},getAvatarUrl(t){return t?t.avatar?t.avatar:t.images?`https://zerocat-bitiful.houlangs.com/user/${t.images}`:"":""},openEditDialog(){this.editDialog=!0},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未知"}}},G={class:"d-flex align-center mb-2"},K={class:"text-caption"},M={class:"d-flex flex-wrap"},Q={class:"text-caption mr-4"},R={class:"text-caption"},J={class:"d-flex align-center"},W={class:"text-caption"},X={class:"mt-2 d-flex align-center"},Y={class:"text-caption"},Z={class:"text-caption"};function $(t,i,_,u,a,r){const p=P;return c(),d(H,null,{default:e(()=>[a.loading?(c(),d(m,{key:0},{default:e(()=>[s(h,{cols:"12",class:"text-center"},{default:e(()=>[s(j,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(c(),g(I,{key:1},[s(m,null,{default:e(()=>[s(h,{cols:"12"},{default:e(()=>[s(y,{class:"mb-4"},{default:e(()=>[s(z,{class:"d-flex align-center"},{default:e(()=>[o("span",null,n(a.listInfo.title||"未命名列表"),1),s(D,{class:"ml-2",color:a.listInfo.state==="public"?"success":"warning",size:"small"},{default:e(()=>[f(n(a.listInfo.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),s(k),a.isOwner?(c(),d(B,{key:0,icon:"mdi-pencil",variant:"text",size:"small",onClick:r.openEditDialog,color:"primary"},null,8,["onClick"])):V("",!0)]),_:1}),a.listInfo.description?(c(),d(N,{key:0},{default:e(()=>[f(n(a.listInfo.description),1)]),_:1})):V("",!0),s(x,null,{default:e(()=>[o("div",G,[s(w,{size:"24",class:"mr-2"},{default:e(()=>[s(C,{src:r.getAvatarUrl(a.authorInfo),alt:"用户头像"},null,8,["src"])]),_:1}),o("span",K,n(a.authorInfo.username||a.authorInfo.display_name||"未知用户"),1)]),o("div",M,[o("span",Q,"创建于: "+n(r.formatDate(a.listInfo.createTime)),1),o("span",R,"更新于: "+n(r.formatDate(a.listInfo.updateTime)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),r.hasProjects?(c(),d(m,{key:1},{default:e(()=>[s(h,{cols:"12"},{default:e(()=>[i[2]||(i[2]=o("h3",{class:"text-h6 mb-4"},"项目列表",-1)),s(m,null,{default:e(()=>[(c(!0),g(I,null,S(a.listInfo.projects,l=>(c(),d(h,{key:l.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[s(y,{title:l.title,subtitle:l.description||"无描述",class:"h-100",to:`/app/link/project?id=${l.id}`},{default:e(()=>[s(x,null,{default:e(()=>[o("div",J,[s(D,{color:l.state==="public"?"success":"warning",size:"small",class:"mr-2"},{default:e(()=>[f(n(l.state==="public"?"公开":"私密"),1)]),_:2},1032,["color"]),o("span",W,n(r.formatDate(l.time)),1)]),o("div",X,[o("span",Y,"浏览: "+n(l.view_count||0),1),s(k),o("span",Z,[s(w,{size:"16",class:"mr-1"},{default:e(()=>[s(C,{src:r.getAvatarUrl(r.getUserInfo(l.authorid)),alt:"用户头像"},null,8,["src"])]),_:2},1024),f(" "+n(r.getUserInfo(l.authorid).username||r.getUserInfo(l.authorid).display_name||`用户${l.authorid}`),1)])])]),_:2},1024)]),_:2},1032,["title","subtitle","to"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):(c(),d(m,{key:0},{default:e(()=>[s(h,{cols:"12",class:"text-center"},{default:e(()=>[s(E,{type:"info",variant:"tonal"},{default:e(()=>i[1]||(i[1]=[f(" 此列表暂无项目 ")])),_:1})]),_:1})]),_:1}))],64)),s(O,{modelValue:a.editDialog,"onUpdate:modelValue":i[0]||(i[0]=l=>a.editDialog=l),"max-width":"600px"},{default:e(()=>[s(p,{listid:_.listId,callback:r.fetchProjectList,close:()=>a.editDialog=!1},null,8,["listid","callback","close"])]),_:1},8,["modelValue"])]),_:1})}const U=b(F,[["render",$],["__scopeId","data-v-4fe31977"]]),tt={components:{showProjectList:U},data(){return{listId:this.$route.params.id,listTitle:"项目列表"}},async mounted(){try{const t=await q(this.listId);t&&t.title&&(this.listTitle=t.title,this.updatePageTitle())}catch(t){console.error("获取列表信息失败:",t)}},methods:{updatePageTitle(){v({title:this.listTitle})}},setup(){v({title:"项目列表"})}};function et(t,i,_,u,a,r){const p=U;return c(),d(p,{listId:a.listId},null,8,["listId"])}const pt=b(tt,[["render",et]]);export{pt as default};
