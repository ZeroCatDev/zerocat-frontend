import{_ as w,a1 as r,ab as b,c as k,o as c,e,N as l,L as t,X as n,i as u,ad as V,Y as h,$ as m,ae as f,D as B,m as y,ao as x,W as C,a9 as F,a3 as v,f as p,at as S,ap as U,aG as _}from"./index-CEHpVphu.js";import{V as L}from"./VTextarea-LgHT96UT.js";import{V as I}from"./VSpacer-CSce2cDM.js";const R={name:"UserRelationControls",props:{userId:{type:Number,required:!0},username:{type:String,required:!0},displayName:{type:String,required:!0}},data(){return{isFollowing:!1,isBlocking:!1,followLoading:!1,blockLoading:!1,blockDialog:!1,blockReason:"",localuser:b,targetUsername:this.displayName||this.username,snackbar:{show:!1,text:"",color:"success"}}},mounted(){this.localuser.user.id&&this.checkRelationships()},watch:{userId:{handler(){this.checkRelationships()},immediate:!0}},methods:{async checkRelationships(){if(this.localuser.user.id)try{const i=await r.get(`/follows/relationships/${this.userId}`);if(i.data.success){const{isFollowing:o,isBlocking:g}=i.data.data;this.isFollowing=o,this.isBlocking=g}}catch(i){console.error("检查用户关系失败:",i)}},async toggleFollow(){if(!this.localuser.user.id){this.$router.push("/login");return}try{this.followLoading=!0,this.isFollowing?(await r.delete(`/follows/${this.userId}`),this.isFollowing=!1,this.showSnackbar(`已取消关注 ${this.targetUsername}`,"info")):(await r.post(`/follows/${this.userId}`),this.isFollowing=!0,this.showSnackbar(`已成功关注 ${this.targetUsername}`,"success"))}catch(i){console.error("关注操作失败:",i),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.followLoading=!1}},toggleBlock(){if(!this.localuser.user.id){this.$router.push("/login");return}this.blockDialog=!0},async confirmBlockAction(){try{if(this.blockLoading=!0,this.isBlocking)await r.delete(`/follows/block/${this.userId}`),this.isBlocking=!1,this.showSnackbar(`已取消拉黑 ${this.targetUsername}`,"success");else{const i=this.blockReason?{reason:this.blockReason}:{};await r.post(`/follows/block/${this.userId}`,i),this.isBlocking=!0,this.isFollowing&&(await r.delete(`/follows/${this.userId}`),this.isFollowing=!1),this.showSnackbar(`已拉黑 ${this.targetUsername}`,"success")}this.blockDialog=!1,this.blockReason=""}catch(i){console.error("拉黑操作失败:",i),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.blockLoading=!1}},sendMessage(){this.showSnackbar("私信功能即将上线","info")},reportUser(){this.showSnackbar("举报功能即将上线","info")},showSnackbar(i,o="success"){this.snackbar.text=i,this.snackbar.color=o,this.snackbar.show=!0}}},D={key:0},N={key:1};function T(i,o,g,q,s,d){return c(),k("div",null,[e(u,{loading:s.followLoading,variant:s.isFollowing?"outlined":"tonal",color:"primary","prepend-icon":s.isFollowing?"mdi-check":"mdi-account-plus",onClick:d.toggleFollow,rounded:"pill"},{default:l(()=>[t(n(s.isFollowing?"已关注":"关注"),1)]),_:1},8,["loading","variant","prepend-icon","onClick"]),e(x,{location:"bottom"},{activator:l(({props:a})=>[e(u,y({icon:"mdi-dots-vertical",variant:"text",size:"small",class:"ml-2"},a),null,16)]),default:l(()=>[e(V,{density:"compact",width:"150"},{default:l(()=>[e(f,{"prepend-icon":s.isBlocking?"mdi-account-cancel":"mdi-account-remove",title:s.isBlocking?"取消拉黑":"拉黑用户",class:B({"text-error":!s.isBlocking}),onClick:d.toggleBlock},null,8,["prepend-icon","title","class","onClick"]),s.isFollowing?(c(),h(f,{key:0,"prepend-icon":"mdi-account-remove",title:"取消关注",onClick:d.toggleFollow},null,8,["onClick"])):m("",!0)]),_:1})]),_:1}),e(U,{modelValue:s.blockDialog,"onUpdate:modelValue":o[2]||(o[2]=a=>s.blockDialog=a),"max-width":"400px"},{default:l(()=>[e(C,null,{default:l(()=>[e(F,{class:"text-h5 text-center pa-4"},{default:l(()=>[t(n(s.isBlocking?"取消拉黑用户":"拉黑用户"),1)]),_:1}),e(v,{class:"pa-4"},{default:l(()=>[s.isBlocking?(c(),k("p",D,[o[5]||(o[5]=t(" 确定要取消拉黑 ")),p("strong",null,n(s.targetUsername),1),o[6]||(o[6]=t(" 吗？取消拉黑后，该用户可以查看您的内容并与您互动。 "))])):(c(),k("p",N,[o[7]||(o[7]=t(" 确定要拉黑 ")),p("strong",null,n(s.targetUsername),1),o[8]||(o[8]=t(" 吗？拉黑后，该用户将无法关注您，也无法查看您的动态或与您互动。 "))])),s.isBlocking?m("",!0):(c(),h(L,{key:2,modelValue:s.blockReason,"onUpdate:modelValue":o[0]||(o[0]=a=>s.blockReason=a),label:"拉黑原因（可选）",placeholder:"请简要说明拉黑原因...",variant:"outlined",rows:"3",class:"mt-4","hide-details":""},null,8,["modelValue"]))]),_:1}),e(S,{class:"pa-4 pt-0"},{default:l(()=>[e(I),e(u,{variant:"text",onClick:o[1]||(o[1]=a=>s.blockDialog=!1)},{default:l(()=>o[9]||(o[9]=[t(" 取消 ")])),_:1,__:[9]}),e(u,{color:s.isBlocking?"primary":"error",loading:s.blockLoading,onClick:d.confirmBlockAction,variant:"tonal"},{default:l(()=>[t(n(s.isBlocking?"取消拉黑":"拉黑"),1)]),_:1},8,["color","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(_,{modelValue:s.snackbar.show,"onUpdate:modelValue":o[4]||(o[4]=a=>s.snackbar.show=a),color:s.snackbar.color,timeout:3e3},{actions:l(()=>[e(u,{variant:"text",onClick:o[3]||(o[3]=a=>s.snackbar.show=!1)},{default:l(()=>o[10]||(o[10]=[t(" 关闭 ")])),_:1,__:[10]})]),default:l(()=>[t(n(s.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const E=w(R,[["render",T]]);export{E as _};
