import{_ as W}from"./LoadingDialog-BFsh9Db_.js";import{_ as N}from"./AuthCard-BLpwvQtN.js";import{_ as z}from"./Recaptcha-CboTm7N3.js";import{_ as G,a as P,o as k,h as t,P as s,aP as Y,S as Z,T as g,Z as J,a0 as E,az as K,aA as b,N as p,ax as B,F as Q,k as m,Y as X,i as $,bc as ee,r as u,ao as ae,O as oe,w as te}from"./index-Be33B4pJ.js";import{A as w}from"./authService-DnAxvQy4.js";import"https://static.geetest.com/v4/gt4.js";const ne={components:{LoadingDialog:W,Recaptcha:z,AuthCard:N},setup(){const _=ee(),o=u(""),h=u(""),a=u(""),c=u("password"),v=u(0),i=u(!1),y=u(!1),f=u(null),l=u(!1),S={required:e=>!!e||"此字段为必填项",length:e=>(e==null?void 0:e.length)===6||"验证码必须是6位数字"},F=[e=>!!e||"必须填写邮箱",e=>/.+@.+\..+/.test(e)||"不符合格式"],O=[e=>!!e||"必须填写密码"];ae.isLogin.value===!0&&_.push("/app/explore"),oe({title:"登录"});const U=()=>c.value==="password"?"登录":c.value==="code"?a.value?"登录":"发送验证码":c.value==="magiclink"?l.value?"已发送，请检查邮箱":"发送登录链接":"登录",D=async()=>{switch(c.value){case"password":await T();break;case"code":a.value?await R():await V();break;case"magiclink":await L();break}},T=async()=>{var e;if(!o.value||!h.value){r("请输入邮箱和密码");return}i.value=!0;try{const n=((e=f.value)==null?void 0:e.getResponse())||null,d=await w.loginWithPassword(o.value,h.value,n);A(d)}catch(n){x(n)}finally{i.value=!1}},R=async()=>{if(!o.value||!a.value){r("请输入邮箱和验证码");return}i.value=!0;try{const e=await w.loginWithCode(o.value,a.value);A(e)}catch(e){x(e)}finally{i.value=!1}},V=async()=>{var e;if(!(v.value>0)){if(!o.value||!/.+@.+\..+/.test(o.value)){r("请输入正确的邮箱地址");return}i.value=!0;try{const n=((e=f.value)==null?void 0:e.getResponse())||null,d=await w.sendLoginCode(o.value,n);d.status==="success"?(C("验证码已发送"),M()):r(d.message)}catch(n){x(n)}finally{i.value=!1}}},L=async()=>{var e;if(!l.value){if(!o.value||!/.+@.+\..+/.test(o.value)){r("请输入正确的邮箱地址");return}i.value=!0;try{const n=((e=f.value)==null?void 0:e.getResponse())||null;if(!n){r("请完成人机验证"),i.value=!1;return}const d=await w.generateMagicLink(o.value,window.location.origin+"/app/account/magiclink/validate",n);d.status==="success"?(C("登录链接已发送到您的邮箱"),l.value=!0):r(d.message)}catch(n){x(n)}finally{i.value=!1}}},I=e=>{window.location.href=w.oauthRedirect(e)},A=e=>{e.status==="success"?(C("登录成功，欢迎回来，"+e.display_name),setTimeout(()=>{_.push("/app/explore")},1e3)):r(e.message)},x=e=>{var n,d;r(((d=(n=e.response)==null?void 0:n.data)==null?void 0:d.message)||e.message)},C=e=>{var n;(n=this==null?void 0:this.$toast)==null||n.add({severity:"success",summary:"成功",detail:e,life:3e3})},r=e=>{var n;(n=this==null?void 0:this.$toast)==null||n.add({severity:"error",summary:"错误",detail:e,life:3e3})},M=()=>{v.value=60;const e=setInterval(()=>{v.value--,v.value<=0&&clearInterval(e)},1e3)},q=e=>{c.value==="code"&&!a.value&&V()},H=()=>{r("验证失败，请重试")},j=()=>{};return te(c,e=>{a.value="",l.value=!1,setTimeout(()=>{f.value&&f.value.resetCaptcha()},100)}),{email:o,password:h,verificationCode:a,loginType:c,countdown:v,loading:i,showPassword:y,rules:S,emailRules:F,passwordRules:O,recaptcha:f,magicLinkSent:l,getLoginButtonText:U,handleLoginAction:D,loginWithPassword:T,loginWithCode:R,sendVerificationCode:V,sendMagicLink:L,loginWithOAuth:I,handleBindVerified:q,handleBindError:H,handleBindClose:j}}},le={class:"d-flex flex-wrap gap-2 justify-start mt-4"};function se(_,o,h,a,c,v){const i=z,y=N,f=W;return k(),P("div",null,[t(y,{subtitle:"登录你的账户"},{default:s(()=>[t(Y,null,{default:s(()=>[t(Z,null,{default:s(()=>[t(g,{cols:"12"},{default:s(()=>[t(K,{modelValue:a.loginType,"onUpdate:modelValue":o[0]||(o[0]=l=>a.loginType=l),class:"mb-4"},{default:s(()=>[t(b,{value:"password",variant:"text"},{default:s(()=>o[7]||(o[7]=[p("密码登录")])),_:1,__:[7]}),t(b,{value:"code",variant:"text"},{default:s(()=>o[8]||(o[8]=[p("验证码登录")])),_:1,__:[8]}),t(b,{value:"magiclink",variant:"text"},{default:s(()=>o[9]||(o[9]=[p("魔术链接登录")])),_:1,__:[9]})]),_:1},8,["modelValue"]),t(B,{label:"邮箱",type:"text",modelValue:a.email,"onUpdate:modelValue":o[1]||(o[1]=l=>a.email=l),variant:"outlined",rules:a.emailRules},null,8,["modelValue","rules"]),a.loginType==="password"?(k(),J(B,{key:0,label:"密码",modelValue:a.password,"onUpdate:modelValue":o[2]||(o[2]=l=>a.password=l),variant:"outlined",rules:a.passwordRules,"append-icon":a.showPassword?"mdi-eye":"mdi-eye-off",type:a.showPassword?"text":"password","onClick:append":o[3]||(o[3]=l=>a.showPassword=!a.showPassword)},null,8,["modelValue","rules","append-icon","type"])):E("",!0),a.loginType==="code"?(k(),P(Q,{key:1},[t(B,{modelValue:a.verificationCode,"onUpdate:modelValue":o[4]||(o[4]=l=>a.verificationCode=l),label:"验证码",variant:"outlined",maxlength:"6",rules:[a.rules.required,a.rules.length]},null,8,["modelValue","rules"]),t(m,{class:"mb-4",variant:"text",onClick:a.sendVerificationCode,disabled:a.countdown>0},{default:s(()=>[p(X(a.countdown>0?`${a.countdown}秒后重新发送`:"发送验证码"),1)]),_:1},8,["onClick","disabled"])],64)):E("",!0)]),_:1}),t(g,{cols:"12"},{default:s(()=>[t(i,{ref:"recaptcha",recaptchaId:"recaptcha-div",showNormal:!0,onBindVerified:a.handleBindVerified,onBindError:a.handleBindError,onBindClose:a.handleBindClose},null,8,["onBindVerified","onBindError","onBindClose"])]),_:1}),t(g,{cols:"12"},{default:s(()=>[t(m,{class:"text-none",color:"primary",rounded:"xl",text:a.getLoginButtonText(),variant:"flat",size:"large",onClick:a.handleLoginAction,"append-icon":"mdi-arrow-right",loading:a.loading},null,8,["text","onClick","loading"])]),_:1}),t(g,{cols:"12"},{default:s(()=>[t(m,{class:"text-none",color:"white",rounded:"xl",text:"注册",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/register"}),t(m,{class:"text-none",color:"white",rounded:"xl",text:"找回密码",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/retrieve"}),t(m,{class:"text-none",color:"white",rounded:"xl",text:"魔术链接登录",variant:"text",size:"large","append-icon":"mdi-arrow-right",to:"/app/account/magiclink"})]),_:1}),t(g,{cols:"12"},{default:s(()=>[$("div",le,[t(m,{onClick:o[5]||(o[5]=l=>a.loginWithOAuth("microsoft")),color:"blue","prepend-icon":"mdi-microsoft",variant:"flat"},{default:s(()=>o[10]||(o[10]=[p("Microsoft")])),_:1,__:[10]}),t(m,{onClick:o[6]||(o[6]=l=>a.loginWithOAuth("github")),color:"black","prepend-icon":"mdi-github",variant:"flat"},{default:s(()=>o[11]||(o[11]=[p("GitHub")])),_:1,__:[11]})])]),_:1})]),_:1})]),_:1})]),_:1}),t(f,{show:a.loading,text:"登录中"},null,8,["show"])])}const me=G(ne,[["render",se]]);export{me as default};
