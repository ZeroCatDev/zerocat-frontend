import{_ as k,Y as C,o as U,N as t,e as s,W as o,a9 as r,f as h,i as b,L as a,a3 as f,Q as S,R as V,ad as x,ae as g,af as p,ag as m,X as u,O as _,bs as y,T as v,a1 as c}from"./index-CD7vfFJn.js";import{V as I}from"./VSpacer-46C6LS8S.js";import{V as w}from"./VSwitch-n-Rd24IJ.js";import"./VSelectionControl-BCgSGn4C.js";const G={name:"SitemapPage",data(){return{loading:!1,generating:!1,settings:{enabled:!1,autoUpdate:!1},status:{enabled:!1,autoUpdate:!1,updateCron:"",currentFileHash:"",lastFullUpdate:"",lastIncrementalUpdate:"",isGenerating:!1,isTaskScheduled:!1},snackbar:{show:!1,text:"",color:"success"}}},methods:{async loadStatus(){this.loading=!0;try{const n=await c.get("/admin/sitemap/status");if(n.status===200&&n.data.status==="success"){const e=n.data.data;this.status=e,this.settings.enabled=e.enabled,this.settings.autoUpdate=e.autoUpdate}}catch{this.showError("加载状态失败")}this.loading=!1},async saveSettings(){this.loading=!0;try{const n=await c.post("/admin/sitemap/settings",{enabled:this.settings.enabled,autoUpdate:this.settings.autoUpdate});n.status===200&&n.data.status==="success"&&(this.showSuccess("设置已更新"),this.loadStatus())}catch{this.showError("保存设置失败"),this.loadStatus()}this.loading=!1},async generateSitemap(n){this.generating=!0;try{const e=await c.post("/admin/sitemap/generate",{type:n});e.status===200&&e.data.status==="success"&&(this.showSuccess("站点地图生成成功"),this.loadStatus())}catch{this.showError("生成站点地图失败")}this.generating=!1},showSuccess(n){this.snackbar={show:!0,text:n,color:"success"}},showError(n){this.snackbar={show:!0,text:n,color:"error"}}},mounted(){this.loadStatus()}};function T(n,e,L,B,l,d){return U(),C(v,{fluid:""},{default:t(()=>[s(o,null,{default:t(()=>[s(r,{class:"d-flex align-center"},{default:t(()=>[e[6]||(e[6]=h("span",null,"站点地图管理",-1)),s(I),s(b,{color:"primary",onClick:d.loadStatus,loading:l.loading,"prepend-icon":"mdi-refresh"},{default:t(()=>e[5]||(e[5]=[a(" 刷新 ")])),_:1,__:[5]},8,["onClick","loading"])]),_:1,__:[6]}),s(f,null,{default:t(()=>[s(S,null,{default:t(()=>[s(V,{cols:"12",md:"6"},{default:t(()=>[s(o,{variant:"outlined"},{default:t(()=>[s(r,null,{default:t(()=>e[7]||(e[7]=[a("基本设置")])),_:1,__:[7]}),s(f,null,{default:t(()=>[s(w,{modelValue:l.settings.enabled,"onUpdate:modelValue":e[0]||(e[0]=i=>l.settings.enabled=i),label:"启用站点地图",disabled:l.loading,onChange:d.saveSettings},null,8,["modelValue","disabled","onChange"]),s(w,{modelValue:l.settings.autoUpdate,"onUpdate:modelValue":e[1]||(e[1]=i=>l.settings.autoUpdate=i),label:"启用自动更新",disabled:l.loading||!l.settings.enabled,onChange:d.saveSettings},null,8,["modelValue","disabled","onChange"])]),_:1})]),_:1})]),_:1}),s(V,{cols:"12",md:"6"},{default:t(()=>[s(o,{variant:"outlined"},{default:t(()=>[s(r,null,{default:t(()=>e[8]||(e[8]=[a("当前状态")])),_:1,__:[8]}),s(f,null,{default:t(()=>[s(x,null,{default:t(()=>[s(g,null,{prepend:t(()=>[s(_,{color:l.status.isGenerating?"warning":"success"},{default:t(()=>[a(u(l.status.isGenerating?"mdi-cog-sync":"mdi-check-circle"),1)]),_:1},8,["color"])]),default:t(()=>[s(p,null,{default:t(()=>e[9]||(e[9]=[a("生成状态")])),_:1,__:[9]}),s(m,null,{default:t(()=>[a(u(l.status.isGenerating?"正在生成中":"空闲"),1)]),_:1})]),_:1}),s(g,null,{prepend:t(()=>[s(_,null,{default:t(()=>e[10]||(e[10]=[a("mdi-clock-outline")])),_:1,__:[10]})]),default:t(()=>[s(p,null,{default:t(()=>e[11]||(e[11]=[a("最后全量更新")])),_:1,__:[11]}),s(m,null,{default:t(()=>[a(u(l.status.lastFullUpdate||"从未更新"),1)]),_:1})]),_:1}),s(g,null,{prepend:t(()=>[s(_,null,{default:t(()=>e[12]||(e[12]=[a("mdi-clock-outline")])),_:1,__:[12]})]),default:t(()=>[s(p,null,{default:t(()=>e[13]||(e[13]=[a("最后增量更新")])),_:1,__:[13]}),s(m,null,{default:t(()=>[a(u(l.status.lastIncrementalUpdate||"从未更新"),1)]),_:1})]),_:1}),s(g,null,{prepend:t(()=>[s(_,null,{default:t(()=>e[14]||(e[14]=[a("mdi-file-document-outline")])),_:1,__:[14]})]),default:t(()=>[s(p,null,{default:t(()=>e[15]||(e[15]=[a("当前文件哈希")])),_:1,__:[15]}),s(m,{class:"text-truncate"},{default:t(()=>[a(u(l.status.currentFileHash||"无"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(S,{class:"mt-4"},{default:t(()=>[s(V,null,{default:t(()=>[s(o,{variant:"outlined"},{default:t(()=>[s(r,null,{default:t(()=>e[16]||(e[16]=[a("手动生成")])),_:1,__:[16]}),s(f,null,{default:t(()=>[s(b,{color:"primary",loading:l.generating,disabled:!l.settings.enabled||l.status.isGenerating,class:"mr-2",onClick:e[2]||(e[2]=i=>d.generateSitemap("full")),"prepend-icon":"mdi-refresh"},{default:t(()=>e[17]||(e[17]=[a(" 全量生成 ")])),_:1,__:[17]},8,["loading","disabled"]),s(b,{loading:l.generating,disabled:!l.settings.enabled||l.status.isGenerating,onClick:e[3]||(e[3]=i=>d.generateSitemap("incremental")),"prepend-icon":"mdi-refresh"},{default:t(()=>e[18]||(e[18]=[a(" 增量更新 ")])),_:1,__:[18]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(y,{modelValue:l.snackbar.show,"onUpdate:modelValue":e[4]||(e[4]=i=>l.snackbar.show=i),color:l.snackbar.color,timeout:3e3},{default:t(()=>[a(u(l.snackbar.text),1)]),_:1},8,["modelValue","color"])]),_:1})}const R=k(G,[["render",T],["__scopeId","data-v-ce151beb"]]);export{R as default};
