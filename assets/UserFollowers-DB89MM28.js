import{_ as x,a0 as w,al as F,ag as v,a as d,o as a,X as c,h as i,P as o,a2 as V,i as m,F as k,T as C,aw as I,ax as S,N as u,W as h,ay as M,Z as p,S as N,k as _,Y as T,t as A,U as B}from"./index-DxnnEWES.js";import{a as y,V as b}from"./VRow-U_ZRI4jj.js";import{V as P}from"./VSnackbar-CQFsEL7M.js";const z={name:"UserFollowing",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1}},data(){return{following:[],loading:!0,loadingMore:!1,unfollowingId:null,totalFollowing:0,localuser:F,VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com",snackbar:{show:!1,text:"",color:"success"}}},computed:{hasMoreFollowing(){return this.following.length<this.totalFollowing&&this.showAll}},watch:{userId:{immediate:!0,handler(l,e){l&&l!==e&&this.fetchFollowing()}}},methods:{async fetchFollowing(l=!1){if(this.userId)try{l?this.loadingMore=!0:this.loading=!0;const e=l?this.following.length:0,n=this.showAll?this.limit:Math.min(this.limit,5),r=await w.get(`/follows/following/${this.userId}`,{params:{limit:n,offset:e}});if(r.data.success){const s=r.data.data;l?this.following=[...this.following,...s.following]:this.following=s.following,this.totalFollowing=s.total}}catch(e){console.error("获取关注用户失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async unfollowUser(l,e){if(!this.localuser.user.id){this.$router.push("/app/account/login");return}try{if(this.unfollowingId=l,await w.delete(`/follows/${l}`),this.userId===this.localuser.user.id)this.following=this.following.filter(n=>n.user.id!==l),this.totalFollowing--;else{const n=this.following.findIndex(r=>r.user.id===l);n!==-1&&(this.following[n].isFollowing=!1)}this.showSnackbar(`已取消关注 ${e}`,"info")}catch(n){console.error("取消关注失败:",n),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.unfollowingId=null}},async loadMoreFollowing(){await this.fetchFollowing(!0)},showSnackbar(l,e="success"){this.snackbar={show:!0,text:l,color:e}}}},L={class:"user-following"},K={class:"d-flex align-center"},j={class:"d-flex justify-center mt-4 mb-4"},q={key:1,class:"text-medium-emphasis"};function U(l,e,n,r,s,f){const g=v("router-link");return a(),d("div",L,[s.loading?(a(),c(b,{key:0},{default:o(()=>[i(y,{cols:"12",class:"text-center"},{default:o(()=>[i(V,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):s.following.length===0?(a(),c(b,{key:1},{default:o(()=>[i(y,{cols:"12",class:"text-center"},{default:o(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无关注的用户",-1)])),_:1,__:[2]})]),_:1})):(a(),d(k,{key:2},[(a(!0),d(k,null,C(s.following,t=>(a(),c(B,{key:t.id,class:"mb-3",hover:""},{default:o(()=>[i(I,null,{prepend:o(()=>[i(g,{to:`/${t.user.username}`},{default:o(()=>[i(T,{size:"50"},{default:o(()=>[i(A,{src:s.VITE_APP_S3_BUCKET+"/user/"+(t.user.avatar||t.user.images),alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:o(()=>[m("div",K,[t.followsYou?(a(),c(N,{key:0,color:"secondary",size:"small",class:"mr-2"},{default:o(()=>e[3]||(e[3]=[u(" 关注了你 ")])),_:1,__:[3]})):p("",!0),s.localuser.user.id&&s.localuser.user.id!==t.user.id?(a(),c(_,{key:1,loading:s.unfollowingId===t.user.id,variant:"outlined",color:"primary",size:"small","prepend-icon":"mdi-account-minus",onClick:E=>f.unfollowUser(t.user.id,t.user.display_name)},{default:o(()=>e[4]||(e[4]=[u(" 取消关注 ")])),_:2,__:[4]},1032,["loading","onClick"])):p("",!0)])]),default:o(()=>[i(S,null,{default:o(()=>[i(g,{to:`/${t.user.username}`,class:"text-decoration-none"},{default:o(()=>[u(h(t.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),i(M,{class:"text-truncate"},{default:o(()=>[u(h(t.created_at||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),m("div",j,[f.hasMoreFollowing?(a(),c(_,{key:0,loading:s.loadingMore,variant:"tonal",onClick:f.loadMoreFollowing},{default:o(()=>e[5]||(e[5]=[u(" 加载更多 ")])),_:1,__:[5]},8,["loading","onClick"])):s.following.length>0?(a(),d("div",q," 没有更多内容了 ")):p("",!0)])],64)),i(P,{modelValue:s.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=t=>s.snackbar.show=t),color:s.snackbar.color,timeout:3e3},{actions:o(()=>[i(_,{variant:"text",onClick:e[0]||(e[0]=t=>s.snackbar.show=!1)},{default:o(()=>e[6]||(e[6]=[u(" 关闭 ")])),_:1,__:[6]})]),default:o(()=>[u(h(s.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const O=x(z,[["render",U],["__scopeId","data-v-b0751933"]]),Y={name:"UserFollowers",props:{userId:{type:Number,required:!0},limit:{type:Number,default:20},showAll:{type:Boolean,default:!1}},data(){return{followers:[],loading:!0,loadingMore:!1,actionLoading:null,totalFollowers:0,localuser:F,VITE_APP_S3_BUCKET:"https://zerocat-bitiful.houlangs.com",snackbar:{show:!1,text:"",color:"success"}}},computed:{hasMoreFollowers(){return this.followers.length<this.totalFollowers&&this.showAll}},watch:{userId:{immediate:!0,handler(l,e){l&&l!==e&&this.fetchFollowers()}}},methods:{async fetchFollowers(l=!1){if(this.userId)try{l?this.loadingMore=!0:this.loading=!0;const e=l?this.followers.length:0,n=this.showAll?this.limit:Math.min(this.limit,5),r=await w.get(`/follows/followers/${this.userId}`,{params:{limit:n,offset:e}});if(r.data.success){const s=r.data.data;l?this.followers=[...this.followers,...s.followers]:this.followers=s.followers,this.totalFollowers=s.total}}catch(e){console.error("获取关注者失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async toggleFollow(l,e,n){if(!this.localuser.user.id){this.$router.push("/app/account/login");return}try{this.actionLoading=l,n?(await w.delete(`/follows/${l}`),this.showSnackbar(`已取消关注 ${e}`,"info")):(await w.post(`/follows/${l}`),this.showSnackbar(`已成功关注 ${e}`,"success"));const r=this.followers.findIndex(s=>s.user.id===l);r!==-1&&(this.followers[r].youFollow=!n)}catch(r){console.error("关注操作失败:",r),this.showSnackbar("操作失败，请稍后重试","error")}finally{this.actionLoading=null}},async loadMoreFollowers(){await this.fetchFollowers(!0)},showSnackbar(l,e="success"){this.snackbar={show:!0,text:l,color:e}}}},D={class:"user-followers"},R={class:"d-flex align-center"},W={class:"d-flex justify-center mt-4 mb-4"},X={key:1,class:"text-medium-emphasis"};function Z(l,e,n,r,s,f){const g=v("router-link");return a(),d("div",D,[s.loading?(a(),c(b,{key:0},{default:o(()=>[i(y,{cols:"12",class:"text-center"},{default:o(()=>[i(V,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):s.followers.length===0?(a(),c(b,{key:1},{default:o(()=>[i(y,{cols:"12",class:"text-center"},{default:o(()=>e[2]||(e[2]=[m("p",{class:"text-medium-emphasis"},"暂无关注者",-1)])),_:1,__:[2]})]),_:1})):(a(),d(k,{key:2},[(a(!0),d(k,null,C(s.followers,t=>(a(),c(B,{key:t.id,class:"mb-3",hover:""},{default:o(()=>[i(I,null,{prepend:o(()=>[i(g,{to:`/${t.user.username}`},{default:o(()=>[i(T,{size:"50"},{default:o(()=>[i(A,{src:s.VITE_APP_S3_BUCKET+"/user/"+(t.user.avatar||t.user.images),alt:"用户头像"},null,8,["src"])]),_:2},1024)]),_:2},1032,["to"])]),append:o(()=>[m("div",R,[s.localuser.user.id&&s.localuser.user.id!==t.user.id?(a(),c(_,{key:0,loading:s.actionLoading===t.user.id,variant:t.youFollow?"outlined":"tonal",color:"primary","prepend-icon":t.youFollow?"mdi-account-minus":"mdi-account-plus",size:"small",onClick:E=>f.toggleFollow(t.user.id,t.user.display_name,t.youFollow)},{default:o(()=>[u(h(t.youFollow?"取消关注":"关注"),1)]),_:2},1032,["loading","variant","prepend-icon","onClick"])):p("",!0)])]),default:o(()=>[i(S,null,{default:o(()=>[i(g,{to:`/${t.user.username}`,class:"text-decoration-none"},{default:o(()=>[u(h(t.user.display_name),1)]),_:2},1032,["to"])]),_:2},1024),i(M,{class:"text-truncate"},{default:o(()=>[u(h(t.created_at||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),m("div",W,[f.hasMoreFollowers?(a(),c(_,{key:0,loading:s.loadingMore,variant:"tonal",onClick:f.loadMoreFollowers},{default:o(()=>e[3]||(e[3]=[u(" 加载更多 ")])),_:1,__:[3]},8,["loading","onClick"])):s.followers.length>0?(a(),d("div",X," 没有更多内容了 ")):p("",!0)])],64)),i(P,{modelValue:s.snackbar.show,"onUpdate:modelValue":e[1]||(e[1]=t=>s.snackbar.show=t),color:s.snackbar.color,timeout:3e3},{actions:o(()=>[i(_,{variant:"text",onClick:e[0]||(e[0]=t=>s.snackbar.show=!1)},{default:o(()=>e[4]||(e[4]=[u(" 关闭 ")])),_:1,__:[4]})]),default:o(()=>[u(h(s.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])}const Q=x(Y,[["render",Z],["__scopeId","data-v-54d95a00"]]);export{O as _,Q as a};
