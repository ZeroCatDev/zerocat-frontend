import{_ as x}from"./EditProjectListConfig-D7KRHXEn.js";import{_ as C}from"./ProjectCard-De9ggFex.js";import{_ as j,X as P,au as k,T as l,o as r,N as e,a as g,h as a,Z as v,F as I,R as L,W as y,as as T,M as n,S as c,K as _,j as U,at as b,Y as B,U as N,q as S,Q as z,L as V}from"./index-BoardjOA.js";import{a as E}from"./user-B1yyLxxw.js";import{V as f,a as m}from"./VRow-DnCu-HME.js";import{V as A}from"./VChip-Dy0NAZz2.js";import{V as O}from"./VSpacer-7bdtXO3d.js";import{V as q}from"./VAlert-DKTv-pIZ.js";import{V as F}from"./VDialog-Bygrtth4.js";import{V as R}from"./VContainer-DvmY3th9.js";import{d as H}from"./projectService-DC80S6NH.js";import"./VTextField-huVeyDMJ.js";/* empty css                   */import"./VInput-BSMIx3P2.js";import"./VSelect-DrDGiuRO.js";import"./VCheckboxBtn-B8zOAPkX.js";import"./VSelectionControl-DKWpLVVs.js";import"./43-lazyload-CBkwrR6M.js";/* empty css              */const K={props:{listId:{type:String,required:!0}},components:{EditProjectListConfig:x,ProjectCard:C},data(){return{loading:!0,listInfo:{},isOwner:!1,editDialog:!1,userCache:{},authorInfo:{}}},computed:{hasProjects(){return this.listInfo.projects&&this.listInfo.projects.length>0}},async created(){await this.fetchProjectList()},methods:{async fetchProjectList(){this.loading=!0;try{const t=await P.get(`/projectlist/lists/listid/${this.listId}`);if(t.data.status==="success"){this.listInfo=t.data.data;const i=k.user.value;if(this.isOwner=i&&i.id===this.listInfo.authorid,this.listInfo.authorid&&(this.authorInfo=await this.fetchUserInfo(this.listInfo.authorid)),this.listInfo.projects&&this.listInfo.projects.length>0){const h=[...new Set(this.listInfo.projects.map(u=>u.authorid))];await Promise.all(h.map(u=>this.fetchUserInfo(u)))}}else this.$toast.add({severity:"error",summary:"错误",detail:t.data.message||"获取列表失败",life:3e3})}catch(t){console.error("获取列表失败:",t),this.$toast.add({severity:"error",summary:"错误",detail:"获取列表失败",life:3e3})}finally{this.loading=!1}},async fetchUserInfo(t){if(this.userCache[t])return this.userCache[t];try{const i=await E(t);return this.userCache[t]=i,i}catch(i){return console.error(`获取用户 ${t} 信息失败:`,i),{id:t,username:`用户${t}`}}},getUserInfo(t){return this.userCache[t]||{id:t,username:`用户${t}`}},getAvatarUrl(t){return t?t.avatar?t.avatar:t.images?`https://zerocat-bitiful.houlangs.com/user/${t.images}`:"":""},openEditDialog(){this.editDialog=!0},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未知"}}},M={class:"d-flex align-center mb-2"},Q={class:"text-caption"},W={class:"d-flex flex-wrap"},X={class:"text-caption mr-4"},Y={class:"text-caption"};function Z(t,i,h,u,s,o){const p=C,D=x;return r(),l(R,null,{default:e(()=>[s.loading?(r(),l(f,{key:0},{default:e(()=>[a(m,{cols:"12",class:"text-center"},{default:e(()=>[a(v,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(r(),g(I,{key:1},[a(f,null,{default:e(()=>[a(m,{cols:"12"},{default:e(()=>[a(L,{class:"mb-4"},{default:e(()=>[a(T,{class:"d-flex align-center"},{default:e(()=>[n("span",null,c(s.listInfo.title||"未命名列表"),1),a(A,{class:"ml-2",color:s.listInfo.state==="public"?"success":"warning",size:"small"},{default:e(()=>[_(c(s.listInfo.state==="public"?"公开":"私密"),1)]),_:1},8,["color"]),a(O),s.isOwner?(r(),l(U,{key:0,icon:"mdi-pencil",variant:"text",size:"small",onClick:o.openEditDialog,color:"primary"},null,8,["onClick"])):y("",!0)]),_:1}),s.listInfo.description?(r(),l(b,{key:0},{default:e(()=>[_(c(s.listInfo.description),1)]),_:1})):y("",!0),a(B,null,{default:e(()=>[n("div",M,[a(N,{size:"24",class:"mr-2"},{default:e(()=>[a(S,{src:o.getAvatarUrl(s.authorInfo),alt:"用户头像"},null,8,["src"])]),_:1}),n("span",Q,c(s.authorInfo.username||s.authorInfo.display_name||"未知用户"),1)]),n("div",W,[n("span",X,"创建于: "+c(o.formatDate(s.listInfo.createTime)),1),n("span",Y,"更新于: "+c(o.formatDate(s.listInfo.updateTime)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),o.hasProjects?(r(),l(f,{key:1},{default:e(()=>[a(m,{cols:"12"},{default:e(()=>[i[2]||(i[2]=n("h3",{class:"text-h6 mb-4"},"项目列表",-1)),a(f,null,{default:e(()=>[(r(!0),g(I,null,z(s.listInfo.projects,d=>(r(),l(m,{key:d.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:e(()=>[a(p,{"project-data":d,"author-data":o.getUserInfo(d.authorid),"show-author":!0},null,8,["project-data","author-data"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):(r(),l(f,{key:0},{default:e(()=>[a(m,{cols:"12",class:"text-center"},{default:e(()=>[a(q,{type:"info",variant:"tonal"},{default:e(()=>i[1]||(i[1]=[_(" 此列表暂无项目 ")])),_:1})]),_:1})]),_:1}))],64)),a(F,{modelValue:s.editDialog,"onUpdate:modelValue":i[0]||(i[0]=d=>s.editDialog=d),"max-width":"600px"},{default:e(()=>[a(D,{listid:h.listId,callback:o.fetchProjectList,close:()=>s.editDialog=!1},null,8,["listid","callback","close"])]),_:1},8,["modelValue"])]),_:1})}const w=j(K,[["render",Z],["__scopeId","data-v-1f99f664"]]),G={components:{showProjectList:w},data(){return{listId:this.$route.params.id,listTitle:"项目列表"}},async mounted(){try{const t=await H(this.listId);t&&t.title&&(this.listTitle=t.title,this.updatePageTitle())}catch(t){console.error("获取列表信息失败:",t)}},methods:{updatePageTitle(){V({title:this.listTitle})}},setup(){V({title:"项目列表"})}};function J(t,i,h,u,s,o){const p=w;return r(),l(p,{listId:s.listId},null,8,["listId"])}const It=j(G,[["render",J]]);export{It as default};
